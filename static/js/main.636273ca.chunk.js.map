{"version":3,"sources":["config.ts","types/Amount.ts","types/DateString.ts","types/LiquidAssets/AccountBalance.ts","types/LiquidAssets/AccountStatement.ts","services/utils.ts","types/Ledger/LedgerAccount.ts","services/memoize.ts","types/Ledger/LedgerScheme.ts","types/Journal/EntryLeg.ts","types/Period.ts","types/VAT/VATRate.ts","types/VAT/VATHistory.ts","types/VAT/VATRates.ts","types/VAT/VATLine.ts","types/VAT/VATDeclaration.ts","types/VAT/VATDeclarationItem.ts","types/Journal/JournalEntry.ts","types/DataMapping.ts","types/Journal/Journal.ts","types/Allocation/LedgerAllocation.ts","types/Allocation/LedgerAllocationMap.ts","types/Accounting.ts","types/LiquidAssets/StatementEntry.ts","types/LiquidAssets/StatementEntryMap.ts","types/IBAN.ts","types/LiquidAssets/AccountStatementMap.ts","types/LiquidAssets/BankAccount.ts","types/LiquidAssets/LiquidAssets.ts","services/ValueProxy.ts","app/AccountingSlice.ts","routes/routes.ts","routes/RouteIcon.tsx","types/PeriodFilter.ts","types/VAT/VATDeclarationPeriod.ts","app/FilterSlice.ts","components/Selectors/PeriodFilter.tsx","pages/PageHeader.tsx","app/AgeSlice.ts","services/crypto.ts","services/stateIO.ts","types/BankImport/BankImportStatement.ts","types/BankImport/MT940ImportStatement.ts","components/Loader/FileLoader.tsx","components/Loader/MT940Loader.tsx","types/BankImport/CAMT053.ts","types/BankImport/CAMT053ImportStatement.ts","components/Loader/CAMT053Loader.tsx","components/Loader/BankImports.tsx","components/Loader/BizcuitImport.tsx","components/Loader/BizcuitLogo.png","components/Loader/VersionImports.tsx","components/Indicators/CSSSpinner.tsx","components/Loader/UploadLoadingProgress.tsx","components/Loader/ImportDialog.tsx","pages/UploadPage.tsx","components/Workers/index.ts","types/Environment.ts","services/URLState.ts","components/useURLState.ts","types/AllocationFilter.ts","components/Editors/useResponsiveStyling.ts","components/Selectors/ItemSelect.tsx","components/Selectors/PeriodSelect.tsx","components/Selectors/AccountSelect.tsx","components/Allocations/AllocationsHeader.tsx","components/ResponsiveTable/index.tsx","components/Editors/PeriodSelector.tsx","components/Utils/HighlightText.tsx","components/Editors/RGSAccountSelector.tsx","components/Editors/ReasonEditor.tsx","components/Utils/FormatAmount.tsx","components/Utils/FormatDate.tsx","components/Utils/CustomDialog.tsx","components/VAT/VATSelector.tsx","components/Editors/AmountEditor.tsx","components/Selectors/DateSelector.tsx","components/VAT/VATDialog.tsx","components/VAT/VATButton.tsx","components/VAT/VATMenuButton.tsx","components/Allocations/AllocationsTableRow.tsx","components/Allocations/AllocationsDataIndicator.tsx","components/Allocations/AllocationsView.tsx","components/Allocations/SimilarAllocations.tsx","components/Allocations/AllocationsTable.tsx","components/Allocations/StatementAllocations.tsx","pages/MapPage.tsx","types/AccountSummaryMap.ts","components/TrialBalance/Styling.ts","components/TrialBalance/BalanceTotals.tsx","components/TrialBalance/LayoutChoice.tsx","components/Utils/FormatPeriod.tsx","components/TrialBalance/BalanceDetails.tsx","components/TrialBalance/BalanceRow.tsx","components/Utils/FormatCategory.tsx","components/TrialBalance/CategoryHeader.tsx","components/TrialBalance/CategoryFooter.tsx","components/TrialBalance/TrialBalance.tsx","pages/TrialBalancePage.tsx","pages/HomePage.tsx","components/Utils/FormatIBAN.tsx","components/BankAccounts.tsx","pages/BankPage.tsx","components/Journals.tsx","pages/JournalPage.tsx","components/Selectors/TextSearch.tsx","components/Selectors/EnumSelect.tsx","components/Selectors/LevelSelector.tsx","components/Selectors/DebitCreditSelector.tsx","components/SearchTextButton.tsx","services/TreeView.ts","components/LedgerScheme.tsx","pages/LedgerPage.tsx","components/Menu/style.ts","app/store.ts","components/Menu/SaveDialog.tsx","components/Menu/AboutDialog.tsx","components/Utils/StyledMenu.tsx","components/Menu/MenuDropdown.tsx","components/Menu/MenuToolbar.tsx","components/Menu/logo-inversed.png","components/Menu/MenuDrawer.tsx","components/Menu/MenuAppBar.tsx","components/Charts/config.ts","components/Charts/index.ts","components/Charts/BankAccountChart.tsx","components/Charts/LiquidAssetsCharts.tsx","components/Charts/ExpenseRevenueChart.tsx","components/Charts/CounterpartiesCharts.tsx","components/Charts/ProfitLossCharts.tsx","components/Charts/AllocationsChart.tsx","pages/ChartsPage.tsx","types/Journal/JournalEditor.ts","pages/MemorialPage.tsx","components/Utils/StateSync.tsx","components/Utils/AppLoader.tsx","components/Utils/ErrorMessage.tsx","components/Utils/ErrorBoundary.tsx","components/VAT/VATPeriodSelector.tsx","components/VAT/FormatVATAmount.tsx","components/VAT/ManualEntryDialog.tsx","components/VAT/VATStyling.ts","components/VAT/VATManualEntry.tsx","components/VAT/VATCategoryDetails.tsx","components/VAT/VATDeclarationView.tsx","pages/VATPage.tsx","App.tsx","serviceWorker.ts","index.tsx","components/Workers/worker.ts","webpack:///./src/components/Workers/worker.ts?a5f8"],"names":["LEDGER_ACCOUNT","BALANCE_ACCOUNT","REVENUE_CATEGORY","PROFITLOSS_ACCOUNT","EXPENSE_CATEGORY","BANK_ACCOUNT","UNMAPPED_ACCOUNT","ACCRUED_EXPENSE","ACCRUED_REVENUE","VAT_TO_BE_CLAIMED","VAT_TO_BE_PAID","PAYMENT_DIFFERENCES","VAT_PRIVATE_USE","CreditDebit","LOCALE","APP","TITLE","KEY","VERSION","packageJson","version","BUILD","dateFormat","STATE","SOURCE","BIZCUIT_LINK_API","localPath","path","defaultAmountData","amount","currency","creditDebit","Credit","Amount","data","assert","this","amounts","concat","filter","isNull","reduce","other","value","add","Decimal","newAmount","toNumber","Math","abs","Debit","options","reversed","precision","isZero","formatOptions","minimumFractionDigits","maximumFractionDigits","formatValue","format","isDebit","Intl","NumberFormat","style","ISO_DATESTRING_LENGTH","length","DateString","dateString","ISODateString","Date","RangeError","day","month","year","toLocaleDateString","toISOString","substr","date","AccountBalance","amountData","AccountStatement","id","closingBalanceData","openingBalanceData","sortedArray","array","getKey","ascending","lt","gt","sort","v1","v2","s1","s2","range","from","to","Array","keys","map","v","removeDiacritics","s","normalize","replace","allOrSome","all","some","noneOrSome","join","LedgerAccount","ledgerAccount","code","indexOf","text","description","toLowerCase","includes","Object","values","String","Referentiecode","ReferentieOmslagcode","Nivo","Omschrijving","OmschrijvingKort","DC","toUpperCase","side","Sortering","Parents","LedgerScheme","getAccount","parents","level","isAllocatable","isBankAccount","isBalanceAccount","isRevenue","isExpense","account","sortKey","Referentienummer","Cache","clear","target","propertyKey","descriptor","Error","originalMethod","mainKey","args","apply","getClearCacheMethod","memoize","getCachedResultMethod","get","name","constructor","key","instance","has","WeakMap","set","useLocalJSON","fetchData","rgsData","connectToParents","storeLedgerScheme","json","fetch","URL","ledgerAccounts","result","accounts","searchText","includeParents","Set","forEach","matchText","parent","a","ledgerAccountMap","orphans","a1","a2","find","c","push","console","warn","acc","isEditable","DefaultBankAccountCode","allocatableAccounts","RGS_API_BASE_URL","EntryLeg","ledgerAccountCode","tag","Period","string","currentYear","getFullYear","min","max","n","Number","periods","period","VATRate","percentage","shortDescription","percentageString","NO_VAT","VAT_0","VAT_HIGH","VAT_LOW","VATHistory","VATRates","actual","isoDateString","fixedRates","rate","VATLine","vatRate","bruto","touched","_touched","vat","netto","setBruto","touch","newBruto","value2String","isNaN","brutoNetto","newVAT","newNetto","assign","reverseBrutoVATNetto","vatLines","lines","line","rates","vatLine","brutoVATNetto","toPositive","toNegative","toFixed","_vat","_netto","round","total","addVATLines","remaining","fromAmountCurrency","auto","getTotalRemaining","hasVAT","noVATLine","getSortedLines","untouch","l1","l2","VATDeclarationTag","getLines","details","detail","NO_VAT_CALCULATION","NO_FOREIGN_VAT_CALCULATION","EmptyVATSpecificationEntryData","reverseData","VATDeclaration","journal","manualVATs","Accounting","vatSpecificationEntryDatas","High","Low","PrivateUse","Paid","hasJournalEntry","journalEntry","getJournalEntry","declaredAmount","category","rateId","getManualId","endDate","manualId","isExpenseCategory","highVAT","lowVAT","paidVAT","journalEntries","vatDate","startDate","allocatedLeg","getVAT","isCredit","vatRateId","entry","manualEntry","privateUseVAT","rounded","getVATs","floor","undefined","totalHigh","totalLow","totalPrivateUse","totalPaid","totalDue","declaredVAT","getDeclaredVAT","rawVAT","leg","getLeg","declared","quarter","JournalEntry","sum","legs","vatSpecificationData","entryLegsData","splice","oppositeLeg","checkIntegrity","reason","_","i","vatRates","oppositeAccount","declaration","getJournalData","difference","Declared","fromDate","toString","DataMapping","type","items","hasItem","addItem","condition","entries","f","getValue","Journal","getItem","modify","entryData","distinctValues","periodFilter","journalEntryData","periodInRange","filterLeg","l","addItemIfNotExists","delItem","getItems","reverse","LedgerAllocation","childrenRefs","parentRef","allocationFilter","equals","getSplitId","statementEntryRef","statementEntry","journalEntryRef","removeChild","setVAT","child","_parent","element","index","arrayRemoveElement","accounting","allocations","getAllocation","valueDate","unsplitAllocation","hasChildren","splitAllocation","addChild","getAccrualsAccount","children","liquidAssets","getStatementEntry","LedgerAllocationMap","allocation","allocationData","mapped","unmapped","isUnmapped","fromEntries","parentData","bankAccount","statementEntries","statementEntryMap","hasParent","contains","fromStatementEntry","fromAllocation","remove","getStatementEntryMap","getSimilarEntries","getUnallocatedEntries","State","metaData","_CurrentState","accountingMetaData","statementsData","statementData","addBankImportStatement","addStatementEntries","ledgerAllocationsData","deleteJournalEntry","bankAccountData","ledgerAccountData","getBankAccount","updateStatementEntries","allocationsData","accountCode","dateData","datePeriod","setPeriod","journalData","LiquidAssets","liquidAssetsData","state","StatementEntry","relatedParties","trim","getAccountStatement","accountStatementRef","bookDate","remittanceInformation","StatementEntryMap","e","isSimilar","statementEntryData","dateInRange","totals","statement","statements","credit","debit","IBAN","props","short","EVERY_FOUR_CHARS","AccountStatementMap","accountStatementData","BankAccount","newStatement","newEntries","statementId","accountStatementMapData","entryId","statementEntryMapData","newEntry","accountStatements","filterOnPeriod","balances","balance","begin","end","beginBalance","endBalance","bankAccounts","getAccountStatementMap","bankAccountId","statementEntriesData","accountStatement","ValueProxy","_value","initialState","AccountingSlice","createSlice","reducers","resetAccountingState","invalidateAll","restoreAccountingState","action","payload","setMetaData","addStatements","invalidate","updateJournalEntry","linkBankAccount","ledgerAllocations","setReason","setLedgerAccount","setDate","actions","selectLiquidAssets","selectLedgerAllocations","selectJournal","selectMetaData","Routes","Upload","Bank","Ledger","Map","TrialBalance","Charts","VAT","Memorial","Edit","Home","route","icon","MenuBook","LibraryBooks","CallSplit","PlaylistAdd","CloudUpload","ShowChart","Domain","NoteOutlined","EditOutlined","RouteIcon","PeriodFilter","dataPeriods","first","last","lte","gte","fromPeriods","before","after","p","VATDeclarationPeriod","qDate","startOfQuarter","toDateString","endOfQuarter","split","periodFilterData","vatPeriodData","FilterSlice","resetFilterState","restoreFilterState","setPeriodFilter","setVATPeriod","vatPeriod","selectPeriodFilter","selectVATPeriod","fromId","useStyles","makeStyles","createStyles","mark","fontSize","root","width","ValueLabelComponent","PeriodFiltering","dispatch","useDispatch","classes","useSelector","distinctPeriods","withBuffer","fromTo","marks","option","label","className","aria-label","Typography","variant","Slider","onChange","event","newValue","newPeriodFilter","fromValues","limitTo","step","valueLabelDisplay","aria-labelledby","marginTop","marginLeft","textAlign","fontWeight","header","PageHeader","headerTitle","title","withName","Grid","container","spacing","direction","justify","alignItems","item","smDown","xs","mdUp","AgeSlice","age","restoreAgeState","resetAge","increaseAge","selectAge","encryptObject","obj","encrypt","content","AES","JSON","stringify","isJSONEncrypted","object","parse","Boolean","decryptJSON","decrypt","enc","Utf8","decryptToJSON","STORAGE_KEY","restoreStateFromJSON","restoreState","resetState","BankImportStatement","statementRef","ref","MT940ImportStatement","transactions","transaction","accountId","number","getAccountBalance","openingBalance","closingBalance","setTag","tagName","tagValueStart","tagValueEnd","tags","substring","match","tagsRe","RegExp","tagStart","exec","nextTag","nextTagName","nextTagStart","getDescriptionTags","FileLoader","hiddenFileInput","useRef","onFileSelected","preventDefault","fileList","files","file","reader","FileReader","onload","onLoad","onerror","onabort","readAsArrayBuffer","readAsText","readFiles","Button","onClick","current","click","color","multiple","accept","hidden","MT940Loader","mt940","then","mt940Statements","mt940Statement","_array","StmtNtry","ntry","NtryRef","Amt","Ccy","CdtDbtInd","BookgDt","ValDt","AddtlNtryInf","NtryDtls","ntryDtls","TxDtls","txDtls","RltdPties","rltdPties","Nm","RmtInf","rmtInf","Ustrd","func","ntryDtl","txDtl","joinedTxDtls","rltdPty","inf","BkToCstmrStmt","Id","Acct","Bal","Ntry","Othr","bal","Dt","Tp","CdOrPrtry","Cd","Prtry","CAMT053","jsonStatement","CAMT053ImportStatement","asCreditDebit","CAMT053Loader","xml","parseString","explicitArray","err","camt053","camt053Statement","bkToCstmrStmt","BankImports","BizcuitImport","useState","requestId","setRequestId","pincode","setPincode","success","setSuccess","loading","setLoading","open","setOpen","bizcuitRef","setBizcuitRef","useEffect","autoClose","cancelAutoClose","clearTimeout","response","url","setTimeout","log","getBizcuitRef","getTransactions","parameters","camt","cursor","src","alt","IconButton","size","KeyboardArrowDown","KeyboardArrowUp","disabled","window","TextField","autoComplete","inputProps","CircularProgress","Check","Dialpad","VersionImports","margin","Alert","severity","AlertTitle","CSSSpinner","UPLOAD_ERROR_MSG","PASSWORD_ERROR","UPLOAD_CANCELLED","isProgressError","progress","theme","backdrop","zIndex","drawer","LoadingProgress","okButton","React","createRef","entriesRead","onClose","anyErrors","Backdrop","component","ErrorOutline","ImportDialog","password","setPassword","handleClose","Dialog","fullWidth","maxWidth","DialogTitle","DialogContent","dividers","DialogContentText","noValidate","onSubmit","autoFocus","DialogActions","UploadPage","search","useLocation","bizcuit","URLSearchParams","setProgress","setEntriesRead","JSONResult","setJSONResult","history","useHistory","nStatements","nEntries","error","onRead","bizcuitImport","pathname","Worker","Environment","ledgerScheme","Data","queryStringOptions","arrayFormat","skipEmptyString","skipNull","URLState","location","load","urlState","newState","queryString","isArray","defaultValue","intValue","parseInt","useURLState","unregisterListener","setURLState","listen","save","AllocationFilter","periodId","useResponsiveStyling","useTheme","useMediaQuery","breakpoints","only","disableUnderline","ItemSelect","onItem","onXs","Select","newItem","displayEmpty","MenuItem","PeriodSelect","onPeriod","getPeriods","areEqual","prevProps","nextProps","memo","AccountSelect","onAccount","ledgerAccountFilter","getLedgerAccounts","AllocationsHeader","NonEmpty","Td","otherProps","Th","inputRoot","paddingTop","paddingBottom","down","PeriodSelectorWidth","PeriodSelector","selectOptions","getSelectablePeriods","Box","display","displayPrint","newPeriod","highlight","palette","dark","HighlightText","html","inputValue","regex","founds","found","replacement","highlightText","dangerouslySetInnerHTML","__html","AccountSelectorWidth","float","autocomplete","minWidth","getOptionLabel","RenderInput","params","InputProps","RGSAccountSelector","accountOptions","Autocomplete","autoHighlight","noOptionsText","openOnFocus","clearOnEscape","renderInput","renderOption","filterOptions","matchDescription","findIndex","ReasonEditor","textFieldProps","updateReason","onBlur","negativeAmount","FormatAmount","debitCredit","skipIfZero","whiteSpace","FormatDate","withStyles","padding","closeButton","position","right","top","grey","subTitle","disableTypography","MuiDialogContent","MuiDialogActions","VATSelector","onVAT","AmountEditor","DateSelector","isOpen","setIsOpen","invalidDateMessage","disableToolbar","autoOk","onDate","onOpen","keyboardIcon","Today","KeyboardButtonProps","invoiceDate","marginBottom","specificationBlock","specification","marginRight","tableRow","rowTitle","VATDialog","isReversed","reverseLines","autoCalc","setAutoCalc","setNetto","updateVATChoices","setVATLines","setRemaining","OKButtonRef","cancelChanges","confirmChanges","updateVATLines","onChangeValue","setter","onFinalValue","finalValue","onVATRateSelected","setVATRate","onQuickVAT","fullScreen","ClearAll","Delete","bind","sm","FormControlLabel","control","Switch","checked","primary","VATButton","PostAdd","VATMenuButton","vatDialog","setVATDialog","fromVATSpecificationData","childAllocationRow","AllocationsTableRow","updateLedgerAccount","updateVAT","updateDate","isMainAllocation","align","colSpan","vatSpecification","AllocationsDataIndicator","isLoading","noData","overflow","textOverflow","checkAll","checkBox","positiveAmount","AllocationsView","onChecked","mainAllocation","onSelect","Checkbox","every","isChecked","TableContainer","Paper","amountClassName","buttons","close","SimilarAllocations","similar","onSimilar","setChecked","handleOK","OKCancel","body","AllocationsTable","rows","setSimilar","ledgerAllocation","similarAllocations","getSimilarAllocations","hasAllocation","StatementAllocations","viewPort","setViewPort","setRows","getStringValue","useMemo","update","getAllocationRows","catch","hasMore","loader","pageStart","loadMore","MapPage","AccountSummaryMap","accountSummaryMap","summary","getAccountSummary","legAmount","bookings","creditAmount","debitAmount","updateBalance","creditBalance","debitBalance","summaryMap","getNewSummary","table","subDescription","paddingLeft","mainDescription","levelHeader","TrDivider","backgroundColor","height","childRow","openCloseButton","categoryHeader","categoryFooterTitle","fontStyle","categoryFooter","BalanceTotals","overallTotals","getTotalisation","LayoutType","LayoutLabel","TRIALSALDI","RESULTS","LayoutChoice","layoutType","onLayout","FormControl","FormLabel","RadioGroup","row","Radio","FormatPeriod","BalanceDetails","setEntries","allEntries","filterOnAccount","prevViewPort","Fragment","slice","BalanceRow","openAccountCodes","getStringArrayValue","newOpen","expandAccountCode","FormatCategory","CategoryHeader","CategoryFooter","DEFAULT_LAYOUT","setJournal","getAccounts","categories","md","layout","initialLoad","categoryAccounts","TrialBalancePage","filteredJournal","HomePage","setText","mdText","MarkdownIt","render","loadText","Container","iban","FormatIBAN","onSmDown","BankAccounts","onSm","accountBalances","getBalances","getTotals","BankPage","filteredAssets","headerRow","background","boxShadow","Journals","filteredEntries","editRef","editEntry","JournalPage","TextSearch","setSearchText","timer","setTimer","onSearch","Input","newSearchText","onKeyUp","placeholder","Clear","legend","EnumSelector","selectedValues","setValues","allValues","newValues","onValues","LevelSelector","allLevels","Levels","levels","EnumSelect","onLevels","CreditDebitSelector","allSides","Sides","sides","onSides","textTransform","lineHeight","SearchTextButton","TreeView","node","implicitlyOpen","reset","ids","isNodeOpen","parentId","AccountTreeViewNode","DEFAULT_LEVELS","DEFAULT_SIDES","LedgerViewer","searching","setSearching","searchedAccounts","setSearchedAccounts","filteredAccounts","setFilteredAccounts","viewPortAccounts","setViewPortAccounts","getNumericArrayValue","treeView","getMatchingAccounts","isNodeVisible","maxLevel","page","dcAlign","indent","textIndent","toggleOpenClose","onOpenClose","reverseCode","LedgerPage","drawerWidth","toolbarStyle","justifyContent","mixins","toolbar","updateAccounting","store","next","test","setAccountingState","updateAge","configureStore","reducer","accountingReducer","filterReducer","ageReducer","middleware","getDefaultMiddleware","getState","selectState","SaveDialog","defaultName","setName","rePassword","setRePassword","saveEnabled","AboutDialog","Link","href","rel","reload","StyledMenu","paper","border","elevation","getContentAnchorEl","anchorOrigin","vertical","horizontal","transformOrigin","StyledMenuItem","main","common","white","menuButton","MenuDropdown","anchorEl","setAnchorEl","saveDialog","setSaveDialog","aboutDialog","setAboutDialog","filename","saveState","blob","Blob","FileSaver","saveAs","saveStateToFile","aria-controls","aria-haspopup","currentTarget","Badge","badgeContent","keepMounted","ListItemIcon","ListItemText","Divider","print","Print","InfoOutlined","flexGrow","hide","logo","MenuToolbar","showMenus","setShowMenus","Toolbar","edge","clsx","flexShrink","drawerOpen","transition","transitions","create","easing","sharp","duration","enteringScreen","drawerClose","leavingScreen","overflowX","activeRoute","secondary","MenuDrawer","onRouteItem","routeItem","RouteListItem","ListItem","button","role","GoBackForward","back","goBack","goForward","ArrowBack","ArrowForward","hasData","routeItems","protectedItemIds","Drawer","enabled","appBar","appBarShift","MenuAppBar","CssBaseline","AppBar","ChartColor","qualitativeColors","warmGreen","warmRed","amountFormat","getQualitativeColor","getBarChartOptions","tooltips","displayColors","callbacks","tooltipItem","datasets","datasetIndex","yLabel","labels","boxWidth","scales","xAxes","yAxes","ticks","callback","splitData","BankAccountChart","chartData","setChartData","getBankAccountChartData","fill","lineTension","borderColor","pointBackgroundColor","pointRadius","pointHitRadius","getLineChartOptions","LiquidAssetsCharts","sliderRoot","rightLefButton","ExpenseRevenueChart","setData","getNumericValue","maxBarThickness","onRangeUpDown","maxRange","showSlider","ArrowLeft","track","ArrowRight","CounterpartiesCharts","getCounterPartiesData","expenseData","revenueData","ProfitLossCharts","getData","getProfitLossData","AllocationsChart","getMappedUnmapped","mappedAllocations","unmappedAllocations","perc","colors","hoverBackgroundColor","getAllocationsData","ChartsPage","EditorTemplates","rules","LegEditor","journalEditor","debitValue","creditValue","MANUAL_LEG","stringValue","numericValue","onLegAmount","legEditor","JournalEditor","_reason","_date","_period","_legs","addLeg","rule","lhs","rhs","evalRhs","Function","updateAmount","finalizeAmount","nonZeroLegs","entryLegData","fromEntryLeg","template","editor","headerGrid","footerGrid","templateSelector","MemorialPage","setJournalEntry","setTemplate","fromJournalEntry","updateData","clone","onCancel","templates","fromTemplate","updateAccount","removeLeg","canBeDeleted","isValid","StateSync","initialized","setInitialized","storage","setItem","saveStateToStorage","sessionStorage","restoreStateFromStorage","AppLoader","errorMsg","setState","styles","initialize","grid","minHeight","card","ErrorMessage","msg","Card","raised","onAcknowledge","startIcon","hasError","ErrorBoundary","errorInfo","message","Component","formControl","VATPeriodSelector","now","quarters","InputLabel","htmlFor","ListSubheader","FormatVATAmount","zeroData","ManualEntryDialog","setLine","showBrutoNetto","canSave","clearedLine","document","registrationStatus","registerVAT","up","categoryDetails","manualButton","VATManualEntry","dialog","setDialog","getVATRate","showNetto","onManual","VATCategoryDetails","VATDeclarationView","openDetailsKey","openDetails","setDeclaration","journalEntryId","isRegistered","getDeclarationDocument","setManualVAT","newDeclaration","itemIsDeclaredOK","DomainDisabled","onDetails","ExpandLess","ExpandMore","random","fromVATDeclaration","VATPage","App","requiresData","routes","defaultMaterialTheme","createMuiTheme","overrides","MuiInputBase","ThemeProvider","utils","DateFnsUtils","locale","nl","hostname","unstable_createMuiStrictModeTheme","unit","lg","xl","addEventListener","ev","confirm","returnValue","ReactDOM","StrictMode","getElementById","navigator","serviceWorker","ready","registration","unregister","inst","wrap","module","exports"],"mappings":"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","file":"static/js/main.636273ca.chunk.js","sourcesContent":["import dateFormat from \"dateformat\"\nimport packageJson from \"../package.json\"\nimport preval from \"preval.macro\"\n\nconst dateTimeStamp = preval`module.exports = new Date()`\n\nexport class LEDGER_ACCOUNT {\n    static readonly BALANCE_ACCOUNT = \"B\"\n    static readonly PROFITLOSS_ACCOUNT = \"W\"\n    static readonly REVENUE_CATEGORY = LEDGER_ACCOUNT.PROFITLOSS_ACCOUNT + \"+\"\n    static readonly EXPENSE_CATEGORY = LEDGER_ACCOUNT.PROFITLOSS_ACCOUNT + \"-\"\n    static readonly BANK_ACCOUNT = \"BLimBan\"\n    static readonly UNMAPPED_ACCOUNT = \"BXxx\"\n    static readonly ACCRUED_EXPENSE = \"BSchOpaNtb\"  // Expenses left to be paid\n    static readonly ACCRUED_REVENUE = \"BVorOvaNov\"  // Revenues left to be received\n    static readonly VAT_TO_BE_CLAIMED = \"BVorVbkTvo\"\n    static readonly VAT_TO_BE_PAID = \"BSchBepBtw\"\n    static readonly PAYMENT_DIFFERENCES = \"WBedAdlBet\"\n    static readonly VAT_PRIVATE_USE = \"WBedAutBop\"\n}\n\nexport const LOCALE = 'nl-NL'\nexport const DEFAULT_CURRENCY = 'EUR'\n\nexport const APP = {\n    TITLE: \"Boekhoud Source\",\n    KEY: \"BkhdSrc\",\n    VERSION: packageJson.version,\n    BUILD: dateFormat(dateTimeStamp, \"yyyy-mm-dd HH:MM\"),\n    STATE: \"Beta\",\n    SOURCE: \"https://github.com/Vegter/Boekhoud-Source\"\n}\n\nexport const RGS_API_BASE_URL = \"http://localhost:8000\"\nexport const BIZCUIT_LINK_API = \"https://bclink.herokuapp.com\"\n\nconst LOCAL_BASE_URL = `/Boekhoud-Source`\n\nexport function localPath(path: string) {\n    return `${LOCAL_BASE_URL}${path}`\n}\n","import assert from \"assert\"\nimport Decimal from \"decimal.js-light\"\nimport { AmountData } from \"../model\"\nimport { DEFAULT_CURRENCY, LOCALE } from \"../config\"\n\nexport enum CreditDebit {\n    Debit = -1,\n    Credit = 1\n}\n\nconst defaultAmountData = {\n    amount: 0,\n    currency: \"\",\n    creditDebit: CreditDebit.Credit\n}\n\ninterface FormatOptions {\n    reversed: boolean,\n    precision: number\n}\n\n/**\n * An amount specifies an amount of money, either debit or credit, in a specific currency\n *\n * Amounts are used in JournalEntries to record business transactions\n * Every business transaction is recorded in at least two places (double entry accounting)\n * The total of the debit and credit amounts in a JournalEntry is 0\n *\n * Amounts are treated as Decimals to prevent floating point rounding issues\n * Externally, amounts are represented as number\n */\nexport class Amount {\n    readonly data: AmountData\n\n    constructor(data?: AmountData) {\n        data = data ?? {...defaultAmountData}\n        assert(data.amount >= 0)\n        this.data = data\n    }\n\n    /**\n     * Creates an Amount from the given amount and currency\n     *\n     * The amount defaults to 0 and the currency to \"\"\n     */\n    static fromAmountCurrency(amount: number = 0, currency: string = \"\"): Amount {\n        return new Amount({\n            amount: Math.abs(amount),\n            currency,\n            creditDebit: amount < 0 ? CreditDebit.Debit : CreditDebit.Credit\n        })\n    }\n\n    /**\n     * Returns the plain amount\n     */\n    get amount(): number { return this.data.amount }\n\n    /**\n     * Returns the currency in which the amount is expressed\n     */\n    get currency(): string { return this.data.currency }\n\n    /**\n     * Returns the \"side\" of the amount; credit or debit\n     */\n    get creditDebit(): CreditDebit { return this.data.creditDebit }\n\n    /**\n     * Tells whether the amount is a debit amount\n     */\n    get isDebit() { return this.data.creditDebit === CreditDebit.Debit }\n\n    /**\n     * Tells whether the amount is a credit amount\n     */\n    get isCredit() { return ! this.isDebit }\n\n    /**\n     * Add a number of Amounts to the current amount and returns the result as a new Amount\n     *\n     * The original amount is not changed\n     */\n    add(amount: Amount, ...amounts: Amount[]): Amount {\n        const [value, currency] = [amount].concat(amounts)\n            .filter(amount => !amount.isNull())\n            .reduce(([value, currency], other) => {\n                assert(currency === defaultAmountData.currency || other.currency === currency)\n                value = value.add(other.value)\n                currency = other.currency\n                return [value, currency]\n        }, [new Decimal(this.value), this.currency] as [Decimal, string])\n        // Convert to Amount\n        const newAmount = value.toNumber()\n        return new Amount({\n            currency,\n            amount: Math.abs(newAmount),\n            creditDebit: newAmount < 0 ? CreditDebit.Debit : CreditDebit.Credit\n        })\n    }\n\n    /**\n     * Return a new reversed Amount for this amount\n     *\n     * The original amount is not changed\n     */\n    reversed(): Amount {\n        return new Amount({\n            ...this.data,\n            creditDebit: this.creditDebit === CreditDebit.Credit ? CreditDebit.Debit : CreditDebit.Credit\n        })\n    }\n\n    /**\n     * returns the value of the amount as a number\n     * A positive number for a credit amount, a negative number for a debit amount\n     */\n    get value(): number {\n        return this.amount * this.creditDebit\n    }\n\n    /**\n     * Tells whether the Amount is not set; ie just created with all default data\n     */\n    isNull(): boolean {\n        return this.amount === defaultAmountData.amount && this.currency === defaultAmountData.currency\n    }\n\n    /**\n     * Tells whether the amount is a zero amount\n     *\n     * A small margin is used to compensate for any rounding errors\n     */\n    isZero(): boolean {\n        const tolerance = 0.001\n        return this.amount <= tolerance\n    }\n\n    /**\n     * Returns the amount as a formatted string\n     *\n     * Example: {10, \"EUR\", debit} =>  -10.00\n     */\n    format(options: Partial<FormatOptions> = {}): string {\n        const { reversed, precision } = options\n        let value: number\n        if (this.isZero()) {\n            value = 0\n        } else {\n            value = this.value\n            if (reversed) {\n                value = -value\n            }\n        }\n\n        const formatOptions = {\n            minimumFractionDigits: precision,\n            maximumFractionDigits: precision\n        }\n\n        return Amount.formatValue(value, formatOptions, this.currency)\n    }\n\n    /**\n     * Format a numeric value using the default Locale in the given currency\n     */\n    static formatValue(value: number, options: {}, currency?: string) {\n        let formatter = new Intl.NumberFormat(LOCALE, {\n            style: 'currency',\n            currency: currency || DEFAULT_CURRENCY,\n            ...options\n        });\n        return formatter.format(value); /* $2,500.00 */\n    }\n\n    /**\n     * Returns a string presentation of the Amount\n     */\n    toString(): string {\n        return this.format()\n    }\n}\n","import { LOCALE } from \"../config\"\n\nconst ISO_DATESTRING_LENGTH = \"yyyy-mm-dd\".length\n\n/**\n * Date value\n */\nexport class DateString {\n    data: string\n\n    static ISODateString = (date: Date) => date.toISOString().substr(0, ISO_DATESTRING_LENGTH)\n\n    constructor(dateString?: string) {\n        // Expects an ISO Date, eg \"2015-03-25\" (The International Standard) or an empty string\n        let data: string | null = null\n        if (dateString) {\n            try {\n                if (dateString === DateString.ISODateString(new Date(dateString))) {\n                    data = dateString\n                }\n            } catch {}\n        } else {\n            data = DateString.ISODateString(new Date())\n        }\n\n        if (data === null) {\n            throw new RangeError()\n        }\n        this.data = data\n    }\n\n    /**\n     * Returns a key that can be used to sort on DateString value\n     *\n     * Older DateStrings have a lower sortKey that newer DateStrings\n     */\n    get sortKey(): string {\n        return this.Date.toISOString()\n    }\n\n    /**\n     * Constructs a new DateString from a Date object\n     */\n    static fromDate(date: Date): DateString {\n        return new DateString(this.ISODateString(date))\n    }\n\n    /**\n     * Returns the unique id of the DateString\n     */\n    get id(): string { return this.data }\n\n    /**\n     * Returns the Date representation of this DateString\n     * @constructor\n     */\n    get Date(): Date {\n        return new Date(this.data)\n    }\n\n    /**\n     * Returns the string value of this DateString\n     */\n    get string(): string {\n        return this.data\n    }\n\n    /**\n     * Returns the period of this DateString\n     */\n    get period(): string {\n        return this.year\n    }\n\n    /**\n     * Returns the year part of this DateString\n     */\n    get year(): string {\n        return this.data.substr(0, 4)\n    }\n\n    /**\n     * Returns the mont part of this DateString\n     */\n    get month(): string {\n        return this.data.substr(5, 2)\n    }\n\n    /**\n     * Returns a formatted representation of this DateString\n     */\n    format(options?:  Intl.DateTimeFormatOptions): string {\n        options = options || {\n            day: '2-digit',\n            month: '2-digit',\n            year: '2-digit'\n        }\n        return this.Date.toLocaleDateString(LOCALE, options)\n    }\n\n    /**\n     * Converts this DateString to a string value\n     */\n    toString(): string {\n        return this.format()\n    }\n}","import { Amount } from \"../Amount\"\nimport { AccountBalanceData } from \"../../model\"\nimport { DateString } from \"../DateString\"\n\n/**\n * The account balance is the amount of money present at a given moment\n */\nexport class AccountBalance {\n    constructor(readonly data: AccountBalanceData = {\n        date: \"\",\n        amountData: new Amount().data\n    }) {}\n\n    /**\n     * Returns the amount of money\n     */\n    get amount(): Amount { return new Amount(this.data.amountData)}\n\n    /**\n     * Returns the date for which the balance is valid\n     */\n    get date(): DateString { return new DateString(this.data.date) }\n}","import { AccountStatementData } from \"../../model\"\nimport { AccountBalance } from \"./AccountBalance\"\n\n/**\n * An account statement is a periodic summary of account activity with a beginning date and an ending date\n */\nexport class AccountStatement {\n    constructor(readonly data: AccountStatementData) {}\n\n    /**\n     * The unique identification of the accountStatement\n     */\n    get id() {\n        return this.data.id\n    }\n\n    /**\n     * The amount of money present at the end date of the accountStatement\n     */\n    get closingBalance() {\n        return new AccountBalance(this.data.closingBalanceData)\n    }\n\n    /**\n     * The amount of money present at the begin date of the accountStatement\n     */\n    get openingBalance() {\n        return new AccountBalance(this.data.openingBalanceData)\n    }\n}\n","import assert from \"assert\"\n\n/**\n * Highlight inputValue in text\n * If the given value is found in the text, the value will be changed like:\n * <span class=className>text</span>\n */\nexport function highlight(inputValue: string, text: string, className: string) {\n    if (inputValue && inputValue.length >= 3) {\n        // Don't trigger on small strings\n        const regex = new RegExp(inputValue, \"gi\")\n        let founds = []\n        text = removeDiacritics(text)\n        let found = regex.exec(text)\n        while (found !== null) {\n            founds.push(found)\n            found = regex.exec(text)\n        }\n        for (let i of founds.map(f => f.index).reverse()) {\n            const replacement = text.substr(i, inputValue.length)\n            text = text.substr(0, i) +\n                `<span class=\"${className}\">${replacement}</span>` +\n                text.substr(i + replacement.length)\n        }\n    }\n    return text\n}\n\n/**\n * Capitalize a string\n * Example: capitalize(\"any string\") = \"Any string\"\n */\nexport const capitalize = (s: string) =>\n    s.charAt(0).toUpperCase() + s.slice(1).toLowerCase()\n\n/**\n * Sort an array on any attribute\n */\nexport function sortedArray<T>(array: T[], getKey: (item: T) => string, ascending: boolean = true) {\n    const [lt, gt] = ascending ? [-1, 1] : [1, -1]\n    array.sort((v1, v2) => {\n        const s1 = getKey(v1)\n        const s2 = getKey(v2)\n        return s1 < s2 ? lt : s1 > s2 ? gt : 0\n    })\n    return array\n}\n\n/**\n * Remove an element from an array, wrapper around array.splice\n */\nexport function arrayRemoveElement<T>(array: T[], element: T): T[] {\n    const index = array.indexOf(element)\n    if (index >= 0) {\n        array.splice(index, 1)\n    }\n    return array\n}\n\n/**\n * Returns a range of numbers, [from, to>\n * Example: range(5, 7) => [5, 6]\n */\nexport function range(from: number, to: number | null = null): number[] {\n    if (to === null) {\n        to = from\n        from = 0\n    }\n    assert(to >= from)\n    return Array.from(Array(to - from).keys()).map(v => from + v)\n}\n\n/**\n * Returns a string without diacritics\n * Example: removeDiacritics(\"accept\") => accepte\n */\nexport function removeDiacritics(s: string) {\n    return s\n        .normalize('NFD')\n        .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nexport function allOrSome<T>(all: T[], some: T[]) {\n    // If some has any elements return some else return all\n    return some.length > 0 ? some : all\n}\n\nexport function noneOrSome<T>(all: T[], some: T[]) {\n    // If some is equal to all then return [] else just return some\n    return some.sort().join(\"\") === all.sort().join(\"\") ? [] : some\n}\n","import { LedgerScheme } from \"./LedgerScheme\"\nimport { LedgerAccountData } from \"../../model\"\nimport { LEDGER_ACCOUNT } from \"../../config\"\nimport { removeDiacritics } from \"../../services/utils\"\nimport { CreditDebit } from \"../Amount\"\n\n/**\n * LedgerAccount\n *\n * A ledger account is used to record business transactions.\n */\nexport class LedgerAccount {\n\n    constructor(readonly data: LedgerAccountData) {}\n\n    /**\n     * A ledgerAccount is uniquely identified by its code\n     */\n    get code(): string { return this.data.Referentiecode }\n\n    /**\n     * A ledgerAccount is uniquely identified by its code\n     */\n    get reverseCode(): string { return this.data.ReferentieOmslagcode || \"\" }\n\n    /**\n     * A ledgerAccount has a level in the ledgerScheme hierarchy\n     */\n    get level(): number { return this.data.Nivo }\n\n    /**\n     * The description of the ledgerAccount\n     */\n    get description(): string { return this.data.Omschrijving }\n\n    /**\n     * A short description of the ledgerAccount\n     */\n    get shortDescription(): string { return this.data.OmschrijvingKort }\n\n    /**\n     * Tells whether the account is a debit (D) or credit (C) account\n     * The highest level accounts (Balance and ProfitLoss) do not have a side\n     */\n    get side(): string | undefined { return this.data.DC?.toUpperCase() }\n\n    get CreditDebit(): CreditDebit | undefined {\n        if (this.side) {\n            return this.side === \"D\" ? CreditDebit.Debit : CreditDebit.Credit\n        }\n        return undefined\n    }\n\n    /**\n     * A property of the ledgerAccount to sort ledgerAccounts\n     */\n    get sortKey(): string {\n        if (this.data.Sortering) {\n            return this.data.Sortering\n        } else {\n            switch(this.data.Referentiecode) {\n                case LEDGER_ACCOUNT.BALANCE_ACCOUNT: {\n                    return \"0\"\n                }\n                case LEDGER_ACCOUNT.PROFITLOSS_ACCOUNT: {\n                    return \"N\"\n                }\n            }\n        }\n        return this.data.Sortering\n    }\n\n    /**\n     * Tells whether the account is an account to book revenues\n     */\n    get isRevenue(): boolean { return this.data.Referentiecode[0] === 'W' && this.data.DC === \"C\" }\n\n    /**\n     * Tells whether the account is an account to book expenses\n     */\n    get isExpense(): boolean { return this.data.Referentiecode[0] === 'W' && this.data.DC === \"D\" }\n\n    /**\n     * An account is part of a hierarchy.\n     * The hierarchy is returned in a sorted list of ledgerAccounts, up to the highest level\n     */\n    get parents(): LedgerAccount[] {\n        return this.data.Parents.map(data => LedgerScheme.getAccount(data.Referentiecode))\n    }\n\n    /**\n     * Returns the parent LedgerAccount if a parent exists, else undefined\n     */\n    get parent(): LedgerAccount | null {\n        const parents = this.parents\n        return parents.length > 0 ? parents[0] : null\n    }\n\n    /**\n     * Tells whether the account can be used to allocate transactions\n     *\n     * Transactions are allocated to RGS level 4 accounts\n     * Initially transactions are allocated to the general unmapped ledgerAccount\n     */\n    get isAllocatable(): boolean { return this.level === 4 || this.code === UNMAPPED_ACCOUNT.code}\n\n    /**\n     * Tells whether the account is \"changeable\"\n     *\n     * A transaction that is allocated to a editable account\n     * can be allocated to another account\n     */\n    get isEditable(): boolean { return this.isAllocatable && !this.isBankAccount() }\n\n    /**\n     * Tells whether the account is a child of the given ledgerAccount\n     */\n    isChildOf(ledgerAccount: LedgerAccount): boolean {\n        return this.code.indexOf(ledgerAccount.code) === 0\n    }\n\n    /**\n     * Tells whether the account is an account that can be associated with a bankAccount\n     */\n    isBankAccount(): boolean {\n        return this.code.indexOf(LEDGER_ACCOUNT.BANK_ACCOUNT) === 0\n    }\n\n    /**\n     * Tells whether the account is balance account\n     * If not, the account is a expense- and revenues account\n     */\n    isBalanceAccount(): boolean {\n        return this.code.indexOf(LEDGER_ACCOUNT.BALANCE_ACCOUNT) === 0\n    }\n\n    get category(): string {\n        if (this.isBalanceAccount()) {\n             return LEDGER_ACCOUNT.BALANCE_ACCOUNT\n        } else if (this.isRevenue) {\n             return LEDGER_ACCOUNT.REVENUE_CATEGORY\n        } else if (this.isExpense) {\n             return LEDGER_ACCOUNT.EXPENSE_CATEGORY\n        } else {\n            return \"\"\n        }\n    }\n\n    /**\n     * Tells whether the account is an account that is yet unmapped\n     * Unmapped means that the account is not part of the regular ledgerScheme accounts\n     * Transactions that are booked on this account need still to be allocated\n     */\n    isUnmapped(): boolean {\n        return this.code === UNMAPPED_ACCOUNT.code\n    }\n\n    /**\n     * Tells whether the account is equal to an another account\n     */\n    public equals(other: LedgerAccount): boolean {\n        return other.code === this.code\n    }\n\n    /**\n     * Returns a method that can be used to sort a list of ledgerAccounts\n     */\n    static get sortKey() {\n        return (account: LedgerAccount) => account.sortKey\n    }\n\n    /**\n     * Tells whether the text matches the description of the ledgerAccount\n     * Any diacritics in the description are ignored\n     */\n    matchDescription(text: string) {\n        return removeDiacritics(this.description).toLowerCase().includes(text)\n    }\n\n    /**\n     * Tells whether any value of the ledgerAccount matched the given text\n     * Any diacritics in the ledgerAccount values are ignored\n     */\n    matchText(text: string) {\n        return removeDiacritics(Object.values(this.data)\n            .map(data => String(data))\n            .map(s => s.toLowerCase())\n            .join(\"\")\n            ).includes(text.toLowerCase())\n    }\n}\n\n/**\n * A special ledgerAccount that can be used to book transactions that still need to be\n * allocated to a ledgerScheme account\n */\nexport const UNMAPPED_ACCOUNT = new LedgerAccount({\n    Referentiecode: LEDGER_ACCOUNT.UNMAPPED_ACCOUNT,\n    ReferentieOmslagcode: null,\n    Sortering: \"0\",\n    Referentienummer: \"0\",\n    OmschrijvingKort: \"Nog te boeken\",\n    Omschrijving: \"Nog te boeken\",\n    DC: null,\n    Nivo: 2,\n    Parents: []\n})\n","/**\n * Caching decorators\n */\n\n/**\n * Hold any method or accessor result in a WeakMap\n *\n * The object references in the keys are held weakly,\n * meaning that they are a target of garbage collection (GC) if there is no other reference to the object anymore.\n */\nconst Cache: Record<string, Record<string, WeakMap<Object, any>>> = {}\n\n/**\n * Clears the cache for a specific class\n *\n * Method decorator\n */\nexport function clear() {\n    return function (target: object, propertyKey: string, descriptor: PropertyDescriptor) {\n        if (descriptor.value) {\n            descriptor.value = getClearCacheMethod(target, descriptor.value)\n        } else {\n            throw Error(\"Only put clear() decorator on method\")\n        }\n    }\n}\n\n/**\n * Memoize a method or accessor result\n *\n * Method or accessor decorator\n */\nexport function memoize() {\n    return function (target: object, propertyKey: string, descriptor: PropertyDescriptor) {\n        if (descriptor.value) {\n            descriptor.value = getCachedResultMethod(target, propertyKey, descriptor.value)\n        } else if (descriptor.get) {\n            descriptor.get = getCachedResultMethod(target, propertyKey, descriptor.get)\n        } else {\n            throw Error(\"Only put memoize() decorator on method or getter\")\n        }\n    }\n}\n\n/**\n * Returns a unique key to identify cached results\n */\nfunction mainKey(target: object) {\n    // target: Either the constructor function of the class for a static member\n    //         or the prototype of the class for an instance member\n\n    // @ts-ignore\n    if (target.name) {\n        // @ts-ignore\n        return `__CLASS__${target.name}`\n    } else {\n        return `__INSTANCE__${target.constructor.name}`\n    }\n}\n\n/**\n * Clears the cache for the specific class or instance\n */\nfunction getClearCacheMethod(target: object, originalMethod: (...args: any[]) => any) {\n    return function(...args: any[]) {\n        delete Cache[mainKey(target)]\n        // @ts-ignore\n        return originalMethod.apply(this, args)\n    }\n}\n\n/**\n * Returns a method that returns a cached result if available\n * If no cached result is available then the result of the original method is returned and saved in the cache\n */\nfunction getCachedResultMethod(target: object, propertyKey: string, originalMethod: (...args: any[]) => any) {\n    const key = mainKey(target)\n\n    return function(...args: any[]) {\n        // @ts-ignore\n        const instance = this\n\n        if (args.length > 0) {\n            throw Error(\"Only memoize methods without arguments\")\n        }\n        if (Cache[key] && Cache[key][propertyKey] && Cache[key][propertyKey].has(instance)) {\n            // Return cached result\n        } else {\n            // Execute the original method, save the result in the cache\n            Cache[key] = Cache[key] ?? {}\n            Cache[key][propertyKey] = Cache[key][propertyKey] ?? new WeakMap()\n            Cache[key][propertyKey].set(instance, originalMethod.apply(instance, args))\n        }\n        // Return the cached result\n        return Cache[key][propertyKey].get(instance)\n    }\n}\n","import assert from \"assert\"\n\nimport { LEDGER_ACCOUNT, RGS_API_BASE_URL } from \"../../config\"\nimport json from \"../../rgsBasis.json\"\n\nimport { LedgerAccount, UNMAPPED_ACCOUNT } from \"./LedgerAccount\"\nimport { LedgerAccountData } from \"../../model\"\nimport { Amount, CreditDebit } from \"../Amount\"\nimport { clear, memoize } from \"../../services/memoize\"\nimport { sortedArray } from \"../../services/utils\"\n\nexport type LedgerSchemeData = Record<string, LedgerAccount>\n\n/**\n * LedgerScheme\n *\n * the Reference Classification System of Financial Information (RCSFI) or in Dutch Referentie GrootboekSchema (RGS)\n * It contains all the ledgers which are required to report to the Dutch government\n * and most of the ledgers used for internal reporting\n *\n * The data is either received from an API or provided locally\n */\nexport abstract class LedgerScheme {\n\n    /**\n     * The address of the API to receive the RGS scheme\n     */\n    private static readonly URL = RGS_API_BASE_URL + \"/rgs?Basis\"\n\n    /**\n     * The actual LedgerScheme, a dictionary that maps a LedgerAccount id to a LedgerAccount\n     */\n    private static ledgerAccountMap: LedgerSchemeData = {}\n\n    /**\n     * Any orphans that have been identified while loading the data.\n     * Orphans are ledger accounts that have no parent ledger account in the ledger account scheme\n     */\n    public static orphans: LedgerAccount[] = []\n\n    /**\n     * The default account to book any bank statements\n     */\n    public static DefaultBankAccountCode = LEDGER_ACCOUNT.BANK_ACCOUNT\n\n    /**\n     * Loads the RGS data, either by using an API or by using locally stored data (useLocalJSON = true)\n     *\n     * Default behaviour is to use locally stored data\n     */\n    public static async load(useLocalJSON: boolean = true): Promise<void> {\n        // import summaryMap\n        let rgsData = await this.fetchData(useLocalJSON)\n\n        // Add unmapped account(s) as first accounts in the list\n        rgsData = [UNMAPPED_ACCOUNT.data].concat(rgsData)\n\n        // Connect each account to its parent\n        this.connectToParents(rgsData)\n\n        // Store ledger scheme\n        this.storeLedgerScheme(rgsData)\n    }\n\n    /**\n     * Returns the data of the ledgerScheme, being the ledgerAccountMap\n     */\n    public static get Data(): typeof LedgerScheme.ledgerAccountMap {\n        return this.ledgerAccountMap\n    }\n\n    /**\n     * Restore data from a saved ledgerAccountMap\n     *\n     * This method is \"Worker-safe\". The ledgerAccountMap is entirely restored from its data\n     */\n    public static set Data(data: typeof LedgerScheme.ledgerAccountMap) {\n        this.storeLedgerScheme(Object.values(data).map((v: LedgerAccount) => v.data))\n    }\n\n    /**\n     * Fetch the RGS data from an API or a local JSON file\n     */\n    private static async fetchData(useLocalJSON: boolean): Promise<LedgerAccountData[]> {\n        if (useLocalJSON && json) {\n            return json as LedgerAccountData[]\n        } else {\n            const data = await fetch(this.URL)\n            return await data.json() as LedgerAccountData[]\n        }\n    }\n\n    @memoize()\n    /**\n     * Returns an array with all account levels present in the LedgerScheme\n     */\n    static Levels(): number[] {\n        return Object.values(\n            this.ledgerAccounts.reduce((result, account) => {\n                result[account.level] = account.level\n                return result\n            }, {} as Record<number, number>))\n    }\n\n    @memoize()\n    /**\n     * Returns an array with all account sides (debit or credit) present in the LedgerScheme\n     */\n    static Sides(): string[] {\n        return Object.values(\n            this.ledgerAccounts.reduce((result, account) => {\n                if (account.side) {\n                    result[account.side] = account.side\n                }\n                return result\n            }, {} as Record<string, string>))\n    }\n\n    static getMatchingAccounts(accounts: LedgerAccount[], searchText: string, includeParents: boolean) {\n        const result = new Set<LedgerAccount>()\n        accounts.forEach(account => {\n            if (account.matchText(searchText)) {\n                result.add(account)\n                if (includeParents) {\n                    account.parents.forEach(parent => result.add(parent))\n                }\n            }\n        })\n        return sortedArray(Array.from(result), a => a.sortKey)\n    }\n\n    @clear()\n    /**\n     * Initialize the ledger scheme data from a list of ledgerAccount data\n     */\n    private static storeLedgerScheme(ledgerAccounts: LedgerAccountData[]): void {\n        this.ledgerAccountMap = ledgerAccounts.reduce((result, data) => {\n            const account = new LedgerAccount(data)\n            result[account.code] = account\n            return result\n        }, {} as typeof LedgerScheme.ledgerAccountMap)\n    }\n\n    @memoize()\n    /**\n     * Returns a list of all LedgerAccounts in the LedgerScheme\n     */\n    public static get ledgerAccounts(): LedgerAccount[] {\n        return sortedArray(Object.values(LedgerScheme.ledgerAccountMap), acc => acc.sortKey)\n    }\n\n    @memoize()\n    /**\n     * Returns a list of LedgerAccounts in the LedgerScheme that are valid to allocate expenses and revenues\n     */\n    public static get allocatableAccounts(): LedgerAccount[] {\n        return this.ledgerAccounts.filter(account => account.isEditable)\n    }\n\n    @memoize()\n    /**\n     * Returns a list of LedgerAccounts in the LedgerScheme that are valid as LedgerAccount for BankAccount transactions\n     */\n    public static get bankAccounts(): LedgerAccount[] {\n        return this.ledgerAccounts.filter(\n            account => account.code === LedgerScheme.DefaultBankAccountCode ||\n            (account.isAllocatable && account.isBankAccount())\n        )\n    }\n\n    @memoize()\n    /**\n     * Returns a list of LedgerAccounts in the LedgerScheme that are balance accounts\n     *\n     * Not being profitLoss accounts or bank accounts\n     */\n    public static get balanceAccounts(): LedgerAccount[] {\n        return this.allocatableAccounts\n            .filter(account => account.isBalanceAccount())\n            .filter(account => !account.isBankAccount())\n    }\n\n    /**\n     * Returns the LedgerAccount to book transactions that need still to be allocated\n     */\n    public static get unmapped(): LedgerAccount {\n        return this.getAccount(LEDGER_ACCOUNT.UNMAPPED_ACCOUNT)\n    }\n\n    /**\n     * Get the account to register accruals\n     *\n     * Based upon the amount (positive or negative) a revenue or expense accruals account is returned\n     */\n    public static getAccrualsAccount(amount: Amount): LedgerAccount {\n        if (amount.creditDebit === CreditDebit.Credit) {\n            return this.getAccount(LEDGER_ACCOUNT.ACCRUED_REVENUE)\n        } else {\n            return this.getAccount(LEDGER_ACCOUNT.ACCRUED_EXPENSE)\n        }\n    }\n\n    /**\n     * Get the LedgerAccount who's code is equal to the given code\n     */\n    public static getAccount(code: string): LedgerAccount {\n        assert(code in this.ledgerAccountMap)\n        return this.ledgerAccountMap[code]\n    }\n\n    /**\n     * Connect the given LedgerAccounts to their parents\n     *\n     * Any LedgerAccounts without parents are registered as orphans\n     */\n    private static connectToParents(accounts: LedgerAccountData[]): void {\n        this.orphans = []\n\n        // Sort accounts on level, ascending\n        accounts.sort((a1, a2) => a1.Nivo - a2.Nivo)\n\n        // Connect accounts to parents\n        for (let account of accounts) {\n            account.Parents = []\n            const parent = accounts.find(c =>\n                c.Nivo === (account.Nivo - 1) &&\n                account.Referentiecode.indexOf(c.Referentiecode) === 0\n            ) || null\n            if (parent === null) {\n                if (account.Nivo > 1) {\n                    // Level 1 is the lowest level, above this level a parent account is expected\n                    this.orphans.push(new LedgerAccount(account))\n                    console.warn(`Missing parent for ${account.Referentiecode}`)\n                }\n            } else {\n                account.Parents.push(parent)\n            }\n        }\n\n        // Determine full list of parents\n        accounts.forEach(account => {\n            const parent = account.Parents[0]\n            account.Parents = parent ? [parent].concat(parent.Parents) : []\n        })\n    }\n}","import { EntryLegData } from \"../../model\"\nimport { Amount } from \"../Amount\"\nimport { LedgerAccount } from \"../Ledger/LedgerAccount\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\n\n/**\n * EntryLeg\n * A leg (or side) of a JournalEntry\n */\nexport class EntryLeg {\n    constructor(readonly data: EntryLegData) {}\n\n    get amount(): Amount { return new Amount(this.data.amountData) }\n    get ledgerAccount(): LedgerAccount { return LedgerScheme.getAccount(this.data.ledgerAccountCode) }\n    get ledgerAccountCode(): string { return this.data.ledgerAccountCode }\n    get tag(): string { return this.data.tag || \"\"}\n\n    set ledgerAccount(ledgerAccount: LedgerAccount) {\n        this.data.ledgerAccountCode = ledgerAccount.code\n    }\n\n    /**\n     * Returns the reversed leg (DEBIT <-> CREDIT)\n     */\n    reversed() {\n        return new EntryLeg({\n            ...this.data,\n            amountData: this.amount.reversed().data\n        })\n    }\n}\n","import { DateString } from \"./DateString\"\nimport { range, sortedArray } from \"../services/utils\"\n\n/**\n * A Period\n *\n * Implemented as a string\n */\nexport class Period {\n    constructor(public data: string = \"\") {}\n\n    /**\n     * Convert a date to a period (year of the date)\n     */\n    static fromDate(date: DateString) {\n        return new Period(date.year)\n    }\n\n    /**\n     * Return a formatted presentation of the period\n     */\n    format(): string {\n        return this.string\n    }\n\n    /**\n     * Tells whether this period equals the given period\n     */\n    equals(other: Period): boolean { return this.data === other.data }\n\n    /**\n     * Tells whether this period is less than or equal than the given period\n     */\n    lte(other: Period): boolean { return this.data <= other.data }\n\n    /**\n     * Tells whether this period is greater than or equal than the given period\n     */\n    gte(other: Period): boolean { return this.data >= other.data }\n\n    /**\n     * Returns the unique id of this period\n     */\n    get id(): string { return this.data }\n\n    /**\n     * Returns the period as a string\n     */\n    get string(): string { return this.data }\n\n    /**\n     * Returns the period as a number\n     */\n    get value(): number { return Number(this.data) }\n\n    /**\n     * Returns the period before this period\n     */\n    get before(): Period {\n        return new Period(String(this.value - 1))\n    }\n\n    /**\n     * Returns the period after this period\n     */\n    get after(): Period {\n        return new Period(String(this.value + 1))\n    }\n\n    /**\n     * Converts the period to a string value\n     */\n    toString(): string {\n        return this.format()\n    }\n\n    /**\n     * Given this period, return a list of periods to choose from\n     *\n     * This can be used in a dropdown to choose another period value\n     */\n    getSelectablePeriods(): Period[] {\n        const NPeriodsUpDown = 5\n        const currentYear = new Date().getFullYear()\n        const [from, to] = [\n            Math.min(this.value, currentYear) - NPeriodsUpDown,\n            Math.max(this.value, currentYear) + NPeriodsUpDown]\n        return range(from, to + 1).map(n => new Period(String(n)))\n    }\n\n    /**\n     * returns a sorted array (ascending) of the given array of periods\n     */\n    static sort(periods: Period[]) {\n        return sortedArray(periods, period => period.string)\n    }\n\n    /**\n     * Returns the minimum period in the given array of periods\n     */\n    static min(...periods: Period[]): Period {\n        const min = Math.min(...periods.map(period => period.value))\n        return periods.find(period => period.value === min) || new Period()\n    }\n\n    /**\n     * Returns the maximum period in the given array of periods\n     */\n    static max(...periods: Period[]): Period {\n        const max = Math.max(...periods.map(period => period.value))\n        return periods.find(period => period.value === max) || new Period()\n    }\n}\n","const NO_VAT_ID = \"\"\nconst VAT_0_ID = \"Vrijgesteld\"\n\nexport class VATRate {\n    constructor(public id: string, public percentage: number) {}\n\n    get percentageString(): string {\n        return `${this.percentage * 100}%`\n    }\n\n    get shortDescription() {\n        if (this.id === NO_VAT_ID) {\n            return \"Geen BTW\"\n        } else {\n            return `BTW ${this.id} ${this.percentageString}`\n        }\n    }\n\n    toString() {\n        return this.shortDescription\n    }\n}\n\nexport const NO_VAT = new VATRate(NO_VAT_ID, 0)\nexport const VAT_0 = new VATRate(VAT_0_ID, 0)\n","import { VATRate } from \"./VATRate\"\n\nexport const VAT_HIGH = \"Hoog\"\nexport const VAT_LOW = \"Laag\"\n\nexport const VATHistory: Record<string, VATRate[]> = {\n    \"2019-01-01\": [\n        new VATRate(VAT_HIGH, 0.21),\n        new VATRate(VAT_LOW, 0.09)\n    ],\n    \"2012-10-01\": [\n        new VATRate(VAT_HIGH, 0.21),\n        new VATRate(VAT_LOW, 0.06)\n    ],\n}","import { VATHistory } from \"./VATHistory\"\nimport { NO_VAT, VAT_0, VATRate } from \"./VATRate\"\n\nexport type VATRatesMap = Record<string, VATRate>\n\nexport class VATRates {\n\n    constructor(public date: Date) {}\n\n    get rates(): VATRatesMap {\n        const actual = Object.keys(VATHistory).find(isoDateString => {\n            return this.date >= new Date(isoDateString)\n        })\n\n        const fixedRates = [\n            VAT_0,\n            NO_VAT\n        ]\n\n        const rates = actual ? VATHistory[actual] : []\n        return rates.concat(fixedRates).reduce((result, rate) => {\n            result[rate.id] = rate\n            return result\n        }, {} as VATRatesMap)\n    }\n}\n","import { NO_VAT, VATRate } from \"./VATRate\"\nimport { VATSpecificationData, VATSpecificationEntryData } from \"../../model\"\nimport { VATRates } from \"./VATRates\"\nimport { Amount } from \"../Amount\"\nimport assert from \"assert\"\n\ninterface BrutoNetto {\n    netto: string\n    vat: string\n    bruto: string\n}\n\n/**\n * VAT line\n *\n * A VAT line holds the VAT information of a journal entry\n */\nexport class VATLine {\n    private static _touched = 0             // last modified indictor\n\n    touched: number = VATLine._touched      // last modified indicator for an instance\n\n    bruto: string = \"\"\n    vat: string = \"\"\n    netto: string = \"\"\n\n    constructor(public vatRate: VATRate | null = null, bruto?: number) {\n        if (bruto) {\n            this.setBruto(bruto)\n        }\n    }\n\n    /**\n     * Create a VAT Line from a VAT Specification (saved with the journal entry data\n     */\n    static fromVATSpecificationData (data: VATSpecificationData): VATLine[] {\n        const date = new Date(data.date)\n\n        const vatLines:VATLine[] = []\n        data.lines.forEach(line => {\n            const vatRates = new VATRates(date).rates\n            const vatRate = vatRates[line.id]\n            if (vatRate) {\n                const vatLine = new VATLine(vatRate)\n                const { bruto, vat, netto } = line\n                vatLine.bruto = bruto\n                vatLine.vat = vat\n                vatLine.netto = netto\n                vatLines.push(vatLine)\n            }\n        })\n\n        return vatLines\n    }\n\n    /**\n     * Get the VAT data to store with the journal entry\n     */\n    get data() : VATSpecificationEntryData {\n        const { bruto, vat, netto } = this\n        const id = this.vatRate ? this.vatRate.id : \"\"\n        return { id, bruto, vat, netto }\n    }\n\n    /**\n     * Return a reversed copy of the given bruto-vat-netto calculation\n     */\n    static reverseBrutoVATNetto(brutoVATNetto: {bruto: string, vat: string, netto: string}) {\n        const toPositive = (value: string) => value.replace(\"-\", \"\")\n        const toNegative = (value: string) => +value ? `-${value}` : value\n\n        let { bruto, vat, netto } = brutoVATNetto\n\n        if (+bruto <= 0) {\n            bruto = toPositive(bruto)\n            vat = toPositive(vat)\n            netto = toPositive(netto)\n        } else {\n            bruto = toNegative(bruto)\n            vat = toNegative(vat)\n            netto = toNegative(netto)\n        }\n        return { bruto, vat, netto }\n    }\n\n    /**\n     * Reverse a VAT line, positive amounts become negative and vice versa\n     */\n    get reversed(): VATLine {\n        const reversed = new VATLine()\n        Object.assign(reversed, this)\n\n        const { bruto, vat, netto } = VATLine.reverseBrutoVATNetto({\n            bruto: this.bruto,\n            vat: this.vat,\n            netto: this.netto\n        })\n\n        reversed.bruto = bruto\n        reversed.vat = vat\n        reversed.netto = netto\n\n        return reversed\n    }\n\n    /**\n     * Tells whether the VAT Line has a VAT (not being NO_VAT)\n     */\n    get hasVAT() : boolean {\n        return this.vatRate\n            ? this.vatRate.id !== NO_VAT.id\n            : false\n    }\n\n    /**\n     * Returns the VAT percentage of this line\n     */\n    get percentage(): number {\n        return this.vatRate ? this.vatRate.percentage : 0\n    }\n\n    /**\n     * Register that this line has been modified (touched)\n     *\n     * touch numbers are comparable between VAT lines to tell the last or most recently modified line\n     */\n    touch() {\n        VATLine._touched += 1\n        this.touched = VATLine._touched\n    }\n\n    /**\n     * Set the touched number back to an earlier saved number\n     */\n    untouch(touched: number) {\n        this.touched = touched\n    }\n\n    /**\n     * Set a VAT Rate for this line\n     */\n    setVATRate(vatRate: VATRate | null, bruto: string | number) {\n        if (this.vatRate === vatRate) return\n\n        this.touch()\n        this.vatRate = vatRate\n        if (vatRate) {\n            /* (Re-)calc */\n            this.bruto = \"\"\n        }\n        this.setBruto(bruto)\n    }\n\n    /**\n     * Set the bruto value for this line and derive vat and netto value\n     */\n    setBruto(bruto: string | number) {\n        const newBruto = VATLine.value2String(bruto)\n        if (newBruto === this.bruto) return\n\n        this.touch()\n        bruto = newBruto\n        if (isNaN(+bruto)) {\n            this.vat = \"\"\n            this.netto = \"\"\n        } else {\n            const { vat, netto } = VATLine.brutoNetto({bruto}, this.percentage)\n            this.vat = vat\n            this.netto = netto\n        }\n        this.bruto = bruto\n    }\n\n    /**\n     * Set the VAT value for this line and derive bruto and netto value\n     */\n    setVAT(vat: string | number) {\n        const newVAT = VATLine.value2String(vat)\n        if (newVAT === this.vat) return\n\n        this.touch()\n        vat = newVAT\n        if (isNaN(+vat)) {\n            this.bruto = \"\"\n            this.netto = \"\"\n        } else {\n            const { bruto, netto } = VATLine.brutoNetto({vat}, this.percentage)\n            this.bruto = bruto\n            this.netto = netto\n        }\n        this.vat = vat\n    }\n\n    /**\n     * Set the netto value for this line and derive bruto and netto value\n     */\n    setNetto(netto: string | number) {\n        const newNetto = VATLine.value2String(netto)\n        if (newNetto === this.netto) return\n\n        this.touch()\n        netto = newNetto\n        if (isNaN(+netto)) {\n            this.bruto = \"\"\n            this.vat = \"\"\n        } else {\n            const { bruto, vat } = VATLine.brutoNetto({netto}, this.percentage)\n            this.bruto = bruto\n            this.vat = vat\n        }\n        this.netto = netto\n    }\n\n    /**\n     * Converts a numeric value to a 2-decimal string representation\n     */\n    static value2String(value: string | number): string {\n        if (typeof value === \"number\") {\n            return value.toFixed(2)\n        }\n        return value\n    }\n\n    /**\n     * Calculates netto, bruto, and VAT given a single netto, bruto, and VAT value\n     */\n    static brutoNetto(brutoNetto: Partial<BrutoNetto>, percentage: number): BrutoNetto {\n        let { bruto, vat, netto } = brutoNetto\n\n        assert(Object.keys(brutoNetto).length === 1, \"Only one known value is expected\")\n\n        if (netto) {\n            const _vat = +netto * percentage\n            vat = this.value2String(_vat)\n            bruto = this.value2String(+netto + _vat)\n        } else if (vat) {\n            const _netto = percentage === 0 ? 0 : +vat / percentage\n            netto = this.value2String(_netto)\n            bruto = this.value2String(_netto + +vat)\n        } else if (bruto) {\n            const _netto = +bruto / (1 + percentage)\n            netto = this.value2String(_netto)\n            vat = this.value2String(+bruto - +netto)\n        } else {\n            return {\n                netto: \"\",\n                vat: \"\",\n                bruto: \"\"\n            }\n        }\n\n        return {\n            netto,\n            vat,\n            bruto\n        }\n    }\n\n    /**\n     * Add the VAT lines to a total bruto, VAT and netto value\n     */\n    static addVATLines(lines: VATSpecificationEntryData[], round?: (n: number) => number) {\n        let bruto = 0\n        let vat = 0\n        let netto = 0\n        lines.forEach(line => {\n            bruto += isNaN(+line.bruto) ? 0 : +line.bruto\n            vat += isNaN(+line.vat) ? 0 : +line.vat\n            netto += isNaN(+line.netto) ? 0 : +line.netto\n        })\n        if (round) {\n            bruto = round(bruto)\n            vat = round(vat)\n            netto = round(netto)\n        }\n        return { bruto, vat, netto }\n    }\n\n    /**\n     * Reverse a collection to VAT lines\n     */\n    static reverseLines(lines: VATLine[]) {\n        return lines.map(line => line.reversed)\n    }\n\n    /**\n     * Return the total and remaining value given a collection of VAT lines and a bruto total value\n     */\n    static getTotalRemaining(lines: VATLine[], bruto: number) {\n        const total = VATLine.addVATLines(lines.map(line => line.data))\n        let remaining = bruto - total.bruto\n        if (Amount.fromAmountCurrency(remaining).isZero()) {\n            remaining = 0\n        }\n        return {total, remaining}\n    }\n\n    /**\n     * Auto-populate a collection of VAT lines to match the desired bruto value\n     * If bruto is null, no auto-population is performed\n     */\n    static updateVATChoices(lines: VATLine[], bruto: number, auto: boolean) {\n        lines = lines.filter(line => line.vatRate)\n\n        if (lines.length && auto) {\n            let {remaining} = this.getTotalRemaining(lines, bruto)\n\n            if (remaining !== 0) {\n                // Allocate any remaining quantity to the oldest lines\n                // A correction can not result in a negative line or a line with a value that exceeds bruto\n\n                if (lines.length === 1 && remaining !== 0 && lines[0].hasVAT) {\n                    // Auto-add no-VAT line to compensate\n                    const noVATLine = new VATLine(NO_VAT, remaining)\n                    lines.push(noVATLine)\n                } else {\n                    // Adjust oldest line to compensate\n                    const sortedLines = VATLine.getSortedLines(lines)\n                    sortedLines.forEach(line => {\n                        if (remaining !== 0) {\n                            // Example: value = 25, remaining = -50\n                            // New bruto is max(0, 25 - 50 = -25) = 0\n                            // Remaining is -50 + (25 - 0)\n                            const bruto = +line.bruto + remaining\n                            remaining += +line.bruto - bruto\n                            // Auto-adjust does no count as touched (no-user initiated adjustment)\n                            const touched = line.touched\n                            line.setBruto(bruto)\n                            line.untouch(touched)\n                        }\n                    })\n                }\n            }\n        }\n\n        if (lines.length === 0) {\n            lines.push(new VATLine(NO_VAT, bruto))\n        } else {\n            lines.push(new VATLine())\n        }\n\n        return lines\n    }\n\n    /**\n     * Sorts a collection of VAT lines on last modified (touched)\n     *\n     * The last modified VAT line will be the first line\n     */\n    static getSortedLines(lines: VATLine[]) {\n        return [...lines].sort((l1, l2) => l1.touched - l2.touched)\n    }\n}\n","import { Journal } from \"../Journal/Journal\"\nimport { VAT_HIGH, VAT_LOW } from \"./VATHistory\"\nimport { VATLine } from \"./VATLine\"\nimport { VATSpecificationEntryData } from \"../../model\"\nimport assert from \"assert\"\nimport { VATDeclarationPeriod } from \"./VATDeclarationPeriod\"\nimport {\n    getLines,\n    NO_FOREIGN_VAT_CALCULATION,\n    NO_VAT_CALCULATION,\n    VATDeclarationItemDetails\n} from \"./VATDeclarationItem\"\nimport { NO_VAT, VATRate } from \"./VATRate\"\nimport { VATRates } from \"./VATRates\"\nimport { JournalEntry } from \"../Journal/JournalEntry\"\nimport { Accounting } from \"../Accounting\"\n\n/**\n * Template for an empt manual VAT specification entry\n */\nconst EmptyVATSpecificationEntryData = {\n    id: \"\",\n    bruto: \"0\",\n    vat: \"0\",\n    netto: \"0\",\n}\n\n/**\n * Reverse the bruto-vat-netto amounts in a VAT specification entry\n */\nexport function reverseData(data: VATSpecificationEntryData): VATSpecificationEntryData {\n    const reversed = VATLine.reverseBrutoVATNetto({\n        bruto: data.bruto,\n        vat: data.vat,\n        netto: data.netto\n    })\n    return {...data, ...reversed}\n}\n\n/**\n * Definition of the VAT declaration categories that are calculated or entered manually in the VAT declaration\n */\nexport enum VATDeclarationTag {\n    High = \"Hoog\",\n    Low = \"Laag\",\n    PrivateUse = \"Prive gebruik\",\n    Paid = \"Betaald\",\n    Declared = \"Aangifte bedrag\"\n}\n\n/**\n * Definition of the VAT declaration categories that allow for a manual entry\n */\nexport type ManualId = VATDeclarationTag.High |\n    VATDeclarationTag.Low |\n    VATDeclarationTag.PrivateUse |\n    VATDeclarationTag.Paid\n\n/**\n * VAT Declaration\n *\n * Generates and holds a VAT Declaration for the given journal in the given declaration period\n */\nexport class VATDeclaration {\n    public currency: string = Accounting.currency\n    public vatSpecificationEntryDatas: VATSpecificationEntryData[]\n    public readonly manualVATs: Record<ManualId, VATSpecificationEntryData> = {\n        [VATDeclarationTag.High]: {...EmptyVATSpecificationEntryData},\n        [VATDeclarationTag.Low]: {...EmptyVATSpecificationEntryData},\n        [VATDeclarationTag.PrivateUse]: {...EmptyVATSpecificationEntryData},\n        [VATDeclarationTag.Paid]: {...EmptyVATSpecificationEntryData},\n    }\n\n    constructor(public readonly journal: Journal,\n                public readonly period: VATDeclarationPeriod,\n                manualVATs?: Record<ManualId, VATSpecificationEntryData>) {\n        this.vatSpecificationEntryDatas = []\n        if (manualVATs) {\n            // Explicit definition of manual VAT entries\n            this.manualVATs = manualVATs\n        } else if (journal.hasJournalEntry(this.id)) {\n            // Adjust the manual VAT specification for the amount that has been declared in any previous session\n            const journalEntry = journal.getJournalEntry(this.id)\n            this.manualVATs[VATDeclarationTag.PrivateUse].vat =\n                (-1 * this.declaredAmount(journalEntry, VATDeclarationTag.PrivateUse)).toFixed(2)\n        }\n    }\n\n    /**\n     * Returns the VAT Rate for the given VAT category\n     */\n    getVATRate(category: string): VATRate {\n        const rateIds: Record<ManualId, string> = {\n            [VATDeclarationTag.High]: VAT_HIGH,\n            [VATDeclarationTag.Low]: VAT_LOW,\n            [VATDeclarationTag.PrivateUse]: NO_VAT.id,\n            [VATDeclarationTag.Paid]: NO_VAT.id,\n        };\n        const manualId = VATDeclaration.getManualId(category)\n        const rateId = rateIds[manualId] || NO_VAT.id\n        const rates = new VATRates(this.period.endDate)\n        return rates.rates[rateId]\n    }\n\n    /**\n     * Unique identification of this declaration\n     */\n    get id() {\n        const { year, quarter } = this.period\n        return `BTW Aangifte ${year} kwartaal ${quarter}`\n    }\n\n    /**\n     * Tells whether this given category is a VAT expense (VAT paid) category\n     */\n    static isExpenseCategory(category: string): boolean {\n        const manualId = VATDeclaration.getManualId(category)\n        return manualId === VATDeclarationTag.Paid\n    }\n\n    /**\n     * Returns the VAT declaration category for the given VAT category\n     *\n     * Example: 1a Leveringen/diensten belast algemeen tarief => VATDeclarationTag.High\n     */\n    static getManualId(category: string): ManualId {\n        const mapping: Record<string, ManualId> = {\n            \"1a\": VATDeclarationTag.High,\n            \"1b\": VATDeclarationTag.Low,\n            \"1d\": VATDeclarationTag.PrivateUse,\n            \"5b\": VATDeclarationTag.Paid\n        }\n        return mapping[category.substr(0, 2)]\n    }\n\n    /**\n     * Register a manual VAT entry for the given category\n     */\n    setManualVAT(category: string, data: VATSpecificationEntryData) {\n        const manualId = VATDeclaration.getManualId(category)\n        if (VATDeclaration.isExpenseCategory(category)) {\n            data = reverseData(data)\n        }\n        this.manualVATs[manualId] = data\n    }\n\n    /**\n     * Get the VAT declaration items for the VAT Categories High VAT, Low VAT and Paid VAT\n     */\n    private getVATs() {\n        const highVAT: VATDeclarationItemDetails[] = []\n        const lowVAT: VATDeclarationItemDetails[] = []\n        const paidVAT: VATDeclarationItemDetails[] = []\n\n        this.journal.journalEntries\n            .filter(journalEntry => journalEntry.vatDate &&\n                this.period.startDate <= journalEntry.vatDate && journalEntry.vatDate <= this.period.endDate)\n            .forEach(journalEntry => {\n                // Single currency VAT declaration\n                assert(!this.currency || this.currency === journalEntry.allocatedLeg.amount.currency)\n                const vat = journalEntry.getVAT()!\n                this.currency = journalEntry.allocatedLeg.amount.currency\n\n                if (journalEntry.allocatedLeg.amount.isCredit) {\n                    [VAT_HIGH, VAT_LOW].forEach(vatRateId => {\n                        const vatLines = vat.lines.filter(line => line.id === vatRateId)\n                        if (vatLines.length) {\n                            const entry = {journalEntry, vatLines}\n                            vatRateId === VAT_HIGH ? highVAT.push(entry) : lowVAT.push(entry)\n                        }\n                    })\n                } else {\n                    paidVAT.push({journalEntry, vatLines: vat.lines})\n                }\n            })\n\n        const manualEntry = (id: ManualId) => ({\n            vatLines: [this.manualVATs[id]]\n        })\n\n        return {\n            highVAT: highVAT.concat(manualEntry(VATDeclarationTag.High)),\n            lowVAT: lowVAT.concat(manualEntry(VATDeclarationTag.Low)),\n            paidVAT: paidVAT.concat(manualEntry(VATDeclarationTag.Paid)),\n            privateUseVAT: [manualEntry(VATDeclarationTag.PrivateUse)]\n        }\n    }\n\n    /**\n     * Get the VAT to be declared for this period\n     *\n     * The rounded=true figures are for the declaration\n     * The rounded=false figures are for the journalEntry\n     */\n    private getDeclaredVAT(rounded: boolean) {\n        const { highVAT, lowVAT, paidVAT, privateUseVAT } = this.getVATs()\n\n        const round = rounded ? Math.floor : undefined\n\n        const totalHigh = VATLine.addVATLines(getLines(highVAT), round)\n        const totalLow = VATLine.addVATLines(getLines(lowVAT), round)\n        const totalPrivateUse = VATLine.addVATLines(getLines(privateUseVAT), round)\n        const totalPaid = VATLine.addVATLines(getLines(paidVAT), round)    // ceil for negative amounts\n\n        const totalDue = totalHigh.vat + totalLow.vat + totalPrivateUse.vat\n\n        return {\n            highVAT,\n            totalHigh,\n            lowVAT,\n            totalLow,\n            privateUseVAT,\n            totalPrivateUse,\n            totalPaid,\n            paidVAT,\n            totalDue,\n            total: totalDue + totalPaid.vat\n        }\n    }\n\n    /**\n     * Returns the data that is required for constructing the journalEntry for this period\n     */\n    getJournalData() {\n        const declaredVAT = this.getDeclaredVAT(true)\n        const rawVAT = this.getDeclaredVAT(false)\n\n        return { declaredVAT, rawVAT }\n    }\n\n    /**\n     * Return the total VAT to be paid or to be claimed for this period\n     */\n    get total() {\n        return this.getDeclaredVAT(true).total\n    }\n\n    /**\n     * Returns the declared amount for the given tag\n     */\n    declaredAmount(journalEntry: JournalEntry | null, tag: VATDeclarationTag) {\n        if (journalEntry) {\n            const leg = journalEntry.getLeg(tag)\n            return leg ? leg.amount.value : 0\n        } else {\n            return 0\n        }\n    }\n\n    /**\n     * Returns a VAT declaration document for this declaration period\n     */\n    getDeclarationDocument(journalEntry: JournalEntry | null = null) {\n        const {\n            highVAT,\n            totalHigh,\n            lowVAT,\n            totalLow,\n            privateUseVAT,\n            totalPrivateUse,\n            totalPaid,\n            paidVAT,\n            totalDue,\n        } = this.getDeclaredVAT(true)\n\n        return {\n            \"1. Prestaties binnenland\": {\n                \"1a Leveringen/diensten belast algemeen tarief\": {\n                    netto: totalHigh.netto,\n                    vat: totalHigh.vat,\n                    bruto: totalHigh.bruto,\n                    details: highVAT,\n                    declared: this.declaredAmount(journalEntry, VATDeclarationTag.High)\n                },\n                \"1b Leveringen/diensten belast met verlaagd tarief\": {\n                    netto: totalLow.netto,\n                    vat: totalLow.vat,\n                    bruto: totalLow.bruto,\n                    details: lowVAT,\n                    declared: this.declaredAmount(journalEntry, VATDeclarationTag.Low)\n                },\n                \"1c Leveringen/diensten belast met overige tarieven behalve 0%\": NO_VAT_CALCULATION,\n                \"1d Prive-gebruik\": {\n                    netto: null,\n                    vat: totalPrivateUse.vat,\n                    bruto: null,\n                    details: privateUseVAT,\n                    declared: this.declaredAmount(journalEntry, VATDeclarationTag.PrivateUse)\n                },\n                \"1e Leveringen/diensten belast met 0% of niet bij u belast\": NO_FOREIGN_VAT_CALCULATION,\n            },\n            \"2. Verleggingsregelingen binnenland\": {\n                \"2a Leveringen/diensten waarbij de heffing van omzetbelasting naar u is verlegd\": NO_VAT_CALCULATION,\n            },\n            \"3. Prestaties naar/in het buitenland\": {\n                \"3a Leveringen naar landen buiten de EU (uitvoer)\": NO_FOREIGN_VAT_CALCULATION,\n                \"3b Leveringen naar/diensten in landen binnen de EU\": NO_FOREIGN_VAT_CALCULATION,\n                \"3c Installatie/afstandsverkopen binnen de EU\": NO_FOREIGN_VAT_CALCULATION,\n            },\n            \"4. Prestaties uit het buitenland aan u verricht\": {\n                \"4a Leveringen/diensten uit landen buiten de EU\": NO_VAT_CALCULATION,\n                \"4b Leveringen/diensten uit landen binnen de EU\": NO_VAT_CALCULATION,\n            },\n            \"5. Voorbelasting, kleineondernemersregeling,schatting en eindtotaal\": {\n                \"5a Verschuldigde omzetbelasting\": {\n                    netto: null,\n                    vat: totalDue,\n                    bruto: null,\n                    details: []\n                },\n                \"5b Voorbelasting\": {\n                    netto: null,\n                    vat: totalPaid.vat,\n                    bruto: null,\n                    details: paidVAT,\n                    declared: this.declaredAmount(journalEntry, VATDeclarationTag.Paid)\n                },\n                \"5c Subtotaal\": {\n                    netto: null,\n                    vat: this.total,\n                    bruto: null,\n                    details: [],\n                },\n            }\n        }\n    }\n}\n","import { JournalEntry } from \"../Journal/JournalEntry\"\nimport { VATSpecificationEntryData } from \"../../model\"\n\n/**\n * A VAT Declaration item is a journalEntry and the VATLines for this entry for the VAT Category\n *\n * Example: a journalEntry with all VAT lines that have VAT high\n */\nexport interface VATDeclarationItemDetails {\n    journalEntry?: JournalEntry\n    vatLines: VATSpecificationEntryData[]\n}\n\n/**\n * Returns all VATSpecificationEntryData that is contained in the given details\n */\nexport const getLines = (details: VATDeclarationItemDetails[]):VATSpecificationEntryData[]  => {\n    return details.reduce((lines, detail) => {\n        lines = lines.concat(detail.vatLines)\n        return lines\n    }, [] as VATSpecificationEntryData[])\n}\n\n/**\n * A VAT declaration item contains a netto-vat-bruto overview\n * and the details that have lead to the netto-vat-bruto outcome\n */\nexport interface VATDeclarationItem {\n    netto: number | null\n    vat: number | null\n    bruto: number | null\n    details: VATDeclarationItemDetails[]\n    declared?: number | null\n}\n\n/**\n * Not all VAT declaration items are calculated\n *\n * Non-calculated items will be assiged a NO_VAT_CALCULATION value\n */\nexport const NO_VAT_CALCULATION: VATDeclarationItem = {\n    netto: 0,\n    vat: 0,\n    bruto: 0,\n    details: []\n}\n\n/**\n * Not all VAT declaration items are calculated\n *\n * Non-calculated foreign-VAT items will be assiged a NO_FOREIGN_VAT_CALCULATION value\n */\nexport const NO_FOREIGN_VAT_CALCULATION: VATDeclarationItem = {\n    netto: 0,\n    vat: null,\n    bruto: null,\n    details: []\n}\n","import { EntryLegData, JournalEntryData, VATSpecificationData } from \"../../model\"\nimport { EntryLeg } from \"./EntryLeg\"\nimport { Amount } from \"../Amount\"\nimport { LedgerAccount } from \"../Ledger/LedgerAccount\"\nimport { DateString } from \"../DateString\"\nimport { Period } from \"../Period\"\nimport { VATLine } from \"../VAT/VATLine\"\nimport { LEDGER_ACCOUNT } from \"../../config\"\nimport { VATDeclaration, VATDeclarationTag } from \"../VAT/VATDeclaration\"\nimport assert from \"assert\"\nimport { VATRate } from \"../VAT/VATRate\"\nimport { VATRates } from \"../VAT/VATRates\"\n\n/**\n * JournalEntry\n * A balanced collection of account bookings\n * The sum of the debited and credited accounts is 0\n *\n * A JournalEntry normally gets created on the basis of the allocation of a bank mutation\n * The allocated leg is the side that describes how the bank mutation is booked\n * The opposite leg is the side that books on the associated ledgerAccount of the bankAccount\n */\nexport class JournalEntry {\n    constructor(readonly data: JournalEntryData) {}\n\n    get id(): string { return this.data.id }\n    get reason(): string { return this.data.reason }\n    get period(): Period { return new Period(this.data.period) }\n    get date(): DateString { return new DateString(this.data.date) }\n    get legs(): EntryLeg[] { return this.data.entryLegsData.map(data => new EntryLeg(data))}\n\n    /**\n     * Set the journal entry date (invoice date)\n     */\n    set date(date: DateString) {\n        this.data.date = date.data\n        if (this.data.vatSpecificationData) {\n            // Update VAT specification\n            this.data.vatSpecificationData.date = date.data\n        }\n    }\n\n    /**\n     * Checks the integrity of the journalEntry\n     *\n     * The sum of all amounts of all legs should be 0\n     */\n    checkIntegrity() {\n        const sum = this.legs\n            .map(leg => leg.amount)\n            .reduce((sum, amount) => sum.add(amount), new Amount())\n        assert(sum.isZero(), `The ${this.legs.length} legs sum up to ${sum}`)\n    }\n\n    getLeg(tag: string) {\n        return this.legs.find(leg => leg.tag === tag)\n    }\n\n    /**\n     * Construct a JournalEntry from the given allocation data\n     */\n    public static fromAllocation(id: string,\n                                 amount: Amount,\n                                 date: DateString,\n                                 period: Period,\n                                 reason: string,\n                                 account: LedgerAccount,\n                                 oppositeAccount: LedgerAccount): JournalEntry {\n\n        const oppositeLeg:EntryLegData = {\n            ledgerAccountCode: oppositeAccount.code,\n            amountData: amount.reversed().data\n        }\n\n        const allocatedLeg:EntryLegData = {\n            ledgerAccountCode: account.code,\n            amountData: amount.data\n        }\n\n        const entry = new JournalEntry({\n            id,\n            date: date.data,\n            period: period.data,\n            reason,\n            entryLegsData: [oppositeLeg, allocatedLeg]\n        })\n        entry.checkIntegrity()\n        return entry\n    }\n\n    /**\n     * Construct a new JournalEntry for the given VAT declaration\n     */\n    public static fromVATDeclaration(declaration: VATDeclaration) {\n        const id: string = declaration.id\n        const currency = declaration.currency\n        const { declaredVAT, rawVAT } = declaration.getJournalData()\n\n        const declared = declaredVAT.total\n        const difference = rawVAT.total - declared\n\n        const DeclarationAccount = (value: number) => value < 0\n            ? LEDGER_ACCOUNT.VAT_TO_BE_CLAIMED\n            : LEDGER_ACCOUNT.VAT_TO_BE_PAID\n\n        const entryLegsData = [\n            // High VAT\n            {\n                ledgerAccountCode: LEDGER_ACCOUNT.VAT_TO_BE_PAID,\n                amountData: Amount.fromAmountCurrency(-rawVAT.totalHigh.vat, currency),\n                tag: VATDeclarationTag.High\n            },\n            // Low VAT\n            {\n                ledgerAccountCode: LEDGER_ACCOUNT.VAT_TO_BE_PAID,\n                amountData: Amount.fromAmountCurrency(-rawVAT.totalLow.vat, currency),\n                tag: VATDeclarationTag.Low\n            },\n            // Private use\n            {\n                ledgerAccountCode: LEDGER_ACCOUNT.VAT_PRIVATE_USE,\n                amountData: Amount.fromAmountCurrency(-rawVAT.totalPrivateUse.vat, currency),\n                tag: VATDeclarationTag.PrivateUse\n            },\n            // Paid VAT\n            {\n                ledgerAccountCode: LEDGER_ACCOUNT.VAT_TO_BE_CLAIMED,\n                amountData: Amount.fromAmountCurrency(-rawVAT.totalPaid.vat, currency),\n                tag: VATDeclarationTag.Paid\n            },\n            // Difference between declared VAT and actual VAT\n            {\n                ledgerAccountCode: LEDGER_ACCOUNT.PAYMENT_DIFFERENCES,\n                amountData: Amount.fromAmountCurrency(difference, currency)\n            },\n        ]\n            .filter(data => !data.amountData.isZero())\n            .map(data => ({...data, amountData: data.amountData.data}))\n            .concat(\n                // Declared VAT\n                {\n                    ledgerAccountCode: DeclarationAccount(declaredVAT.total),\n                    amountData: Amount.fromAmountCurrency(declaredVAT.total, currency).data,\n                    tag: VATDeclarationTag.Declared\n                },\n            )\n\n        const entry = new JournalEntry({\n            id,\n            date: DateString.fromDate(new Date()).data,\n            period: new Period(declaration.period.year.toString()).data,\n            reason: id,\n            entryLegsData\n        })\n\n        entry.checkIntegrity()\n        return entry\n    }\n\n    /**\n     * Returns the vatLegs for this journalEntry, possible an empty array\n     */\n    get vatLegs(): EntryLeg[] {\n        return this.data.entryLegsData\n            .filter((_, i) => i >= 2)\n            .map(data => new EntryLeg(data))\n    }\n\n    /**\n     * Returns an array of VAT rates that apply to this journal entry\n     */\n    get vatRates(): VATRate[] {\n        const vat = this.getVAT()\n        if (vat) {\n            const vatRates = new VATRates(this.date.Date).rates\n            return vat.lines.map(line => vatRates[line.id])\n        } else {\n            return []\n        }\n    }\n\n    /**\n     * Returns the VAT date for this journalEntry\n     *\n     * If no VAT is applicable to this journalEntry, null is returned\n     */\n    get vatDate(): Date | null {\n        const vat = this.getVAT()\n        if (vat) {\n            return this.date.Date\n        } else {\n            return null\n        }\n    }\n\n    /**\n     * Returns the VAT specification data, or null if no VAT specification exists for this journalEntry\n     */\n    getVAT(): VATSpecificationData | null {\n        return this.data.vatSpecificationData || null\n    }\n\n    /**\n     * Set VAT, ie add VAT lines and a VAT specification to this journalEntry\n     */\n    setVAT(vatSpecificationData: VATSpecificationData | null) {\n        this.data.entryLegsData.splice(2)   // Remove any existing VAT legs\n        const lines = vatSpecificationData?.lines ?? []\n        if (vatSpecificationData && lines.length > 0) {\n            this.date = new DateString(vatSpecificationData.date)\n            this.data.vatSpecificationData = vatSpecificationData\n            const netto = VATLine.addVATLines(lines).netto\n            const currency = this.allocatedLeg.amount.currency\n            lines.forEach(line => {\n                if (+line.vat !== 0) {\n                    this.data.entryLegsData.push({\n                        ledgerAccountCode: +line.vat < 0\n                            ? LEDGER_ACCOUNT.VAT_TO_BE_CLAIMED\n                            : LEDGER_ACCOUNT.VAT_TO_BE_PAID,\n                        amountData: Amount.fromAmountCurrency(+line.vat, currency).data\n                    })\n                }\n            })\n            // Alternative: amount = opposite.amount - vat\n            this.allocatedLeg.data.amountData = Amount.fromAmountCurrency(+netto, currency).data\n        } else {\n            this.data.vatSpecificationData = undefined\n            this.allocatedLeg.data.amountData = this.oppositeLeg.amount.reversed().data\n        }\n        this.checkIntegrity()\n    }\n\n    /**\n     * Returns the EntryLeg with the opposite account\n     */\n    get oppositeLeg(): EntryLeg {\n        return this.legs[0]\n    }\n\n    /**\n     * Returns the EntryLeg with the allocated account\n     */\n    get allocatedLeg(): EntryLeg {\n        return this.legs[1]\n    }\n\n    /**\n     * Sets the reason (description) for the journalEntry\n     */\n    set reason(reason: string) {\n        this.data.reason = reason\n    }\n\n    /**\n     * Sets the period for the journalEntry\n     */\n    set period(period: Period) {\n        this.data.period = period.data\n    }\n}\n","/**\n * Base class for all data-mapped classes\n *\n * The methods in this class allow for a mapping between the raw data and its corresponding class\n * See the test files for an example how to use the DataMapping class to construct an intelligent (javascript-like) Map\n */\nexport class DataMapping<MapData extends Record<string, Data>, Data> {\n    readonly data: Record<string, Data>\n\n    constructor(data: MapData) {\n        this.data = data\n    }\n\n    hasData(): boolean { return Object.keys(this.data).length > 0 }\n    get size(): number { return Object.keys(this.data).length }\n\n    protected hasItem(id: string): boolean { return id in this.data }\n\n    private get items(): Data[] { return Object.values(this.data) }\n    private get entries(): [string, Data][] { return Object.entries(this.data) }\n\n    protected addItem(key: string, data: Data): void { this.data[key] = data }\n    protected delItem(key: string): void { delete this.data[key]}\n\n    protected getItems<T>(type: { new(data: Data): T }): T[] {\n        return this.items.map(data => new type(data))\n    }\n    protected getItem<T>(type: { new(data: Data): T }, id: string): T {\n        return new type(this.data[id])\n    }\n\n    protected addItemIfNotExists(key: string, data: Data): void {\n        if (!this.hasItem(key)) {\n            this.addItem(key, data)\n        }\n    }\n\n    protected filter<T>(type: { new(data: MapData): T }, condition: (key: string, data: Data) => boolean): T {\n        /**\n         * Returns a filtered copy of the data\n         */\n        return new type(this.entries.reduce((result, [key, data]) => {\n            if (condition(key, data)) {\n                result[key] = data\n            }\n            return result\n        }, {} as Record<string, Data>) as MapData)\n    }\n\n    protected modify<T>(type: { new(data: MapData): T }, f: (data: Data) => Data): T {\n        /**\n         * Returns a modified copy of the data.\n         * Take care to provide a modification function that does not alter the original data\n         */\n        return new type(this.entries.reduce((result, [key, data]) => {\n            result[key] = f(data)\n            return result\n        }, {} as Record<string, Data>) as MapData)\n    }\n\n    protected distinctValues<T>(getValue: (key: string, data: Data) => T): T[] {\n        /**\n         * Returns an array of distinct attribute values of the Data\n         */\n        const result = this.entries.reduce((result, [key, value]) => {\n            result.add(getValue(key, value))\n            return result\n        }, new Set<T>())\n        return Array.from(result)\n    }\n}","import assert from \"assert\"\n\nimport { JournalEntry } from \"./JournalEntry\"\nimport { PeriodFilter } from \"../PeriodFilter\"\nimport { JournalEntryData, JournalEntryMapData } from \"../../model\"\nimport { DataMapping } from \"../DataMapping\"\nimport { Period } from \"../Period\"\nimport { EntryLeg } from \"./EntryLeg\"\n\n/**\n * A Journal is a collection of JournalEntries indexed on id\n */\nexport class Journal extends DataMapping<JournalEntryMapData, JournalEntryData> {\n\n    /**\n     * Return a list of all JournalEntries in the Journal, newest on top\n     */\n    get journalEntries(): JournalEntry[] { return this.getItems(JournalEntry).reverse() }\n\n    /**\n     * Get the JournalEntry with the given id\n     * @throws Throws an AssertionError if the id can not be found\n     */\n    getJournalEntry(id: string): JournalEntry {\n        assert(this.hasItem(id))\n        return this.getItem(JournalEntry, id)\n    }\n\n    hasJournalEntry(id: string): boolean {\n        return this.hasItem(id)\n    }\n\n    public reversed(): Journal {\n        const reversedLegs = (entryData: JournalEntryData) => ({\n            ...entryData,\n            entryLegsData: entryData.entryLegsData.map(data => new EntryLeg(data).reversed().data)\n        })\n        return this.modify(Journal, reversedLegs)\n    }\n\n    /**\n     * Return a sorted list of Periods that occur in the journal\n     */\n    public distinctPeriods(): Period[] {\n        const getPeriod = (_: string, data: JournalEntryData) => data.period\n        return this\n            .distinctValues(getPeriod)\n            .sort()\n            .map(data => new Period(data))\n    }\n\n    /**\n     * Get a new (filtered) journal with only entries that match the given periodFilter\n     */\n    public filterOnPeriod(periodFilter: PeriodFilter): Journal {\n        const matchesPeriodFilter = (_: string, journalEntryData: JournalEntryData) =>\n            periodFilter.periodInRange(new JournalEntry(journalEntryData).period)\n        return this.filter(Journal, matchesPeriodFilter)\n    }\n\n    /**\n     * Get a new (modified) journal with only legs that are of the specified ledgerAccount\n     */\n    public filterOnAccount(filterLeg: (leg: EntryLeg) => boolean): Journal {\n        const ledgerAccountLegsOnly = (entry: JournalEntryData) => ({\n            ...entry,\n            entryLegsData: new JournalEntry(entry).legs.filter(filterLeg).map(l => l.data)\n        })\n        return this.modify(Journal, ledgerAccountLegsOnly)\n    }\n\n    /**\n     * Add a journalEntry to the Journal (only if the entry does not yet exist)\n     */\n    public add(journalEntry: JournalEntry): void {\n        this.addItemIfNotExists(journalEntry.id, journalEntry.data)\n    }\n\n    /**\n     * Remove the given journalEntry from the Journal\n     */\n    remove(journalEntry: JournalEntry): void {\n        this.delItem(journalEntry.id)\n    }\n}\n","import { LedgerAllocationData, VATSpecificationData } from \"../../model\"\n\nimport { LedgerAccount } from \"../Ledger/LedgerAccount\"\nimport { StatementEntry } from \"../LiquidAssets/StatementEntry\"\nimport { JournalEntry } from \"../Journal/JournalEntry\"\nimport { Accounting } from \"../Accounting\"\nimport { arrayRemoveElement } from \"../../services/utils\"\nimport { Period } from \"../Period\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\nimport { AllocationFilter } from \"../AllocationFilter\"\nimport { Amount } from \"../Amount\"\nimport { DateString } from \"../DateString\"\n\n/**\n * LedgerAllocation\n *\n * Allocate a BankAccount StatementEntry to a LedgerAccount\n * Creates a JournalEntry with two legs:\n * - AllocatedLeg for the allocation of the deposit or withdrawal of the BankAccount\n * - OppositeLeg for the BankAccount booking\n */\nexport class LedgerAllocation {\n    constructor(readonly data: LedgerAllocationData) {}\n\n    /**\n     * Unique identification of the LedgerAllocation\n     */\n    get id(): string { return this.data.id }\n\n    /**\n     * Gets access to the Accounting environment in which the allocation lives\n     */\n    private static get accounting() { return new Accounting() }\n\n    /**\n     * A reference to the JournalEntry for this allocation\n     */\n    private get journalEntryRef(): string { return this.data.journalEntryRef }\n\n    /**\n     * A reference to the BankAccount StatementEntry for this allocation\n     */\n    private get statementEntryRef(): string { return this.data.statementEntryRef }\n\n    /**\n     * A reference to any parent of this allocation\n     *\n     * When an allocation is assigned a new period it is split in two allocations\n     * The parent is the original allocation, the child is the new (splitted) allocation in the new period\n     */\n    get parentRef(): string | null { return this.data.parentRef }\n\n    /**\n     * A reference to any children of this allocation\n     *\n     * When an allocation is assigned a new period it is split in two allocations\n     * The parent is the original allocation, the child is the new (splitted) allocation in the new period\n     */\n    get childrenRefs(): string[] { return this.data.childrenRefs }\n\n    /**\n     * The parent LedgerAllocation for this allocation\n     */\n    get parent(): LedgerAllocation | null {\n        if (this.parentRef !== null) {\n            return LedgerAllocation.accounting.allocations.getAllocation(this.parentRef)\n        }\n        return null\n    }\n\n    /**\n     * A virtual attribute to allow sorting allocations\n     *\n     * Sorting is on the date of the statementEntry and the id of the allocation\n     * Sorting on id takes care that parents come before any children\n     */\n    get sortKey(): string { return this.statementEntry.valueDate.string + \".\" + this.id }\n\n    /**\n     * Sort method for ledgerAllocation\n     *\n     * Compares two ledgerAllocations on the basis of their sortKey\n     */\n    static sort(a1: LedgerAllocation, a2: LedgerAllocation) {\n        const s1 = a1.sortKey\n        const s2 = a2.sortKey\n        return s1 < s2 ? -1 : s1 > s2 ? 1 : 0\n    }\n\n    /**\n     * Returns a list of LedgerAllocations that are children of this allocation\n     */\n    get children() : LedgerAllocation[] {\n        return this.childrenRefs.map(id => LedgerAllocation.accounting.allocations.getAllocation(id))\n    }\n\n    /**\n     * Returns the period for this allocation, being the period of the associated JournalEntry\n     */\n    get period(): Period {\n        return this.journalEntry.period\n    }\n\n    /**\n     * Returns the ledgerAccount for this allocation\n     * Being the ledgerAccount of the allocated leg of the associated JournalEntry\n     */\n    get ledgerAccount(): LedgerAccount {\n        return this.journalEntry.allocatedLeg.ledgerAccount\n    }\n\n    /**\n     * Returns the code of the ledgerAccount for this allocation\n     * Being the code of the ledgerAccount of the allocated leg of the associated JournalEntry\n     */\n    get ledgerAccountCode(): string {\n        return this.journalEntry.allocatedLeg.ledgerAccountCode\n    }\n\n    /**\n     * Returns the statementEntry for this allocation\n     */\n    get statementEntry(): StatementEntry {\n        return LedgerAllocation.accounting.liquidAssets.getStatementEntry(this.statementEntryRef)\n    }\n\n    /**\n     * Returns the journalEntry for this allocation\n     */\n    get journalEntry(): JournalEntry {\n        return LedgerAllocation.accounting.journal.getJournalEntry(this.journalEntryRef)\n    }\n\n    /**\n     * Returns the amount that has been allocated by this allocation\n     */\n    get amount(): Amount {\n        return this.journalEntry.allocatedLeg.amount\n    }\n\n    /**\n     * Tells whether this allocation is equal to another allocation\n     * @param other\n     */\n    equals(other: LedgerAllocation) {\n        return other.id === this.id\n    }\n\n    /**\n     * Tells whether this allocation has any children\n     */\n    hasChildren() : boolean { return this.data.childrenRefs.length > 0}\n\n    /**\n     * Tells whether this allocation has a parent\n     */\n    hasParent(): boolean { return this.data.parentRef !== null }\n\n    /**\n     * Tells whether the allocation matches the given allocationFilter\n     *\n     * In order to match period and ledgerAccount should match (if set in the filter)\n     */\n    matches(allocationFilter: AllocationFilter): boolean {\n        const { period, ledgerAccountCode } = allocationFilter\n        return ((period === null || period.equals(this.period)) &&\n                (ledgerAccountCode === null || ledgerAccountCode === this.ledgerAccountCode))\n    }\n\n    /**\n     * Creates a new LedgerAllocation from a BankAccount StatementEntry\n     */\n    static fromStatementEntry(entry: StatementEntry): LedgerAllocation {\n        return new LedgerAllocation({\n            id: entry.id,\n            statementEntryRef: entry.id,\n            journalEntryRef: \"\",\n            parentRef: null,\n            childrenRefs: []\n        })\n    }\n\n    /**\n     * Gets an id for a child ledgerAllocation\n     */\n    getSplitId(period: Period) { return `${this.id}.${period.string}` }\n\n    /**\n     * Splits an allocation\n     *\n     * Creates a new allocation in the given period\n     * The parent of the new allocation is set to this allocation\n     */\n    private splitAllocation(period: Period): LedgerAllocation {\n        const ledgerAllocationData: LedgerAllocationData = {\n            id: this.getSplitId(period),\n            statementEntryRef: this.statementEntry.id,\n            journalEntryRef: \"\",\n            parentRef: this.id,    // Connect child to parent\n            childrenRefs: []\n        }\n        return new LedgerAllocation(ledgerAllocationData)\n    }\n\n    /**\n     * Unsplit an allocation\n     *\n     * Removes the child from its parent\n     */\n    private unsplitAllocation(): void {\n        this.parent!.removeChild(this)\n    }\n\n    /**\n     * Updates the ledgerAccount of the allocation\n     *\n     * Any child will have a oppositeLeg that mirrors the allocatedLeg of the allocation\n     * The mirroring is established by updating the oppositeLegs of any children allocations\n     */\n    set ledgerAccount(ledgerAccount: LedgerAccount) {\n        // Update allocated leg\n        this.journalEntry.allocatedLeg.ledgerAccount = ledgerAccount\n\n        // Update any child entryLegsData\n        this.children.forEach(child => {\n            child.journalEntry.oppositeLeg.ledgerAccount = ledgerAccount\n        })\n    }\n\n    getVAT(): VATSpecificationData | null {\n        return this.journalEntry.getVAT()\n    }\n\n    setVAT(vatSpecificationData: VATSpecificationData | null) {\n        this.journalEntry.setVAT(vatSpecificationData)\n    }\n\n    /**\n     * Updates the parent of the allocation\n     */\n    private set _parent(parent: LedgerAllocation) {\n        this.data.parentRef = parent.id\n    }\n\n    /**\n     * Sets the allocation period\n     *\n     * If the period is not equal to this period and the allocation has no children\n     * then the allocation is split:\n     * [bankAccontLedgerAccount, allocatedLedgerAccount] =>\n     * - [bankAccontLedgerAccount, AccrualsAccount] (parent)\n     * - [AccrualsAccount, allocatedLedgerAccount]  (child)\n     *\n     * If the period is equal to the parent period then the allocation is unsplit.\n     * The split is undone and the journalEntry gets the original value\n     *\n     */\n    set period(period: Period) {\n        if (period.equals(this.period)) return\n\n        const { allocations } = LedgerAllocation.accounting\n        const parent = this.parent\n        if (parent) {\n            if (period.equals(parent.period)) {\n                // unsplit this child\n                this.unsplitAllocation()\n\n                if (this.getVAT()) {\n                    // Set VAT back to the parent\n                    parent.setVAT(this.getVAT())\n                    this.setVAT(null)\n                }\n\n                parent.ledgerAccount = this.ledgerAccount\n                allocations.removeChild(this)\n            } else {\n                // no subsplit, simply change period\n                this.journalEntry.period = period\n            }\n        } else {\n            if (this.hasChildren()) {\n                // no multi split allowed\n            } else {\n                // split\n                const child = this.splitAllocation(period)\n                allocations.addChild(this, child, period)\n\n                if (this.getVAT()) {\n                    // Transfer VAT to the child\n                    child.setVAT(this.getVAT())\n                    this.setVAT(null)\n                }\n\n                child.ledgerAccount = this.ledgerAccount\n                this.ledgerAccount = LedgerScheme.getAccrualsAccount(this.amount)\n            }\n        }\n    }\n\n    get reason() {\n        return this.journalEntry.reason\n    }\n\n    set reason(reason: string) {\n        if (this.reason !== reason) {\n            this.journalEntry.reason = reason\n            if (this.parent) {\n                this.parent.reason = reason\n            } else {\n                this.children.forEach(child => child.reason = reason)\n            }\n        }\n    }\n\n    set journalEntry(journalEntry: JournalEntry) {\n        this.data.journalEntryRef = journalEntry.id\n    }\n\n    set date(date: DateString) {\n        this.journalEntry.date = date\n    }\n\n    addChild(child: LedgerAllocation) {\n        this.childrenRefs.push(child.id)\n        child._parent = this\n    }\n\n    removeChild(child: LedgerAllocation) {\n        arrayRemoveElement(this.childrenRefs, child.id)\n    }\n}\n\n","import { LedgerAllocationMapData } from \"../../model\"\nimport { PeriodFilter } from \"../PeriodFilter\"\nimport { LedgerAllocation } from \"./LedgerAllocation\"\nimport { StatementEntry } from \"../LiquidAssets/StatementEntry\"\nimport { Accounting } from \"../Accounting\"\nimport { JournalEntry } from \"../Journal/JournalEntry\"\nimport { LedgerAccount, UNMAPPED_ACCOUNT } from \"../Ledger/LedgerAccount\"\nimport { BankAccount } from \"../LiquidAssets/BankAccount\"\nimport { Period } from \"../Period\"\nimport assert from \"assert\"\nimport { sortedArray } from \"../../services/utils\"\n\n/**\n * Record of LedgerAllocations indexed by id\n */\nexport class LedgerAllocationMap {\n    constructor(readonly data: LedgerAllocationMapData) {}\n\n    private static get accounting() { return new Accounting() }\n\n    /**\n     * Get a LedgerAllocation by id\n     */\n    getAllocation(id: string): LedgerAllocation {\n        // assert(id in this.data)\n        return new LedgerAllocation(this.data[id])\n    }\n\n    /**\n     * Tells whether an allocation with the given id exists in the map\n     * @param id\n     */\n    hasAllocation(id: string): boolean {\n        return id in this.data\n    }\n\n    /**\n     * Get all LedgerAllocations, newest on top\n     */\n    get allocations(): LedgerAllocation[] {\n        // Newest on top\n        const result = Object.keys(this.data).map(key => new LedgerAllocation(this.data[key])).reverse()\n        // Sorted on date\n        return sortedArray(result, (a) => a.statementEntry.valueDate.string, false)\n    }\n\n    /**\n     * Tells the number of ledgerAllocations in the map\n     */\n    get length(): number {\n        return Object.keys(this.data).length\n    }\n\n    /**\n     * Returns a new LedgerAllocationMap with keys sorted on the sortKey of the LedgerAllocations\n     */\n    sorted(): LedgerAllocationMap {\n        const sortedAllocations = this.allocations.sort(LedgerAllocation.sort)\n        const data = sortedAllocations.reduce((result, allocation) => {\n            result[allocation.id] = allocation.data\n            return result\n        }, {} as LedgerAllocationMapData)\n        return new LedgerAllocationMap(data)\n    }\n\n    /**\n     * Get all ledgerAccounts that are used in at least 1 ledgerAllocation\n     * The results are sorted ascending\n     */\n    getLedgerAccounts(): LedgerAccount[] {\n        const result = this.allocations.reduce((result, allocation) => {\n            const ledgerAccount = allocation.ledgerAccount\n            result[ledgerAccount.code] = allocation.ledgerAccount\n            return result\n        }, {} as Record<string, LedgerAccount>)\n        return sortedArray(Object.values(result), LedgerAccount.sortKey)\n    }\n\n    /**\n     * Get all periods that are used in at least 1 ledgerAllocation\n     */\n    getPeriods(): Period[] {\n        const result = this.allocations.reduce((result, allocation) => {\n            const period = allocation.period\n            result[period.string] = period\n            return result\n        }, {} as Record<string, Period>)\n        return Object.values(result)\n    }\n\n    /**\n     * Gets the number of mapped and yet unmapped ledgerAllocations\n     */\n    getMappedUnmapped(): [number, number] {\n        return Object.values(this.data)\n            .reduce(([mapped, unmapped], allocationData): [number, number] => {\n                const ledgerAccount = new LedgerAllocation(allocationData).ledgerAccount\n                if (ledgerAccount.isUnmapped()) {\n                    unmapped++\n                } else {\n                    mapped++\n                }\n                return [mapped, unmapped]\n            }, [0, 0])\n    }\n\n    /**\n     * Return a new LedgerAllocationMap that holds only ledgerAllocations that match the given filter\n     */\n    filterOnPeriod(periodFilter: PeriodFilter): LedgerAllocationMap {\n        const data = Object.fromEntries(\n            Object.entries(this.data)\n                .filter(([_, allocationData]) => {\n                    const allocation = new LedgerAllocation(allocationData)\n                    const parentData = allocationData.parentRef && this.data[allocationData.parentRef]\n                    const parent = parentData && new LedgerAllocation(parentData)\n                    const children = allocationData.childrenRefs.map(c => new LedgerAllocation(this.data[c]))\n                    return periodFilter.periodInRange(allocation.period) ||\n                        (parent && periodFilter.periodInRange(parent.period)) ||\n                        (children.some(c => periodFilter.periodInRange(c.period)))\n                })\n        )\n        return new LedgerAllocationMap(data)\n    }\n\n    /**\n     * Update the ledgerAllocations in the map for the ledgerAccount of the given bankAccount\n     *\n     * All parent ledgerAllocations that are bound to statementEntry of the given bankAccount\n     * are updated for the new ledgerAccount of the given bankAccount\n     */\n    updateStatementEntries(bankAccount: BankAccount) {\n        const statementEntries = bankAccount.statementEntryMap\n        this.allocations.forEach(allocation => {\n            if (!allocation.hasParent() && statementEntries.contains(allocation.statementEntry)) {\n                allocation.journalEntry.oppositeLeg.ledgerAccount = bankAccount.ledgerAccount\n            }\n        })\n    }\n\n    /**\n     * Add ledgerAllocations for the given statementEntries\n     *\n     * Each new ledgerAllocation is bound to a statementEntry and is unmapped\n     */\n    addStatementEntries(bankAccount: BankAccount, statementEntries: StatementEntry[]) {\n        statementEntries.forEach(entry => {\n            const allocation = LedgerAllocation.fromStatementEntry(entry)\n            const period = Period.fromDate(entry.valueDate)\n            this.add(allocation, bankAccount.ledgerAccount, period)\n        })\n    }\n\n    /**\n     * Adds an allocation to the map\n     *\n     * The opposite account is normally the ledgerAccount of the bankAccount\n     */\n\n    private add(allocation: LedgerAllocation, oppositeAccount: LedgerAccount, period: Period): void {\n        // Add allocation, do not overwrite\n        if (!this.data[allocation.id]) {\n            this.data[allocation.id] = allocation.data\n\n            const entry = allocation.statementEntry\n            const journalEntry = JournalEntry.fromAllocation(\n                allocation.id,\n                entry.amount,\n                entry.valueDate,\n                period,\n                entry.description,\n                UNMAPPED_ACCOUNT,\n                oppositeAccount)\n            LedgerAllocationMap.accounting.journal.add(journalEntry)\n\n            allocation.journalEntry = journalEntry\n        }\n    }\n\n    /**\n     * Add a child to the ledgerAllocationMap\n     */\n    addChild(parent: LedgerAllocation, child: LedgerAllocation, period: Period) {\n        this.add(child, parent.ledgerAccount, period)\n        parent.addChild(child)\n    }\n\n    /**\n     * Removes a child\n     *\n     * The child is removed from the parent and the child is removed from the map\n     */\n    removeChild(child: LedgerAllocation) {\n        assert(child.parent)\n        child.parent.removeChild(child)\n        this.remove(child)\n    }\n\n    /**\n     * Removes an allocation from the map\n     */\n    private remove(allocation: LedgerAllocation): void {\n        delete this.data[allocation.id]\n        LedgerAllocationMap.accounting.journal.remove(allocation.journalEntry)\n    }\n\n    /**\n     * Returns unmapped allocations that are bound to the given entries\n     */\n    private getUnallocatedEntries(entries: StatementEntry[]): LedgerAllocation[] {\n        return entries\n            .map(entry => this.getAllocation(entry.id))\n            .filter(allocation => allocation.ledgerAccount.isUnmapped())\n    }\n\n    /**\n     * Get a list of similar allocations\n     *\n     * Child allocations do not have similar allocations\n     * For an unmapped allocation the allocations that are bound to similar statementEntries are returned\n     * For a mapped allocation the allocations that are bound to the same ledgerAccount are returned\n     */\n    getSimilarAllocations(allocation: LedgerAllocation): LedgerAllocation[] {\n        let result:LedgerAllocation[]\n        if (allocation.hasParent()) {\n            // Similarity is at parent level, child allocations do not have similar allocations\n            result = []\n        } else if (allocation.ledgerAccount.isUnmapped()) {\n            // Return all similar unmapped allocations (bound to similar statementEntries)\n            const statements = new Accounting().liquidAssets.getStatementEntryMap()\n            const entries = statements.getSimilarEntries(allocation.statementEntry)\n            result = this.getUnallocatedEntries(entries)\n        } else {\n            // Return all allocations that are booked on the same account\n            result = this.allocations.filter(a => a.ledgerAccount.equals(allocation.ledgerAccount))\n        }\n        return sortedArray(result, a => a.sortKey, false)\n    }\n}","import { AccountingState } from \"../app/AccountingSlice\"\nimport { Journal } from \"./Journal/Journal\"\nimport { LiquidAssets } from \"./LiquidAssets/LiquidAssets\"\nimport { LedgerAllocationMap } from \"./Allocation/LedgerAllocationMap\"\nimport {\n    AccountingMetaData,\n    BankAccountData,\n    BankImportStatementData,\n    JournalEntryData,\n    LedgerAccountData,\n    LedgerAllocationData,\n    VATSpecificationData\n} from \"../model\"\nimport { LedgerScheme } from \"./Ledger/LedgerScheme\"\nimport { Period } from \"./Period\"\nimport { JournalEntry } from \"./Journal/JournalEntry\"\nimport { memoize } from \"../services/memoize\"\nimport { DateString } from \"./DateString\"\n\nexport class Accounting {\n    /**\n     * Current state is a class property\n     * Set on every instantiation\n     * - Allows reducers to work on the Draft<State> model\n     * - Allows components to work on the current State model (set by middleware)\n     */\n    private static _CurrentState: AccountingState\n\n    constructor(data?: AccountingState) {\n        if (data) {\n            // Used by reducers to work on writable draft-state\n            Accounting.State = data\n        }   // Else use the current state\n    }\n\n    static get State(): AccountingState {\n        return this._CurrentState\n    }\n\n    static set State(state: AccountingState) {\n        // Explicitly set the state (post-action in redux middleware)\n        this._CurrentState = state\n    }\n\n    /**\n     * The currency is determined by the currency of the first allocated statement entry\n     */\n    @memoize()\n    static get currency(): string {\n        return new Accounting().allocations.allocations[0].statementEntry.amount.currency\n    }\n\n    /**\n     * Returns the journal (dictionary of journalEntries)\n     */\n    get journal() { return new Journal(Accounting.State.journalData) }\n\n    /**\n     * Returns the liquid assets (dictionary of bank accounts\n     */\n    get liquidAssets() { return new LiquidAssets(Accounting.State.liquidAssetsData) }\n\n    /**\n     * Returns the allocations (dictionary of allocations)\n     *\n     * Allocations connect a statement entry of a bank account to a ledger account\n     */\n    get allocations() { return new LedgerAllocationMap(Accounting.State.ledgerAllocationsData) }\n\n    setMetaData(metaData: AccountingMetaData) {\n        /**\n         * Update the metadata (name)\n         */\n        Accounting._CurrentState.accountingMetaData = metaData\n    }\n\n    addStatements(statementsData: BankImportStatementData[]) {\n        /**\n         * Add bankAccount statements and its statementEntries\n         */\n        statementsData.forEach(statementData => {\n            const { bankAccount, statementEntries } = this.liquidAssets.addBankImportStatement(statementData)\n            this.allocations.addStatementEntries(bankAccount, statementEntries)\n        })\n        Accounting._CurrentState.ledgerAllocationsData = this.allocations.data\n    }\n\n    deleteJournalEntry(journalEntryData: JournalEntryData) {\n        if (this.journal.hasJournalEntry(journalEntryData.id)) {\n            // Remove any existing journalEntry with the same id\n            this.journal.remove(this.journal.getJournalEntry(journalEntryData.id))\n        }\n    }\n\n    updateJournalEntry(journalEntryData: JournalEntryData) {\n        // Remove any existing journalEntry with the same id\n        this.deleteJournalEntry(journalEntryData)\n        // Add the journalEntry to the journal\n        this.journal.add(new JournalEntry(journalEntryData))\n    }\n\n    linkBankAccount(bankAccountData: BankAccountData, ledgerAccountData: LedgerAccountData) {\n        /**\n         * Associate a bankAccount with a (Balance) ledgerAccount\n         */\n        const ledgerAccount = LedgerScheme.getAccount(ledgerAccountData.Referentiecode)\n        const bankAccount = this.liquidAssets.getBankAccount(bankAccountData.id)\n        bankAccount.ledgerAccount = ledgerAccount\n        this.allocations.updateStatementEntries(bankAccount)\n    }\n\n    setPeriod(allocationData: LedgerAllocationData, period: string) {\n        /**\n         * Setting a period splits an allocation in two parts:\n         * - The original allocation gets associated with an accruals account\n         * - A new allocation will be made with the new period and the original account\n         * If the period of a split allocation is set back to its original value\n         * then the split will be undone\n         */\n        const allocation = this.allocations.getAllocation(allocationData.id)\n        allocation.period = new Period(period)\n    }\n\n    setReason(allocationData: LedgerAllocationData, reason: string) {\n        /**\n         * Change the reason (description) of a journalEntry\n         */\n        const allocation = this.allocations.getAllocation(allocationData.id)\n        allocation.reason = reason\n    }\n\n    setLedgerAccount(allocationsData: LedgerAllocationData[], accountCode: string) {\n        /**\n         * Change the ledgerAccount of a set of allocations\n         */\n        const ledgerAccount = LedgerScheme.getAccount(accountCode)\n        allocationsData.forEach(allocationData => {\n            const allocation = this.allocations.getAllocation(allocationData.id)\n            allocation.ledgerAccount = ledgerAccount\n        })\n    }\n\n    setVAT(allocationData: LedgerAllocationData, vatSpecificationData: VATSpecificationData) {\n        /**\n         * Specifies the VAT or deletes the VAT for the allocation\n         */\n        const allocation = this.allocations.getAllocation(allocationData.id)\n        allocation.setVAT(vatSpecificationData)\n    }\n\n    setDate(allocationData: LedgerAllocationData, dateData: string) {\n        /**\n         * Specifies the VAT or deletes the VAT for the allocation\n         */\n        const allocation = this.allocations.getAllocation(allocationData.id)\n        allocation.date = new DateString(dateData)\n        // Default behaviour is to have invoice date and period equal\n        // This can be undone by the user by setting the period explicitly afterwards\n        const datePeriod = Period.fromDate(allocation.journalEntry.date)\n        if (! datePeriod.equals(allocation.period)) {\n            this.setPeriod(allocationData, datePeriod.data)\n        }\n    }\n}","import { StatementEntryData } from \"../../model\"\nimport { Amount } from \"../Amount\"\nimport { DateString } from \"../DateString\"\nimport { AccountStatement } from \"./AccountStatement\"\nimport { Accounting } from \"../Accounting\"\nimport { memoize } from \"../../services/memoize\"\n\n/**\n * StatementEntry\n *\n * Specification of a deposit made into the bank account or a payment made out\n *\n * - Deposits in the form of income, cash deposits, etc.\n * - Withdrawals in the form of cash, cheques, etc.\n * - Any interest that was made on the account\n * - Any bank fees or charges for service\n */\nexport class StatementEntry {\n    constructor(readonly data: StatementEntryData) {}\n\n    /**\n     * Unique identification of the StatementEntry\n     */\n    get id(): string {\n        return this.data.id\n    }\n\n    /**\n     * Returns the AccountStatement on which this StatementEntry is mentioned\n     */\n    @memoize()\n    get accountStatement(): AccountStatement {\n        return new Accounting().liquidAssets.getAccountStatement(this.data.accountStatementRef)\n    }\n\n    /**\n     * Returns the party that is at the other side of this StatementEntry (creditor, debtor or bank)\n     */\n    get relatedParties(): string {\n        return this.data.relatedParties\n    }\n\n    /**\n     * The date when the transaction actually carries out or is supposed to carry out.\n     */\n    get valueDate(): DateString {\n        return new DateString(this.data.valueDate)\n    }\n\n    /**\n     * The date when the bank posts it in your account\n     */\n    get bookDate(): DateString {\n        return new DateString(this.data.bookDate)\n    }\n\n    /**\n     * The amount that is deposited of withdrawn from the BankAccount\n     */\n    get amount(): Amount {\n        return new Amount(this.data.amountData)\n    }\n\n    /**\n     * A description for the deposit of withdrawal\n     */\n    get description(): string {\n        return [this.data.relatedParties, this.data.remittanceInformation].join(\" \").trim()\n    }\n\n    /**\n     * The year in which the transaction is booked (valueDate)\n     */\n    get year(): string {\n        return this.valueDate.year\n    }\n\n    /**\n     * Tells whether a StatementEntry is similar to another StatementEntry\n     *\n     * This can be used to book similar entries on the same LedgerAccount\n     */\n    isSimilar(other: StatementEntry) {\n        return this.relatedParties.trim().toLowerCase() === other.relatedParties.trim().toLowerCase()\n    }\n}","import { StatementEntryData, StatementEntryMapData } from \"../../model\"\nimport { Amount, CreditDebit } from \"../Amount\"\nimport { StatementEntry } from \"./StatementEntry\"\nimport { DataMapping } from \"../DataMapping\"\nimport { PeriodFilter } from \"../PeriodFilter\"\nimport { DateString } from \"../DateString\"\n\nexport interface EntryTotals {\n    statements: number,\n    total: Amount,\n    debit: Amount,\n    credit: Amount\n}\n\n/**\n * Record of StatementEntries indexed by id\n */\nexport class StatementEntryMap extends DataMapping<StatementEntryMapData, StatementEntryData> {\n\n    /**\n     * Get a list of all StatementEntries\n     */\n    get statementEntries(): StatementEntry[] { return this.getItems(StatementEntry) }\n\n    /**\n     * Get a StatementEntry by id\n     */\n    getStatementEntry(id: string): StatementEntry { return this.getItem(StatementEntry, id) }\n\n    /**\n     * Tells whether the given StatementEntry is contained in this Record\n     */\n    contains(statementEntry: StatementEntry) { return this.hasItem(statementEntry.id) }\n\n    /**\n     * Get a list of StatementEntries that are considered similar to the given statementEntry\n     *\n     * The list will at least have one StatementEntry as an entry is considered similar to itself\n     */\n    getSimilarEntries(entry: StatementEntry): StatementEntry[] {\n        return this.getItems(StatementEntry)\n            .filter(e => e.isSimilar(entry))\n    }\n\n    /**\n     * Returns a new StatementEntryMap with only entries that match the given filter\n     */\n    filterOnPeriod(periodFilter: PeriodFilter): StatementEntryMap {\n        return this.filter(StatementEntryMap,(_, statementEntryData) =>\n            periodFilter.dateInRange(new DateString(statementEntryData.valueDate)))\n    }\n\n    /**\n     * Get the totals (count, total, total debit, total credit) of all entries in this Record\n     */\n    getTotals(): EntryTotals {\n        return this.getItems(StatementEntry)\n            .reduce((totals: EntryTotals, statement) => {\n                const amount = statement.amount\n\n                totals.statements += 1\n                totals.total = totals.total.add(amount)\n                if (amount.creditDebit === CreditDebit.Credit) {\n                    totals.credit = totals.credit.add(amount)\n                } else {\n                    totals.debit = totals.debit.add(amount)\n                }\n                return totals\n            }, {\n                statements: 0,\n                total: new Amount(),\n                debit: new Amount(),\n                credit: new Amount()\n            } as EntryTotals)\n    }\n}","interface FormatProps {\n    short?: boolean\n}\n\n/**\n * Simple class to hold an IBAN value\n */\nexport class IBAN {\n    data: string\n\n    constructor(s: string) {\n        this.data = s\n    }\n\n    /**\n     * Returns a formatted presentation of the IBAN\n     */\n    format(props: FormatProps = {}): string {\n        const short = props.short ?? false\n\n        if (this.data.length > 9 && !short) {\n            // ISO13616\n            // IBAN is traditionally expressed in groups of four characters separated by spaces\n            const EVERY_FOUR_CHARS =/(.{4})(?!$)/g\n            return this.data.replace(EVERY_FOUR_CHARS, `$1 `)\n        } else if (this.data.length === 9 || short) {\n            const s = this.data.substr(this.data.length - 9)\n            return s.replace(/^(.{2})(.{2})(.{2})(.*)$/, `$1.$2.$3.$4`)\n        } else {\n            return this.data\n        }\n    }\n\n    /**\n     * Converts the IBAN to a string value\n     */\n    toString(): string {\n        return this.format()\n    }\n}","import {\n    AccountStatementData,\n    AccountStatementMapData,\n} from \"../../model\"\nimport { PeriodFilter } from \"../PeriodFilter\"\nimport { DateString } from \"../DateString\"\nimport { DataMapping } from \"../DataMapping\"\nimport { AccountStatement } from \"./AccountStatement\"\nimport { sortedArray } from \"../../services/utils\"\nimport { AccountBalance } from \"./AccountBalance\"\nimport { memoize } from \"../../services/memoize\"\n\n/**\n * A Record of AccountStatements indexed by id\n */\nexport class AccountStatementMap extends DataMapping<AccountStatementMapData, AccountStatementData> {\n\n    /**\n     * Returns an AccountStatementMap with statements that match the given periodFilter\n     */\n    filterOnPeriod(periodFilter: PeriodFilter): AccountStatementMap {\n        const filterCondition = (_: string, accountStatementData: AccountStatementData) =>\n            periodFilter.dateInRange(new DateString(accountStatementData.closingBalanceData.date))\n        return this.filter(AccountStatementMap, filterCondition)\n    }\n\n    /**\n     * Returns a list of AccountStatements sorted on data, ascending\n     */\n    @memoize()\n    get accountStatements(): AccountStatement[] {\n        return sortedArray(Object.values(this.data), data => new AccountBalance(data.closingBalanceData).date.id)\n            .map(data => new AccountStatement(data))\n    }\n\n    /**\n     * Returns the AccountStatement with the given id\n     */\n    getAccountStatement(id: string): AccountStatement {\n        return this.getItem(AccountStatement, id)\n    }\n}","import { AccountStatement } from \"./AccountStatement\"\nimport { AccountBalance } from \"./AccountBalance\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\nimport {\n    AccountBalanceData,\n    BankAccountData,\n    StatementEntryData,\n    PlainAccountStatementData\n} from \"../../model\"\nimport { LedgerAccount } from \"../Ledger/LedgerAccount\"\nimport { StatementEntryMap } from \"./StatementEntryMap\"\nimport { IBAN } from \"../IBAN\"\nimport { StatementEntry } from \"./StatementEntry\"\nimport { AccountStatementMap } from \"./AccountStatementMap\"\n\n/**\n * A bank account is a financial account maintained by a bank or other financial institution\n * in which the financial transactions between the bank and a customer are recorded\n */\nexport class BankAccount {\n\n    constructor(readonly data: BankAccountData) {}\n\n    /**\n     * The unique identification of the BankAccount\n     */\n    get id(): string { return this.data.id }\n\n    /**\n     * Returns the international bank account number (IBAN) of the BankAccount\n     *\n     * A standard international numbering system for individual bank accounts around the world\n     */\n    get IBAN(): IBAN { return new IBAN(this.data.id) }\n\n    /**\n     * Returns the LedgerAccount that is associated with the BankAccount\n     */\n    get ledgerAccount() { return LedgerScheme.getAccount(this.data.ledgerAccountCode) }\n\n    /**\n     * Add a statement and its entries to the BankAccount\n     *\n     * If the statement of an entry already exists it will be skipped\n     * Only new statements and entries will be registered\n     */\n    public add(statement: PlainAccountStatementData,\n               entries: StatementEntryData[]): [ AccountStatement | null, StatementEntry[]] {\n        let newStatement : AccountStatement | null = null\n        const newEntries: StatementEntry[] = []\n\n        const statementId = statement.id\n        if (!this.data.accountStatementMapData[statementId]) {\n            // Add new statement\n            newStatement = new AccountStatement(statement)\n            this.data.accountStatementMapData[statementId] = newStatement.data\n        }\n\n        entries.forEach(entryData => {\n            const entryId = entryData.id\n            if (!this.data.statementEntryMapData[entryId]) {\n                // Add new statement entries\n                const newEntry = new StatementEntry(entryData)\n                this.data.statementEntryMapData[entryData.id] = newEntry.data\n                newEntries.push(newEntry)\n            }\n        })\n\n        return [ newStatement, newEntries ]\n    }\n\n    /**\n     * Returns a Record of statements indexed by statement id\n     */\n    get accountStatementMap(): AccountStatementMap {\n        return new AccountStatementMap(this.data.accountStatementMapData)\n    }\n\n    /**\n     * Returns a Record of statementEntries indexed by entry id\n     */\n    get statementEntryMap() {\n        return new StatementEntryMap(this.data.statementEntryMapData)\n    }\n\n    /**\n     * Returns the oldest begin balance of the bankAccount\n     */\n    public beginBalance(): AccountBalance | null {\n        let result: Partial<AccountBalanceData> = {}\n        const statements = Object.values(this.data.accountStatementMapData)\n        statements.forEach(statement => {\n            // Take first openingBalance for the specific date\n            if (!result.date || statement.openingBalanceData.date < result.date) {\n                result.date = statement.openingBalanceData.date\n                result.amountData = statement.openingBalanceData.amountData\n            }\n        })\n        return result.date ? new AccountBalance(result as AccountBalanceData) : null\n    }\n\n    /**\n     * Returns the latest end balance of the bankAccount\n     */\n    public endBalance(): AccountBalance | null {\n        let result: Partial<AccountBalanceData> = {}\n        const statements = Object.values(this.data.accountStatementMapData)\n        statements.forEach(statement => {\n            // Take last closingBalance for the specific date\n            if (!result.date || statement.closingBalanceData.date >= result.date) {\n                result.date = statement.closingBalanceData.date\n                result.amountData = statement.closingBalanceData.amountData\n            }\n        })\n        return result.date ? new AccountBalance(result as AccountBalanceData) : null\n    }\n\n    /**\n     * Updates the LedgerAccount that is associated with the BankAccount\n     */\n    set ledgerAccount(ledgerAccount: LedgerAccount) {\n        this.data.ledgerAccountCode = ledgerAccount.code\n    }\n}\n","import { BankAccount } from \"./BankAccount\"\nimport { PeriodFilter } from \"../PeriodFilter\"\nimport {\n    BankAccountData,\n    BankImportStatementData,\n    BankAccountMapData,\n    StatementEntryMapData,\n    AccountStatementMapData\n} from \"../../model\"\nimport { StatementEntryMap } from \"./StatementEntryMap\"\nimport { AccountStatementMap } from \"./AccountStatementMap\"\nimport { AccountBalance } from \"./AccountBalance\"\nimport { Amount } from \"../Amount\"\nimport { DataMapping } from \"../DataMapping\"\nimport { AccountStatement } from \"./AccountStatement\"\nimport { StatementEntry } from \"./StatementEntry\"\nimport { clear, memoize } from \"../../services/memoize\"\n\ntype AccountBalanceMap = Record<string, {\n    beginBalance: AccountBalance | null,\n    endBalance: AccountBalance | null\n}>\n\n/**\n * LiquidAssets\n *\n * A liquid asset is an asset that can easily be converted into cash in a short amount of time\n * In the current implementation the only LiquidAssets are BankAccounts\n */\nexport class LiquidAssets extends DataMapping<BankAccountMapData, BankAccountData> {\n\n    /**\n     * Returns the LiquidAssets hold in BankAccounts\n     */\n    get bankAccounts(): BankAccount[] { return this.getItems(BankAccount) }\n\n    /**\n     * Returns the BankAccount with the given id\n     * @param id\n     */\n    getBankAccount(id: string): BankAccount { return this.getItem(BankAccount, id) }\n\n    /**\n     * Returns LiquidAssets with assets that match the given periodFilter\n     */\n    filterOnPeriod(filter: PeriodFilter): LiquidAssets {\n        return this.modify(LiquidAssets,(bankAccountData) => {\n            const accountStatements = new AccountStatementMap(bankAccountData.accountStatementMapData)\n            const statementEntries = new StatementEntryMap(bankAccountData.statementEntryMapData)\n            return {\n                ...bankAccountData,\n                accountStatementMapData: accountStatements.filterOnPeriod(filter).data,\n                statementEntryMapData: statementEntries.filterOnPeriod(filter).data\n            }\n        })\n    }\n\n    /**\n     * Returns the total of all beginBalances and all endBalances\n     */\n    getTotals(balances: AccountBalanceMap): [Amount, Amount] {\n        return Object.values(balances).reduce(([begin, end], balance) => {\n            if (balance.beginBalance !== null) {\n                begin = begin.add(balance.beginBalance.amount)\n            }\n            if (balance.endBalance !== null) {\n                end = end.add(balance.endBalance.amount)\n            }\n            return [begin, end]\n        }, [new Amount(), new Amount()])    }\n\n    /**\n     * Returns a Record of begin- and enBalance per bankAccount\n     */\n    getBalances(): AccountBalanceMap {\n        return this.bankAccounts.reduce((result, bankAccount) => {\n            result[bankAccount.id] = {\n                beginBalance: bankAccount.beginBalance(),\n                endBalance: bankAccount.endBalance()\n            }\n            return result\n        }, {} as AccountBalanceMap)\n    }\n\n    @memoize()\n    /**\n     * Returns a Record of AccountStatements indexed by their id\n     */\n    getAccountStatementMap(): AccountStatementMap {\n        const data = this.bankAccounts.reduce((result, bankAccount) => {\n            result = {\n                ...result,\n                ...bankAccount.data.accountStatementMapData\n            }\n            return result\n        }, {} as AccountStatementMapData)\n        return new AccountStatementMap(data)\n    }\n\n    /**\n     * Returns the AccountStatement with the given id\n     * @param id\n     */\n    getAccountStatement(id: string) {\n        return this.getAccountStatementMap().getAccountStatement(id)\n    }\n\n    @memoize()\n    /**\n     * Returns a Record of StatementEntries indexed by their id\n     */\n    getStatementEntryMap(): StatementEntryMap {\n        const data = this.bankAccounts.reduce((result, bankAccount) => {\n            result = {\n                ...result,\n                ...bankAccount.data.statementEntryMapData\n            }\n            return result\n        }, {} as StatementEntryMapData)\n        return new StatementEntryMap(data)\n    }\n\n    /**\n     * Returns the StatementEntry with the given id\n     * @param id\n     */\n    getStatementEntry(id: string) {\n        return this.getStatementEntryMap().getStatementEntry(id)\n    }\n\n    @clear()\n    addBankImportStatement(statementData: BankImportStatementData): {\n        bankAccount: BankAccount,\n        accountStatement: AccountStatement | null,\n        statementEntries: StatementEntry[]\n    } {\n        const bankAccountId = statementData.bankAccountData.id\n        this.addItemIfNotExists(bankAccountId, {\n            ...statementData.bankAccountData,\n            accountStatementMapData: {},\n            statementEntryMapData: {}\n        })\n\n        const bankAccount = this.getItem(BankAccount, bankAccountId)\n        const [ accountStatement, statementEntries] = bankAccount.add(statementData.accountStatementData,\n                                                                      statementData.statementEntriesData)\n        return { bankAccount, accountStatement, statementEntries }\n    }\n}\n","export class ValueProxy<T> {\n    _value: T | null = null\n\n    invalidate() {\n        this._value = null\n    }\n\n    getValue(getValue: () => T): T {\n        if (this._value === null) {\n            this._value = getValue()\n        }\n        return this._value\n    }\n}\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { RootState } from './store';\n\nimport {\n    BankAccountData,\n    BankImportStatementData,\n    JournalEntryMapData,\n    LedgerAccountData,\n    LedgerAllocationData,\n    LedgerAllocationMapData,\n    BankAccountMapData,\n    AccountingMetaData,\n    VATSpecificationData,\n    JournalEntryData\n} from \"../model\"\n\nimport { LiquidAssets } from \"../types/LiquidAssets/LiquidAssets\"\nimport { Journal } from \"../types/Journal/Journal\"\nimport { LedgerAllocationMap } from \"../types/Allocation/LedgerAllocationMap\"\nimport { Accounting } from \"../types/Accounting\"\nimport { ValueProxy } from \"../services/ValueProxy\"\n\nexport interface AccountingState {\n    accountingMetaData: AccountingMetaData\n    liquidAssetsData: BankAccountMapData\n    ledgerAllocationsData: LedgerAllocationMapData\n    journalData: JournalEntryMapData\n}\n\nconst initialState: AccountingState = {\n    accountingMetaData: { name: \"\" },\n    liquidAssetsData: {},\n    ledgerAllocationsData: {},\n    journalData: {}\n};\n\nexport const AccountingSlice = createSlice({\n    name: 'accounting',\n    initialState,\n    reducers: {\n        resetAccountingState: () => {\n            invalidateAll()\n            return { ...initialState }\n        },\n\n        restoreAccountingState: (state, action: PayloadAction<{state: AccountingState}>) => {\n            invalidateAll()\n            return {\n                ...initialState,\n                ...action.payload.state\n            }\n        },\n\n        setMetaData: (state, action: PayloadAction<AccountingMetaData>) => {\n            const accounting = new Accounting(state)\n            accounting.setMetaData(action.payload)\n        },\n\n        addStatements: (state, action: PayloadAction<{statementsData: BankImportStatementData[]}>) => {\n            invalidateAll()\n            const { statementsData } = action.payload\n            const accounting = new Accounting(state)\n            accounting.addStatements(statementsData)\n        },\n\n        deleteJournalEntry: (state, action: PayloadAction<{journalEntryData: JournalEntryData}>) => {\n            journal.invalidate()\n            const { journalEntryData } = action.payload\n            const accounting = new Accounting(state)\n            accounting.deleteJournalEntry(journalEntryData)\n        },\n\n        updateJournalEntry: (state, action: PayloadAction<{journalEntryData: JournalEntryData}>) => {\n            journal.invalidate()\n            const { journalEntryData } = action.payload\n            const accounting = new Accounting(state)\n            accounting.updateJournalEntry(journalEntryData)\n        },\n\n        linkBankAccount: (state,\n                          action: PayloadAction<{bankAccountData: BankAccountData, ledgerAccountData: LedgerAccountData}>) => {\n            invalidateAll()\n            const { bankAccountData, ledgerAccountData } = action.payload\n            const accounting = new Accounting(state)\n            accounting.linkBankAccount(bankAccountData, ledgerAccountData)\n        },\n\n        setPeriod: (state,\n                    action: PayloadAction<{allocationData: LedgerAllocationData, period: string}>) => {\n            ledgerAllocations.invalidate()\n            journal.invalidate()\n            const { allocationData, period } = action.payload\n            const accounting = new Accounting(state)\n            accounting.setPeriod(allocationData, period)\n        },\n\n        setReason: (state,\n                    action: PayloadAction<{allocationData: LedgerAllocationData,\n                                           reason: string}>) => {\n            ledgerAllocations.invalidate()\n            journal.invalidate()\n            const { allocationData, reason } = action.payload\n            const accounting = new Accounting(state)\n            accounting.setReason(allocationData, reason)\n        },\n\n        setLedgerAccount: (state,\n                           action: PayloadAction<{allocationsData: LedgerAllocationData[],\n                                                  accountCode: string}>) => {\n            ledgerAllocations.invalidate()\n            journal.invalidate()\n            const { allocationsData, accountCode } = action.payload\n            const accounting = new Accounting(state)\n            accounting.setLedgerAccount(allocationsData, accountCode)\n        },\n\n        setVAT: (state,\n                 action: PayloadAction<{allocationData: LedgerAllocationData,\n                                        vatSpecificationData: VATSpecificationData}>) => {\n            const { allocationData, vatSpecificationData } = action.payload\n            ledgerAllocations.invalidate()\n            journal.invalidate()\n            const accounting = new Accounting(state)\n            accounting.setVAT(allocationData, vatSpecificationData)\n        },\n\n        setDate: (state,\n                  action: PayloadAction<{allocationData: LedgerAllocationData,\n                                         dateData: string}>) => {\n            const { allocationData, dateData } = action.payload\n            ledgerAllocations.invalidate()\n            journal.invalidate()\n            const accounting = new Accounting(state)\n            accounting.setDate(allocationData, dateData)\n        }\n    },\n});\n\nexport const { resetAccountingState,\n    restoreAccountingState,\n    setMetaData,\n    addStatements,\n    deleteJournalEntry,\n    updateJournalEntry,\n    linkBankAccount,\n    setPeriod,\n    setReason,\n    setVAT,\n    setDate,\n    setLedgerAccount } = AccountingSlice.actions;\n\nconst invalidateAll = () => {\n    liquidAssets.invalidate()\n    ledgerAllocations.invalidate()\n    journal.invalidate()\n}\n\nconst liquidAssets = new ValueProxy<LiquidAssets>()\nexport const selectLiquidAssets = (state: RootState) =>\n    liquidAssets.getValue(() => new LiquidAssets(state.accounting.liquidAssetsData))\n\nlet ledgerAllocations = new ValueProxy<LedgerAllocationMap>()\nexport const selectLedgerAllocations = (state: RootState) =>\n    ledgerAllocations.getValue(() => new LedgerAllocationMap(state.accounting.ledgerAllocationsData))\n\nlet journal = new ValueProxy<Journal>()\nexport const selectJournal = (state: RootState) =>\n    journal.getValue(() => new Journal(state.accounting.journalData))\n\nexport const selectAccountingState = (state: RootState) => state.accounting\n\nexport const selectMetaData = (state: RootState) => state.accounting.accountingMetaData\n\nexport default AccountingSlice.reducer","import { localPath } from \"../config\"\n\nexport interface RouteItem {\n    id: string\n    text: string\n    path: string\n}\n\nexport const Routes = {\n    Upload: {\n        id: \"Upload\",\n        text: \"Upload Bankbestand\",\n        path: \"/upload\",\n    },\n    Bank: {\n        id: \"Bank\",\n        text: \"Bank\",\n        path: \"/bank\",\n    },\n    Journal: {\n        id: \"Journal\",\n        text: \"Journaal\",\n        path: \"/journal\",\n    },\n    Ledger: {\n        id: \"Ledger\",\n        text: \"Grootboek\",\n        path: \"/ledger\",\n\n    },\n    Map: {\n        id: \"Map\",\n        text: \"Transacties boeken\",\n        path: \"/map\",\n\n    },\n    TrialBalance: {\n        id: \"TrialBalance\",\n        text: \"Saldibalans\",\n        path: \"/trialbalance\",\n\n    },\n    Charts: {\n        id: \"Charts\",\n        text: \"Visualisatie\",\n        path: \"/charts\",\n    },\n    VAT: {\n        id: \"VAT\",\n        text: \"BTW Aangifte\",\n        path: \"/vat\"\n    },\n    Memorial: {\n        id: \"Memorial\",\n        text: \"Memoriaal\",\n        path: \"/memo\"\n    },\n    Edit: {\n        id: \"JournalEntryEdit\",\n        text: \"Bewerken\",\n        path: \"/edit\"\n    },\n    Home: {\n        id: \"Home\",\n        text: \"Home\",\n        path: \"/\",\n    }\n}\n\nObject.values(Routes).forEach(route => route.path = localPath(route.path))\n","import React from 'react'\n\nimport {\n    Home,\n    CloudUpload,\n    AccountBalance,\n    CallSplit,\n    LibraryBooks,\n    MenuBook,\n    PlaylistAdd,\n    ShowChart,\n    NoteOutlined,\n    Domain,\n    EditOutlined\n} from \"@material-ui/icons\"\n\nimport { Routes } from \"./routes\"\n\ninterface RouteIconProps {\n    id: string\n}\n\nconst icon: Record<string, JSX.Element> = {\n    [Routes.Home.id]: <Home/>,\n    [Routes.Ledger.id]: <MenuBook/>,\n    [Routes.Journal.id]: <LibraryBooks/>,\n    [Routes.Map.id]: <CallSplit/>,\n    [Routes.TrialBalance.id]: <PlaylistAdd/>,\n    [Routes.Upload.id]: <CloudUpload/>,\n    [Routes.Bank.id]: <AccountBalance/>,\n    [Routes.Charts.id]: <ShowChart/>,\n    [Routes.VAT.id]: <Domain/>,\n    [Routes.Memorial.id]: <NoteOutlined/>,\n    [Routes.Edit.id]: <EditOutlined/>\n}\n\nfunction RouteIcon(props: RouteIconProps) {\n    return (\n        <span>\n            {icon[props.id] || null}\n        </span>\n    )\n}\n\nexport default RouteIcon","import { PeriodFilterData } from \"../model\"\nimport { DateString } from \"./DateString\"\nimport { Period } from \"./Period\"\nimport { range } from \"../services/utils\"\n\n/**\n * Filter data on period (from - to)\n */\nexport class PeriodFilter {\n    constructor(public data: PeriodFilterData = { periods: [] }) {}\n\n    /**\n     * Create a period filter from an array of periods\n     *\n     * The array is assumed to be sorted\n     * The first period of the array is the begin period\n     * The last period of the array is the end period\n     */\n    static fromPeriods(periods: Period[]): PeriodFilter {\n        if (periods.length > 0) {\n            // Period filter is a fromTo [from, to]\n            periods = Period.sort(periods)\n            periods = [periods[0], periods[periods.length - 1]]\n        }\n        return new PeriodFilter({ periods: periods.map(period => period.string) })\n    }\n\n    /**\n     * Create a period filter from an array of values (years)\n     *\n     * The array is assumed to be sorted\n     * The first period of the array is the begin period\n     * The last period of the array is the end period\n     */\n    public static fromValues(values: number[]): PeriodFilter {\n        return this.fromPeriods(values.map(value => new Period(String(value))))\n    }\n\n    /**\n     * Return a new period filter that is limited to the given periods\n     *\n     * Example:\n     * - PeriodFilter(2000, 2010) limitTo (2005, 2015) => PeriodFilter(2005, 2010)\n     */\n    limitTo(periods: Period[]): PeriodFilter {\n        // return a filter that has limits that are within the min-max of the given periods\n        let dataPeriods = [this.first, this.last]\n        if (periods.length > 0) {\n            const min = Period.min(...periods)\n            const max = Period.max(...periods)\n\n            if (this.first.lte(min)) {\n                dataPeriods[0] = min\n            }\n\n            if (this.last.gte(max)) {\n                dataPeriods[1] = max\n            }\n\n            if (this.first.equals(min) && this.last.equals(max)) {\n                // Select all periods\n                dataPeriods = []\n            }\n        }\n        return PeriodFilter.fromPeriods(dataPeriods)\n    }\n\n    /**\n     * Returns a new PeriodFilter with a buffer period at each side of the interval\n     *\n     * Example:\n     * - PeriodFilter(2005, 2007) withBuffer => PeriodFilter(2004, 2008)\n     */\n    withBuffer(): PeriodFilter {\n        if (this.length) {\n            return PeriodFilter.fromPeriods([this.first.before, this.last.after])\n        }\n        return this\n    }\n\n    /**\n     * Returns the list of Periods in the PeriodFilter\n     *\n     * Example:\n     * - PeriodFilter(2005, 2007) periods => [2005, 2007]\n     */\n    private get periods(): Period[] { return this.data.periods.map(p => new Period(p)) }\n\n    /**\n     * Return the begin and end period of the PeriodFilter as numbers\n     */\n    get fromTo(): number[] {\n        if (this.length > 0) {\n            return [this.first.value, this.last.value]\n        }\n        return []\n    }\n\n    /**\n     * Return the periods in the PeriodFilter as a range\n     *\n     * Example:\n     * - PeriodFilter(2005, 2007) values => [2005, 2006, 2007]\n     */\n    get values(): number[] {\n        if (this.length > 0) {\n            return range(this.first.value, this.last.value + 1)\n        }\n        return []\n    }\n\n    /**\n     * Returns the number of periods in the PeriodFilter\n     */\n    get length(): number { return this.periods.length }\n\n    /**\n     * Return the first Period of the PeriodFilter or an empty Period\n     */\n    get first(): Period { return this.periods[0] ?? new Period() }\n\n    /**\n     * Returns the last period of the PeriodFilter or an empty Period\n     */\n    get last(): Period { return this.periods[this.length - 1] ?? new Period() }\n\n    /**\n     * Tells whether this PeriodFilter is equal to the given PeriodFilter (same interval)\n     */\n    public equals(other: PeriodFilter): boolean {\n        return this.first.equals(other.first) && this.last.equals(other.last)\n    }\n\n    /**\n     * Returns the numeric value of the given period string\n     * @param period\n     */\n    public static asValue(period: string): number {\n        return Number(period)\n    }\n\n    /**\n     * Tells whether the given period is in range of this PeriodFilter\n     */\n    public periodInRange(period: Period): boolean {\n        return this.length === 0 || (this.first.lte(period) && period.lte(this.last))\n    }\n\n    /**\n     * Tells whether the given date is in range of this PeriodFilter\n     */\n    public dateInRange(date: DateString): boolean {\n        const period = Period.fromDate(date)\n        return this.periodInRange(period)\n    }\n}\n","import { endOfQuarter, startOfQuarter } from \"date-fns\"\nimport { VATPeriodData } from \"../../model\"\n\n/**\n * A VAT declaration period consists of a year and a quarter\n */\nexport class VATDeclarationPeriod {\n    constructor(public year: number, public quarter: number) {\n    }\n\n    /**\n     * The unique id for this declaration period\n     */\n    get id(): string {\n        return `${this.year}.${this.quarter}`\n    }\n\n    /**\n     * Get the VATPeriodData for this period\n     */\n    get data(): VATPeriodData {\n        return {\n            period: this.id\n        }\n    }\n\n    /**\n     * Constructs a declaration period from the given id\n     */\n    static fromId(id: string): VATDeclarationPeriod {\n        const [year, quarter] = id.split(\".\")\n        return new VATDeclarationPeriod(+year, +quarter)\n    }\n\n    /**\n     * Start Date of the VAT declaration period\n     */\n    get startDate(): Date {\n        const qDate = new Date(this.year, (this.quarter - 1) * 3, 1)\n        return new Date(startOfQuarter(qDate).toDateString())\n    }\n\n    /**\n     * End Date of the VAT declaration period\n     */\n    get endDate(): Date {\n        return new Date(endOfQuarter(this.startDate).toDateString())\n    }\n}","import { createSlice, PayloadAction } from '@reduxjs/toolkit';\n\nimport { RootState } from './store';\n\nimport { PeriodFilterData, VATPeriodData } from \"../model\"\nimport { PeriodFilter } from \"../types/PeriodFilter\"\nimport { ValueProxy } from \"../services/ValueProxy\"\nimport { VATDeclarationPeriod } from \"../types/VAT/VATDeclarationPeriod\"\n\nexport interface FilterState {\n    periodFilterData: PeriodFilterData\n    vatPeriodData: VATPeriodData | null\n}\n\nconst initialState: FilterState = {\n    periodFilterData: new PeriodFilter().data,\n    vatPeriodData: null\n};\n\nexport const FilterSlice = createSlice({\n    name: 'filter',\n    initialState,\n    reducers: {\n        resetFilterState: () => {\n            periodFilter.invalidate()\n            return { ...initialState }\n        },\n\n        restoreFilterState: (state, action: PayloadAction<{ state: FilterState }>) => {\n            periodFilter.invalidate()\n            return action.payload.state\n        },\n\n        setPeriodFilter: (state, action: PayloadAction<{ periodFilterData: PeriodFilterData }>) => {\n            periodFilter.invalidate()\n            const { periodFilterData } = action.payload\n\n            state.periodFilterData = new PeriodFilter(periodFilterData).data\n        },\n\n        setVATPeriod: (state, action: PayloadAction<{ vatPeriodData: VATPeriodData | null }>) => {\n            vatPeriod.invalidate()\n            const { vatPeriodData } = action.payload\n\n            state.vatPeriodData = vatPeriodData\n        }\n\n    }\n});\n\nexport const { resetFilterState, restoreFilterState, setPeriodFilter, setVATPeriod } = FilterSlice.actions;\n\nconst periodFilter = new ValueProxy<PeriodFilter>()\nexport const selectPeriodFilter = (state: RootState) =>\n    periodFilter.getValue(() => new PeriodFilter(state.filter.periodFilterData))\n\nconst vatPeriod = new ValueProxy<VATDeclarationPeriod | null>()\nexport const selectVATPeriod = (state: RootState) =>\n    vatPeriod.getValue(() => state.filter.vatPeriodData\n        ? VATDeclarationPeriod.fromId(state.filter.vatPeriodData.period)\n        : null)\n\nexport default FilterSlice.reducer","import React from 'react'\nimport { useDispatch, useSelector } from \"react-redux\"\n\nimport { makeStyles, Slider, Typography } from '@material-ui/core'\nimport { createStyles } from \"@material-ui/core/styles\"\n\nimport { selectJournal } from \"../../app/AccountingSlice\"\nimport { selectPeriodFilter, setPeriodFilter } from \"../../app/FilterSlice\"\n\nimport { PeriodFilter } from \"../../types/PeriodFilter\"\n\nconst useStyles = makeStyles((/*theme: Theme*/) =>\n    createStyles({\n        mark: {\n          fontSize: 10\n        },\n        root: {\n            width: 200,\n        },\n}))\n\ninterface ValueLabelComponentProps {\n    children: React.ReactElement\n    open: boolean\n    value: number\n}\n\nfunction ValueLabelComponent(props: ValueLabelComponentProps) {\n    const { children } = props;\n    return (\n        <div>\n            {children}\n        </div>\n    )\n}\n\nfunction PeriodFiltering() {\n    const dispatch = useDispatch()\n    const classes = useStyles()\n\n    const periodFilter = useSelector(selectPeriodFilter)\n    const journal = useSelector(selectJournal)\n\n    const periods = journal.distinctPeriods()\n    if (periods.length === 0) {\n        // Nothing to choose\n        return null\n    }\n\n    const options = PeriodFilter.fromPeriods(periods).withBuffer().values\n\n    // value is the current periodFilterData or all periods if the filterOnPeriod is []\n    const value = periodFilter.length ? periodFilter.fromTo : PeriodFilter.fromPeriods(periods).fromTo\n\n    const onChange = (event: any, newValue: number | number[]) => {\n        const newPeriodFilter = PeriodFilter.fromValues(newValue as number[]).limitTo(periods)\n        if (newPeriodFilter.equals(periodFilter)) {\n            // Nothing changed\n            return\n        }\n        dispatch(setPeriodFilter({\n            periodFilterData: newPeriodFilter.data\n        }))\n    };\n\n    const marks = options.map((option: number) => (\n        {\n            value: option,\n            label: (\n                <span key={option} className={classes.mark}>\n                    {option}\n                </span>\n            )\n        }))\n\n    return (\n        <div className={classes.root} aria-label={\"rapportage periode\"}>\n            <Typography id=\"rapportage-periode-slider\" variant={\"caption\"}>\n                Rapportage Periode\n            </Typography>\n            <Slider\n                min={options[0]}\n                max={options[options.length - 1]}\n                value={value}\n                onChange={onChange}\n                marks={marks}\n                step={null}\n                valueLabelDisplay=\"on\"\n                ValueLabelComponent={ValueLabelComponent}\n                aria-labelledby={\"rapportage-periode-slider\"}\n            />\n        </div>\n    )\n}\n\nexport default PeriodFiltering;\n","import React from 'react'\n\nimport { Grid, makeStyles } from \"@material-ui/core\"\n\nimport { RouteItem } from \"../routes/routes\"\n\nimport RouteIcon from \"../routes/RouteIcon\"\nimport PeriodFilter from \"../components/Selectors/PeriodFilter\"\nimport Hidden from \"@material-ui/core/Hidden/Hidden\"\nimport { createStyles } from \"@material-ui/core/styles\"\nimport { useSelector } from \"react-redux\"\nimport { selectMetaData } from \"../app/AccountingSlice\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        icon: {\n            marginTop: 2\n        },\n        periodFilter: {\n            marginLeft: 2,\n        },\n        name: {\n            textAlign: \"right\",\n            fontWeight: \"bold\"\n        },\n        header: {\n            marginTop: -15\n        },\n    }))\n\ninterface PageHeaderProps {\n    title: RouteItem | string\n    periodFilter?: boolean\n    withName?: boolean\n}\n\nfunction PageHeader(props: PageHeaderProps) {\n    const name = useSelector(selectMetaData).name\n    const {title, periodFilter = true, withName = true} = props\n    const classes = useStyles()\n\n    let headerTitle\n    if (typeof title === 'string') {\n        headerTitle = (\n            <h2>{props.title}</h2>\n        )\n    } else {\n        headerTitle = (\n            <h2>\n                <Grid container spacing={1} direction={\"row\"} justify={\"center\"} alignItems={\"stretch\"}>\n                    <Grid item className={classes.icon}>\n                        <RouteIcon id={title.id}/>\n                    </Grid>\n                    <Grid item>\n                        {title.text}\n                    </Grid>\n                </Grid>\n            </h2>\n        )\n    }\n\n    return (\n        <div>\n\n            {/*Large header, hidden at or below small devices*/}\n            <Hidden smDown>\n                <Grid container spacing={0} alignItems={\"flex-start\"} className={classes.header}>\n                    <Grid item xs={3}>\n                        <div className={classes.periodFilter}>\n                            {periodFilter && <PeriodFilter/>}\n                        </div>\n                    </Grid>\n                    <Grid item xs={6}>\n                        {headerTitle}\n                    </Grid>\n                    {withName && <Grid item xs={3}>\n                        <div className={classes.name}>{name}</div>\n                    </Grid>}\n                </Grid>\n            </Hidden>\n\n            {/*Small header, hidden at or above small devices*/}\n            <Hidden mdUp>\n                <Grid container direction={\"column\"} spacing={0} alignItems={\"center\"} className={classes.header}>\n                    <Grid item xs={12}>\n                        {headerTitle}\n                    </Grid>\n                    {withName && <Grid item xs={12}>\n                        <div className={classes.name}>{name}</div>\n                    </Grid>}\n                    <Grid item xs={12} className={classes.periodFilter}>\n                        {periodFilter && <PeriodFilter/>}\n                    </Grid>\n                </Grid>\n            </Hidden>\n        </div>\n    )\n}\n\nexport default PageHeader\n","import { createSlice, PayloadAction } from '@reduxjs/toolkit'\n\nimport { RootState } from './store';\n\nexport interface AgeState {\n    age: number\n}\n\nconst initialState: AgeState = {\n    age: 0\n};\n\nexport const AgeSlice = createSlice({\n    name: 'age',\n    initialState,\n    reducers: {\n        restoreAgeState: (state, action: PayloadAction<{ state: AgeState }>) => {\n            return action.payload.state\n        },\n\n        resetAge: (state) => {\n            state.age = 0\n        },\n\n        increaseAge: (state) => {\n            state.age += 1\n        },\n    }\n});\n\nexport const { restoreAgeState, resetAge, increaseAge } = AgeSlice.actions;\n\nexport const selectAge = (state: RootState) => state.age.age\n\nexport default AgeSlice.reducer","import { AES, enc } from \"crypto-js\"\n\ninterface EncryptedObject {\n    encrypt: string     // Encryption method: currently AES\n    content: string     // Encrypted JSON contents of the original object\n}\n\n/**\n * Encrypt the given object using the given key\n *\n * CryptoJS supports AES-128, AES-192, and AES-256.\n * It will pick the variant by the size of the key you pass in.\n * If you use a passphrase, then it will generate a 256-bit key.\n */\nexport function encryptObject(obj: object, key: string): EncryptedObject {\n    return {\n        encrypt: \"AES\",\n        content: AES.encrypt(JSON.stringify(obj), key).toString()\n    }\n}\n\n/**\n * Decrypt the given encrypted object using the given key\n * The JSON representation of the original object is returned\n *\n * @throws Error when the decryption fails (wrong key)\n */\nfunction decryptToJSON(obj: EncryptedObject, key: string): string {\n    try {\n        const bytes = AES.decrypt(obj.content, key)\n        const result = bytes.toString(enc.Utf8)\n        if (result) {\n            return result\n        }\n    } catch {}\n    throw new Error(\"Decryption failed\")\n}\n\n/**\n * Tells whether the given object is an encrypted object\n */\nexport function isEncrypted(obj: any): boolean {\n    return Boolean(obj.encrypt && obj.content)\n}\n\n/**\n * Tells whether the given JSON string is a JSON representation of an encrypted object\n */\nexport function isJSONEncrypted(json: string): boolean {\n    try {\n        const object = JSON.parse(json)\n        return isEncrypted(object)\n    }\n    catch {}\n    return false\n}\n\n/**\n * Decrypt the given JSON string using the given key\n * Returns the JSON representation of the orginal object if the decryption succeeds\n * Returns null if the given JSON string is not a representation of an encrypted object\n *\n * @throws Error when the decryption fails (wrong key)\n */\nexport function decryptJSON(json: string, key: string): string | null {\n    if (isJSONEncrypted(json)) {\n        const object = JSON.parse(json)\n        return decryptToJSON(object, key)\n    }\n    return null\n}\n","import FileSaver from \"file-saver\"\n\nimport { resetAccountingState, restoreAccountingState } from \"../app/AccountingSlice\"\nimport { resetFilterState, restoreFilterState } from \"../app/FilterSlice\"\nimport { restoreAgeState } from \"../app/AgeSlice\"\nimport { RootState } from \"../app/store\"\nimport { Dispatch } from \"react\"\nimport { APP } from \"../config\"\nimport { encryptObject } from \"./crypto\"\n\nconst STORAGE_KEY = APP.KEY\n\nexport function saveStateToFile(state: RootState, filename: string, password: string = \"\"): boolean {\n\n    try {\n        const saveState = password\n            ? encryptObject(state, password)\n            : state\n        const json = JSON.stringify(saveState)\n        const blob = new Blob([json], {type: \"application/json\"});\n        FileSaver.saveAs(blob, filename);\n        return true\n    }\n    catch {\n        return false\n    }\n}\n\nexport function saveStateToStorage(state: RootState, storage: Storage): void {\n    const json = JSON.stringify(state)\n    storage.setItem(STORAGE_KEY, json)\n}\n\nexport function restoreStateFromStorage(storage: Storage, dispatch: Dispatch<any>): void {\n    const json = storage.getItem(STORAGE_KEY)\n    if (json !== null) {\n        restoreStateFromJSON(json, dispatch)\n    }\n}\n\nexport function restoreStateFromJSON(json: string, dispatch: Dispatch<any>): void {\n    try {\n        const state: RootState = JSON.parse(json)\n        restoreState(state, dispatch)\n    }\n    catch {}\n}\n\nexport function restoreState(state: RootState, dispatch: Dispatch<any>) {\n    dispatch(restoreAccountingState({state: state.accounting}))\n    dispatch(restoreFilterState({state: state.filter}))\n    dispatch(restoreAgeState({state: state.age}))\n}\n\nexport function resetState(dispatch: Dispatch<any>) {\n    dispatch(resetAccountingState())\n    dispatch(resetFilterState())\n}\n","import {\n    BankImportStatementData,\n    PlainAccountStatementData,\n    PlainBankAccountData,\n    StatementEntryData\n} from \"../../model\"\n\n/**\n * Bank Import Statement\n *\n * A Bank Import Statement is either a MT940 or CAMT053 Bank Import Statement\n */\nexport class BankImportStatement {\n    data: BankImportStatementData\n\n    constructor(bankAccount: PlainBankAccountData,\n                accountStatement: PlainAccountStatementData,\n                statementEntries: StatementEntryData[]) {\n\n        const statementRef = (ref: string) => [bankAccount.id, ref].join(\".\")\n\n        // Make accountStatement id unique\n        accountStatement.id = statementRef(accountStatement.id)\n        statementEntries.forEach(s => s.accountStatementRef = statementRef(s.accountStatementRef))\n        this.data = {\n            bankAccountData: bankAccount,\n            accountStatementData: accountStatement,\n            statementEntriesData: statementEntries\n        }\n    }\n\n    get statementEntryCount() { return this.data.statementEntriesData.length }\n}\n","import { BalanceInfo, Statement as MT940Statement, Transaction as MT940Transaction } from \"mt940-js\";\nimport { BankImportStatement } from \"./BankImportStatement\"\nimport { CreditDebit } from \"../Amount\"\nimport { AccountBalance } from \"../LiquidAssets/AccountBalance\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\nimport {\n    AccountBalanceData,\n    StatementEntryData,\n    PlainBankAccountData,\n    PlainAccountStatementData\n} from \"../../model\"\nimport { DEFAULT_CURRENCY } from \"../../config\"\n\n/**\n * MT940 Import Statement\n */\nexport class MT940ImportStatement extends BankImportStatement {\n    constructor(statement: MT940Statement) {\n        super(MT940ImportStatement.getBankAccount(statement),\n              MT940ImportStatement.getAccountStatement(statement),\n              statement.transactions.map((transaction: MT940Transaction) =>\n                  MT940ImportStatement.getStatementEntry(statement, transaction))\n        )\n    }\n\n    /**\n     * Gets the BankAccount data for the given statement\n     */\n    private static getBankAccount(statement: MT940Statement): PlainBankAccountData {\n        const accountId = (statement.accountId ?? \"\").split(\" \")[0]\n        return {\n            id: accountId,\n            currency: DEFAULT_CURRENCY,\n            ledgerAccountCode: LedgerScheme.DefaultBankAccountCode\n        }\n    }\n\n    /**\n     * Gets the AccountBalance for the given Balance data\n     */\n    private static getAccountBalance(balance?: BalanceInfo): AccountBalanceData {\n        if (balance) {\n            return {\n                date: balance.date,\n                amountData: {\n                    amount: balance.value,\n                    currency: balance.currency,\n                    creditDebit: balance.isCredit ? CreditDebit.Credit : CreditDebit.Debit\n                }\n            }\n        } else {\n            return new AccountBalance().data\n        }\n    }\n\n    /**\n     * Get the Account Statement Data for the given statement\n     */\n    private static getAccountStatement(statement: MT940Statement): PlainAccountStatementData {\n        return {\n            id: statement.number ?? \"\",\n            openingBalanceData: MT940ImportStatement.getAccountBalance(statement.openingBalance),\n            closingBalanceData: MT940ImportStatement.getAccountBalance(statement.closingBalance),\n        }\n    }\n\n    /**\n     * Get the description tags for the given statement\n     *\n     * As a last resort a 999 tag is included that is the complete description text (without 999)\n     */\n    private static getDescriptionTags(transaction: MT940Transaction): Record<string, string> {\n        const description = transaction.description\n\n        function setTag(tagName?:string, tagValueStart?:number, tagValueEnd?:number) {\n            if (tagName && tagValueStart) {\n                tags[tagName] = description.substring(tagValueStart, tagValueEnd ?? description.length)\n            }\n        }\n\n        const tags:Record<string, string> = {}\n        const tagsRe = new RegExp(\"/([A-Z]{2,})/\", \"g\")\n\n        let match, tagName = \"\", tagStart = undefined\n        do {\n            match = tagsRe.exec(description)\n            if (match) {\n                const [nextTag, nextTagName] = match\n                const nextTagStart = description.indexOf(nextTag)\n                setTag(tagName, tagStart, nextTagStart);\n\n                [tagName, tagStart] = [nextTagName, nextTagStart + nextTag.length]\n            }\n        } while (match)\n        setTag(tagName, tagStart)\n\n        // Last resort...\n        tags[\"999\"] = transaction.description.replace(/^999/, \"\")\n\n        return tags\n    }\n\n\n    /**\n     * Get the Statement Entry Data for the given statement and transaction\n     */\n    private static getStatementEntry(statement: MT940Statement, transaction: MT940Transaction): StatementEntryData {\n        const tags = this.getDescriptionTags(transaction)\n        return {\n            id: transaction.id,\n            amountData: {\n                amount: transaction.amount,\n                currency: transaction.currency,\n                creditDebit: transaction.isCredit ? CreditDebit.Credit : CreditDebit.Debit\n            },\n            bookDate: transaction.valueDate,\n            valueDate: transaction.valueDate,\n            relatedParties: tags[\"NAME\"] || \"\",\n            remittanceInformation: tags[\"REMI\"] || tags[\"TRTP\"] || (tags[\"NAME\"] ? \"\" : tags[\"999\"]),\n            accountStatementRef: statement.number || \"\"\n        }\n    }\n}\n","import React, { useRef } from 'react'\n\nimport { Button } from \"@material-ui/core\";\n\ninterface FileLoaderProps {\n    onLoad: (result: any) => void,\n    readAsArrayBuffer?: boolean,\n    title: string,\n    accept: string\n}\n\nfunction FileLoader(props: FileLoaderProps) {\n    const hiddenFileInput = useRef<any>(null)\n\n    function readFiles(files: File[]) {\n        for (let file of files) {\n            const reader = new FileReader()\n\n            reader.onload = () => {\n                if (reader.result) {\n                    props.onLoad(reader.result)\n                }\n            };\n\n            reader.onerror = () => {\n                props.onLoad(null)\n            }\n\n            reader.onabort = () => {\n                props.onLoad(null)\n            }\n\n            if (props.readAsArrayBuffer) {\n                reader.readAsArrayBuffer(file)\n            } else {\n                reader.readAsText(file)\n            }\n        }\n    }\n\n    function onClick() {\n        hiddenFileInput.current.click()\n    }\n\n    function onFileSelected(e:React.ChangeEvent<HTMLInputElement>) {\n        e.preventDefault()\n\n        const fileList:FileList | null = e.target.files\n\n        if (fileList) {\n            readFiles(Array.from(fileList))\n        }\n    }\n\n    return (\n        <Button variant={\"contained\"}\n                style={{width: 290}}\n                aria-label={props.title}\n                onClick={onClick}\n                color={\"primary\"}>\n            {props.title}\n            <input type=\"file\"\n                   ref={hiddenFileInput}\n                   multiple={true}\n                   accept={props.accept}\n                   onChange={e => onFileSelected(e)} hidden/>\n        </Button>\n    );\n}\n\nexport default FileLoader","import React from 'react';\n\nimport * as mt940 from \"mt940-js\";\nimport { Statement as MT940Statement } from \"mt940-js\";\n\nimport { MT940ImportStatement } from \"../../types/BankImport/MT940ImportStatement\";\nimport { BankImportStatement } from \"../../types/BankImport/BankImportStatement\";\n\nimport FileLoader from \"./FileLoader\";\n\ninterface MT940LoaderProps {\n    onLoad: (statements: BankImportStatement[]) => void\n}\n\nfunction MT940Loader(props: MT940LoaderProps) {\n    const statements: BankImportStatement[] = []\n\n    function onLoad (result: any) {\n        if (result) {\n            mt940.read(result).then((mt940Statements) => {\n                mt940Statements.forEach((mt940Statement: MT940Statement) => {\n                    statements.push(new MT940ImportStatement(mt940Statement))\n                })\n                props.onLoad(statements)\n            });\n        } else {\n            props.onLoad([])\n        }\n    }\n\n    return (\n        <FileLoader onLoad={onLoad}\n                    readAsArrayBuffer={true}\n                    title={\"Importeer MT940 bestand\"}\n                    accept={\".swi\"}/>\n    );\n}\n\nexport default MT940Loader","const _array = (item: any) => {\n    if (!item) {\n        return []\n    } else if (item instanceof Array) {\n        return item\n    } else {\n        return [item]\n    }\n}\n\ntype TTxDtl = BkToCstmrStmt[\"Ntry\"][0][\"NtryDtls\"][0][\"TxDtls\"][0]\n\ninterface StmtBal {\n    Amt: number\n    Ccy: string\n    CdtDbtInd: string\n    Dt: string,\n    Tp: {\n        CdOrPrtry: {\n            Cd: string\n            Prtry: string\n        }\n    }\n}\n\ninterface StmtAcct {\n    Id: {\n        IBAN: string\n        Othr: string\n    }\n    Ccy: string\n}\n\nclass StmtNtry {\n    NtryRef: string\n    Amt: number\n    Ccy: string\n    CdtDbtInd: string\n    BookgDt: string\n    ValDt: string\n    AddtlNtryInf: string\n    NtryDtls: {\n        TxDtls: {\n            RltdPties: {\n                Nm: string\n            }[]\n            RmtInf: {\n                Ustrd: string\n            }[]\n        }[]\n    }[]\n\n    constructor(ntry: any) {\n        this.NtryRef = ntry[\"NtryRef\"]\n        this.Amt = ntry[\"Amt\"][\"_\"]\n        this.Ccy = ntry[\"Amt\"][\"$\"][\"Ccy\"]\n        this.CdtDbtInd = ntry[\"CdtDbtInd\"]\n        this.BookgDt = ntry[\"BookgDt\"][\"Dt\"]\n        this.ValDt = ntry[\"ValDt\"][\"Dt\"]\n        this.AddtlNtryInf = ntry[\"AddtlNtryInf\"]\n        this.NtryDtls = _array(ntry[\"NtryDtls\"]).map((ntryDtls:any) => ({\n            TxDtls: _array(ntryDtls[\"TxDtls\"]).map((txDtls:any) => ({\n                RltdPties: _array(txDtls[\"RltdPties\"]).map((rltdPties:any) => ({\n                    Nm: (rltdPties[\"Cdtr\"] || rltdPties[\"Dbtr\"] || {})[\"Nm\"]\n                })),\n                RmtInf: _array(txDtls[\"RmtInf\"]).map((rmtInf: any) => ({\n                    Ustrd: rmtInf[\"Ustrd\"]\n                }))\n            }))\n        }))\n    }\n\n    joinedTxDtls(func: (txDtl: TTxDtl) => string[]): string {\n        let values: string[] = []\n        this.NtryDtls.forEach(ntryDtl =>\n            ntryDtl.TxDtls.forEach(txDtl => values = values.concat(func(txDtl))))\n        return values.join(\" \")\n    }\n\n    get Nm() : string {\n        return this.joinedTxDtls((txDtl: TTxDtl) => txDtl.RltdPties.map(rltdPty => rltdPty.Nm)) || \"\"\n    }\n\n    get RmtInf() : string {\n        return this.joinedTxDtls((txDtl: TTxDtl) => txDtl.RmtInf.map(inf => inf.Ustrd)) || this.AddtlNtryInf || \"\"\n    }\n}\n\nexport class BkToCstmrStmt {\n    Id: string\n    Acct: StmtAcct\n    Bal: StmtBal[]\n    Ntry: StmtNtry[]\n\n    constructor(statement: any) {\n        this.Id = statement[\"Id\"]\n        this.Acct = {\n            Id: {\n                IBAN: statement[\"Acct\"][\"Id\"][\"IBAN\"],\n                Othr: statement[\"Acct\"][\"Id\"][\"Othr\"]\n            },\n            Ccy: statement[\"Acct\"][\"Ccy\"]\n        }\n        this.Bal = (statement[\"Bal\"] || []).map((bal: any) => ({\n            Amt: bal[\"Amt\"][\"_\"],\n            Ccy: bal[\"Amt\"][\"$\"][\"Ccy\"],\n            CdtDbtInd: bal[\"CdtDbtInd\"],\n            Dt: bal[\"Dt\"][\"Dt\"],\n            Tp: {\n                CdOrPrtry: {\n                    Cd: bal[\"Tp\"][\"CdOrPrtry\"][\"Cd\"],\n                    Prtry: bal[\"Tp\"][\"CdOrPrtry\"][\"Prtry\"]\n                }\n            }\n        }))\n        this.Ntry = _array(statement[\"Ntry\"]).map((ntry: any) => new StmtNtry(ntry))\n    }\n}\n\nexport class CAMT053 {\n    statements: BkToCstmrStmt[]\n\n    constructor(jsonStatement: any) {\n        this.statements = _array(jsonStatement[\"Document\"][\"BkToCstmrStmt\"][\"Stmt\"])\n    }\n}\n","import { BankImportStatement } from \"./BankImportStatement\"\nimport { BkToCstmrStmt } from \"./CAMT053\";\nimport { CreditDebit } from \"../Amount\"\nimport { AccountBalance } from \"../LiquidAssets/AccountBalance\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\nimport {\n    AccountBalanceData,\n    PlainAccountStatementData,\n    PlainBankAccountData,\n    StatementEntryData\n} from \"../../model\"\n\ntype TNtry = BkToCstmrStmt[\"Ntry\"][0]\ntype TBal = BkToCstmrStmt[\"Bal\"][0]\n\n/**\n * CAMT053 Import Statement\n */\nexport class CAMT053ImportStatement extends BankImportStatement {\n\n    constructor(statement: BkToCstmrStmt) {\n        super(CAMT053ImportStatement.getBankAccount(statement),\n              CAMT053ImportStatement.getAccountStatement(statement),\n              statement.Ntry.map((ntry, i) =>\n                  CAMT053ImportStatement.getStatementEntry(statement, ntry, i))\n        )\n    }\n\n    /**\n     * Gets the Bank Account data for the given statement\n     */\n    private static getBankAccount(statement: BkToCstmrStmt): PlainBankAccountData {\n        return {\n            id: statement.Acct.Id.IBAN ?? Object.values(statement.Acct.Id.Othr).join(\"\"),\n            currency: statement.Acct.Ccy,\n            ledgerAccountCode: LedgerScheme.DefaultBankAccountCode,\n        }\n    }\n\n    /**\n     * Converts CAMT053 CRDT or DBIT strings to CreditDebit enum\n     */\n    private static asCreditDebit(CdtDbtInd: string) {\n        return CdtDbtInd === \"CRDT\" ? CreditDebit.Credit : CreditDebit.Debit\n    }\n\n    /**\n     * Gets the Account Balance data for the given balance (if available)\n     */\n    private static getAccountBalance(balance?: TBal): AccountBalanceData {\n        if (balance) {\n            return {\n                date: balance.Dt,\n                amountData: {\n                    amount: balance.Amt,\n                    currency: balance.Ccy,\n                    creditDebit: CAMT053ImportStatement.asCreditDebit(balance.CdtDbtInd)\n                }\n            }\n        } else {\n            return new AccountBalance().data\n        }\n    }\n\n    /**\n     * Get the Account Statement data for the given statement\n     */\n    private static getAccountStatement(statement: BkToCstmrStmt): PlainAccountStatementData {\n        const openingBalance = statement.Bal.find((bal: TBal) => bal.Tp.CdOrPrtry.Cd === \"OPBD\")\n        const closingBalance = statement.Bal.find((bal: TBal) => bal.Tp.CdOrPrtry.Cd === \"CLBD\")\n        return {\n            id: statement.Id,\n            openingBalanceData: CAMT053ImportStatement.getAccountBalance(openingBalance),\n            closingBalanceData: CAMT053ImportStatement.getAccountBalance(closingBalance),\n        }\n    }\n\n    /**\n     * Get the Statement Entry data for the given statement\n     */\n    private static getStatementEntry(statement: BkToCstmrStmt, ntry: TNtry, i: number): StatementEntryData {\n        return {\n            id: ntry.NtryRef || `${statement.Id}.${i}`,\n            amountData: {\n                amount: ntry.Amt,\n                currency: ntry.Ccy,\n                creditDebit: CAMT053ImportStatement.asCreditDebit(ntry.CdtDbtInd)\n            },\n            bookDate: ntry.BookgDt,\n            valueDate: ntry.ValDt,\n            relatedParties: ntry.Nm,\n            remittanceInformation: ntry.RmtInf,\n            accountStatementRef: statement.Id\n        }\n    }\n}","import React from 'react';\n\nimport { parseString } from 'xml2js'\n\nimport { BkToCstmrStmt, CAMT053 } from \"../../types/BankImport/CAMT053\"\nimport { CAMT053ImportStatement } from \"../../types/BankImport/CAMT053ImportStatement\";\nimport { BankImportStatement } from \"../../types/BankImport/BankImportStatement\";\n\nimport FileLoader from \"./FileLoader\";\n\ninterface CAMT053LoaderProps {\n    onLoad: (statements: BankImportStatement[]) => void\n}\n\nfunction CAMT053Loader(props: CAMT053LoaderProps) {\n    const statements: BankImportStatement[] = []\n\n    function onLoad (result: any) {\n        if (result) {\n            const xml = result as string\n            parseString(xml, {explicitArray: false}, (err: Error, result: any) => {\n                if (!err) {\n                    const camt053 = new CAMT053(result)\n                    for (let camt053Statement of camt053.statements) {\n                        const bkToCstmrStmt = new BkToCstmrStmt(camt053Statement)\n                        statements.push(new CAMT053ImportStatement(bkToCstmrStmt))\n                    }\n                }\n            })\n            props.onLoad(statements)\n        }\n    }\n\n    return (\n        <FileLoader onLoad={onLoad}\n                    title={\"Importeer CAMT.053 bestand\"}\n                    accept={\".xml\"}/>\n\n    );\n}\n\nexport default CAMT053Loader","import { BankImportStatement } from \"../../types/BankImport/BankImportStatement\"\nimport MT940Loader from \"./MT940Loader\"\nimport CAMT053Loader from \"./CAMT053Loader\"\nimport React from \"react\"\n\nexport function BankImports(props: { onLoad: (statements: BankImportStatement[]) => void }) {\n    return <>\n        <h3>Bank</h3>\n        <p>\n            Via onderstaande buttons kan een import worden gestart van een MT940 of CAMT.053 bestand\n        </p>\n        <p>\n            <MT940Loader onLoad={props.onLoad}/>\n        </p>\n        <p>\n            <CAMT053Loader onLoad={props.onLoad}/>\n        </p>\n    </>\n}","import React, { useEffect, useState } from \"react\"\n\nimport { parseString } from \"xml2js\"\n\nimport { Button, CircularProgress, Grid, TextField } from \"@material-ui/core\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport { Check, Dialpad, Error, KeyboardArrowDown, KeyboardArrowUp } from \"@material-ui/icons\"\n\nimport { BIZCUIT_LINK_API } from \"../../config\"\nimport logo from \"./BizcuitLogo.png\"\n\nimport { BankImportStatement } from \"../../types/BankImport/BankImportStatement\"\nimport { BkToCstmrStmt, CAMT053 } from \"../../types/BankImport/CAMT053\"\nimport { CAMT053ImportStatement } from \"../../types/BankImport/CAMT053ImportStatement\"\n\nexport function BizcuitImport(props: { onLoad: (statements: BankImportStatement[]) => void }) {\n    const [requestId, setRequestId] = useState(\"\")\n    const [pincode, setPincode] = useState(\"\")\n    const [success, setSuccess] = useState<boolean | undefined>(undefined)\n    const [loading, setLoading] = useState(false)\n    const [open, setOpen] = useState(false)\n    const [bizcuitRef, setBizcuitRef] = useState(\"\")\n\n    const title = \"Importeer vanuit Bizcuit\"\n\n    const onClick = () => {\n        window.open(bizcuitRef, \"\")\n        setPincode(\"\")\n        setSuccess(undefined)\n    }\n\n    const onPincode = (event: any) => {\n        const value = event.target.value || \"\"\n        setPincode(value)\n    }\n\n    useEffect(() => {\n        let autoClose:NodeJS.Timeout | null = null\n\n        const cancelAutoClose = () => {\n            if (autoClose) {\n                clearTimeout(autoClose)\n                autoClose = null\n            }\n        }\n\n        const getBizcuitRef = async () => {\n            try {\n                const response = await fetch(BIZCUIT_LINK_API + \"/bizcuit_auth\")\n                const data = await response.json() as {url: string, requestId: string}\n                setBizcuitRef(data.url)\n                setRequestId(data.requestId)\n                autoClose = setTimeout(() => setOpen(false), 60 * 1000)\n            } catch (err) {\n                console.log(err)\n            }\n        }\n\n        if (open) {\n            getBizcuitRef()\n        } else {\n            setBizcuitRef(\"\")\n            setRequestId(\"\")\n            cancelAutoClose()\n        }\n\n        return () => {\n            cancelAutoClose()\n        }\n    }, [open])\n\n    useEffect(() => {\n        const getTransactions = async() => {\n            setLoading(true)\n            try {\n                const parameters = `?requestId=${requestId}&pincode=${pincode}`\n                const response = await fetch(BIZCUIT_LINK_API + \"/bizcuit_transactions\" + parameters)\n                const data = await response.json()\n                const items = data as {camt: string}[]\n                setSuccess(true)\n\n                const statements: BankImportStatement[] = []\n                items.forEach(item => {\n                    const xml = item.camt\n                    parseString(xml, {explicitArray: false}, (err: Error, result: any) => {\n                        if (!err) {\n                            const camt053 = new CAMT053(result)\n                            for (let camt053Statement of camt053.statements) {\n                                const bkToCstmrStmt = new BkToCstmrStmt(camt053Statement)\n                                statements.push(new CAMT053ImportStatement(bkToCstmrStmt))\n                            }\n                        }\n                    })\n                })\n                props.onLoad(statements)\n            } catch (err) {\n                setSuccess(false)\n                props.onLoad([])\n            }\n            setLoading(false)\n        }\n\n        if (requestId && pincode.length === 6) {\n            getTransactions()\n            setRequestId(\"\")\n        }\n    }, [props, pincode, requestId])\n\n    return <>\n        <h3>\n            <Grid container direction={\"row\"} justify={\"center\"} alignItems={\"center\"} spacing={1}\n                  onClick={() => setOpen(!open)}\n                  style={{cursor: \"pointer\"}}>\n                <Grid item><img src={logo} alt={\"Bizcuit logo\"} width={20}/></Grid>\n                <Grid item>Bizcuit</Grid>\n                <Grid item>\n                    <IconButton aria-label={\"Activate Bizcuit import\"} color={\"primary\"} size={\"small\"}>\n                        {!open && <KeyboardArrowDown/>}\n                        {open && <KeyboardArrowUp/>}\n                    </IconButton>\n                </Grid>\n            </Grid>\n        </h3>\n        {open && <>\n        <p>\n            Via onderstaande button kan een import worden gestart vanuit Bizcuit\n        </p>\n        <p>\n            <Button variant={\"contained\"}\n                    style={{width: 290}}\n                    disabled={!bizcuitRef}\n                    aria-label={title}\n                    onClick={onClick}\n                    color={\"primary\"}>\n                {bizcuitRef ? title : \"Initialiseer koppeling...\"}\n            </Button>\n        </p>\n        <p>\n            De import wordt geautoriseerd bij Bizcuit<br/>\n            Daarna onvangt u per email een pincode waarmee u de import onderstaand kunt bevestigen\n        </p>\n        <Grid container direction={\"row\"} justify={\"center\"} alignItems={\"center\"} spacing={1}>\n            <Grid item><form><TextField style={{width: 100}}\n                       variant=\"outlined\"\n                       autoComplete=\"off\"\n                       inputProps={{style: { textAlign: 'center' }}}\n                       disabled={!requestId}\n                       label=\"Pincode\"\n                       type={\"password\"}\n                       onChange={onPincode}\n                       value={pincode}/></form> </Grid>\n\n            {loading && <Grid item><CircularProgress size={24}/></Grid>}\n            {!loading && <Grid item>{success === true ? <Check/> : success === false ? <Error/> : <Dialpad/>}</Grid>}\n        </Grid>\n        </>}\n    </>\n}","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAkCAYAAADsHujfAAAABmJLR0QA/wD/AP+gvaeTAAAElUlEQVRYha3Ya4xdUxTA8d++M602g9CM1HjVOxRVQqVBvd/SMKL4gDQiNKFUCFHtnBni/YomqC+V+FCPiqIe8Wh9IEKUehSNFGklHi3iMUFn7mwfzp17z7333M69w/p01trrrP0/5+y99lonaFFiohOnYgYOxe7YCQPYgp/wBT7Gq3g/JIZGihuaBuh1kuhqnIX2Fth/xGPGeCTM9/2oQWJiKhbhmBYmz5N/cJ8Ot4cb9DcNEp/W5nMLMF/9GxjEKnyArwUbRUVBm2gSJuMETMkJvUHBhWGhd0cEiffo0O8ZnFEztB73YllIbG70EOU4t9pL0Rxcjh0yQ1sEc0OPxQ1BYmJbvIbpGfOv6MPDIbFlJICcmJ24A5fVzDkvJB6sA4mJdryCkzPmz7WZGRZY3ypADlA3Hsd2wybBZaHHklqQO3FjxrTSON3hJr/9V4jMHIfjDexYMv2lYHoZJPaZbsjbKJRMa41zdCOImJiC63E8ulQW9AA2YY1gueiJkPi76t4+RxnyFsaVTB8FiASJDzG1NPCLNkeEBb7Jheg1R/SQ5vLJRsGloceqnBgPl9QfQunpuvFs2Std0YtyIRJnYoUWkqF0u58XEi/UxLpeus0fGAZZJX3FsE6XQ8IVBhqArJXmCfhTcLtoNeU0XhDsJToHp2du/RMHhsR3eXHbY2JPHFe2BPdtBWL/DARcHno8meeLxbHXeaKlGINtcROuynMuCM5Qec2DoucaBCaYlOWyvecb+iL0eBYPZUznNvItiI7O6G+NkDHHZq6HwnX+2hpISVZkrrvi/cbng3BwRv+kicCtSSjnCxi0W35mLmCXjJ67XUcrMVEQq9bEZ2GWYiOQymEUbPzfIG6zK57EiZn4Sxr5tyNW7s5cj2byxDG4CJMNOoqq9fCRnT26NZB+lUW4QyPHJiAm4HWVtJ2VzTi7UVog/TQbMvreowUxVhvaGox24t6Y2H5rIGsz+rTRcoSbbRKciyewUlrDZOUivNMIpoB3MvqMeI+OUcP0eCkkLgmJk0y2k2AmPs24HIylMSmf8FUgK1QWbId+548WpApqlmLo8aIJjsRTmaEzcUkdSEhsUP1WbomLjfk/YCDM9Y8uF2NNxjyvDiT1TuvGkuzje7Nzo8aqZJSbmHJh0t3SkzFNibfZvR7kQMtriO+Mt9qvLuJYq6XVF7zcLAjo8GaVXnRAHUiYpahgrkpNsaOi5fGucpGL0s5Iy4BjaXEtTfK3tEAalqrqrrZ4vhs3ZEyv6dCd15m1KrHPQYZ8VjYUTAkLKzuqeht1mS+tsIflVP1WxsQe/xXEkDkZbZOJvswOV4GEKwwYrxvvZczTsCb2uiYmVfVI0xJ7nYUrM6altek+v+VMu71lOK1m6NtSjfpcUy1nol1wtegObFMy/4wDau8fqQlfKG3Ca8+QIt7Fm4J1ok34XUHRkPGCiaJpuICq8nIA54SkfseN/Fuiz2GGLKKqpByN/CGYXapj66T5HzWJk3GN9HO1mnlf1ubasMBXjRxaaZKGgToFp4hmSA+xfaVN9fBhOdxyfiv9h7IsJFXJMlf+BdJgUDLZtI0xAAAAAElFTkSuQmCC\"","import FileLoader from \"./FileLoader\"\nimport React from \"react\"\nimport { useSelector } from \"react-redux\"\nimport { selectAge } from \"../../app/AgeSlice\"\nimport { Alert, AlertTitle } from \"@material-ui/lab\"\n\nexport function VersionImports(props: { onLoad: (result: any) => void }) {\n    const age = useSelector(selectAge)\n\n    return <>\n        <h3>Bestand</h3>\n        <p>\n            Via onderstaande button kan een import worden gestart van een eerder bewaarde versie\n        </p>\n\n        {age > 0 && <div style={{width: \"50%\", margin: \"auto\"}}>\n            <Alert variant={\"filled\"} severity=\"warning\" className={\"text-left-align\"}>\n                <AlertTitle className={\"text-left-align\"}>\n                    {`Let op, er zijn nog ${age} onbewaarde updates`}\n                </AlertTitle>\n                Als u deze updates niet verloren wilt laten gaan dient u ze te bewaren voordat u een nieuwe versie importeert\n            </Alert>\n        </div>}\n\n        <p>\n            <FileLoader onLoad={props.onLoad}\n                        title={\"Importeer versie\"}\n                        accept={\".json\"}/>\n        </p>\n    </>\n}","import React from \"react\"\n\nimport \"./CSSSpinner.css\"\n\nexport function CSSSpinner() {\n    return (\n        <div className=\"spinner\">\n            <div className=\"rect1\"/>\n            <div className=\"rect2\"/>\n            <div className=\"rect3\"/>\n            <div className=\"rect4\"/>\n            <div className=\"rect5\"/>\n        </div>)\n}","import React, { useRef } from \"react\"\nimport { Backdrop, CircularProgress, IconButton } from \"@material-ui/core\"\nimport { CSSSpinner } from \"../Indicators/CSSSpinner\"\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\"\nimport { ErrorOutline } from \"@material-ui/icons\"\n\nexport const UPLOAD_ERROR_MSG = \"Upload mislukt\"\nexport const PASSWORD_ERROR = \"Onjuist wachtwoord\"\nexport const UPLOAD_CANCELLED = \"Upload afgebroken\"\n\nexport function isProgressError(progress: string) {\n    return [UPLOAD_ERROR_MSG, PASSWORD_ERROR, UPLOAD_CANCELLED].includes(progress)\n}\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        backdrop: {\n            zIndex: theme.zIndex.drawer + 1,\n            color: '#fff',\n        },\n    }),\n);\n\nexport function LoadingProgress(props: { progress: string, loading: boolean, entriesRead: number, onClose: () => void }) {\n    const classes = useStyles()\n    const okButton = useRef<any>(React.createRef())\n\n    const {progress, loading, entriesRead, onClose} = props\n\n    const anyErrors = isProgressError(progress)\n\n    if (!loading) {\n        // Auto close\n        setTimeout(() => okButton.current?.click(), 1500)\n    }\n\n    return <div>\n        <Backdrop className={classes.backdrop} open={loading}/>\n        <h3>Import Voortgang</h3>\n        <p>\n            {progress}\n        </p>\n\n        {/*While Loading*/}\n        {loading &&\n        <CSSSpinner/>}\n\n        {/*When loading has finished*/}\n        {!loading &&\n        <div>\n\n            {/*No errors*/}\n            {!anyErrors &&\n            <div>\n                <p>\n                    U wordt in enkele ogenblikken automatisch omgeleid naar de boekingspagina\n                </p>\n                {entriesRead > 0 &&\n                <div>\n                    Hier kunt u de {entriesRead} nieuwe transacties toewijzen aan grootboekrekeningen\n                </div>}\n            </div>}\n\n            <div>\n                <IconButton ref={okButton} onClick={onClose} component=\"label\">\n                    {anyErrors  && <ErrorOutline/>}\n                    {!anyErrors && <CircularProgress size={25}/>}\n                </IconButton>\n            </div>\n        </div>}\n    </div>\n}","import React, { useState } from 'react'\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\n\ninterface ImportDialogProps {\n    open: boolean\n    onClose: (password: string | null) => void\n}\n\nexport default function ImportDialog(props: ImportDialogProps) {\n\n    const [password, setPassword] = useState(\"\")\n\n    const { open } = props\n\n    const onPassword = (event: any) => setPassword(event.target.value)\n\n    const onClose = (password: string | null) => {\n        setPassword(\"\")\n        props.onClose(password)\n    }\n\n    const handleClose = () => onClose(password)\n\n    const handleCancel = () => onClose(null)\n\n    return (\n        <div>\n            <Dialog fullWidth={false}\n                    open={open}\n                    maxWidth={false}\n                    onClose={handleClose}\n                    aria-labelledby=\"import-dialog-title\">\n                <DialogTitle id=\"import-dialog-title\">Wachtwoord</DialogTitle>\n                <DialogContent dividers>\n                    <DialogContentText>\n                        Uw administratie is versleuteld opgeslagen\n                        <br/>\n                        U dient het wachtwoord (of wachtzin) in te geven waarmee het bestand is versleuteld\n                    </DialogContentText>\n                    <form noValidate autoComplete=\"off\" onSubmit={handleClose}>\n                    <TextField\n                        value={password}\n                        onChange={onPassword}\n                        autoFocus\n                        margin=\"dense\"\n                        id=\"password\"\n                        inputProps={{autoComplete: \"on\"}}\n                        label=\"Wachtwoord of wachtzin\"\n                        type=\"password\"\n                        fullWidth\n                    />\n                    </form>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={handleCancel} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button onClick={handleClose} color=\"primary\" disabled={!password}>\n                        OK\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        </div>\n    );\n}\n","import React, { useState } from 'react'\nimport { useDispatch } from 'react-redux'\n\nimport { addStatements } from '../app/AccountingSlice'\nimport { BankImportStatement } from \"../types/BankImport/BankImportStatement\"\nimport { Routes } from \"../routes/routes\"\nimport PageHeader from \"./PageHeader\"\nimport { resetState, restoreStateFromJSON } from \"../services/stateIO\"\nimport { useHistory, useLocation } from \"react-router-dom\"\nimport { LedgerScheme } from \"../types/Ledger/LedgerScheme\"\nimport { Accounting } from \"../types/Accounting\"\nimport { BankImports } from \"../components/Loader/BankImports\"\nimport { BizcuitImport } from \"../components/Loader/BizcuitImport\"\nimport { VersionImports } from \"../components/Loader/VersionImports\"\nimport {\n    isProgressError,\n    LoadingProgress,\n    PASSWORD_ERROR,\n    UPLOAD_CANCELLED,\n    UPLOAD_ERROR_MSG\n} from \"../components/Loader/UploadLoadingProgress\"\nimport ImportDialog from \"../components/Loader/ImportDialog\"\nimport { decryptJSON, isJSONEncrypted } from \"../services/crypto\"\nimport { resetAge } from \"../app/AgeSlice\"\n\nfunction UploadPage() {\n    const search = useLocation().search\n    const bizcuit = new URLSearchParams(search).get('bizcuit')\n\n    const [ progress, setProgress ] = useState(\"\")\n    const [ loading, setLoading ] = useState<boolean>(false)\n    const [ entriesRead, setEntriesRead ] = useState(0)\n    const [ JSONResult, setJSONResult ] = useState(\"\")\n\n    const dispatch = useDispatch()\n    const history = useHistory();\n\n    function onLoad (statements: BankImportStatement[]) {\n        setLoading(true)\n        setProgress(`Bank transacties worden ingelezen...`)\n\n        let accounting = new Accounting()\n        let nStatements = -accounting.liquidAssets.getAccountStatementMap().size\n        let nEntries = -accounting.liquidAssets.getStatementEntryMap().size\n\n        if (statements.length) {\n            setTimeout(() => {\n                // Monitor the number of statements and entries read\n                try {\n                    dispatch(addStatements({statementsData: statements.map(statement => statement.data)}))\n\n                    accounting = new Accounting()\n                    nStatements += accounting.liquidAssets.getAccountStatementMap().size\n                    nEntries += accounting.liquidAssets.getStatementEntryMap().size\n\n                    setEntriesRead(nEntries)\n                    setProgress(`${nEntries} nieuwe transacties en ${nStatements} nieuwe statements en  zijn ingelezen`)\n                } catch (e) {\n                    console.error(e)\n                    setProgress(UPLOAD_ERROR_MSG)\n                } finally {\n                    setLoading(false)\n                }\n            }, 0)\n        } else {\n            setProgress(UPLOAD_ERROR_MSG)\n            setLoading(false)\n        }\n    }\n\n    function onRead (result: any) {\n        resetState(dispatch)\n        setLoading(true)\n        setProgress(`Versie wordt ingelezen...`)\n\n        if (result && typeof(result) === typeof(\"\")) {\n            if (isJSONEncrypted(result)) {\n                setJSONResult(result)\n            } else {\n                setTimeout(() => {\n                    try {\n                        JSON.parse(result)\n                        restoreStateFromJSON(result, dispatch)\n                        dispatch(resetAge())\n                        setProgress(`Bewaarde versie is ingelezen`)\n                    } catch (e) {\n                        console.error(e)\n                        setProgress(UPLOAD_ERROR_MSG)\n                    } finally {\n                        setLoading(false)\n                    }\n                }, 0)\n            }\n        } else {\n            setProgress(UPLOAD_ERROR_MSG)\n            setLoading(false)\n        }\n    }\n\n    function onCloseImportDialog(password: string | null) {\n        setJSONResult(\"\")\n\n        if (password) {\n            try {\n                const json = decryptJSON(JSONResult, password)\n                return onRead(json)\n            } catch {}\n            setProgress(PASSWORD_ERROR)\n        } else {\n            setProgress(UPLOAD_CANCELLED)\n        }\n        setLoading(false)\n    }\n\n    function onClose() {\n        const success = !isProgressError(progress)\n        setProgress(\"\")\n        if (success) {\n            // If new entries have been read then filter on unmapped entries\n            history.push({\n                pathname: Routes.Map.path,\n                search: entriesRead ? `?ledgerAccountCode=${LedgerScheme.unmapped.code}` : \"\"\n            })\n        }\n    }\n\n    const bizcuitImport = bizcuit ? <BizcuitImport onLoad={onLoad}/> : null\n\n    return (\n        <div>\n            <PageHeader title={Routes.Upload} periodFilter={false} withName={false}/>\n            {JSONResult && <ImportDialog open={true} onClose={onCloseImportDialog}/>}\n            {progress &&\n                <LoadingProgress progress={progress} loading={loading} entriesRead={entriesRead} onClose={onClose}/>}\n            {!progress &&\n                <>\n                    <BankImports onLoad={onLoad}/>\n                    {bizcuitImport}\n                    <VersionImports onLoad={onRead}/>\n                </>}\n        </div>\n    );\n}\n\nexport default UploadPage;\n","/* ./worker/index.ts */\n\n// eslint-disable-next-line\nimport Worker from 'comlink-loader!./worker'; // inline loader\n\nexport default Worker;\n","import { AccountingState } from \"../app/AccountingSlice\"\nimport { LedgerScheme, LedgerSchemeData } from \"./Ledger/LedgerScheme\"\nimport { Accounting } from \"./Accounting\"\n\n/**\n * This class stores a reference to the current Accounting data\n *\n * The class is used to transfer the current Accounting state to a Web Worker\n * The Web Worker runs in a separate thread and uses the environment to re-create any Accounting classes\n *\n */\n\nexport interface EnvironmentData {\n    ledgerScheme: LedgerSchemeData\n    state: AccountingState\n}\n\nexport class Environment {\n\n    constructor(data?: EnvironmentData) {\n        /**\n         * Without any data the current Accounting state is returned\n         */\n        if (data) {\n            /**\n             * With data; a Web Worker can re-create the accounting classes from any received environment data\n             */\n            const { ledgerScheme, state } = data\n\n            LedgerScheme.Data = ledgerScheme\n            Accounting.State = state\n        }\n    }\n\n    /**\n     * Get the current Accounting data\n     * This data can be passed to a Web Worker\n     */\n    get data(): EnvironmentData {\n        return {\n            ledgerScheme: LedgerScheme.Data,\n            state: Accounting.State\n        }\n    }\n}","import * as queryString from \"query-string\"\nimport { StringifyOptions } from \"query-string\"\n\nconst queryStringOptions: StringifyOptions = {\n    arrayFormat: 'bracket',\n    skipEmptyString: true,\n    skipNull: true\n}\n\ntype LocationProvider = { search: string }\ntype HistoryProvider = { push: (obj: any) => void }\ntype SearchState = Record<string, string | string[] | null>\n\n/**\n * Allows to store state in the URL\n */\nexport class URLState {\n\n    private state: SearchState\n\n    constructor(location: LocationProvider) {\n        this.state = this.load(location)\n    }\n\n    save(history: HistoryProvider, location: LocationProvider, urlState: any) {\n        this.state = this.load(location)\n        const newState = {\n            ...this.state,\n            ...urlState\n        }\n        const search = queryString.stringify(newState, queryStringOptions)\n        history.push({search})\n    }\n\n    load(location: LocationProvider): SearchState {\n        return queryString.parse(location.search, queryStringOptions)\n    }\n\n    hasValue(key: string): boolean {\n        return !(this.getValue(key) === null || this.getValue(key) === undefined)\n    }\n\n    getValue(key: string): any {\n        return this.state[key]\n    }\n\n    getStringValue(key: string): string {\n        const value = this.getValue(key)\n        return typeof value === 'string' ? value : \"\"\n    }\n\n    getStringArrayValue(key: string): string[] {\n        const value = this.getValue(key)\n        return Array.isArray(value) ? value : []\n    }\n\n    getNumericValue(key: string, defaultValue: number = 0): number {\n        const value = this.getValue(key)\n        if (typeof value === 'string') {\n            const intValue = parseInt(value)\n            return isNaN(intValue) ? defaultValue : intValue\n        }\n        return defaultValue\n    }\n\n    getNumericArrayValue(key: string): number[] {\n        const value = this.getValue(key)\n        return Array.isArray(value) ? value.map(v => parseInt(v)) : []\n    }\n}","import { useHistory, useLocation } from \"react-router-dom\"\nimport { useEffect, useRef, useState } from \"react\"\nimport { URLState } from \"../services/URLState\"\n\nexport function useURLState(): [URLState, (state: Record<string, any>) => void] {\n    const location = useLocation()\n    const history = useHistory()\n    const unregisterListener = useRef<() => void>(() => null)\n\n    const [urlState, setURLState] = useState<URLState>(() => new URLState(location))\n\n    const setState = (state: Record<string, any>) => {\n        urlState.save(history, location, state)\n    }\n\n    useEffect(() => {\n        unregisterListener.current = history.listen((location) => {\n            setURLState(new URLState(location))\n        })\n\n        return () => {\n            unregisterListener.current()\n        }\n    },[history])\n\n    return [urlState, setState];\n}\n","import { AllocationFilterData } from \"../model\"\nimport { Period } from \"./Period\"\nimport { LedgerAccount } from \"./Ledger/LedgerAccount\"\nimport { LedgerScheme } from \"./Ledger/LedgerScheme\"\n\n/**\n * Simple filter on period and account\n * Its data is used to be stored in the application state\n */\nexport class AllocationFilter {\n    constructor(public data: AllocationFilterData = { periodId: null, ledgerAccountCode: null}) {}\n\n    /**\n     * Returns the period on which is filtered, or null\n     */\n    get period(): Period | null {\n        const { periodId } = this.data\n        return periodId ? new Period(periodId) : null\n    }\n\n    /**\n     * Returns the ledgerAccount on which is filtered, or null\n     */\n    get ledgerAccount(): LedgerAccount | null {\n        const { ledgerAccountCode } = this.data\n        return ledgerAccountCode ? LedgerScheme.getAccount(ledgerAccountCode) : null\n    }\n\n    /**\n     * Returns the code of the ledgerAccount on which is filtered, or null\n     */\n    get ledgerAccountCode(): string | null {\n        const { ledgerAccountCode } = this.data\n        return ledgerAccountCode\n    }\n}","import { useTheme } from \"@material-ui/core/styles\"\nimport { useMediaQuery } from \"@material-ui/core\"\n\ntype StylingOptions = {\n    variant: \"outlined\" | \"standard\" | \"filled\"\n    inputProps: {\n        disableUnderline?: boolean\n    }\n}\n\nexport function useResponsiveStyling(): StylingOptions {\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    return onXs\n        ? { variant: \"outlined\", inputProps: {}}\n        : { variant: \"standard\", inputProps: { disableUnderline: true }}\n}\n","import React from 'react'\n\nimport { MenuItem, Select, useMediaQuery } from \"@material-ui/core\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { useResponsiveStyling } from \"../Editors/useResponsiveStyling\"\n\ninterface Props {\n    title: string\n    width: number\n    items: string[]\n    item: string | null\n    onItem: (item: string | null) => void\n}\n\nfunction ItemSelect(props: Props) {\n    const { title, width, items, item, onItem } = props\n\n    const { variant } = useResponsiveStyling()\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'))\n\n    const value = item ?? \"\"\n\n    function onChange(event: React.ChangeEvent<{ value: unknown }>) {\n        const newItem = event.target.value as string\n        if (newItem !== item) {\n            onItem(newItem || null)\n        }\n    }\n\n    return (\n        <div>\n            <Select\n                style={{width: onXs ? \"100%\" : width}}\n                value={value}\n                variant={variant}\n                onChange={onChange}\n                displayEmpty={true}\n                disableUnderline={true}\n                aria-label={title}\n            >\n                <MenuItem value={\"\"}>\n                    {title + \"...\"}\n                </MenuItem>\n                {items.map(item => {\n                    return (\n                        <MenuItem key={item} value={item}>\n                            {item}\n                        </MenuItem>\n                    )\n                })}\n            </Select>\n        </div>\n    )\n}\n\nexport default ItemSelect","import React from 'react'\n\nimport ItemSelect from \"./ItemSelect\"\n\nimport { Period } from \"../../types/Period\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\nimport { AllocationFilter } from \"../../types/AllocationFilter\"\n\ninterface Props {\n    title: string\n    width: number\n    allocations: LedgerAllocationMap\n    allocationFilter: AllocationFilter\n    onPeriod: (period: Period | null) => void\n}\n\nfunction PeriodSelect(props: Props) {\n    const { width, allocations, allocationFilter, onPeriod } = props\n\n    const { period: periodFilter } = allocationFilter\n\n    const periods = allocations.getPeriods()\n    const period = periods.find(p => periodFilter && p.equals(periodFilter)) || null\n\n    const items = periods.map(period => period.string)\n    const item = period ? period.string : \"\"\n\n    const title = periodFilter && !item ? periodFilter.string : props.title\n\n    function onItem(item: string | null) {\n        const period = item ? periods.find(period => period.string === item) : null\n        onPeriod(period ?? null)\n    }\n\n    return (\n        <ItemSelect title={title} width={width} items={items} item={item} onItem={onItem} />\n    )\n}\n\nfunction areEqual(prevProps: Props, nextProps: Props) {\n    return prevProps.allocationFilter.period?.id === nextProps.allocationFilter.period?.id\n}\n\nexport default React.memo(PeriodSelect, areEqual)","import React from 'react'\n\nimport ItemSelect from \"./ItemSelect\"\n\nimport { LedgerAccount } from \"types/Ledger/LedgerAccount\"\nimport { LedgerAllocationMap } from \"types/Allocation/LedgerAllocationMap\"\nimport { AllocationFilter } from \"types/AllocationFilter\"\n\ninterface Props {\n    title: string\n    width: number\n    allocations: LedgerAllocationMap\n    allocationFilter: AllocationFilter\n    onAccount: (account: LedgerAccount | null) => void\n}\n\nfunction AccountSelect(props: Props) {\n    const { width, allocations, allocationFilter, onAccount } = props\n\n    const { ledgerAccount: ledgerAccountFilter } = allocationFilter\n\n    const accounts = allocations.getLedgerAccounts()\n    const account = accounts.find(a => ledgerAccountFilter && a.equals(ledgerAccountFilter)) || null\n\n    const items = accounts.map(account => account.shortDescription)\n    const item = account ? account.shortDescription : \"\"\n\n    const title = ledgerAccountFilter && !item ? ledgerAccountFilter.shortDescription : props.title\n\n    function onItem(item: string | null) {\n        const account = item ? accounts.find(account => account.shortDescription === item) : null\n        onAccount(account ?? null)\n    }\n\n    return (\n        <ItemSelect title={title} width={width} items={items} item={item} onItem={onItem} />\n    )\n}\n\nexport default AccountSelect","import React from 'react'\nimport { Grid } from \"@material-ui/core\"\nimport PeriodSelect from \"../Selectors/PeriodSelect\"\nimport AccountSelect from \"../Selectors/AccountSelect\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { Period } from \"../../types/Period\"\nimport { AllocationFilter } from \"../../types/AllocationFilter\"\nimport { useURLState } from \"../useURLState\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\n\ninterface AllocationsHeaderProps {\n    allocations: LedgerAllocationMap\n    allocationFilter: AllocationFilter\n}\n\nfunction AllocationsHeader(props: AllocationsHeaderProps) {\n    const { allocations, allocationFilter } = props\n    const [, setURLState] = useURLState()\n\n    function onAccountSelect(ledgerAccount: LedgerAccount | null) {\n        const ledgerAccountCode = ledgerAccount ? ledgerAccount.code : null\n        setURLState({ledgerAccountCode})\n    }\n\n    function onPeriodSelect(period: Period | null) {\n        const periodId = period ? period.id : null\n        setURLState({periodId})\n    }\n\n    const width = 200\n\n    return (\n        <Grid container spacing={1} direction={\"row\"} alignItems={\"center\"} justify={\"center\"}>\n\n            <Grid item>\n            <PeriodSelect title={\"Kies Periode\"}\n                          width={width}\n                          allocations={allocations}\n                          allocationFilter={allocationFilter}\n                          onPeriod={onPeriodSelect} />\n            </Grid>\n\n            <Grid item>\n            <AccountSelect title={\"Kies Grootboek\"}\n                           width={width}\n                           allocations={allocations}\n                           allocationFilter={allocationFilter}\n                           onAccount={onAccountSelect} />\n            </Grid>\n\n        </Grid>\n    )\n}\n\nexport default AllocationsHeader\n","import React from 'react'\n\nimport { Th as ThOrg, Td as TdOrg } from 'react-super-responsive-table';\n\nimport \"./ResponsiveTable.css\"\n\nexport { Table, Thead, Tbody, Tr } from 'react-super-responsive-table';\n\n\ninterface TdThProps {\n    children: React.ReactNode,\n}\n\nfunction NonEmpty(props: TdThProps) {\n    // Fix empty Th/Td not rendering properly\n    return (\n        <>\n            {props.children || '\\u00A0'}\n        </>\n    )\n}\n\nexport function Td(props: TdThProps & any) {\n\n    const { children, ...otherProps } = props\n\n    return (\n        <TdOrg {...otherProps}>\n            <NonEmpty children={children}/>\n        </TdOrg>\n    )\n}\n\nexport function Th(props: TdThProps & any) {\n\n    const { children, ...otherProps } = props\n\n    return (\n        <ThOrg {...otherProps}>\n            <NonEmpty children={children}/>\n        </ThOrg>\n    )\n}\n","import React, { ChangeEvent } from 'react'\nimport { useDispatch } from \"react-redux\"\n\nimport { Box, makeStyles, MenuItem, Select } from '@material-ui/core'\n\nimport { setPeriod } from \"../../app/AccountingSlice\"\n\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport { Period } from \"../../types/Period\"\nimport { createStyles } from \"@material-ui/core/styles\"\nimport { useResponsiveStyling } from \"./useResponsiveStyling\"\n\nexport const PeriodSelectorWidth = 70\n\nconst useStyles = makeStyles((theme) =>\n    createStyles({\n        inputRoot: {\n            paddingTop: 10,\n            paddingBottom: 10,\n        },\n        root: {\n            width: PeriodSelectorWidth,\n            [theme.breakpoints.down('xs')]: {\n                width: PeriodSelectorWidth + 20,\n                marginTop: \"-5px\"\n            },\n        },\n}));\n\ninterface PeriodSelectorProps {\n    allocation: LedgerAllocation\n    disabled: boolean\n}\n\nfunction PeriodSelector(props: PeriodSelectorProps) {\n    const { allocation, disabled } = props\n    const dispatch = useDispatch()\n    const classes = useStyles()\n    const { variant, inputProps } = useResponsiveStyling()\n\n    const period = allocation.period\n    const periods = period.getSelectablePeriods()\n\n    const onChange = (event: ChangeEvent<{ name?: string | undefined; value: unknown; }>) => {\n        const newValue = event.target.value as string\n        const newPeriod = newValue ? new Period(newValue) : period\n        if (! newPeriod.equals(period)) {\n            dispatch(setPeriod({allocationData: allocation.data, period: newPeriod.data}))\n        }\n    }\n\n    const selectOptions = periods.map(period => (\n        <MenuItem key={period.string} value={period.data}>\n            {period.toString()}\n        </MenuItem>\n    ))\n\n    return (\n        <>\n        <Box display=\"none\" displayPrint=\"block\">\n            {/* Print Only */}\n            {period.toString()}\n        </Box>\n\n        <Box display=\"block\" displayPrint=\"none\">\n        {/* Screen Only */}\n            <Select value={period}\n                    aria-label={\"kies een periode\"}\n                    variant={variant}\n                    {...inputProps}\n                    className={classes.root}\n                    inputProps={{classes: {root: classes.inputRoot}}}\n                    onChange={onChange}\n                    disabled={disabled}\n            >\n                {selectOptions}\n            </Select>\n        </Box>\n        </>\n    )\n}\n\nfunction areEqual(prevProps: PeriodSelectorProps, nextProps: PeriodSelectorProps) {\n    return prevProps.allocation.period.equals(nextProps.allocation.period) &&\n        prevProps.disabled === nextProps.disabled\n}\n\nexport default React.memo(PeriodSelector, areEqual)","import React from 'react'\nimport { highlight } from \"../../services/utils\"\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        highlight: {\n            color: theme.palette.error.dark,\n        },\n    }),\n)\n\ninterface HighlightTextProps {\n    highlightText: string\n    text: string\n}\n\nfunction HighlightText(props: HighlightTextProps) {\n    const { highlightText, text } = props\n    const classes = useStyles()\n\n    const html = highlight(highlightText, text, classes.highlight)\n\n    return (\n        <span dangerouslySetInnerHTML={{__html: html}}/>\n    )\n}\n\nexport default HighlightText;","import React, { ChangeEvent } from 'react'\n\nimport { Box, TextField } from \"@material-ui/core\"\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\"\nimport { Autocomplete } from \"@material-ui/lab\"\nimport { AutocompleteRenderInputParams } from \"@material-ui/lab/Autocomplete\"\n\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { useResponsiveStyling } from \"./useResponsiveStyling\"\nimport HighlightText from \"../Utils/HighlightText\"\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\n\nexport const AccountSelectorWidth = 225\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        code: {\n            fontSize: 10,\n            float: \"left\",\n            fontWeight: \"bold\"\n        },\n        description: {\n            textAlign: \"right\",\n            fontSize: 10\n        },\n        option: {\n            width: \"100%\"\n        },\n        autocomplete: {\n            minWidth: AccountSelectorWidth,\n            maxWidth: AccountSelectorWidth * 1.5,\n            width: \"100%\",\n            display: \"inline-block\",\n            [theme.breakpoints.down('sm')]: {\n                minWidth: AccountSelectorWidth - 50,\n                maxWidth: AccountSelectorWidth,\n            },\n            [theme.breakpoints.down('xs')]: {\n                minWidth: 0,\n                maxWidth: \"100%\",\n            },\n        }\n    }),\n)\n\nconst getOptionLabel = (option: LedgerAccount) =>\n    option.shortDescription\n\nfunction RenderInput(params: AutocompleteRenderInputParams) {\n    const { variant, inputProps } = useResponsiveStyling()\n\n    return <TextField {...params}\n                      InputProps={{\n                          ...params.InputProps,\n                          ...inputProps,\n                          \"aria-label\": \"RGS Grootboekrekening\",\n                          classes: {\n                              root: \"input-root\"\n                          }}}\n                      variant={variant}\n                      size={\"small\"}\n                      margin={\"none\"}/>\n}\n\nconst renderOption = (option: LedgerAccount, state: { inputValue: string }, classes: ReturnType<typeof useStyles>) => {\n    const {inputValue} = state\n\n    if (option.isUnmapped()) {\n        return null\n    }\n\n    return (\n        <div className={classes.option}>\n            <HighlightText highlightText={inputValue} text={option.shortDescription}/>\n            <div>\n                <div className={classes.code}>\n                    {option.code}\n                </div>\n                {option.parents.map(parent =>\n                    <div key={parent.code} className={classes.description}>\n                        {parent.shortDescription}\n                    </div>\n                )}\n            </div>\n        </div>\n    )\n}\n\ninterface RGSAccountSelectorProps {\n    accountOptions: LedgerAccount[]\n    ledgerAccount: LedgerAccount\n    onChange: (account: LedgerAccount) => void\n    disabled?: boolean\n}\n\nfunction RGSAccountSelector(props: RGSAccountSelectorProps) {\n    const classes = useStyles()\n    const { ledgerAccount, accountOptions, disabled } = props\n\n    const onChange = (event: ChangeEvent<{}>, value: LedgerAccount | null) => {\n        if (value) {\n            props.onChange(value)\n        } else {\n            props.onChange(LedgerScheme.unmapped)\n        }\n    }\n\n    const filterOptions = (options: LedgerAccount[], state: any) => {\n        let searchText = state.inputValue as string\n        if (searchText) {\n            // Show matching accounts\n            searchText = searchText.toLowerCase().trim()\n            return options.filter(option => option.matchDescription(searchText))\n        } else {\n            // Show accounts around the current ledgerAccount\n            const index = options.findIndex(option => option.equals(ledgerAccount))\n            const items = 100\n            const min = Math.max(0, index - (items / 2))\n            const max = min + items\n            return options.filter((option, i) => min <= i && i <= max)\n        }\n    }\n\n    return (\n        <>\n        <Box display=\"none\" displayPrint=\"block\">\n            {/* Print Only */}\n            {ledgerAccount.shortDescription}\n        </Box>\n\n        <Box display=\"block\" displayPrint=\"none\">\n            {/* Screen Only */}\n            <Autocomplete\n                disabled={disabled}\n                aria-label={\"kies een grootboek rekening\"}\n                autoHighlight={true}\n                noOptionsText={\"Geen rekeningen gevonden\"}\n                options={accountOptions}\n                size={\"small\"}\n                openOnFocus={false}\n                clearOnEscape={false}\n                value={ledgerAccount}\n                getOptionLabel={getOptionLabel}\n                className={classes.autocomplete}\n                renderInput={RenderInput}\n                renderOption={(option, state) => renderOption(option, state, classes)}\n                onChange={onChange}\n                filterOptions={filterOptions}\n            />\n        </Box>\n        </>\n    )\n}\n\nfunction areEqual(prevProps: RGSAccountSelectorProps, nextProps: RGSAccountSelectorProps) {\n    return prevProps.ledgerAccount.code === nextProps.ledgerAccount.code &&\n        prevProps.disabled === nextProps.disabled\n}\n\nexport default React.memo(RGSAccountSelector, areEqual)","import React from 'react';\nimport { useDispatch } from \"react-redux\"\n\nimport { Box, TextField } from \"@material-ui/core\"\n\nimport { setReason } from '../../app/AccountingSlice'\n\nimport { useResponsiveStyling } from \"./useResponsiveStyling\"\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\n\ninterface ReasonEditorProps {\n    allocation: LedgerAllocation\n}\n\nfunction ReasonEditor(props: ReasonEditorProps & any) {\n\n    const { allocation, ...textFieldProps } = props\n    const [reason, updateReason] = React.useState(allocation.reason);\n    const dispatch = useDispatch();\n    const { variant, inputProps } = useResponsiveStyling()\n\n    const onChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n        updateReason(e.target.value)\n    }\n\n    const saveValue = () => {\n        dispatch(setReason({allocationData: allocation.data, reason}))\n    }\n\n    return (\n        <>\n\n        <Box display=\"none\" displayPrint=\"block\">\n            {/* Print Only */}\n            {reason}\n        </Box>\n\n        <Box display=\"block\" displayPrint=\"none\">\n            {/* Screen Only */}\n            <TextField value={reason}\n                       aria-label={\"pas de omschrijving aan\"}\n                       title={reason}\n                       variant={variant}\n                       InputProps={{...inputProps, classes: {root: \"input-root\"}}}\n                       inputProps={{\n                           \"aria-label\": \"Beschrijving van de boeking\"\n                       }}\n                       {...textFieldProps}\n                       margin={\"none\"}\n                       size={\"small\"}\n                       onChange={onChange}\n                       onBlur={saveValue}\n                       fullWidth={true}>\n            </TextField>\n        </Box>\n        </>\n    );\n}\n\nfunction areEqual(prevProps: ReasonEditorProps & any, nextProps: ReasonEditorProps & any) {\n    return prevProps.allocation.reason === nextProps.allocation.reason\n}\n\nexport default React.memo(ReasonEditor, areEqual)","import React from 'react'\nimport { Amount } from \"../../types/Amount\"\nimport { makeStyles } from \"@material-ui/core\"\nimport { createStyles, Theme } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        negativeAmount: {\n            color: theme.palette.error.dark\n        },\n    }));\n\ninterface AmountProps {\n    amount: Amount\n    debitCredit: boolean\n    skipIfZero?: boolean\n    precision?: number\n}\n\nfunction FormatAmount(props: AmountProps) {\n    const { amount, debitCredit, precision = 2, skipIfZero = false } = props\n    const classes = useStyles()\n\n    const reversed = amount.isDebit && debitCredit\n    const className = amount.isDebit && !debitCredit\n        ? classes.negativeAmount\n        : \"\"\n\n    if (skipIfZero && amount.isZero()) {\n        return null\n    }\n\n    return (\n        <span className={className}>\n            {amount.format({reversed, precision})}\n        </span>\n    )\n}\n\nexport default FormatAmount","import React from 'react'\nimport { DateString } from \"../../types/DateString\"\nimport { makeStyles } from \"@material-ui/core\"\nimport { createStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        date: {\n            whiteSpace: \"nowrap\"\n        },\n    }));\n\ninterface FormatDateProps {\n    date: DateString\n}\n\nfunction FormatDate(props: FormatDateProps) {\n    const { date } = props\n    const classes = useStyles()\n\n    return (\n        <span className={classes.date}>{date.format()}</span>\n    )\n}\n\nexport default FormatDate","import React from 'react';\nimport { createStyles, Theme, withStyles, WithStyles } from '@material-ui/core/styles'\nimport MuiDialogTitle from '@material-ui/core/DialogTitle';\nimport MuiDialogContent from '@material-ui/core/DialogContent';\nimport MuiDialogActions from '@material-ui/core/DialogActions';\nimport IconButton from '@material-ui/core/IconButton';\nimport CloseIcon from '@material-ui/icons/Close';\nimport Typography from '@material-ui/core/Typography';\n\nconst styles = (theme: Theme) =>\n    createStyles({\n        root: {\n            margin: 0,\n            padding: theme.spacing(2),\n        },\n        closeButton: {\n            position: 'absolute',\n            right: theme.spacing(1),\n            top: theme.spacing(1),\n            color: theme.palette.grey[500],\n        },\n    });\n\n\nexport interface DialogTitleProps extends WithStyles<typeof styles> {\n    id: string\n    subTitle?: string\n    children: React.ReactNode\n    onClose?: () => void\n}\n\nexport const DialogTitle = withStyles(styles)((props: DialogTitleProps) => {\n    const { children, classes, onClose, subTitle, ...other } = props;\n    return (\n        <MuiDialogTitle disableTypography className={classes.root} {...other}>\n            <Typography variant=\"h6\">{children}</Typography>\n            {onClose ? (\n                <IconButton aria-label=\"close\" className={classes.closeButton} onClick={onClose}>\n                    <CloseIcon />\n                </IconButton>\n            ) : null}\n            {subTitle && <span>{subTitle}</span>}\n        </MuiDialogTitle>\n    );\n});\n\nexport const DialogContent = withStyles((theme: Theme) => ({\n    root: {\n        padding: theme.spacing(2),\n    },\n}))(MuiDialogContent);\n\nexport const DialogActions = withStyles((theme: Theme) => ({\n    root: {\n        margin: 0,\n        padding: theme.spacing(1),\n    },\n}))(MuiDialogActions);\n\n// function TemplateDialog() {\n//     const [open, setOpen] = React.useState(false);\n//     const theme = useTheme()\n//     const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n//\n//\n//     const handleClickOpen = () => {\n//         setOpen(true);\n//     };\n//     const handleClose = () => {\n//         setOpen(false);\n//     };\n//\n//     return (\n//         <div>\n//             <Button variant=\"outlined\" color=\"primary\" onClick={handleClickOpen}>\n//                 Open dialog\n//             </Button>\n//             <Dialog fullWidth={false} fullScreen={onXs} maxWidth={false}\n//                     onClose={handleClose} aria-labelledby=\"customized-dialog-title\" open={open}>\n//                 <DialogTitle id=\"customized-dialog-title\" onClose={handleClose}>\n//                     Modal title\n//                 </DialogTitle>\n//                 <DialogContent dividers>\n//                     <Typography gutterBottom>\n//                         Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac facilisis\n//                         in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum at eros.\n//                     </Typography>\n//                     <Typography gutterBottom>\n//                         Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis\n//                         lacus vel augue laoreet rutrum faucibus dolor auctor.\n//                     </Typography>\n//                     <Typography gutterBottom>\n//                         Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel\n//                         scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus\n//                         auctor fringilla.\n//                     </Typography>\n//                 </DialogContent>\n//                 <DialogActions>\n//                     <Button autoFocus onClick={handleClose} color=\"primary\">\n//                         Save changes\n//                     </Button>\n//                 </DialogActions>\n//             </Dialog>\n//         </div>\n//     );\n// }\n","import React from 'react';\nimport ItemSelect from \"../Selectors/ItemSelect\"\nimport { VATRate } from \"../../types/VAT/VATRate\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { VATRatesMap } from \"../../types/VAT/VATRates\"\n\ninterface VATSelectorProps {\n    vatRates: VATRatesMap\n    vatLine: VATLine\n    onVAT: (vatLine: VATLine, rate: VATRate | null) => void\n}\n\nfunction VATSelector(props: VATSelectorProps) {\n\n    const { vatRates, vatLine, onVAT } = props\n\n    const title = \"Kies BTW\"\n    const width = 200\n\n    const items = Object.values(vatRates).map(rate => rate.shortDescription)\n\n    const vatRate = vatLine.vatRate\n    const item = vatRate ? vatRate.shortDescription : \"\"\n\n    const onItem = (item: string | null) => {\n        const vatRate = Object.values(vatRates).find(rate => rate.shortDescription === item) || null\n        onVAT(vatLine, vatRate)\n    }\n\n    return (\n        <ItemSelect title={title} width={width} items={items} item={item} onItem={onItem} />\n    )\n}\n\nexport default VATSelector;\n","import React from 'react'\nimport { TextField } from \"@material-ui/core\"\n\ninterface AmountEditorProps {\n    value: string,\n    onChange: (value: string) => void\n    onBlur: () => void\n    disabled?: boolean\n}\n\nfunction AmountEditor(props: AmountEditorProps) {\n    const { value, disabled = false } = props\n\n    const onChange = (event: any) => {\n        props.onChange(event.target.value)\n    }\n\n    const onBlur = () => {\n        props.onBlur()\n    }\n\n    return (\n        <TextField value={value}\n                   size={\"small\"}\n                   style={{\n                       width: 100\n                   }}\n                   InputProps={{\n                       disableUnderline: true\n                   }}\n                   inputProps={{\n                       style: { textAlign: 'right' }\n                   }}\n                   disabled={disabled}\n                   onBlur={onBlur}\n                   onChange={onChange}\n        />\n    )\n}\n\nexport default AmountEditor;\n","import React, { useState } from 'react'\nimport { KeyboardDatePicker } from \"@material-ui/pickers\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { useMediaQuery } from \"@material-ui/core\"\nimport { Today } from \"@material-ui/icons\"\n\ninterface DateSelectorProps {\n    label: string\n    date: Date\n    onDate: (date: Date | null) => void\n    disableUnderline?: boolean\n}\n\nfunction DateSelector(props: DateSelectorProps) {\n    const {label, date} = props\n    const [isOpen, setIsOpen] = useState(false)\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const onDate = (date: Date | null) => {\n        setIsOpen(false)\n        props.onDate(date)\n    }\n\n    const style = onXs ? {width: \"96%\"} : {width: 135}\n\n    return (\n        <KeyboardDatePicker\n            style={style}\n            invalidDateMessage={\"Ongeldige datum\"}\n            label={label}\n            format=\"dd-MM-yyyy\"\n            disableToolbar={true}\n            value={date}\n            autoOk={true}\n            onChange={onDate}\n            onOpen={() => setIsOpen(true)}\n            onClose={() => setIsOpen(false)}\n            keyboardIcon={<Today fontSize={\"small\"}/>}\n            InputProps={{\n                disableUnderline: props.disableUnderline ?? true,\n            }}\n            KeyboardButtonProps={{\n                'aria-label': `wijzig ${label}`,\n            }}\n            open={isOpen}/>\n    )\n}\n\nexport default DateSelector;\n","import React, { useEffect, useRef, useState } from 'react'\nimport { Dialog, FormControlLabel, Grid, IconButton, Switch, useMediaQuery } from \"@material-ui/core\"\nimport { DialogActions, DialogContent, DialogTitle } from \"../Utils/CustomDialog\"\nimport Button from \"@material-ui/core/Button\"\nimport { createStyles, makeStyles, useTheme } from \"@material-ui/core/styles\"\nimport { Table, Tbody, Td, Th, Thead, Tr } from \"react-super-responsive-table\"\nimport { ClearAll, Delete } from \"@material-ui/icons\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { VATRates } from \"../../types/VAT/VATRates\"\nimport VATSelector from \"./VATSelector\"\nimport { NO_VAT, VATRate } from \"../../types/VAT/VATRate\"\nimport { Amount } from \"../../types/Amount\"\nimport AmountEditor from \"../Editors/AmountEditor\"\nimport FormatAmount from \"../Utils/FormatAmount\"\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport DateSelector from \"../Selectors/DateSelector\"\nimport { VAT_HIGH, VAT_LOW } from \"../../types/VAT/VATHistory\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        invoiceDate: {\n            textAlign: \"center\",\n            margin: \"auto\",\n            marginBottom: 10\n        },\n        specificationBlock: {\n            marginTop: 2\n        },\n        specification: {\n            textAlign: \"right\",\n            marginRight: 15,\n            fontSize: \"80%\"\n        },\n        tableRow: {\n            textAlign: \"right\"\n        },\n        rowTitle: {\n            textAlign: \"left\"\n        }\n    }),\n);\n\ninterface VATDialogProps {\n    allocation: LedgerAllocation\n    lines: VATLine[]\n    onClose: (date: Date, vatLines: VATLine[] | null) => void\n}\n\nexport function VATDialog(props: VATDialogProps) {\n    const [open, setOpen] = React.useState(true);\n\n    const { allocation, onClose } = props\n\n    const currency = allocation.statementEntry.amount.currency\n    const bruto = Math.abs(allocation.statementEntry.amount.value)\n    const isReversed = allocation.statementEntry.amount.value < 0\n    const lines = isReversed ? VATLine.reverseLines(props.lines) : props.lines\n    const valueDate = allocation.statementEntry.valueDate\n\n    const [autoCalc, setAutoCalc] = useState(true)\n    const [vat, setVAT] = useState(0)\n    const [netto, setNetto] = useState(bruto)\n    const [vatLines, setVATLines] = useState<VATLine[]>(VATLine.updateVATChoices(lines, bruto, autoCalc))\n    const [remaining, setRemaining] = useState(bruto)\n    // const [expand, setExpand] = useState(false)\n    const [date, setDate] = useState<Date>(allocation.journalEntry.date.Date)\n\n    const OKButtonRef = useRef<any>(React.createRef())\n\n    const classes = useStyles()\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    useEffect(() => {\n        const {total, remaining} = VATLine.getTotalRemaining(vatLines, bruto)\n        setRemaining(remaining)\n        setVAT(total.vat)\n        setNetto(total.netto)\n    }, [vatLines, bruto])\n\n    const cancelChanges = () => confirmChanges(null)\n\n    const confirmChanges = (lines: VATLine[] | null) => {\n        setOpen(false);\n        if (lines) {\n            lines = lines.filter(line => line.vatRate)\n            lines = isReversed ? VATLine.reverseLines(lines) : lines    // revert reversion\n        }\n        onClose(date, lines)\n    };\n\n    const clearVATLines = () => setVATLines([new VATLine(NO_VAT, bruto)])\n\n    const updateVATLines = (auto: boolean = autoCalc) => setVATLines(VATLine.updateVATChoices(vatLines, bruto, auto))\n\n    const onChangeValue = (line: VATLine, value: string, setter: (value: string | number) => void) => {\n        setter(value)\n        updateVATLines()\n    }\n\n    const onFinalValue = (line: VATLine, finalValue: string, setter: (value: string | number) => void) => {\n        if (!isNaN(+finalValue)) {\n            setter(+finalValue)\n            updateVATLines()\n        }\n    }\n\n    const onDateChange = (date: Date | null) => setDate(date || valueDate.Date)\n\n    const onVATRateSelected = (line: VATLine, rate: VATRate | null) => {\n        line.setVATRate(rate, line.bruto ? line.bruto : remaining)\n        updateVATLines()\n    }\n\n    const onQuickVAT = (rateId: string | null) => {\n        const rate = rateId ? vatRates[rateId] : null\n        const vatLine = new VATLine(rate, bruto)\n        confirmChanges([vatLine])\n    }\n\n    const toggleAutoCalc = () => {\n        if (!autoCalc) {\n            updateVATLines(true)\n        }\n        setAutoCalc(!autoCalc)\n    }\n\n    const vatRates = new VATRates(date).rates\n\n    return (\n        <div>\n            <Dialog fullWidth={false}\n                    fullScreen={onXs}\n                    maxWidth={false}\n                    onClose={() => cancelChanges()}\n                    aria-labelledby=\"vat-dialog-title\"\n                    open={open}>\n                <DialogTitle id=\"vat-dialog-title\"\n                             subTitle={allocation.reason}>\n                    BTW\n                </DialogTitle>\n                <DialogContent dividers>\n\n                    {/* Invoice date */}\n                    <div className={classes.invoiceDate}>\n                        <DateSelector label={\"Factuur datum\"}\n                                      date={date}\n                                      onDate={onDateChange}/>\n                    </div>\n\n                    {/* Shortcut buttons */}\n                    <Grid container spacing={1} direction={\"row\"} justify={\"center\"}>\n                        <Grid item><Button variant={\"outlined\"} color={\"primary\"} onClick={() => onQuickVAT(VAT_HIGH)}>\n                            Hoog {vatRates[VAT_HIGH].percentageString}</Button></Grid>\n                        <Grid item><Button variant={\"outlined\"} color={\"primary\"} onClick={() => onQuickVAT(VAT_LOW)}>\n                            Laag {vatRates[VAT_LOW].percentageString}</Button></Grid>\n                        <Grid item><Button variant={\"outlined\"} color={\"primary\"} onClick={() => onQuickVAT(null)}>\n                            Geen BTW</Button></Grid>\n                    </Grid>\n\n                    {/* Advanced VAT */}\n                    <div>\n                        <Table>\n                            <Thead>\n                                <Tr className={classes.tableRow}>\n                                    {onXs && <Th/>}\n                                    {!onXs && <Th>\n                                        <IconButton size={\"small\"}\n                                                    disabled={vatLines.length <= 1}\n                                                    title={\"Verwijder alle BTW regels\"}\n                                                    aria-label={\"Verwijder alle BTW regels\"}\n                                                    onClick={clearVATLines}>\n                                            <ClearAll/>\n                                        </IconButton>\n                                    </Th>}\n                                    <Th className={classes.rowTitle}>BTW Tarief\n                                    </Th>\n                                    <Th>Incl BTW</Th>\n                                    <Th>BTW</Th>\n                                    <Th>Excl BTW</Th>\n                                </Tr>\n                            </Thead>\n\n                            <Tbody>\n                                {vatLines.map((line, i) => {\n                                    const vatRate = line.vatRate\n                                    const percentage = line.percentage\n\n                                    return (\n                                        <Tr key={i} className={classes.tableRow}>\n                                            <Td>\n                                                {Boolean(vatRate) && !onXs &&\n                                                <IconButton size={\"small\"}\n                                                            title={\"Verwijder deze BTW regel\"}\n                                                            aria-label={\"Verwijder deze BTW regel\"}\n                                                            onClick={() => onVATRateSelected(line, null)}>\n                                                    <Delete/>\n                                                </IconButton>}\n                                            </Td>\n                                            <Td className={`noheader ${classes.rowTitle}`}>\n                                                {/* VAT Rate */}\n                                                <VATSelector vatRates={vatRates}\n                                                             vatLine={line}\n                                                             onVAT={onVATRateSelected}/>\n                                            </Td>\n                                            <Td>\n                                                {/*Bruto (Incl VAT)*/}\n                                                <AmountEditor value={line.bruto}\n                                                           disabled={!line.vatRate}\n                                                           onBlur={() => onFinalValue(line, line.bruto, line.setBruto.bind(line))}\n                                                           onChange={value => onChangeValue(line, value, line.setBruto.bind(line))}/>\n                                            </Td>\n                                            <Td>\n                                                {/*VAT*/}\n                                                <AmountEditor value={line.vat}\n                                                           disabled={percentage === 0}\n                                                           onChange={value => onChangeValue(line, value, line.setVAT.bind(line))}\n                                                           onBlur={() => onFinalValue(line, line.vat, line.setVAT.bind(line))}/>\n                                            </Td>\n                                            <Td>\n                                                {/*Netto (Excl VAT)*/}\n                                                <AmountEditor value={line.netto}\n                                                           disabled={percentage === 0}\n                                                           onBlur={() => onFinalValue(line, line.netto, line.setNetto.bind(line))}\n                                                           onChange={value => onChangeValue(line, value, line.setNetto.bind(line))}/>\n                                            </Td>\n                                        </Tr>\n                                    )\n                                })}\n\n                                {/* Totals overview */}\n                                <Tr className={classes.tableRow}>\n                                    <Td/>\n                                    <Td className={classes.rowTitle}>Totaal</Td>\n                                    <Td><FormatAmount amount={Amount.fromAmountCurrency(bruto - remaining, currency)} debitCredit={false}/></Td>\n                                    <Td><FormatAmount amount={Amount.fromAmountCurrency(vat, currency)} debitCredit={false}/></Td>\n                                    <Td><FormatAmount amount={Amount.fromAmountCurrency(netto, currency)} debitCredit={false}/></Td>\n                                </Tr>\n\n                            </Tbody>\n                        </Table>\n                </div>\n\n                </DialogContent>\n\n                <DialogActions>\n                    {/* Calculation toggle and Confirm button */}\n                    <Grid container spacing={2} direction={\"row\"} justify={\"space-between\"} alignItems={\"center\"}>\n                        <Grid item xs={12} sm={6}>\n                            <FormControlLabel\n                                control={\n                                    <Switch\n                                        checked={autoCalc}\n                                        title={\"Automatisch aanpassen van de BTW regels\"}\n                                        onChange={toggleAutoCalc}\n                                        name=\"auto calc\"\n                                        color=\"primary\"\n                                    />\n                                }\n                                label={autoCalc\n                                    ? \"Automatisch aanpassen\"\n                                    : <span>\n                                        Restant <FormatAmount amount={Amount.fromAmountCurrency(remaining, currency)}\n                                                                        debitCredit={false}/>\n                                      </span>\n                                }\n                            />\n                        </Grid>\n                        <Grid item xs={12} sm={6}>\n                            <div className={\"text-right-align\"}>\n                            <Button onClick={cancelChanges}>Cancel</Button>\n                            <Button disabled={remaining !== 0}\n                                    onClick={() => confirmChanges(vatLines)}\n                                    ref={OKButtonRef}\n                                    color=\"primary\">\n                                OK\n                            </Button>\n                            </div>\n                        </Grid>\n                    </Grid>\n\n                </DialogActions>\n            </Dialog>\n        </div>\n    );\n}\n","import React from 'react'\nimport { Grid, IconButton, makeStyles, useMediaQuery } from \"@material-ui/core\"\nimport { PostAdd } from \"@material-ui/icons\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { createStyles, Theme, useTheme } from \"@material-ui/core/styles\"\nimport Button from \"@material-ui/core/Button\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        percentage: {\n            fontSize: \"80%\"\n        },\n        hasVAT: {\n            color: theme.palette.primary.dark\n        }\n    }));\n\ninterface VATButtonProps {\n    lines: VATLine[]\n    onClick: (event: React.MouseEvent<HTMLElement>) => void\n}\n\nfunction VATButton(props: VATButtonProps) {\n    const { lines, onClick } = props\n    const classes = useStyles()\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'))\n\n    const hasVAT = lines.length > 0\n\n    const icon = hasVAT\n        ? <span className={classes.percentage}>\n            {lines.length === 1 ? lines[0].vatRate?.percentageString : \"x%\"}\n          </span>\n        : <PostAdd/>\n\n    if (onXs) {\n        return <Button variant={\"outlined\"}\n                       fullWidth={true}\n                       aria-label={\"BTW specificatie\"}\n                       onClick={onClick}\n                       className={hasVAT ? classes.hasVAT : \"\"}\n        >\n            <Grid container direction={\"row\"} justify={\"center\"} alignItems={\"center\"} spacing={1}>\n                <Grid item>BTW</Grid>\n                <Grid item>{icon}</Grid>\n            </Grid>\n\n        </Button>\n    } else {\n        return <IconButton size={\"small\"}\n                           aria-label={\"BTW specificatie\"}\n                           onClick={onClick}\n                           className={hasVAT ? classes.hasVAT : \"\"}\n        >\n            {icon}\n        </IconButton>\n    }\n}\n\nexport default VATButton;\n","import React, { useState } from 'react'\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { VATSpecificationData } from \"../../model\"\nimport { DateString } from \"../../types/DateString\"\nimport { VATDialog } from \"./VATDialog\"\nimport VATButton from \"./VATButton\"\n\ninterface VATMenuButtonProps {\n    allocation: LedgerAllocation\n    onClose: (result: VATSpecificationData | null) => void\n}\n\nexport function VATMenuButton(props: VATMenuButtonProps) {\n    const { allocation, onClose } = props\n\n    const [vatDialog, setVATDialog] = useState(false)\n\n    // The current VAT specification lines\n    const vatSpecificationData = allocation.journalEntry.data.vatSpecificationData\n    const vatLines = vatSpecificationData\n        ? VATLine.fromVATSpecificationData(vatSpecificationData)\n        : []\n\n    const setVAT = (date: Date, vatLines: VATLine[] | null = null) => {\n        setVATDialog(false)   // Close any open dialog\n        if (vatLines) {\n            if (vatLines.length === 1 && !vatLines[0].hasVAT) {\n                // Choose for NO_VAT, delete any existing VAT lines\n                vatLines = []\n            }\n            onClose({\n                date: DateString.ISODateString(date),\n                lines: vatLines.map(l => l.data)\n            })\n        } else {\n            // No changes\n            onClose(null)\n        }\n    }\n\n    return (\n        <div>\n            <VATButton lines={vatLines}\n                       onClick={() => setVATDialog(true)}/>\n\n            {vatDialog && <VATDialog allocation={allocation}\n                                     lines={vatLines}\n                                     onClose={setVAT}/>}\n\n        </div>\n    );\n}\n\nfunction areEqual(prevProps: VATMenuButtonProps, nextProps: VATMenuButtonProps) {\n    return prevProps.allocation.journalEntry.data.vatSpecificationData ===\n        nextProps.allocation.journalEntry.data.vatSpecificationData\n}\n\nexport default React.memo(VATMenuButton, areEqual)\n","import React from 'react'\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport PeriodSelector from \"../Editors/PeriodSelector\"\nimport RGSAccountSelector from \"../Editors/RGSAccountSelector\"\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport ReasonEditor from \"../Editors/ReasonEditor\"\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport { makeStyles } from \"@material-ui/core\"\nimport { createStyles, Theme } from \"@material-ui/core/styles\"\nimport FormatAmount from \"../Utils/FormatAmount\"\nimport FormatDate from \"../Utils/FormatDate\"\nimport VATMenuButton from \"../VAT/VATMenuButton\"\nimport { VATSpecificationData } from \"../../model\"\nimport DateSelector from \"../Selectors/DateSelector\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n      childAllocationRow: {\n        [theme.breakpoints.down('xs')]: {\n          marginLeft: \"25px !important\",\n        },\n      }\n    }));\n\ninterface AllocationsTableRowProps {\n    allocation: LedgerAllocation\n    debitCredit: boolean\n    updateLedgerAccount: (ledgerAllocation: LedgerAllocation, ledgerAccount: LedgerAccount) => void\n    updateVAT: (ledgerAllocation: LedgerAllocation, vat: VATSpecificationData) => void\n    updateDate: (ledgerAllocation: LedgerAllocation, date: Date) => void\n}\n\nfunction AllocationsTableRow(props: AllocationsTableRowProps) {\n    const classes = useStyles()\n\n    const { allocation, debitCredit, updateLedgerAccount, updateVAT, updateDate } = props\n\n    const { statementEntry } = allocation\n\n    const isMainAllocation = !allocation.hasParent()    // Don't show details for children\n    const amount = statementEntry.amount\n    const hasChildren = allocation.hasChildren()\n\n    const onVAT = (vatSpecification: VATSpecificationData | null) => {\n        if (vatSpecification) {\n            updateVAT(allocation, vatSpecification)\n        }\n    }\n\n    const onDate = (date: Date | null) => {\n        if (date) {\n            updateDate(allocation, date)\n        }\n    }\n\n    return (\n      <Tr key={allocation.id} className={isMainAllocation ? \"\" : classes.childAllocationRow}>\n        <Td>\n          {isMainAllocation && <FormatDate date={statementEntry.valueDate}/>}\n        </Td>\n\n        <Td>\n          {!hasChildren && <DateSelector label={\"\"}\n                                         date={allocation.journalEntry.date.Date}\n                                         onDate={onDate} />}\n        </Td>\n\n        <Td>\n          <PeriodSelector key={allocation.period.string + hasChildren}\n                          disabled={hasChildren}\n                          allocation={allocation}/>\n        </Td>\n\n        {debitCredit &&\n        <Td align=\"right\">\n            {isMainAllocation && amount.isDebit && <FormatAmount amount={amount} debitCredit={debitCredit} />}\n        </Td>}\n\n        {debitCredit &&\n        <Td align=\"right\">\n            {isMainAllocation && amount.isCredit && <FormatAmount amount={amount} debitCredit={debitCredit} />}\n        </Td>}\n\n        {!debitCredit &&\n        <Td align=\"right\" colSpan={2}>\n          {isMainAllocation && <FormatAmount amount={amount} debitCredit={debitCredit} />}\n        </Td>}\n\n        <Td className={\"noheader\"}>\n          <RGSAccountSelector disabled={hasChildren}\n                              ledgerAccount={allocation.ledgerAccount}\n                              accountOptions={LedgerScheme.allocatableAccounts}\n                              onChange={(account: LedgerAccount) => updateLedgerAccount(allocation, account)}/>\n        </Td>\n\n        <Td className={\"noheader\"}>\n            {!hasChildren && <VATMenuButton allocation={allocation}\n                                         onClose={onVAT}/>}\n        </Td>\n\n        <Td className={\"noheader\"}>\n          <ReasonEditor key={allocation.reason} allocation={allocation}/>\n        </Td>\n\n      </Tr>\n  )\n}\n\nexport default AllocationsTableRow;\n","import React from 'react'\nimport { Button } from \"@material-ui/core\"\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\nimport { AllocationFilter } from \"../../types/AllocationFilter\"\nimport { useURLState } from \"../useURLState\"\n\ninterface AllocationsDataIndicatorProps {\n    isLoading: boolean\n    noData: boolean\n    allocationFilter: AllocationFilter\n}\n\nfunction AllocationsDataIndicator(props: AllocationsDataIndicatorProps) {\n    const { isLoading, noData, allocationFilter } = props\n    const { ledgerAccountCode, period } = allocationFilter\n    const [, setURLState] = useURLState()\n\n    function onAccountClear() {\n        setURLState({ledgerAccountCode: null})\n    }\n\n    function onPeriodClear() {\n        setURLState({periodId: null})\n    }\n\n    return (\n        <div>\n            {isLoading &&\n            <div>\n                Loading...\n            </div>}\n            {noData &&\n            <div>\n                Geen data gevonden\n                <div>\n                    {ledgerAccountCode &&\n                    <p><Button size={\"small\"} color={\"primary\"}\n                                 onClick={() => onAccountClear()}>\n                        Wis filter op grootboek\n                        : {LedgerScheme.getAccount(ledgerAccountCode).shortDescription}\n                    </Button></p>}\n                    {period &&\n                    <p><Button size={\"small\"} color={\"primary\"}\n                                 onClick={() => onPeriodClear()}>\n                        Wis filter op periode\n                        : {period.string}\n                    </Button></p>}\n                </div>\n            </div>}\n        </div>\n    )\n}\n\nexport default AllocationsDataIndicator","import React from 'react'\n\nimport { Checkbox, Paper, TableContainer, useMediaQuery } from \"@material-ui/core\"\nimport { Table, Thead, Tbody, Tr, Th, Td } from '../ResponsiveTable';\n\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport { createStyles, makeStyles, useTheme } from \"@material-ui/core/styles\"\nimport FormatDate from \"../Utils/FormatDate\"\nimport FormatAmount from \"../Utils/FormatAmount\"\n\nconst useStyles = makeStyles((theme) =>\n    createStyles({\n        description: {\n            overflow: \"hidden\",\n            textOverflow: \"ellipsis\",\n        },\n        checkAll: {\n            [theme.breakpoints.only('xs')]: {\n                marginLeft: 13,\n            },\n        },\n        checkBox: {\n            [theme.breakpoints.only('xs')]: {\n                marginLeft: -12,\n                marginBottom: -11\n            },\n        },\n        negativeAmount: {\n            color: \"red\"\n        },\n        positiveAmount: {\n        },\n    }),\n);\n\nexport type AllocationSelector = Record<string, boolean>\n\ninterface Props {\n    allocations: LedgerAllocation[]\n    allocation: LedgerAllocation\n    checked?: AllocationSelector\n    onChecked?: (checked: AllocationSelector) => void\n}\n\nfunction AllocationsView(props: Props) {\n    const classes = useStyles();\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const { allocations, checked, onChecked } = props\n    const mainAllocation = props.allocation\n\n    const onSelectAll = (event: React.ChangeEvent<HTMLInputElement>) => {\n        if (checked) {\n            const isChecked = event.target.checked\n            allocations\n                .filter(a => a.id !== mainAllocation.id)\n                .forEach(allocation => checked[allocation.id] = isChecked)\n            onChecked && onChecked(checked)\n        }\n    }\n\n    const onSelect = (event: React.ChangeEvent<HTMLInputElement>) => {\n        if (checked) {\n            const id = event.target.name\n            checked[id] = event.target.checked\n            onChecked && onChecked(checked)\n        }\n    }\n\n    const checkAll = checked && onChecked && <Checkbox\n        className={classes.checkAll}\n        checked={allocations.every(allocation => checked[allocation.id])}\n        color={\"primary\"}\n        onChange={onSelectAll}/>\n\n    return (\n        <div>\n            {onXs && checkAll}\n            <TableContainer component={Paper}>\n            <Table key={Number(onXs)}>\n                <Thead>\n                    <Tr>\n                        <Th>{!onXs && checkAll}</Th>\n                        <Th>datum</Th>\n                        <Th align=\"right\">Bedrag</Th>\n                        <Th className={classes.description}>Omschrijving</Th>\n                    </Tr>\n                </Thead>\n                <Tbody>\n                    {allocations.map(allocation => {\n                        const amount = allocation.amount\n                        const amountClassName = amount.value < 0 ? classes.negativeAmount : classes.positiveAmount\n                        const isMainAllocation = allocation.id === mainAllocation.id\n                        const style = isMainAllocation ? { fontWeight: \"bold\" } : {}\n                        return (\n                            <Tr key={allocation.id} style={style}>\n                                {checked && onChecked && <Td className={\"noheader\"}>\n                                    <Checkbox\n                                        className={classes.checkBox}\n                                        checked={checked[allocation.id]}\n                                        disabled={isMainAllocation}\n                                        color={\"primary\"}\n                                        name={allocation.id}\n                                        onChange={onSelect}\n                                    />\n                                </Td>}\n                                <Td>\n                                    <FormatDate date={allocation.journalEntry.date}/>\n                                </Td>\n                                <Td align=\"right\" className={amountClassName}>\n                                    <FormatAmount amount={allocation.amount} debitCredit={false}/>\n                                </Td>\n                                <Td className={\"noheader\"}>\n                                    {allocation.journalEntry.reason}\n                                </Td>\n                            </Tr>\n                        )\n                    })}\n                </Tbody>\n            </Table>\n            </TableContainer>\n        </div>\n    )\n}\n\nexport default AllocationsView;\n","import React from 'react';\n\nimport { makeStyles, createStyles, useTheme } from '@material-ui/core/styles'\nimport {\n    Button,\n    Dialog,\n    Grid,\n    Typography,\n    useMediaQuery\n} from \"@material-ui/core\"\n\nimport AllocationsView, { AllocationSelector } from \"./AllocationsView\"\n\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\n\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { DialogActions, DialogContent, DialogTitle } from \"../Utils/CustomDialog\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        title: {\n            textAlign: \"center\",\n        },\n        buttons: {\n            marginTop: 10,\n            marginBottom: 10\n        },\n        close: {\n            color: \"white\",\n            marginRight: -20\n        }\n    }),\n);\n\nexport interface Similar {\n    allocation: LedgerAllocation\n    allocations: LedgerAllocation[]\n    account: LedgerAccount\n}\n\ninterface Props {\n    similar: Similar\n    onSimilar: (allocations: LedgerAllocation[]) => void\n}\n\nexport default function SimilarAllocations(props: Props) {\n    const classes = useStyles();\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const { similar, onSimilar } = props\n\n    const { allocation, allocations , account } = similar\n\n    const [ checked, setChecked ] = React.useState<AllocationSelector>(\n        allocations.reduce((result, allocation) => {\n            result[allocation.id] = true\n            return result\n        }, {} as AllocationSelector))\n\n    const handleClose = () => {\n        onSimilar([])\n    };\n\n    const handleOK = () => {\n        onSimilar(allocations.filter(allocation => checked[allocation.id]))\n    }\n\n    const onChecked = (checked: AllocationSelector) => {\n        setChecked({...checked})\n    }\n\n    const OKCancel = () => (\n        <Grid container spacing={2} justify={\"center\"}  className={classes.buttons}>\n            <Grid item><Button size={\"small\"} variant={\"contained\"} onClick={handleOK}>OK</Button></Grid>\n            <Grid item><Button size={\"small\"} variant={\"contained\"} onClick={handleClose}>Cancel</Button></Grid>\n        </Grid>\n    )\n\n    const body = (\n        <div>\n            <div>\n                <div>\n                    <Typography variant=\"h6\" color=\"textPrimary\" className={classes.title}>\n                        {account.shortDescription}\n                    </Typography>\n                </div>\n                <div>\n                    <AllocationsView allocations={allocations}\n                                     allocation={allocation}\n                                     checked={checked}\n                                     onChecked={onChecked} />\n                </div>\n            </div>\n        </div>\n    );\n\n    return (\n        <Dialog fullWidth={false}\n                fullScreen={onXs}\n                maxWidth={false}\n                onClose={handleClose}\n                aria-labelledby=\"vergelijkbare-boekingen\"\n                open={true}>\n            <DialogTitle id=\"vergelijkbare-boekingen\" onClose={handleClose}>\n                Gelijksoortige boekingen\n            </DialogTitle>\n            <DialogContent dividers>\n                {body}\n            </DialogContent>\n            <DialogActions>\n                <OKCancel/>\n            </DialogActions>\n        </Dialog>\n    );\n}\n","import React, { useState } from 'react'\nimport { Table, Tbody, Td, Th, Thead, Tr } from \"../ResponsiveTable\"\nimport AllocationsTableRow from \"./AllocationsTableRow\"\nimport AllocationsDataIndicator from \"./AllocationsDataIndicator\"\nimport { Paper, TableContainer, useMediaQuery } from \"@material-ui/core\"\nimport { LedgerAllocation } from \"../../types/Allocation/LedgerAllocation\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { AllocationFilter } from \"../../types/AllocationFilter\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { setDate, setLedgerAccount, setVAT } from \"../../app/AccountingSlice\"\nimport { useDispatch } from \"react-redux\"\nimport SimilarAllocations, { Similar } from \"./SimilarAllocations\"\nimport { VATSpecificationData } from \"../../model\"\nimport { AccountSelectorWidth } from \"../Editors/RGSAccountSelector\"\nimport { PeriodSelectorWidth } from \"../Editors/PeriodSelector\"\nimport { DateString } from \"../../types/DateString\"\n\ninterface AllocationsTableProps {\n    allocations: LedgerAllocationMap\n    allocationFilter: AllocationFilter\n    rows: LedgerAllocation[]\n    isLoading: boolean\n}\n\nfunction AllocationsTable(props: AllocationsTableProps) {\n    const { allocations, allocationFilter, rows, isLoading } = props\n    const [similar, setSimilar] = useState<Similar | null>(null)\n    const dispatch = useDispatch()\n\n    const theme = useTheme()\n    const onSm = useMediaQuery(theme.breakpoints.only('sm'));\n\n    const debitCredit = !onSm\n    const noData = !isLoading && rows.length === 0\n\n    function updateLedgerAccount(ledgerAllocation: LedgerAllocation, ledgerAccount: LedgerAccount) {\n        if (ledgerAllocation.journalEntry.allocatedLeg.ledgerAccountCode === ledgerAccount.code) {\n            // No change, no further actions\n            return\n        }\n        const similarAllocations = allocations.getSimilarAllocations(ledgerAllocation)\n\n        if (similarAllocations.length > 1) {\n            // Propose to update similar allocations (includes itself for reference)\n            const similar: Similar = {\n                allocation: ledgerAllocation,\n                allocations: similarAllocations,\n                account: ledgerAccount\n            }\n            setSimilar(similar)\n        } else {\n            // update the selected allocation\n            dispatch(setLedgerAccount({\n                allocationsData: [ledgerAllocation.data],\n                accountCode: ledgerAccount.code\n            }))\n        }\n    }\n\n    function onSimilar(allocations: LedgerAllocation[]) {\n        if (similar && allocations.length) {\n            dispatch(setLedgerAccount({\n                allocationsData: [...allocations.map(allocation => allocation.data)],\n                accountCode: similar.account.code\n            }))\n        }\n        setSimilar(null)\n    }\n\n    function updateVAT(ledgerAllocation: LedgerAllocation, vatSpecificationData: VATSpecificationData) {\n        dispatch(setVAT({\n            allocationData: ledgerAllocation.data,\n            vatSpecificationData\n        }))\n    }\n\n    function updateDate(ledgerAllocation: LedgerAllocation, date: Date) {\n        dispatch(setDate({\n            allocationData: ledgerAllocation.data,\n            dateData: DateString.fromDate(date).data\n        }))\n    }\n\n    return (\n        <TableContainer component={Paper}>\n        {similar && <SimilarAllocations similar={similar} onSimilar={onSimilar} />}\n        <Table>\n            <Thead>\n                <Tr>\n                    <Th style={{width: 85}}>Datum</Th>\n                    <Th style={{width: 85}}>Factuur</Th>\n                    <Th style={{width: PeriodSelectorWidth}}>Periode</Th>\n                    {debitCredit && <Th style={{width: 100}} align={\"right\"}>Debit</Th>}\n                    {debitCredit && <Th style={{width: 100}} align={\"right\"}>Credit</Th>}\n                    {!debitCredit && <Th style={{width: 100}} colSpan={2} align={\"right\"}>Bedrag</Th>}\n                    <Th style={{width: AccountSelectorWidth}}>Grootboek</Th>\n                    <Th style={{width: 50}}>BTW</Th>\n                    <Th>Omschrijving</Th>\n                </Tr>\n            </Thead>\n            <Tbody>\n                {rows.map((allocation) => {\n                    if (! allocations.hasAllocation(allocation.id)) {\n                        // rows and allocations can be out of sync for a moment (worker thread)\n                        return null\n                    } else {\n                        return (\n                            <AllocationsTableRow key={allocation.id}\n                                                 allocation={allocation}\n                                                 debitCredit={debitCredit}\n                                                 updateDate={updateDate}\n                                                 updateVAT={updateVAT}\n                                                 updateLedgerAccount={updateLedgerAccount} />\n                        )\n                    }\n                })}\n\n                {(isLoading || noData) &&\n                <Tr>\n                    <Td colSpan={6} align={\"center\"}>\n                        <AllocationsDataIndicator isLoading={isLoading}\n                                                  noData={noData}\n                                                  allocationFilter={allocationFilter}/>\n                    </Td>\n                </Tr>}\n            </Tbody>\n        </Table>\n        </TableContainer>\n    )\n}\n\nexport default AllocationsTable;\n","import React, { useEffect, useMemo, useState } from 'react'\n\nimport InfiniteScroll from \"react-infinite-scroller\"\n\nimport { LedgerAllocation} from \"../../types/Allocation/LedgerAllocation\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\nimport { StatementEntryMap } from \"../../types/LiquidAssets/StatementEntryMap\"\nimport Worker from '../Workers'\nimport { Environment } from \"../../types/Environment\"\nimport { useURLState } from \"../useURLState\"\nimport { AllocationFilter } from \"../../types/AllocationFilter\"\nimport AllocationsHeader from \"./AllocationsHeader\"\nimport AllocationsTable from \"./AllocationsTable\"\n\ninterface StatementAllocationsProps {\n    statements: StatementEntryMap\n    allocations: LedgerAllocationMap\n}\n\nfunction StatementAllocations(props: StatementAllocationsProps) {\n    const LOAD_PER = 25\n\n    const { allocations } = props\n\n    const [viewPort, setViewPort] = useState(LOAD_PER)\n    const [rows, setRows] = useState<LedgerAllocation[]>([])\n    const [loading, setLoading] = useState(true)\n\n    // Get the filterValues from the URL\n    const [urlState, ] = useURLState()\n    const periodId = urlState.getStringValue(\"periodId\") || null\n    const ledgerAccountCode = urlState.getStringValue(\"ledgerAccountCode\") || null\n    const allocationFilter = useMemo(\n        () => new AllocationFilter({periodId, ledgerAccountCode}),\n        [periodId, ledgerAccountCode]\n    )\n\n    useEffect(() => {\n        const update = async () => {\n            const instance = new Worker();\n            const result = await instance.getAllocationRows(\n                new Environment().data,\n                allocations.allocations,\n                viewPort,\n                allocationFilter\n            ) as LedgerAllocation[]\n\n            setRows(result.map(allocation => new LedgerAllocation(allocation.data)))\n            setLoading(false)\n        }\n\n        setLoading(true)\n        update().catch(e => console.error(\"Failed to load statement allocation data\", e))\n    }, [allocations, allocationFilter, viewPort])\n\n    const hasMore = !loading && viewPort < allocations.length\n    const loadMore = () => {\n        setLoading(true)\n        setViewPort(viewPort + LOAD_PER)\n    }\n\n    const isLoading = viewPort === 0 || (loading && rows.length === 0)\n    const loader = <div key={1}>Laden...</div>\n\n    return (\n        <div>\n            <AllocationsHeader allocations={allocations}\n                               allocationFilter={allocationFilter}/>\n\n            <InfiniteScroll loader={loader}\n                            pageStart={0}\n                            hasMore={hasMore}\n                            loadMore={loadMore}>\n\n                <AllocationsTable allocations={allocations}\n                                  allocationFilter={allocationFilter}\n                                  rows={rows}\n                                  isLoading={isLoading}/>\n\n            </InfiniteScroll>\n        </div>\n    );\n}\n\nexport default StatementAllocations","import React, { useMemo } from 'react'\nimport { useSelector } from \"react-redux\";\n\nimport { selectLedgerAllocations, selectLiquidAssets } from \"../app/AccountingSlice\"\nimport { selectPeriodFilter } from \"../app/FilterSlice\"\n\nimport { Routes } from \"../routes/routes\"\n\nimport StatementAllocations from \"../components/Allocations/StatementAllocations\";\nimport PageHeader from \"./PageHeader\"\n\nfunction MapPage() {\n    const liquidAssets = useSelector(selectLiquidAssets)\n    const ledgerAllocations = useSelector(selectLedgerAllocations)\n    const periodFilter = useSelector(selectPeriodFilter)\n\n    const allocations = useMemo(() => ledgerAllocations.filterOnPeriod(periodFilter), [ledgerAllocations, periodFilter])\n    const statementEntryMap = useMemo(() => liquidAssets.getStatementEntryMap(), [liquidAssets])\n\n    return (\n        <div>\n            <PageHeader title={Routes.Map}/>\n            <StatementAllocations statements={statementEntryMap}\n                                  allocations={allocations}/>\n        </div>\n    );\n}\n\nexport default MapPage;","import { JournalEntry } from \"./Journal/JournalEntry\"\nimport { Amount, CreditDebit } from \"./Amount\"\nimport { LedgerAccount } from \"./Ledger/LedgerAccount\"\nimport { EntryLeg } from \"./Journal/EntryLeg\"\nimport { LedgerScheme } from \"./Ledger/LedgerScheme\"\nimport { sortedArray } from \"../services/utils\"\nimport { LEDGER_ACCOUNT } from \"../config\"\n\ntype Booking = {\n    journalEntry: JournalEntry\n    leg: EntryLeg\n}\n\ninterface AccountSummary {\n    account: LedgerAccount,\n    bookings: Booking[],\n    debitAmount: Amount,\n    creditAmount: Amount,\n    debitBalance: Amount,\n    creditBalance: Amount,\n    balance: Amount,\n}\n\nexport type SummaryMap = Record<string, AccountSummary>\n\n/**\n * Provide for a summary of the journalEntries per ledgerAccount\n *\n * For each ledgerAccount the amounts and balances are calculated\n * A reference to the journalEntries and legs is included in the summary\n */\nexport class AccountSummaryMap {\n    accountSummaryMap: SummaryMap\n\n    /**\n     * Create a new AccountSummaryMap for the given journalEntries\n     */\n    constructor(journalEntries: JournalEntry[]) {\n        this.accountSummaryMap = {}\n\n        journalEntries.forEach(journalEntry => {\n            journalEntry.legs.forEach(leg => {\n                this.update(journalEntry, leg)\n            })\n        })\n\n        this.updateBalance()\n    }\n\n    /**\n     * Update the accountSummary for the given journalEntry and leg\n     */\n    private update = (journalEntry: JournalEntry, leg: EntryLeg )  => {\n        const summary = this.getAccountSummary(leg.ledgerAccount, leg.amount.currency)\n\n        const legAmount = new Amount(leg.amount);\n\n        summary.bookings.push({ journalEntry, leg })\n\n        summary.balance = summary.balance.add(legAmount)\n\n        if (leg.amount.creditDebit === CreditDebit.Credit) {\n            summary.creditAmount = summary.creditAmount.add(legAmount)\n        } else {\n            summary.debitAmount = summary.debitAmount.add(legAmount)\n        }\n    }\n\n    /**\n     * Update the credit- and debit balances in the accountSummary\n     *\n     * The balance is simply a debitBalance if the total balance is debit and a creditBalance in the reverse case\n     */\n    private updateBalance() {\n        Object.values(this.accountSummaryMap).forEach(summary => {\n            if (summary.balance.creditDebit === CreditDebit.Credit) {\n                summary.creditBalance = summary.balance\n            } else {\n                summary.debitBalance = summary.balance\n            }\n        })\n    }\n\n    /**\n     * Return a new fresh summary to gather account statistics\n     */\n    private static getNewSummary(account: LedgerAccount, currency: string = \"\"): AccountSummary {\n        return {\n            account,\n            bookings: [],\n            debitAmount: Amount.fromAmountCurrency(0, currency),\n            creditAmount: Amount.fromAmountCurrency(0, currency),\n            debitBalance: Amount.fromAmountCurrency(0, currency),\n            creditBalance: Amount.fromAmountCurrency(0, currency),\n            balance: Amount.fromAmountCurrency(0, currency),\n        }\n    }\n\n    /**\n     * Get an account summary for the given ledgerAccount\n     *\n     * An optional currency can be provided to initialise a summary (used internally)\n     */\n    getAccountSummary(account: LedgerAccount, currency: string = \"\"): AccountSummary {\n        const summaryMap = this.accountSummaryMap\n        const key = account.code\n\n        if (! summaryMap[key]) {\n            summaryMap[key] = AccountSummaryMap.getNewSummary(account, currency)\n        }\n        return summaryMap[key]\n    }\n\n    /**\n     * Get the ledgerAccounts for which a summary is available\n     */\n    getAccounts(): LedgerAccount[] {\n        const accounts = Object.entries(this.accountSummaryMap)\n            .filter(([_, summary]) => summary.bookings.length > 0)\n            .map(([accountCode, _]) => LedgerScheme.getAccount(accountCode))\n        return sortedArray(accounts, (account: LedgerAccount) => {\n            const primary = {\n                [LEDGER_ACCOUNT.BALANCE_ACCOUNT]: 1,\n                [LEDGER_ACCOUNT.REVENUE_CATEGORY]: 2,\n                [LEDGER_ACCOUNT.EXPENSE_CATEGORY]: 3\n            }[account.category]\n            return `${primary}.${account.sortKey}`\n        })\n    }\n\n    /**\n     * Get the total for all ledgerAccounts\n     *\n     * Normally the balance of the totalisation is 0\n     */\n    getTotalisation(filter: (account: LedgerAccount) => boolean = () => true): AccountSummary {\n        // The currency of the totalisation is automatically set by the Amount.add method\n        const total = AccountSummaryMap.getNewSummary(LedgerScheme.unmapped) // Not bound to any account\n        Object.values(this.accountSummaryMap)\n            .forEach(summary => {\n                if (filter(summary.account)) {\n                    total.debitAmount = total.debitAmount.add(summary.debitAmount)\n                    total.creditAmount = total.creditAmount.add(summary.creditAmount)\n                    if (summary.balance.creditDebit === CreditDebit.Credit) {\n                        total.creditBalance = total.creditBalance.add(summary.balance)\n                    } else {\n                        total.debitBalance = total.debitBalance.add(summary.balance)\n                    }\n                    total.balance = total.balance.add(summary.balance)\n                }\n            })\n        return total\n    }\n}\n","import { makeStyles } from \"@material-ui/core\"\nimport { createStyles, Theme } from \"@material-ui/core/styles\"\n\nexport const useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        table: {\n        },\n        subDescription: {\n            paddingLeft: 40,\n            overflow: \"hidden\",\n            textOverflow: \"ellipsis\",\n            [theme.breakpoints.only('sm')]: {\n                paddingLeft: 20,\n                maxWidth: 150,\n            },\n        },\n        mainDescription: {\n            fontWeight: 450\n        },\n        levelHeader: {\n            fontWeight: 'bold'\n        },\n        TrDivider: {\n            backgroundColor: \"lightgray\",\n            height: \"2px\",\n            margin: 0,\n            padding: 0\n        },\n        childRow: {\n            [theme.breakpoints.down('xs')]: {\n                marginLeft: \"25px !important\",\n            },\n        },\n        openCloseButton: {\n            textAlign: \"left\"\n        },\n        categoryHeader: {\n            fontWeight: \"bold\"\n        },\n        categoryFooterTitle: {\n            fontStyle: \"normal\",\n            textAlign: \"right\"\n        },\n        categoryFooter: {\n            fontWeight: \"bold\",\n        }\n    }));\n","import { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport FormatAmount from \"../Utils/FormatAmount\"\nimport React from \"react\"\nimport { useStyles } from \"./Styling\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\n\ninterface BalanceTotalsProps {\n    children: React.ReactNode\n    summary: AccountSummaryMap\n    filter?: (account: LedgerAccount) => boolean\n}\n\nexport function BalanceTotals(props: BalanceTotalsProps) {\n    const classes = useStyles()\n\n    const { children, summary, filter } = props\n\n    const overallTotals = summary.getTotalisation(filter)\n    return (\n        <>\n            <Tr className={classes.levelHeader}>\n                <Td className={classes.levelHeader}>\n                    {children}\n                </Td>\n                {overallTotals && [\n                    overallTotals.debitAmount,\n                    overallTotals.creditAmount,\n                    overallTotals.debitBalance,\n                    overallTotals.creditBalance,\n                    overallTotals.balance,\n                ].map((v, i) =>\n                    <Td key={i}\n                        className={classes.levelHeader}\n                        align=\"right\">\n                        <FormatAmount amount={v} debitCredit={i !== 4}/>\n                    </Td>)}\n            </Tr>\n        </>\n)\n}","import React, { ChangeEvent } from 'react'\nimport { FormControl, FormControlLabel, FormLabel, Radio, RadioGroup } from \"@material-ui/core\"\n\nexport enum LayoutType {\n    TRIALSALDI = \"T\",\n    RESULTS = \"R\"\n}\n\nexport const LayoutLabel = {\n    [LayoutType.TRIALSALDI]: \"Proef- en Saldibalans\",\n    [LayoutType.RESULTS]: \"Winst- en Verliesrekening\"\n}\n\ninterface LayoutChoiceProps {\n    layoutType: LayoutType\n    onLayout: (layoutType: LayoutType) => void\n}\n\nfunction LayoutChoice(props: LayoutChoiceProps) {\n    const { layoutType, onLayout } = props\n\n    const onChange = (event: ChangeEvent<HTMLInputElement>, value: string) => {\n        const layout = value as LayoutType\n        onLayout(layout)\n    }\n\n    return (\n        <FormControl component=\"fieldset\">\n            <FormLabel component=\"legend\" className={\"text-left-align\"}>Overzicht</FormLabel>\n            <RadioGroup aria-label=\"Proef- en Saldibalans of Resultatenrekening\"\n                        row\n                        name=\"layout\"\n                        value={layoutType}\n                        onChange={onChange}>\n                {Object.entries(LayoutLabel).map(([value, label]) => {\n                    return (\n                        <FormControlLabel key={value}\n                                          value={value}\n                                          control={<Radio size={\"small\"} color=\"primary\"/>} label={label} />\n                    )\n                })}\n            </RadioGroup>\n        </FormControl>\n    )\n}\n\nexport default LayoutChoice","import React from 'react'\nimport { Period } from \"../../types/Period\"\n\ninterface FormatPeriodProps {\n    period: Period\n}\n\nfunction FormatPeriod(props: FormatPeriodProps) {\n    const { period } = props\n\n    return (\n        <span>{period.format()}</span>\n    )\n}\n\nexport default FormatPeriod","import { Journal } from \"../../types/Journal/Journal\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport React, { useEffect } from \"react\"\nimport { JournalEntry } from \"../../types/Journal/JournalEntry\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { useMediaQuery } from \"@material-ui/core\"\nimport { sortedArray } from \"../../services/utils\"\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport FormatAmount from \"../Utils/FormatAmount\"\nimport FormatDate from \"../Utils/FormatDate\"\nimport FormatPeriod from \"../Utils/FormatPeriod\"\nimport { useStyles } from \"./Styling\"\n\nexport function BalanceDetails(props: { journal: Journal, account: LedgerAccount, loadMore: number }) {\n    const [entries, setEntries] = React.useState<JournalEntry[]>([])\n    const [viewPort, setViewPort] = React.useState(25)\n\n    const {journal, account, loadMore} = props\n    const classes = useStyles()\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'))\n\n    useEffect(() => {\n        const filteredJournal = journal.filterOnAccount(leg => leg.ledgerAccount.equals(account))\n        let allEntries: JournalEntry[] = filteredJournal.journalEntries.filter(entry => entry.legs.length)\n        allEntries = sortedArray(allEntries, (e) => [e.period.string, e.date.string].join(\".\"))\n        setEntries(allEntries)\n    }, [journal, account])\n\n    useEffect(() => {\n        setViewPort(prevViewPort => prevViewPort + 25)\n    }, [loadMore])\n\n    return (\n        <React.Fragment>\n            {!onXs && <Tr className={classes.levelHeader}>\n                <Td/>\n                <Td/>\n                <Td/>\n                <Td align={\"right\"} className={classes.levelHeader}>Datum</Td>\n                <Td align={\"right\"} className={classes.levelHeader}>Periode</Td>\n                <Td/>\n            </Tr>}\n            {entries.slice(0, viewPort).map(entry => {\n                const fullEntry = journal.getJournalEntry(entry.id)\n                const rates = fullEntry.vatRates.map(rate => rate.percentageString).join(\", \")\n                return entry.legs.map((leg, i) => (\n                    <Tr key={`${entry.id}.${i}`} className={classes.childRow}>\n                        <Td className={`${classes.subDescription} noheader`}>\n                            {entry.reason}\n                            {rates && `(${rates})`}\n                            {leg.tag && ` (${leg.tag})`}\n                        </Td>\n                        <Td align=\"right\">\n                            {leg.amount.isDebit && <FormatAmount amount={leg.amount} debitCredit={true}/>}\n                        </Td>\n                        <Td align=\"right\">\n                            {leg.amount.isCredit && <FormatAmount amount={leg.amount} debitCredit={true}/>}\n                        </Td>\n                        <Td align=\"right\"><FormatDate date={entry.date}/></Td>\n                        <Td align=\"right\"><FormatPeriod period={entry.period}/></Td>\n                        <Td/>\n                    </Tr>))\n            })}\n            {/* Empty line as separation line */}\n            {!onXs && <Tr><Td colSpan={6}/></Tr>}\n        </React.Fragment>\n    )\n}","import React, { useMemo } from 'react'\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport { IconButton, useMediaQuery } from \"@material-ui/core\"\nimport KeyboardArrowUpIcon from \"@material-ui/icons/KeyboardArrowUp\"\nimport KeyboardArrowRightIcon from \"@material-ui/icons/KeyboardArrowRight\"\nimport FormatAmount from \"../Utils/FormatAmount\"\nimport { BalanceDetails } from \"./BalanceDetails\"\nimport { useURLState } from \"../useURLState\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\nimport { useStyles } from \"./Styling\"\nimport { Journal } from \"../../types/Journal/Journal\"\n\ninterface BalanceRowProps {\n    journal: Journal\n    ledgerAccount: LedgerAccount,\n    summary: AccountSummaryMap,\n    viewPort: number\n}\n\nfunction BalanceRow(props: BalanceRowProps) {\n    const [urlState, setURLState] = useURLState()\n\n    const openAccountCodes = useMemo(() => urlState.getStringArrayValue(\"open\"), [urlState])\n\n    const { journal, ledgerAccount, summary, viewPort } = props\n\n    const classes = useStyles()\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const expandAccountCode = (id: string) => {\n        const newOpen = openAccountCodes.includes(id)\n            ? openAccountCodes.filter(s => s !== id)\n            : (onXs ? [id] : [...openAccountCodes, id])\n        setURLState({open: newOpen})\n    }\n\n    const { debitAmount, creditAmount, debitBalance, creditBalance, balance } = summary.getAccountSummary(ledgerAccount)\n    const accountCode = ledgerAccount.code\n    return (\n        <>\n\n            <Tr>\n                <Td className={`${classes.mainDescription} noheader`}>\n                    <IconButton aria-label=\"details\" size=\"small\" onClick={() => expandAccountCode(accountCode)}>\n                        {openAccountCodes.includes(accountCode)\n                            ? <KeyboardArrowUpIcon />\n                            : <KeyboardArrowRightIcon />}\n                    </IconButton>\n                    {ledgerAccount.shortDescription}\n                </Td>\n                <Td align=\"right\"><FormatAmount amount={debitAmount} debitCredit={true} skipIfZero={true}/></Td>\n                <Td align=\"right\"><FormatAmount amount={creditAmount} debitCredit={true} skipIfZero={true}/></Td>\n                <Td align=\"right\"><FormatAmount amount={debitBalance} debitCredit={true} skipIfZero={true}/></Td>\n                <Td align=\"right\"><FormatAmount amount={creditBalance} debitCredit={true} skipIfZero={true}/></Td>\n                <Td align=\"right\"><FormatAmount amount={balance} debitCredit={false}/></Td>\n            </Tr>\n\n            {openAccountCodes.includes(accountCode) &&\n                <BalanceDetails journal={journal} account={ledgerAccount} loadMore={viewPort}/>\n            }\n\n        </>\n    )\n}\n\nexport default BalanceRow;\n","import React from 'react'\nimport { LEDGER_ACCOUNT } from \"../../config\"\n\ninterface FormatCategoryProps {\n    category: string\n}\n\nfunction FormatCategory(props: FormatCategoryProps) {\n    const { category } = props\n\n    const description = {\n        [LEDGER_ACCOUNT.BALANCE_ACCOUNT]: \"Balans\",\n        [LEDGER_ACCOUNT.REVENUE_CATEGORY]: \"Opbrengsten\",\n        [LEDGER_ACCOUNT.EXPENSE_CATEGORY]: \"Kosten\"\n    }[category]\n\n    return (\n        <span>{description}</span>\n    )\n}\n\nexport default FormatCategory","import { useStyles } from \"./Styling\"\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport React from \"react\"\nimport FormatCategory from \"../Utils/FormatCategory\"\n\nexport function CategoryHeader(props: { category: string }) {\n    const {category} = props\n    const classes = useStyles()\n\n    return <Tr>\n        <Td colSpan={6} className={classes.categoryHeader}>\n            <FormatCategory category={category}/>\n        </Td>\n    </Tr>\n}","import React from 'react'\nimport { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\nimport FormatCategory from \"../Utils/FormatCategory\"\nimport { BalanceTotals } from \"./BalanceTotals\"\nimport { Td, Tr } from \"../ResponsiveTable\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { useMediaQuery } from \"@material-ui/core\"\n\ninterface CategoryFooterProps {\n    summary: AccountSummaryMap\n    category: string\n}\n\nfunction CategoryFooter(props: CategoryFooterProps) {\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'))\n\n    const { summary, category } = props\n\n    return (\n        <>\n            <BalanceTotals summary={summary}\n                           filter={account => account.category === category}>\n                <div>\n                    Totaal <FormatCategory category={category}/>\n                </div>\n            </BalanceTotals>\n\n            {!onXs && <Tr>\n                <Td colSpan={6}/>\n            </Tr>}\n        </>\n    )\n}\n\nexport default CategoryFooter;\n","import React, { useEffect, useMemo } from 'react'\n\nimport { Box, Button, Grid, Paper, TableContainer } from \"@material-ui/core\"\nimport { Table, Tbody, Th, Thead, Tr } from '../ResponsiveTable'\n\nimport { Journal } from \"../../types/Journal/Journal\"\nimport { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\nimport InfiniteScroll from \"react-infinite-scroller\"\nimport { useURLState } from \"../useURLState\"\nimport { BalanceTotals } from \"./BalanceTotals\"\nimport { useStyles } from \"./Styling\"\nimport LayoutChoice, { LayoutLabel, LayoutType } from \"./LayoutChoice\"\nimport { EntryLeg } from \"../../types/Journal/EntryLeg\"\nimport BalanceRow from \"./BalanceRow\"\nimport { CategoryHeader } from \"./CategoryHeader\"\nimport CategoryFooter from \"./CategoryFooter\"\n\ninterface TrialBalanceProps {\n    journal: Journal\n}\n\nconst DEFAULT_LAYOUT = LayoutType.TRIALSALDI\n\nfunction TrialBalance(props:TrialBalanceProps) {\n    const [urlState, setURLState] = useURLState()\n    const [viewPort, setViewPort] = React.useState(0)\n    const [journal, setJournal] = React.useState<Journal>(props.journal)\n\n    const classes = useStyles()\n\n    const openAccountCodes = useMemo(() => urlState.getStringArrayValue(\"open\"), [urlState])\n\n    const layoutType = useMemo<LayoutType>(() => {\n        const value = urlState.getStringValue(\"layout\")\n        return Object.values(LayoutType).find(v => v === value) || DEFAULT_LAYOUT\n    }, [urlState])\n\n    useEffect(() => {\n        if (layoutType === LayoutType.RESULTS) {\n            setJournal(props.journal\n                .filterOnAccount((leg: EntryLeg) => !leg.ledgerAccount.isBalanceAccount()))\n        } else {    // LayoutType.TRIALSALDI\n            setJournal(props.journal)\n        }\n    }, [layoutType, props.journal])\n\n    const journalEntries = journal.journalEntries\n    const summary = new AccountSummaryMap(journalEntries)\n    const accounts = summary.getAccounts()\n    const categories = Array.from(new Set(accounts.map(acc => acc.category)))\n\n    const loadMore = () => setViewPort(viewPort + 25)\n\n    const onLayout = (layout: LayoutType) => {\n        if (layout === DEFAULT_LAYOUT) {\n            setURLState({layout: null})\n        } else {\n            setURLState({layout})\n        }\n    }\n\n    const onOpenCloseAll = () => {\n        setURLState({open: openAccountCodes.length ? null : accounts.map(a => a.code)})\n    }\n\n    return (\n        <div>\n\n        <Box display=\"block\" displayPrint=\"none\">\n            {/* Screen Only */}\n            <Grid container direction={\"row\"} alignItems={\"center\"}>\n                <Grid item xs={6} md={3} className={classes.openCloseButton}>\n                    <Button variant={\"contained\"} color={\"primary\"} size={\"small\"} onClick={() => onOpenCloseAll()}>\n                        <span>{openAccountCodes.length ? \"Sluit\" : \"Open\" } alle posten</span>\n                    </Button>\n                </Grid>\n                <Grid item xs={6}>\n                    <LayoutChoice layoutType={layoutType} onLayout={onLayout}/>\n                </Grid>\n            </Grid>\n        </Box>\n\n        <Box display=\"none\" displayPrint=\"block\">\n            {/* Print Only */}\n            <h2>{LayoutLabel[layoutType]}</h2>\n        </Box>\n\n        <InfiniteScroll pageStart={0} hasMore={openAccountCodes.length > 0} loadMore={loadMore} initialLoad={false}>\n        <TableContainer component={Paper}>\n                <Table className={classes.table}\n                       size=\"small\">\n                    <Thead>\n                        <Tr>\n                            <Th/>\n                            <Th align=\"right\">Debit</Th>\n                            <Th align=\"right\">Credit</Th>\n                            <Th align=\"right\">Saldo Debit</Th>\n                            <Th align=\"right\">Saldo Credit</Th>\n                            <Th align=\"right\">Saldo</Th>\n                        </Tr>\n                    </Thead>\n                    <Tbody>\n\n                        {categories.map(category => {\n                            const categoryAccounts = accounts.filter(account => account.category === category)\n\n                            return (\n                                <React.Fragment key={category}>\n\n                                    <CategoryHeader category={category}/>\n\n                                    {categoryAccounts.map(ledgerAccount => {\n                                        return <BalanceRow key={ledgerAccount.code}\n                                                           journal={journal}\n                                                           ledgerAccount={ledgerAccount}\n                                                           summary={summary}\n                                                           viewPort={viewPort}/>\n                                    })}\n\n                                    <CategoryFooter category={category} summary={summary}/>\n\n                                </React.Fragment>\n                            )\n                        })}\n\n                        <BalanceTotals summary={summary}>\n                            <span>Totaal</span>\n                        </BalanceTotals>\n\n                    </Tbody>\n                </Table>\n            </TableContainer>\n        </InfiniteScroll>\n        </div>\n    );\n}\n\nexport default TrialBalance;","import React, { useMemo } from 'react'\nimport { useSelector } from \"react-redux\";\n\nimport { selectJournal } from \"../app/AccountingSlice\"\nimport { selectPeriodFilter } from \"../app/FilterSlice\"\n\nimport { Routes } from \"../routes/routes\"\n\nimport TrialBalance from \"../components/TrialBalance/TrialBalance\"\nimport PageHeader from \"./PageHeader\"\n\nfunction TrialBalancePage() {\n    const journal = useSelector(selectJournal)\n    const periodFilter = useSelector(selectPeriodFilter)\n\n    const filteredJournal = useMemo(() => journal.filterOnPeriod(periodFilter), [journal, periodFilter])\n\n    return (\n        <div>\n            <PageHeader title={Routes.TrialBalance}/>\n            <TrialBalance journal={filteredJournal}/>\n        </div>\n    );\n}\n\nexport default TrialBalancePage;","import React, { useEffect, useState } from 'react'\n\nimport { Container } from \"@material-ui/core\";\nimport { createStyles, makeStyles } from \"@material-ui/core/styles\"\n\nimport MarkdownIt from \"markdown-it\"\nimport { localPath } from \"../config\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        root: {\n            textAlign: \"left\",\n            marginLeft: \"5%\",\n            marginRight: \"5%\"\n        },\n    }),\n);\n\n\n\nfunction HomePage() {\n    const classes = useStyles();\n    const [text, setText] = useState(\"\")\n\n    useEffect(() => {\n        const loadText = async () => {\n            const data = await fetch(localPath(\"/README.md\"))\n            const mdText = await data.text()\n            const md = new MarkdownIt()\n            setText(md.render(mdText))\n        }\n\n        if (! text) {\n            loadText().catch(() => {\n                setText(\"Tekst kan niet geladen worden\")\n            })\n        }\n    }, [text])\n\n    return (\n        <Container maxWidth={false}>\n            <div dangerouslySetInnerHTML={{__html: text}} className={classes.root} />\n        </Container>\n    );\n}\n\nexport default HomePage;\n","import React from 'react'\nimport { IBAN } from \"../../types/IBAN\"\nimport { makeStyles, useMediaQuery } from \"@material-ui/core\"\nimport { createStyles, useTheme } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        iban: {\n            whiteSpace: \"nowrap\",\n        },\n    }));\n\ninterface FormatIBANProps {\n    iban: IBAN\n}\n\nfunction FormatIBAN(props: FormatIBANProps) {\n    const {iban} = props\n    const classes = useStyles()\n    const theme = useTheme();\n    const onSmDown = useMediaQuery(theme.breakpoints.down('sm'));\n\n    return (\n        <span className={classes.iban}>\n            {iban.format({short: onSmDown})}\n        </span>\n    )\n}\n\nexport default FormatIBAN;\n","import React from 'react'\nimport { useDispatch } from \"react-redux\"\n\nimport { makeStyles, Paper, TableContainer, useMediaQuery } from \"@material-ui/core\"\n\nimport { Table, Thead, Tbody, Tr, Th, Td } from './ResponsiveTable';\n\nimport { linkBankAccount } from \"../app/AccountingSlice\"\n\nimport { BankAccount } from \"../types/LiquidAssets/BankAccount\"\nimport { LedgerAccount } from \"../types/Ledger/LedgerAccount\"\nimport { LedgerScheme } from \"../types/Ledger/LedgerScheme\"\n\nimport RGSAccountSelector from \"./Editors/RGSAccountSelector\"\nimport { LiquidAssets } from \"../types/LiquidAssets/LiquidAssets\"\nimport { createStyles, useTheme } from \"@material-ui/core/styles\"\nimport FormatAmount from \"./Utils/FormatAmount\"\nimport FormatDate from \"./Utils/FormatDate\"\nimport FormatIBAN from \"./Utils/FormatIBAN\"\n\nconst useStyles = makeStyles((/*theme: Theme*/) =>\n    createStyles({\n    table: {\n    },\n    date: {\n        whiteSpace: \"nowrap\",\n    },\n    levelHeader: {\n        fontWeight: 'bold'\n    },\n}));\n\ninterface BankAccountsProps {\n    liquidAssets: LiquidAssets\n}\n\nfunction BankAccounts(props: BankAccountsProps) {\n    const { liquidAssets } = props\n    const classes = useStyles()\n    const dispatch = useDispatch()\n    const theme = useTheme();\n    const onSm = useMediaQuery(theme.breakpoints.only('sm'));\n    const onSmDown = useMediaQuery(theme.breakpoints.down('sm'));\n\n    const bankAccounts = liquidAssets.bankAccounts\n\n    const accountOptions = LedgerScheme.bankAccounts\n\n    function updateLedgerAccount(bankAccount: BankAccount, ledgerAccount: LedgerAccount) {\n        dispatch(linkBankAccount({bankAccountData: bankAccount.data, ledgerAccountData: ledgerAccount.data}))\n    }\n\n    const accountBalances = liquidAssets.getBalances()\n    const [begin, end] = liquidAssets.getTotals(accountBalances)\n\n    return (\n        <div>\n            <TableContainer component={Paper}>\n                <Table>\n                    <Thead>\n                        <Tr>\n                            <Th>Rekening</Th>\n                            <Th align={\"right\"}>Saldo</Th>\n                            <Th>{!onSm && \"Datum\"}</Th>\n                            <Th align={\"right\"}>Saldo</Th>\n                            <Th>{!onSm && \"Datum\"}</Th>\n                            <Th align=\"left\">RGS</Th>\n                        </Tr>\n                    </Thead>\n                    <Tbody>\n                        {bankAccounts.map(bankAccount => {\n                            const balances = accountBalances[bankAccount.id]\n                            const beginBalance = balances.beginBalance\n                            const endBalance = balances.endBalance\n                            return (\n                                <Tr key={bankAccount.id}>\n                                    <Td><FormatIBAN iban={bankAccount.IBAN}/></Td>\n                                    <Td align=\"right\">{beginBalance && <FormatAmount amount={beginBalance.amount} debitCredit={false}/>}</Td>\n                                    <Td align=\"left\" className={classes.date}>\n                                        {!onSm && beginBalance && <FormatDate date={beginBalance.date}/>}\n                                    </Td>\n                                    <Td align=\"right\">{endBalance && <FormatAmount amount={endBalance.amount} debitCredit={false}/>}</Td>\n                                    <Td align=\"left\" className={classes.date} >\n                                        {!onSm && endBalance && <FormatDate date={endBalance.date}/>}\n                                    </Td>\n                                    <Td align=\"left\" className={\"noheader\"}>\n                                        <RGSAccountSelector ledgerAccount={bankAccount.ledgerAccount}\n                                                            accountOptions={accountOptions}\n                                                            onChange={(account: LedgerAccount) => updateLedgerAccount(bankAccount, account)}/>\n                                    </Td>\n                                </Tr>\n                            )\n                        })}\n\n                        {!onSmDown &&<Tr className={classes.levelHeader}>\n                            <Td className={classes.levelHeader}>Totaal</Td>\n                            <Td align=\"right\"><FormatAmount amount={begin} debitCredit={false}/></Td>\n                            <Td align=\"left\"/>\n                            <Td align=\"right\"><FormatAmount amount={end} debitCredit={false}/></Td>\n                            <Td align=\"left\"/>\n                            <Td align=\"left\"/>\n                        </Tr>}\n\n                    </Tbody>\n                </Table>\n            </TableContainer>\n        </div>\n    )\n}\n\nexport default BankAccounts","import React from 'react'\nimport { useSelector } from \"react-redux\"\n\nimport { selectLiquidAssets } from \"../app/AccountingSlice\"\nimport { selectPeriodFilter } from \"../app/FilterSlice\"\n\nimport BankAccounts from \"../components/BankAccounts\"\nimport PageHeader from \"./PageHeader\"\nimport { Routes } from \"../routes/routes\"\n\nfunction BankPage() {\n    const liquidAssets = useSelector(selectLiquidAssets)\n    const periodFilter = useSelector(selectPeriodFilter)\n\n    const filteredAssets = liquidAssets.filterOnPeriod(periodFilter)\n\n    return (\n        <div>\n            <PageHeader title={Routes.Bank}/>\n            <BankAccounts liquidAssets={filteredAssets} />\n        </div>\n    )\n}\n\nexport default BankPage","import React, { useState } from 'react'\nimport { useHistory } from \"react-router-dom\"\n\nimport { Grid, makeStyles, Paper, TableContainer } from \"@material-ui/core\"\nimport { createStyles } from \"@material-ui/core/styles\"\nimport IconButton from \"@material-ui/core/IconButton\"\n\nimport { Table, Thead, Tbody, Tr, Th, Td } from './ResponsiveTable';\n\nimport InfiniteScroll from \"react-infinite-scroller\"\n\nimport { Routes } from \"../routes/routes\"\nimport { Journal } from \"../types/Journal/Journal\"\nimport { JournalEntry } from \"../types/Journal/JournalEntry\"\n\nimport { sortedArray } from \"../services/utils\"\nimport FormatDate from \"./Utils/FormatDate\"\nimport FormatAmount from \"./Utils/FormatAmount\"\nimport FormatPeriod from \"./Utils/FormatPeriod\"\nimport RouteIcon from \"../routes/RouteIcon\"\n\nconst useStyles = makeStyles((/*theme: Theme*/) =>\n    createStyles({\n    headerRow: {\n        background: \"lightgrey\",\n        boxShadow: \"none !important\"\n    },\n    header: {\n        fontWeight: \"bold\",\n    }\n}));\n\ninterface JournalProps {\n    journal: Journal\n}\n\nfunction Journals(props: JournalProps) {\n    const [viewPort, setViewPort] = useState(0)\n    const history = useHistory()\n\n    const { journal } = props\n    const classes = useStyles()\n\n    let entries: JournalEntry[] = journal.journalEntries\n    entries = sortedArray(entries, (e) => [e.period.string, e.date.string].join(\".\"), false)\n\n    const filteredEntries = entries.slice(0, viewPort)\n    const hasMore = viewPort < entries.length\n    const loadMore = () => setViewPort(viewPort + 50)\n\n    const editEntry = (entry: JournalEntry) => {\n        const editRef = Routes.Edit.path\n        history.push(`${editRef}?id=${entry.id}`)\n    }\n\n    return (\n        <div>\n            <InfiniteScroll pageStart={0} hasMore={hasMore} loadMore={loadMore}>\n            <TableContainer component={Paper}>\n                    <Table>\n                        <Thead><Tr>\n                            <Th>datum</Th>\n                            <Th>Periode</Th>\n                            <Th>RGS</Th>\n                            <Th align=\"right\">Debit</Th>\n                            <Th align=\"right\">Credit</Th>\n                        </Tr></Thead>\n                        <Tbody>\n                        {filteredEntries.map(entry => {\n                            return (\n                                <React.Fragment key={entry.id}>\n                                    <Tr className={classes.headerRow}>\n                                        <Td colSpan={5} className={classes.header}>\n                                            <Grid container alignItems={\"center\"} spacing={1}>\n                                                <Grid item>\n                                                    <IconButton onClick={() => editEntry(entry)}\n                                                                aria-label={\"Edit entry\"} size={\"small\"}>\n                                                        {RouteIcon({id: Routes.Edit.id})}\n                                                    </IconButton>\n                                                </Grid>\n                                                <Grid item>\n                                                    {entry.reason}\n                                                </Grid>\n                                            </Grid>\n                                        </Td>\n                                    </Tr>\n                                    {entry.legs.map((leg, i) => {\n                                        const ledgerAccount = leg.ledgerAccount\n                                        const key = `${entry.id}.${i}`\n                                        return (\n                                            <Tr key={key}>\n                                                <Td><FormatDate date={entry.date}/></Td>\n                                                <Td><FormatPeriod period={entry.period}/></Td>\n                                                <Td>\n                                                    {ledgerAccount.shortDescription}\n                                                    {leg.tag && ` (${leg.tag})`}\n                                                </Td>\n                                                <Td align={\"right\"}>{leg.amount.isDebit && <FormatAmount amount={leg.amount} debitCredit={true}/>}</Td>\n                                                <Td align={\"right\"}>{leg.amount.isCredit && <FormatAmount amount={leg.amount} debitCredit={true}/>}</Td>\n                                            </Tr>\n                                        )})}\n                                </React.Fragment>\n                            )\n                        })}\n                    </Tbody>\n                </Table>\n            </TableContainer>\n            </InfiniteScroll>\n        </div>\n    )\n}\n\nexport default Journals;\n","import React from 'react';\nimport { useSelector } from \"react-redux\";\n\nimport { selectJournal } from \"../app/AccountingSlice\"\nimport { selectPeriodFilter } from \"../app/FilterSlice\"\n\nimport { Routes } from \"../routes/routes\"\n\nimport Journals from \"../components/Journals\"\nimport PageHeader from \"./PageHeader\"\n\nfunction JournalPage() {\n\n    const journal = useSelector(selectJournal)\n    const periodFilter = useSelector(selectPeriodFilter)\n\n    const filteredJournal = journal.filterOnPeriod(periodFilter)\n\n    return (\n        <div>\n            <PageHeader title={Routes.Journal}/>\n            <Journals journal={filteredJournal}/>\n        </div>\n    );\n}\n\nexport default JournalPage;","import React, { useEffect, useState } from 'react'\nimport { IconButton, Input, InputProps } from \"@material-ui/core\"\nimport { Clear } from \"@material-ui/icons\"\n\ninterface Props {\n    text: string,\n    onSearch: (text: string) => void\n}\n\nfunction TextSearch(props: InputProps & Props) {\n    const [searchText, setSearchText] = useState(props.text)\n    const [timer, setTimer] = useState<any>(null)\n\n    useEffect(() => {\n        setSearchText(props.text)\n    }, [props.text])\n\n    const onChange = (event: any) => {\n        const newSearchText = event.target.value\n        clearTimeout(timer)\n\n        setSearchText(newSearchText)\n        const timeout = newSearchText ? 500 : 0\n        setTimer(setTimeout(() => {\n            // Try to collect succeeding keystrokes\n            search(newSearchText)\n        },  timeout))\n    }\n\n    const onSearch = (event: React.KeyboardEvent<HTMLTextAreaElement | HTMLInputElement>) => {\n        if (event.key === 'Enter') {\n            // Search immediately\n            search(searchText)\n        }\n    }\n\n    const search = (text: string) => {\n        setSearchText(text)\n        clearTimeout(timer)\n        props.onSearch(text)\n    }\n\n    return (\n        <>\n            <Input\n                value={searchText}\n                onChange={onChange}\n                onKeyUp={onSearch}\n                placeholder=\"Search\"\n                inputProps={{ 'aria-label': 'zoek tekst' }}\n            />\n            <IconButton aria-label=\"wis zoektekst\" onClick={() => search(\"\")}>\n                <Clear/>\n            </IconButton>\n        </>\n    )\n}\n\nexport default TextSearch;\n","import React, { useState } from 'react'\nimport { Checkbox, FormControlLabel } from \"@material-ui/core\"\nimport { createStyles, makeStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        legend: {\n            marginLeft: -20\n        },\n    }),\n);\n\ninterface Stringable {\n    toString: () => string\n}\n\ninterface EnumSelectorProps<T> {\n    title: string\n    allValues: T[]\n    selectedValues: T[]\n    onValues: (values: string[]) => void\n}\n\nfunction EnumSelector<T extends Stringable>(props: EnumSelectorProps<T>) {\n    const [values, setValues] = useState<string[]>(props.selectedValues.map(v => v.toString()))\n    const [timer, setTimer] = useState<any>(null)\n\n    const classes = useStyles()\n\n    const allValues:string[] = props.allValues.map(v => v.toString())\n\n    const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n        const value:string = event.target.name\n        clearTimeout(timer)\n\n        const newValues = event.target.checked\n            ? [...values, value]\n            : values.filter(l => l !== value)\n\n        if (newValues.length) {\n            setValues(newValues)\n\n            const timeout = 500\n            setTimer(setTimeout(() => {\n                // Try to collect succeeding keystrokes\n                props.onValues(newValues)\n            },  timeout))\n        }\n    };\n\n    return (\n        <>\n            {/*<FormLabel component=\"legend\">*/}\n                <div className={classes.legend}>{props.title}</div>\n            {/*</FormLabel>*/}\n            <div>\n                {allValues.map(value => {\n                    return (\n                        <FormControlLabel key={value}\n                                          control={\n                                              <Checkbox\n                                                  disabled={values.includes(value) && values.length === 1}\n                                                  size={\"small\"}\n                                                  checked={values.includes(value)}\n                                                  onChange={onChange}\n                                                  name={value}\n                                                  color=\"primary\"\n                                              />\n                                          }\n                                          label={value}\n                        />)\n                })}\n            </div>\n        </>\n    )\n}\n\nexport default EnumSelector;\n","import React from 'react'\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\nimport EnumSelector from \"./EnumSelect\"\n\ninterface LevelSelectorProps {\n    levels: number[]\n    onLevels: (levels: number[]) => void\n}\n\nfunction LevelSelector(props: LevelSelectorProps) {\n    const allLevels = LedgerScheme.Levels()\n    const { levels } = props\n\n    const onLevels = (values: string[]) => {\n        props.onLevels(values.map(v => parseInt(v)))\n    }\n\n    return (\n        <EnumSelector title={\"Nivo\"}\n                      allValues={allLevels}\n                      selectedValues={levels}\n                      onValues={onLevels}/>\n    )\n}\n\nexport default LevelSelector;\n","import React from 'react'\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\nimport EnumSelector from \"./EnumSelect\"\n\ninterface CreditDebitSelectorProps {\n    sides: string[]\n    onSides: (sides: string[]) => void\n}\n\nfunction CreditDebitSelector(props: CreditDebitSelectorProps) {\n    const allSides = LedgerScheme.Sides()\n    const { sides } = props\n\n    const onSides = (sides: string[]) => {\n        props.onSides(sides)\n    };\n\n    return (\n        <EnumSelector title={\"Debit/Credit\"}\n                      allValues={allSides}\n                      selectedValues={sides}\n                      onValues={onSides}/>\n    )\n}\n\nexport default CreditDebitSelector;\n","import React from 'react'\nimport { Button, makeStyles } from \"@material-ui/core\"\nimport HighlightText from \"./Utils/HighlightText\"\nimport { createStyles } from \"@material-ui/core/styles\"\n\nconst useStyles = makeStyles((/*theme: Theme*/) =>\n    createStyles({\n        searchText: {\n            textAlign: \"left\",\n            fontWeight: \"inherit\",\n            textTransform: \"none\",\n            lineHeight: \"inherit\",\n            fontSize: \"inherit\",\n            marginLeft: -5\n        },\n    }))\n\ninterface SearchTextButtonProps {\n    text: string\n    searchText: string\n    onSearch: (text: string) => void\n}\n\nfunction SearchTextButton(props: SearchTextButtonProps) {\n    const { text, searchText, onSearch } = props\n    const classes = useStyles()\n\n    return (\n        <Button aria-label={`zoek op ${text}`}\n                size={\"small\"}\n                className={classes.searchText}\n                onClick={() => onSearch(text)}>\n            <HighlightText highlightText={searchText}\n                           text={text}/>\n        </Button>\n    )\n}\n\nexport default SearchTextButton;\n","/**\n * TreeView\n *\n * Elementary treeView support\n */\n\ninterface TreeViewProps {\n    open: string[],     // All node id's that are explicitly opened\n    close: string[],    // All node id's that are explicitly closed\n    levels: number[]    // All levels that are open\n}\n\nexport class TreeView implements TreeViewProps {\n    open: string[]\n    close: string[]\n    levels: number[]\n\n    constructor(props: TreeViewProps) {\n        const { open, close, levels } = props\n        this.open = open\n        this.close = close\n        this.levels = levels\n    }\n\n    /**\n     * Tells whether the node with the given id and level is open (has any children below)\n     */\n    isNodeOpen(node: Omit<TreeViewNode, \"parentId\">): boolean {\n        const { id, level } = node\n        if (this.open.includes(id)) {\n            // Explicitly opened\n            return true\n        } else if (this.close.includes(id)) {\n            // Explicitly closed\n            return false\n        } else {\n            // Implicit visibility\n            return this.levels.includes(level) && this.levels.includes(level + 1)\n        }\n    }\n\n    /**\n     * Opens a node when it is closes and vice versa\n     */\n    toggleOpenClose(node: Omit<TreeViewNode, \"parentId\">): {\n        open: string[],\n        close: string[]\n    } {\n        const { id, level } = node\n        const implicitlyOpen = this.levels.includes(level + 1)\n        \n        const reset = (ids: string[]) => ids.filter(i => i.indexOf(id) !== 0)\n\n        if (this.isNodeOpen(node)) {\n            // Close id\n            this.open = reset(this.open)          // clear any open ids or children or id\n            this.close = implicitlyOpen\n                    ? [...reset(this.close), id]  // reset children, close account explicitly\n                    : reset(this.close)           // simply reset account and children, account will close automatically\n        } else {\n            // Open id\n            this.open = implicitlyOpen\n                ? this.open                       // already implicitly open, do not change open\n                : [...this.open, id]              // explicitly open\n            this.close = reset(this.close)        // unclose account and any children\n        }\n        return {\n            open: this.open,\n            close: this.close\n        }\n    }\n\n    /**\n     * Tells whether the node with the given id, parentId and level is visible in the treeView\n     */\n    isNodeVisible(node: TreeViewNode): boolean {\n        const { id, parentId, level } = node\n        if (this.open.includes(id) ||                   // Explicitly opened\n            this.close.includes(id) ||                  // Explicitly closed (show to be able to re-open)\n            (parentId && this.open.includes(parentId))  // Opened by parent\n        ) {\n            return true\n        } else if (this.close.some(c => id.indexOf(c) === 0)) {\n            return false                                // Closed by parent\n        } else {\n            // Default or implicit behaviour\n            return this.levels.includes(level)          // Level is visible\n        }\n    }\n}\n\nexport interface TreeViewNode {\n    id: string,\n    parentId: string | null,\n    level: number\n}\n","import React, { useEffect, useMemo, useState } from 'react'\n\nimport { Grid, IconButton, Paper, TableContainer, useMediaQuery } from \"@material-ui/core\"\n\nimport { Table, Thead, Tbody, Tr, Th, Td } from './ResponsiveTable';\n\nimport InfiniteScroll from 'react-infinite-scroller'\n\nimport { LedgerAccount } from \"../types/Ledger/LedgerAccount\"\nimport TextSearch from \"./Selectors/TextSearch\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { useURLState } from \"./useURLState\"\nimport HighlightText from \"./Utils/HighlightText\"\nimport { allOrSome, noneOrSome, removeDiacritics } from \"../services/utils\"\nimport LevelSelector from \"./Selectors/LevelSelector\"\nimport { LedgerScheme } from \"../types/Ledger/LedgerScheme\"\nimport CreditDebitSelector from \"./Selectors/DebitCreditSelector\"\nimport SearchTextButton from \"./SearchTextButton\"\nimport KeyboardArrowUpIcon from \"@material-ui/icons/KeyboardArrowUp\"\nimport KeyboardArrowRightIcon from \"@material-ui/icons/KeyboardArrowRight\"\nimport { TreeView, TreeViewNode } from \"../services/TreeView\"\n\nclass AccountTreeViewNode implements TreeViewNode {\n    id: string\n    level: number\n    parentId: string | null\n\n    constructor(account: LedgerAccount) {\n        this.id = account.code\n        this.level = account.level\n        this.parentId = account.parent && account.parent.code\n    }\n}\n\ninterface LedgerViewerProps {\n    accounts: LedgerAccount[]\n}\n\nconst LOAD_PER = 100\nconst DEFAULT_LEVELS = [1, 2]\nconst DEFAULT_SIDES = [\"D\", \"C\", \"\"]\n\nfunction LedgerViewer(props: LedgerViewerProps) {\n    const [urlState, setURLState] = useURLState()\n    const [viewPort, setViewPort] = useState(LOAD_PER)\n    const [searching, setSearching] = useState(false)\n    const [searchedAccounts, setSearchedAccounts] = useState<LedgerAccount[]>([])\n    const [filteredAccounts, setFilteredAccounts] = useState<LedgerAccount[]>([])\n    const [viewPortAccounts, setViewPortAccounts] = useState<LedgerAccount[]>([])\n\n    const theme = useTheme()\n    const onSmDown = useMediaQuery(theme.breakpoints.down('sm'));\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const { accounts } = props\n\n    const searchText = useMemo(() => urlState.getStringValue(\"search\"), [urlState])\n    const open = useMemo(() => urlState.getStringArrayValue(\"open\"), [urlState])\n    const close = useMemo(() => urlState.getStringArrayValue(\"close\"), [urlState])\n    const levels = useMemo(() => allOrSome(DEFAULT_LEVELS, urlState.getNumericArrayValue(\"levels\")),\n        [urlState])\n    const sides = useMemo(() => allOrSome(DEFAULT_SIDES, urlState.getStringArrayValue(\"sides\")),\n        [urlState])\n\n    const treeView = new TreeView({open, close, levels})\n\n    useEffect(() => {\n        setViewPort(LOAD_PER)\n        if (searchText) {\n            setSearchedAccounts(LedgerScheme.getMatchingAccounts(accounts, searchText, true))\n        } else {\n            setSearchedAccounts(accounts)\n        }\n        setSearching(false)\n    }, [searchText, accounts])\n\n    useEffect(() => {\n        const treeView = new TreeView({open, close, levels})    // local treeView\n        const accountIsVisible = (account: LedgerAccount) => {\n            return treeView.isNodeVisible(new AccountTreeViewNode(account))\n        }\n        const sideIsVisible = (side: string | undefined) => (!side || sides.includes(side))\n\n        setFilteredAccounts(searchedAccounts.filter(acc => accountIsVisible(acc) && sideIsVisible(acc.side)))\n    }, [levels, sides, open, close, searchedAccounts])\n\n    useEffect(() => {\n        setViewPortAccounts(filteredAccounts.slice(0, viewPort))\n    }, [viewPort, filteredAccounts])\n\n    const hasMore = viewPort < filteredAccounts.length\n    const loadMore = (page: any) => setViewPort(page * LOAD_PER)\n\n    const onSearch = (search: string) => {\n        setSearching(true)\n        setURLState({search: removeDiacritics(search)})\n    }\n\n    const onSides = (sides: string[]) => setURLState({sides: noneOrSome(DEFAULT_SIDES, sides)})\n\n    const onLevels = (levels: number[]) => setURLState({levels: noneOrSome(DEFAULT_LEVELS, levels)})\n\n    const onOpenClose = (account: LedgerAccount) =>\n        setURLState(treeView.toggleOpenClose(new AccountTreeViewNode(account)))\n\n    const isOpen = (account: LedgerAccount) => treeView.isNodeOpen(new AccountTreeViewNode(account))\n\n    const maxLevel = Math.max(...LedgerScheme.Levels())\n\n    return (\n        <div>\n            <Grid container direction={\"row\"} justify={\"space-between\"} alignItems={\"center\"}>\n                <Grid item xs={12} sm={6} md={5}>\n                    <TextSearch disabled={searching} text={searchText} onSearch={onSearch} />\n                </Grid>\n                {!onSmDown && <Grid item md={2}>\n                    <CreditDebitSelector sides={sides} onSides={onSides}/>\n                </Grid>}\n                <Grid item xs={12} sm={6} md={5}>\n                    <div>\n                    <LevelSelector key={levels.length} levels={levels} onLevels={onLevels}/>\n                    </div>\n                </Grid>\n            </Grid>\n            <InfiniteScroll loader={<div key={1}>Loading...</div>} pageStart={0} hasMore={hasMore} loadMore={loadMore}>\n                <TableContainer component={Paper}>\n                    <Table>\n                        <Thead>\n                            <Tr>\n                                <Th>Omschrijving Kort</Th>\n                                {!onSmDown && <Th>Omschrijving</Th>}\n                                <Th>Code</Th>\n                                <Th>Omslag</Th>\n                                <Th>D/C</Th>\n                                <Th>Nivo</Th>\n                                {!onSmDown && <Th>Sortering</Th>}\n                                {!onSmDown && <Th>Nummer</Th>}\n                            </Tr>\n                        </Thead>\n                        <Tbody>\n                            {viewPortAccounts.map(account => {\n                                const dcAlign = account.data.DC === \"D\" ? \"left\" : \"right\"\n                                const indent = (account.level - 1) * 15\n                                const iconWidth = 26\n                                const style = onXs\n                                    ? {\n                                        marginLeft: indent  // Indent card\n                                      }\n                                    : {\n                                        //    - text\n                                        //      next line text\n                                        textIndent: -iconWidth,             // real indent\n                                        paddingLeft: indent + iconWidth     // indent text after icon\n                                    }\n                                return (\n                                    <Tr key={account.data.Referentiecode} style={ onXs ? style : {} }>\n                                        <Td className={\"noheader\"}>\n                                            <div style={ onXs ? {} : style }>\n                                                <IconButton aria-label=\"details\"\n                                                            disabled={account.level === maxLevel}\n                                                            size=\"small\"\n                                                            onClick={() => onOpenClose(account)}>\n                                                    {isOpen(account)\n                                                        ? <KeyboardArrowUpIcon fontSize={\"small\"} />\n                                                        : <KeyboardArrowRightIcon fontSize={\"small\"}/>}\n                                                </IconButton>\n                                                {account.shortDescription}\n                                            </div>\n                                        </Td>\n                                        {!onSmDown && <Td>\n                                            <HighlightText highlightText={searchText}\n                                                           text={account.description}/>\n                                        </Td>}\n                                        <Td>\n                                            <HighlightText highlightText={searchText}\n                                                           text={account.data.Referentiecode}/>\n                                        </Td>\n                                        <Td>\n                                            {account.reverseCode &&\n                                            <SearchTextButton text={account.reverseCode}\n                                                              searchText={searchText}\n                                                              onSearch={onSearch}/>\n                                            }\n                                        </Td>\n                                        <Td align={dcAlign}>{account.data.DC}</Td>\n                                        <Td align={\"center\"}>{account.data.Nivo || \"\"}</Td>\n                                        {!onSmDown && <Td>{account.sortKey}</Td>}\n                                        {!onSmDown && <Td>{account.data.Referentienummer}</Td>}\n                                    </Tr>\n                                )\n                            })}\n                        </Tbody>\n                    </Table>\n                </TableContainer>\n            </InfiniteScroll>\n        </div>\n    )\n}\n\nexport default LedgerViewer","import React, { useMemo } from 'react'\n\nimport { LedgerScheme } from \"../types/Ledger/LedgerScheme\"\nimport { Routes } from \"../routes/routes\"\n\nimport LedgerViewer from \"../components/LedgerScheme\"\nimport PageHeader from \"./PageHeader\"\n\nfunction LedgerPage() {\n    const accounts = useMemo(() => LedgerScheme.ledgerAccounts.filter(a => !a.isUnmapped()), [])\n\n    return (\n        <div>\n            <PageHeader title={Routes.Ledger} periodFilter={false} withName={false}/>\n            <LedgerViewer accounts={accounts}/>\n        </div>\n    );\n}\n\nexport default LedgerPage;","import { Theme } from \"@material-ui/core/styles\"\n\nexport const drawerWidth = 250\n\nexport const toolbarStyle = (theme: Theme) => ({\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'flex-end',\n    padding: theme.spacing(0, 1),\n    // necessary for content to be below app bar\n    ...theme.mixins.toolbar,\n})\n","import { configureStore } from '@reduxjs/toolkit'\n\nimport accountingReducer from './AccountingSlice'\nimport filterReducer from './FilterSlice'\nimport ageReducer, { resetAge, increaseAge } from './AgeSlice'\nimport { Accounting } from \"../types/Accounting\"\n\nconst updateAccounting = (store: any) => (next: any) => (action: any) => {\n  // Execute action\n  const result = next(action)\n\n  // Execute post action\n  if (/^accounting\\//.test(action.type)) {\n    // On each invocation of an accountingReducer\n    // Inject new accounting state in Accounting\n    setAccountingState(store)\n  }\n\n  return result\n}\n\nconst updateAge = ({ dispatch }: any) => (next: any) => (action: any) => {\n  // Execute action\n  const result = next(action)\n\n  if (/(restore|reset)(Accounting|Filter)State/.test(action.type)) {\n    // Reset age on any filter or accounting restore or reset action\n    dispatch(resetAge())\n  } else if (/^(accounting|filter)\\//.test(action.type)  && !/^accounting\\/addStatements/.test(action.type) ) {\n    // any other filter or accounting action increases the age\n    // Expect for reading statements (unmodified data loaded from an external file)\n    dispatch(increaseAge())\n  }\n\n  return result\n}\n\nexport const store = configureStore({\n  reducer: {\n    accounting: accountingReducer,\n    filter: filterReducer,\n    age: ageReducer\n  },\n  middleware: (getDefaultMiddleware) =>\n      getDefaultMiddleware().concat([updateAccounting, updateAge])\n});\n\nexport function setAccountingState(store: any) {\n  Accounting.State = store.getState().accounting\n}\n\nexport const selectState = (state: RootState) => state\n\nexport type RootState = ReturnType<typeof store.getState>;\n\n// export type AppThunk<ReturnType = void> = ThunkAction<\n//   ReturnType,\n//   RootState,\n//   unknown,\n//   Action<string>\n// >;","import React, { useState } from 'react'\nimport Button from '@material-ui/core/Button';\nimport TextField from '@material-ui/core/TextField';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogContentText from '@material-ui/core/DialogContentText';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { useSelector } from \"react-redux\"\nimport { selectMetaData } from \"../../app/AccountingSlice\"\n\ninterface SaveDialogProps {\n    open: boolean\n    onClose: (name: string | null, password: string) => void\n}\n\nexport default function SaveDialog(props: SaveDialogProps) {\n    const meta = useSelector(selectMetaData)\n\n    const defaultName = meta.name\n\n    const [name, setName] = useState(defaultName)\n    const [password, setPassword] = useState(\"\")\n    const [rePassword, setRePassword] = useState(\"\")\n\n    const { open } = props\n\n    const onChange = (event: any) => setName(event.target.value)\n\n    const onPassword = (event: any) => setPassword(event.target.value)\n\n    const onRePassword = (event: any) => setRePassword(event.target.value)\n\n    const onClose = (name: string | null, password: string = \"\") => {\n        setName(\"\")\n        setPassword(\"\")\n        setRePassword(\"\")\n        props.onClose(name, password)\n    }\n\n    const handleClose = () => onClose(name, password)\n\n    const handleCancel = () => onClose(null)\n\n    const saveEnabled = name && password && password === rePassword\n\n    return (\n        <div>\n            <Dialog fullWidth={false}\n                    open={open}\n                    maxWidth={false}\n                    onClose={handleClose}\n                    aria-labelledby=\"save-dialog-title\">\n                <DialogTitle id=\"save-dialog-title\">Bewaar Administratie</DialogTitle>\n                <DialogContent dividers>\n                    <DialogContentText>\n                        Bewaar de huidige administratie in een bestand op uw computer\n                        <br/>\n                        U dient een wachtwoord (of beter: wachtzin) in te geven waarmee het bestand wordt versleuteld\n                    </DialogContentText>\n                    <form noValidate autoComplete=\"off\">\n                    <TextField\n                        value={name}\n                        onChange={onChange}\n                        autoFocus\n                        margin=\"dense\"\n                        id=\"name\"\n                        label=\"Naam van de administratie\"\n                        type=\"text\"\n                        fullWidth\n                    />\n                    <TextField\n                        value={password}\n                        onChange={onPassword}\n                        margin=\"dense\"\n                        id=\"password\"\n                        label=\"Wachtwoord of wachtzin\"\n                        type=\"password\"\n                        inputProps={{autoComplete: \"on\"}}\n                        fullWidth\n                    />\n                    <TextField\n                        value={rePassword}\n                        onChange={onRePassword}\n                        margin=\"dense\"\n                        id=\"repassword\"\n                        label=\"Herhaal wachtwoord of wachtzin\"\n                        type=\"password\"\n                        inputProps={{autoComplete: \"on\"}}\n                        fullWidth\n                    />\n                    </form>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={handleCancel} color=\"primary\">\n                        Cancel\n                    </Button>\n                    <Button onClick={handleClose} color=\"primary\" disabled={!saveEnabled}>\n                        Bewaar\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        </div>\n    );\n}\n","import React from 'react'\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogContent from '@material-ui/core/DialogContent';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport { APP } from \"../../config\"\nimport { Grid, Link } from \"@material-ui/core\"\n\ninterface AboutDialogProps {\n    open: boolean\n    onClose: () => void\n}\n\nexport default function AboutDialog(props: AboutDialogProps) {\n    const { open } = props\n\n    const onClose = () => {\n        props.onClose()\n    }\n\n    const onUpdate = () => {\n        window.location.reload()\n    }\n\n    return (\n        <div>\n            <Dialog fullWidth={false}\n                    open={open}\n                    maxWidth={false}\n                    onClose={onClose}\n                    aria-labelledby=\"about-dialog\">\n                <DialogTitle id=\"about-dialog\">{APP.TITLE}</DialogTitle>\n                <DialogContent dividers>\n                        <Grid container direction={\"column\"} justify={\"space-between\"} alignItems={\"center\"} spacing={3}>\n                            <Grid item>\n                                <div className={\"text-center\"}>\n                                Boekhoud Source is een Open Source Boekhoud Applicatie\n                                </div>\n                            </Grid>\n                            <div>Versie: {APP.VERSION} {APP.STATE}</div>\n                            <div>Build: {APP.BUILD}</div>\n                            <Grid item>\n                                <Link href={APP.SOURCE} target=\"_blank\" rel=\"noopener\">\n                                    Github Repository\n                                </Link>\n                            </Grid>\n                            <Grid item>\n                                <Button size={\"small\"} onClick={() => onUpdate()}>Update</Button>\n                            </Grid>\n                        </Grid>\n                </DialogContent>\n                <DialogActions>\n                    <Button onClick={onClose} color=\"primary\">\n                        OK\n                    </Button>\n                </DialogActions>\n            </Dialog>\n        </div>\n    );\n}\n","import { withStyles } from \"@material-ui/core/styles\"\nimport Menu, { MenuProps } from \"@material-ui/core/Menu\"\nimport MenuItem from \"@material-ui/core/MenuItem\"\nimport React from \"react\"\n\nexport const StyledMenu = withStyles({\n    paper: {\n        border: '1px solid #d3d4d5',\n    },\n})((props: MenuProps) => (\n    <Menu\n        elevation={0}\n        getContentAnchorEl={null}\n        anchorOrigin={{\n            vertical: 'bottom',\n            horizontal: 'center',\n        }}\n        transformOrigin={{\n            vertical: 'top',\n            horizontal: 'center',\n        }}\n        {...props}\n    />\n));\n\nexport const StyledMenuItem = withStyles((theme) => ({\n    root: {\n        '&:focus': {\n            backgroundColor: theme.palette.primary.main,\n            '& .MuiListItemIcon-root, & .MuiListItemText-primary': {\n                color: theme.palette.common.white,\n            },\n        },\n    },\n}))(MenuItem);\n\n","import React, { useState } from 'react'\nimport { createStyles, makeStyles } from '@material-ui/core/styles'\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport { Badge, IconButton } from \"@material-ui/core\"\nimport MoreVertIcon from \"@material-ui/icons/MoreVert\"\nimport { resetState, saveStateToFile } from \"../../services/stateIO\"\nimport { Routes } from \"../../routes/routes\"\nimport SaveIcon from \"@material-ui/icons/Save\"\nimport DeleteIcon from \"@material-ui/icons/Delete\"\nimport { useDispatch, useSelector } from \"react-redux\"\nimport { store } from \"../../app/store\"\nimport { useHistory } from \"react-router-dom\"\nimport { InfoOutlined, Print } from \"@material-ui/icons\"\nimport SaveDialog from \"./SaveDialog\"\nimport { setMetaData } from 'app/AccountingSlice';\nimport AboutDialog from \"./AboutDialog\"\nimport Divider from \"@material-ui/core/Divider\"\nimport { StyledMenu, StyledMenuItem } from \"../Utils/StyledMenu\"\nimport { selectAge, resetAge } from \"../../app/AgeSlice\"\n\nconst useStyles = makeStyles((theme) =>\n    createStyles({\n        menuButton: {\n            color: theme.palette.common.white\n        }\n    }),\n);\n\nexport default function MenuDropdown() {\n    const [anchorEl, setAnchorEl] = React.useState<null | HTMLElement>(null);\n    const [saveDialog, setSaveDialog] = useState(false)\n    const [aboutDialog, setAboutDialog] = useState(false)\n\n    const classes = useStyles()\n    const dispatch = useDispatch()\n    const history = useHistory()\n    const age = useSelector(selectAge)\n\n    const handleClick = (event: React.MouseEvent<HTMLElement>) => {\n        setAnchorEl(event.currentTarget)\n    };\n\n    const handleClose = () => {\n        setAnchorEl(null)\n    };\n\n    const onSave = () => {\n        handleClose()\n        setSaveDialog(true)\n    }\n\n    const onCloseSave = (name: string | null, password: string) => {\n        setSaveDialog(false)\n        if (name) {\n            dispatch(setMetaData({ name }))\n            if (saveStateToFile(store.getState(), `${name}.json`, password)) {\n                dispatch(resetAge())\n            }\n        }\n    }\n\n    const onDelete = () => {\n        handleClose()\n        resetState(dispatch)\n        history.push(Routes.Upload.path)\n    }\n\n    const onAbout = () => {\n        handleClose()\n        setAboutDialog(true)\n    }\n\n    const onCloseAbout = () => {\n        setAboutDialog(false)\n    }\n\n    const onPrint = () => {\n        handleClose()\n        // Wait for menu to close and then print\n        setTimeout(() => window.print(), 0)\n    }\n\n    return (\n        <div>\n            {saveDialog && <SaveDialog open={true} onClose={onCloseSave}/>}\n            {aboutDialog && <AboutDialog open={true} onClose={onCloseAbout}/>}\n\n            <IconButton\n                aria-controls=\"shortcuts-menu\"\n                aria-haspopup=\"true\"\n                aria-label={\"open een menu met shortcuts\"}\n                onClick={handleClick}\n                className={classes.menuButton}\n            >\n                <Badge badgeContent={age} color={\"secondary\"}>\n                    <MoreVertIcon />\n                </Badge>\n            </IconButton>\n\n            <StyledMenu\n                id=\"shortcuts-menu\"\n                anchorEl={anchorEl}\n                keepMounted\n                open={Boolean(anchorEl)}\n                onClose={handleClose}\n            >\n                <StyledMenuItem onClick={onSave}>\n                    <ListItemIcon>\n                        <SaveIcon fontSize=\"small\" />\n                    </ListItemIcon>\n                    <ListItemText primary={`Bewaar updates (${age}) en data...`} />\n                </StyledMenuItem>\n\n                <StyledMenuItem onClick={onDelete}>\n                    <ListItemIcon>\n                        <DeleteIcon fontSize=\"small\" />\n                    </ListItemIcon>\n                    <ListItemText primary={`Verwijder updates (${age}) en data`}/>\n                </StyledMenuItem>\n\n                <Divider/>\n\n                <StyledMenuItem onClick={onPrint}>\n                    <ListItemIcon>\n                        <Print fontSize=\"small\" />\n                    </ListItemIcon>\n                    <ListItemText primary=\"Print pagina\" />\n                </StyledMenuItem>\n\n                <Divider/>\n\n                <StyledMenuItem onClick={onAbout}>\n                    <ListItemIcon>\n                        <InfoOutlined fontSize=\"small\" />\n                    </ListItemIcon>\n                    <ListItemText primary={`Over deze app...`} />\n                </StyledMenuItem>\n            </StyledMenu>\n        </div>\n    );\n}\n","import React, { useEffect, useState } from 'react'\n\nimport { createStyles, makeStyles } from '@material-ui/core/styles';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport IconButton from '@material-ui/core/IconButton';\nimport MenuIcon from '@material-ui/icons/Menu';\nimport clsx from 'clsx';\nimport logo from \"./logo-inversed.png\"\n\nimport MenuDropdown from \"./MenuDropdown\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        menuButton: {\n            marginRight: 36,\n        },\n        title: {\n            flexGrow: 1,\n        },\n        hide: {\n            display: 'none',\n        },\n        logo: {\n            marginRight: 10,\n            marginBottom: -1,\n            width: 25,\n            height: 25\n        }\n\n    }),\n);\n\ninterface MenuToolbarProps {\n    title: string\n    open: boolean\n    setOpen: (isOpen: boolean) => void\n}\n\nexport default function MenuToolbar(props: MenuToolbarProps) {\n    const [showMenus, setShowMenus] = useState(false)\n    const classes = useStyles();\n\n    const { title, open } = props\n\n    const setOpen = () => {\n        props.setOpen(true);\n    };\n\n    useEffect(() => {\n        // First show toolbar and then menus (solves app-refresh issue on iOS)\n        setTimeout(() => setShowMenus(true), 0)\n    })\n\n    return (\n        <Toolbar>\n            {showMenus && <IconButton\n                color=\"inherit\"\n                aria-label=\"open of sluit menu\"\n                onClick={setOpen}\n                edge=\"start\"\n                className={clsx(classes.menuButton, {\n                    [classes.hide]: open,\n                })}\n            >\n                <MenuIcon />\n            </IconButton>}\n            <Typography variant=\"h6\" className={classes.title}>\n                <img src={logo} className={classes.logo} alt={\"Applicatie Logo\"}/>\n                {title}\n            </Typography>\n            {showMenus && <MenuDropdown />}\n        </Toolbar>\n    );\n}\n","export default \"data:image/png;base64,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\"","import React from 'react';\nimport { useHistory, useLocation } from \"react-router-dom\"\nimport { useSelector } from \"react-redux\"\n\nimport { createStyles, makeStyles, useTheme, Theme } from '@material-ui/core/styles';\nimport Drawer from '@material-ui/core/Drawer';\nimport Divider from '@material-ui/core/Divider';\nimport IconButton from '@material-ui/core/IconButton';\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport clsx from 'clsx';\n\nimport { drawerWidth, toolbarStyle } from \"./style\"\n\nimport { Routes, RouteItem } from \"../../routes/routes\"\nimport { selectJournal } from \"../../app/AccountingSlice\"\n\nimport RouteIcon from \"../../routes/RouteIcon\"\nimport { ArrowBack, ArrowForward } from \"@material-ui/icons\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        drawer: {\n            width: drawerWidth,\n            flexShrink: 0,\n            whiteSpace: 'nowrap',\n        },\n        drawerOpen: {\n            width: drawerWidth,\n            transition: theme.transitions.create('width', {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.enteringScreen,\n            }),\n        },\n        drawerClose: {\n            transition: theme.transitions.create('width', {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.leavingScreen,\n            }),\n            overflowX: 'hidden',\n            width: theme.spacing(7) + 1,\n            [theme.breakpoints.down('sm')]: {\n                width: 0,\n            },\n        },\n        toolbar: toolbarStyle(theme),\n        activeRoute: {\n            color: theme.palette.secondary.dark,\n        }\n    }),\n);\n\ninterface MenuDrawerProps {\n    open: boolean\n    setOpen: (isOpen: boolean) => void\n}\n\nexport default function MenuDrawer(props: MenuDrawerProps) {\n    const classes = useStyles();\n    const theme = useTheme();\n    const history = useHistory();\n    const location = useLocation()\n    const journal = useSelector(selectJournal)\n\n    const { open } = props\n\n    const setClose = () => {\n        props.setOpen(false);\n    };\n\n    const onRouteItem = (routeItem: RouteItem) => {\n        props.setOpen(false);\n        history.push(routeItem.path)\n    }\n\n    function RouteListItem(props: {routeItem: RouteItem, disabled?: boolean}) {\n        const { routeItem, disabled = false } = props\n        const className= routeItem.path === location.pathname ? classes.activeRoute : \"\"\n        return (\n            <ListItem button key={routeItem.id} disabled={disabled} title={routeItem.text} role={\"button\"}\n                  onClick={() => onRouteItem(routeItem)} aria-label={`navigeer naar ${routeItem.text}`}>\n                <ListItemIcon className={className}><RouteIcon id={routeItem.id}/></ListItemIcon>\n                <ListItemText className={className} primary={routeItem.text} />\n            </ListItem>\n        )\n    }\n\n    function GoBackForward(props: {back: boolean}) {\n        const { back } = props\n        return (\n            <ListItem button title={`ga naar ${back ? \"vorige\" : \"volgende\"} pagina`} role={\"button\"}\n                      onClick={() => back ? history.goBack() : history.goForward()}>\n                <ListItemIcon>\n                    {back && <ArrowBack/>}\n                    {!back && <ArrowForward/>}\n                </ListItemIcon>\n                <ListItemText primary={back ? \"Vorige\" : \"Volgende\" } />\n            </ListItem>\n        )\n\n    }\n\n    const hasData = journal.hasData()\n\n    const routeItems: (RouteItem | string)[] = [\n        Routes.Home,\n        Routes.Upload,\n        \"divider\",\n        Routes.Map,\n        Routes.TrialBalance,\n        Routes.Journal,\n        Routes.Memorial,\n        Routes.VAT,\n        \"divider\",\n        Routes.Charts,\n        Routes.Bank,\n        \"divider\",\n        Routes.Ledger,\n    ]\n\n    const protectedItemIds = [\n        Routes.Bank,\n        Routes.Map,\n        Routes.TrialBalance,\n        Routes.Journal,\n        Routes.VAT,\n        Routes.Memorial,\n        Routes.Charts\n    ].map(routeItem => routeItem.id)\n\n    return (\n        <Drawer\n            role={\"navigation\"}\n            variant=\"permanent\"\n            className={clsx(classes.drawer, {\n                [classes.drawerOpen]: open,\n                [classes.drawerClose]: !open,\n            })}\n            classes={{\n                paper: clsx({\n                    [classes.drawerOpen]: open,\n                    [classes.drawerClose]: !open,\n                }),\n            }}\n        >\n            <div className={classes.toolbar}>\n                <IconButton onClick={setClose} aria-label={\"vergroot of verklein het menu\"}>\n                    {theme.direction === 'rtl' ? <ChevronRightIcon /> : <ChevronLeftIcon />}\n                </IconButton>\n            </div>\n            <Divider />\n            <div aria-label=\"hoofd menu\">\n                <GoBackForward back={true}/>\n                <GoBackForward back={false}/>\n                <Divider/>\n                {routeItems.map((item, i) => {\n                    if (typeof (item) === \"string\" && item === \"divider\") {\n                        return <Divider key={i}/>\n                    } else {\n                        const routeItem = item as RouteItem\n                        const enabled = protectedItemIds.includes(routeItem.id) ? hasData : true\n                        return <RouteListItem key={i} routeItem={routeItem} disabled={! enabled} />\n                    }\n                })}\n            </div>\n        </Drawer>\n    );\n}\n","import React from 'react';\n\nimport { createStyles, makeStyles, Theme } from '@material-ui/core/styles';\nimport AppBar from '@material-ui/core/AppBar';\nimport CssBaseline from '@material-ui/core/CssBaseline';\nimport clsx from 'clsx';\n\nimport { drawerWidth, toolbarStyle } from \"./style\"\n\nimport MenuToolbar from \"./MenuToolbar\"\nimport MenuDrawer from \"./MenuDrawer\"\nimport { APP } from \"../../config\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        root: {\n            display: 'flex',\n        },\n        appBar: {\n            zIndex: theme.zIndex.drawer + 1,\n            transition: theme.transitions.create(['width', 'margin'], {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.leavingScreen,\n            }),\n        },\n        appBarShift: {\n            marginLeft: drawerWidth,\n            width: `calc(100% - ${drawerWidth}px)`,\n            transition: theme.transitions.create(['width', 'margin'], {\n                easing: theme.transitions.easing.sharp,\n                duration: theme.transitions.duration.enteringScreen,\n            }),\n        },\n        toolbar: toolbarStyle(theme),\n        content: {\n            flexGrow: 1,\n            padding: theme.spacing(3),\n            [theme.breakpoints.down('xs')]: {\n                padding: theme.spacing(1),\n            },\n        },\n    }),\n);\n\ninterface MenuAppBarProps {\n    title: string,\n    children: React.ReactNode,\n}\n\nexport default function MenuAppBar(props: MenuAppBarProps) {\n    const classes = useStyles();\n    const [open, setOpen] = React.useState(false);\n\n    return (\n        <div className={classes.root}>\n            <CssBaseline />\n            <div className={\"noprint\"}>\n                <AppBar\n                    position=\"fixed\"\n                    className={clsx(classes.appBar, {\n                        [classes.appBarShift]: open,\n                    })}\n                >\n                    {/*Toolbar at the top of the screen*/}\n                    <MenuToolbar title={APP.TITLE} open={open} setOpen={setOpen}/>\n                </AppBar>\n                {/*Menu at the left of the screen*/}\n                <MenuDrawer open={open} setOpen={setOpen}/>\n            </div>\n            <main className={classes.content}>\n                <div className={classes.toolbar} />\n                {props.children}\n            </main>\n        </div>\n    );\n}\n","export function getWidth() { return 325 }\nexport function getHeight() { return 300 }\n\nexport function getWidthHeight() {\n    return [getWidth(), getHeight()]\n}\n\nexport const ChartColor = {\n    // https://colorbrewer2.org/?type=qualitative&scheme=Paired&n=8\n    qualitativeColors: ['#a6cee3','#1f78b4','#b2df8a','#33a02c','#fb9a99','#e31a1c','#fdbf6f','#ff7f00'],\n    warmGreen: \"#319432\",\n    warmRed: \"#F9423A\"\n}\n","import { BankAccount } from \"../../types/LiquidAssets/BankAccount\"\nimport { StatementEntry } from \"../../types/LiquidAssets/StatementEntry\"\nimport { Amount } from \"../../types/Amount\"\nimport { LedgerAccount } from \"../../types/Ledger/LedgerAccount\"\nimport { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\nimport { LiquidAssets } from \"../../types/LiquidAssets/LiquidAssets\"\nimport { DateString } from \"../../types/DateString\"\nimport { ExpenseRevenueChartData } from \"./ExpenseRevenueChart\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\nimport { ChartColor } from \"./config\"\n\nconst amountFormat = (value: number) => Amount.formatValue(value, {\n    maximumFractionDigits: 0,\n    minimumFractionDigits: 0\n})\n\nconst dateFormat = (value: DateString) => value.format({month: 'short', year: '2-digit'})\n\nexport function getQualitativeColor(i: number) {\n    return ChartColor.qualitativeColors[i % ChartColor.qualitativeColors.length]\n}\n\nexport function getPieChartOptions(title: string) {\n    return {\n        title: {\n            display: true,\n            text: title\n        }\n    }\n}\n\nexport function getLineChartOptions(title: string) {\n    return {\n        title: {\n            display: true,\n            text: title\n        },\n        tooltips: {\n            displayColors: false,\n            callbacks: {\n                title: function(tooltipItem: any, data: any) {\n                    const index = tooltipItem[0].index\n                    return data.labels[index].format()\n                },\n                label: function(tooltipItem: any) {\n                    return amountFormat(tooltipItem.yLabel);\n                }\n            }\n        },\n        legend: {\n            display: false,\n        },\n        scales: {\n            xAxes: [{\n                ticks: {\n                    callback: dateFormat\n                }\n            }],\n            yAxes: [{\n                ticks: {\n                    callback: amountFormat\n                }\n            }],\n        }\n    }\n}\n\nexport function getBarChartOptions(title: string) {\n    return {\n        tooltips: {\n            displayColors: false,\n            callbacks: {\n                label: function(tooltipItem: any, data: any) {\n                    let label = data.datasets[tooltipItem.datasetIndex].label || '';\n\n                    if (label) {\n                        label += ' ';\n                    }\n                    label += amountFormat(tooltipItem.yLabel)\n                    return label;\n                }\n            }\n        },\n        title: {\n            display: true,\n            text: title\n        },\n        legend: {\n            fullWidth: false,\n            labels: {\n                fontSize: 10,\n                boxWidth: 10\n            }\n        },\n        scales: {\n            xAxes: [{\n            }],\n            yAxes: [{\n                ticks: {\n                    callback: amountFormat\n                }\n            }],\n        }\n    }\n}\n\nexport function getBankAccountData(bankAccount: BankAccount) {\n    const statementEntries = bankAccount.statementEntryMap.statementEntries\n\n    const getKey = (entry: StatementEntry) =>\n        entry.accountStatement.closingBalance.date.string\n\n    const getData = (entry: StatementEntry) => ({\n        label: entry.accountStatement.closingBalance.date,\n        value: entry.accountStatement.closingBalance.amount.value\n    })\n\n    const chartData = statementEntries.reduce((result, statementEntry) => {\n        const key = getKey(statementEntry)\n        if (!result[key]) {\n            result[key] = getData(statementEntry)\n        }\n        return result\n    }, {} as Record<string, ReturnType<typeof getData>>)\n\n    const keys = Object.keys(chartData).sort()\n\n    return keys.map(key => chartData[key])\n}\n\nexport function getProfitLossData(summaryMap: AccountSummaryMap, accounts: LedgerAccount[]) {\n\n    const getKey = (account: LedgerAccount) =>\n        account.code\n\n    const getData = (account: LedgerAccount) => ({\n        label: account.shortDescription,\n        value: summaryMap.getAccountSummary(account).balance\n    })\n\n    const chartData = accounts.reduce((result, account) => {\n        if (account.isBankAccount()) {\n            return result\n        }\n        const key = getKey(account)\n        const data = getData(account)\n        if (!result[key]) {\n            result[key] = getData(account)\n        } else {\n            result[key].value = result[key].value.add(data.value)\n        }\n        return result\n    }, {} as Record<string, ReturnType<typeof getData>>)\n\n    return Object.values(chartData)\n        .filter(v => ! v.value.isZero())\n        .sort((v1, v2) => Math.abs(v2.value.value) - Math.abs(v1.value.value))\n}\n\nexport function getAllocationsData(allocations: LedgerAllocationMap) {\n    const [mapped, unmapped] = allocations.getMappedUnmapped()\n\n    const mappedAllocations = (mapped / (mapped + unmapped)) * 100\n    const unmappedAllocations = 100 - mappedAllocations\n    const perc = (value: number) => `${Math.round(value,)}%`\n\n    const { warmGreen, warmRed } = ChartColor\n    const colors = [warmGreen, warmRed]\n\n    return {\n        labels: [\n            `Toegewezen ${perc(mappedAllocations)}`,\n            `Nog toe te wijzen ${perc(unmappedAllocations)}`\n        ],\n        datasets: [{\n            data: [\n                mapped,\n                unmapped\n            ],\n            backgroundColor: colors,\n            hoverBackgroundColor: colors\n        }]\n    };\n}\n\nexport function getCounterPartiesData(liquidAssets: LiquidAssets) {\n\n    const statementEntries = liquidAssets.getStatementEntryMap().statementEntries\n\n    const getKey = (entry: StatementEntry) =>\n        entry.relatedParties.toLowerCase().trim()\n\n    const getData = (entry: StatementEntry) => ({\n        label: entry.relatedParties,\n        value: entry.amount\n    })\n\n    const chartData = statementEntries.reduce((result, statementEntry) => {\n        const key = getKey(statementEntry)\n        const data = getData(statementEntry)\n        if (!result[key]) {\n            result[key] = data\n        } else {\n            result[key].value = result[key].value.add(data.value)\n        }\n        return result\n    }, {} as Record<string, ReturnType<typeof getData>>)\n\n    return Object.values(chartData)\n        .filter(v => v.label && ! v.value.isZero())\n        .sort((v1, v2) => Math.abs(v2.value.value) - Math.abs(v1.value.value))\n}\n\nexport function splitData(data: ExpenseRevenueChartData) {\n    return data.reduce((result, data) => {\n        if (data.value.isZero()) return result\n        if (data.value.value > 0) {\n            result[1].push(data)\n        } else {\n            result[0].push(data)\n        }\n        return result\n    }, [[], []] as [ExpenseRevenueChartData, ExpenseRevenueChartData])\n}\n\n\n","import React, { useEffect, useState } from 'react'\nimport { Line } from \"react-chartjs-2\"\nimport { getLineChartOptions } from \"./index\"\nimport { BankAccount } from \"../../types/LiquidAssets/BankAccount\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport Worker from \"../Workers\"\nimport { Environment } from \"../../types/Environment\"\nimport { DateString } from \"../../types/DateString\"\nimport { getWidthHeight } from \"./config\"\n\ninterface BankAccountChartProps {\n    bankAccount: BankAccount\n}\n\nexport type BankAccountChartData = {label: DateString, value: number}[]\n\nfunction BankAccountChart(props: BankAccountChartProps) {\n    const [chartData, setChartData] = useState({})\n    const [loading, setLoading] = useState(true)\n    const theme = useTheme()\n\n    const { bankAccount } = props\n\n    useEffect(() => {\n        const update = async () => {\n            const instance = new Worker();\n            const chartData = await instance.getBankAccountChartData(\n                new Environment().data,\n                bankAccount\n            ) as BankAccountChartData\n\n            setChartData({\n                labels: chartData.map(data => new DateString(data.label.data)),\n                datasets: [\n                    {\n                        label: \"\",\n                        fill: false,\n                        lineTension: 0.2,\n                        borderColor: theme.palette.primary.main,\n                        pointBackgroundColor: theme.palette.primary.dark,\n                        pointRadius: 1,\n                        pointHitRadius: 10,\n                        data: chartData.map(data => data.value)\n                    }\n                ]\n            })\n            setLoading(false)\n        }\n\n        setLoading(true)\n        update().catch(e => console.error(\"Failed to load bankaccount chart data\", e))\n    }, [bankAccount, theme])\n\n    const title = bankAccount.IBAN.format()\n    const options = getLineChartOptions(title)\n\n    const [width, height] = getWidthHeight()\n\n    return (\n        <div style={{width: width, height: height}}>\n            {loading && <div>Loading {title}...</div>}\n            {!loading && <Line data={chartData}\n                  options={options}\n                  width={width}\n                  height={height} />}\n        </div>\n    )\n}\n\nexport default BankAccountChart;\n","import React from 'react'\n\nimport { Grid } from \"@material-ui/core\"\n\nimport { LiquidAssets } from \"../../types/LiquidAssets/LiquidAssets\"\nimport BankAccountChart from \"./BankAccountChart\"\n\ninterface Props {\n    liquidAssets: LiquidAssets\n}\n\nexport default function LiquidAssetsCharts(props: Props) {\n    const { liquidAssets } = props\n    const { bankAccounts } = liquidAssets\n\n    return (\n        <Grid container justify={\"space-around\"}>\n            {bankAccounts.map(bankAccount => {\n                return (\n                    <Grid item key={bankAccount.id}>\n                        <BankAccountChart bankAccount={bankAccount} />\n                    </Grid>\n                )\n            })}\n        </Grid>\n    )\n}","import React, { useEffect, useState } from 'react'\n\nimport { Grid, makeStyles, Slider } from \"@material-ui/core\"\nimport { createStyles } from \"@material-ui/core/styles\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport { ArrowLeft, ArrowRight } from \"@material-ui/icons\"\n\nimport { Bar } from \"react-chartjs-2\"\n\nimport { getBarChartOptions, getQualitativeColor } from \"./index\"\nimport { getWidthHeight } from \"./config\"\n\nimport { Amount } from \"../../types/Amount\"\nimport { useURLState } from \"../useURLState\"\n\nconst useStyles = makeStyles((/*theme: Theme*/) =>\n    createStyles({\n        sliderRoot: {\n            marginTop: -10\n        },\n        rightLefButton: {\n            marginBottom: 5,\n        },\n    }))\n\nexport type ExpenseRevenueChartData = {\n    label: string,\n    value: Amount\n}[]\n\ninterface ExpenseRevenueChartProps {\n    title: string,\n    data: ExpenseRevenueChartData\n}\n\nconst ITEMS_TO_SHOW = 5\n\nfunction ExpenseRevenueChart(props: ExpenseRevenueChartProps) {\n    const [urlState, setURLState] = useURLState()\n    const [data, setData] = useState({})\n\n    const classes = useStyles()\n    const {title} = props\n\n    const [width, height] = getWidthHeight()\n\n    const id = `${title.toLowerCase()}Chart`\n    const range = urlState.getNumericValue(id)\n\n    useEffect(() => {\n        setData({\n            labels: [\"\"],\n            datasets: props.data.slice(range, range + ITEMS_TO_SHOW)\n                .map((data, i) => ({\n                    label: data.label,\n                    maxBarThickness: 50,\n                    backgroundColor: getQualitativeColor(range + i),\n                    data: [Math.abs(data.value.value)]\n                }))\n        })\n    }, [props.data, range])\n\n    const onChange = (event: React.ChangeEvent<{}>, value: (number | number[])) => {\n        if (typeof value === \"number\" && value !== range) {\n            setURLState({[id]: value})\n        }\n    }\n\n    const onRangeUpDown = (n: number) => {\n        setURLState({[id]: range + n})\n    }\n\n    const maxRange = props.data.length\n    const showSlider = maxRange > ITEMS_TO_SHOW\n\n    return (\n        <div>\n            <Bar data={data}\n                 options={getBarChartOptions(title)}\n                 width={width}\n                 height={height} />\n            {showSlider && (\n                <Grid container\n                      spacing={0}\n                      justify={\"space-around\"}\n                      alignItems={\"center\"}\n                      className={classes.sliderRoot}>\n                    <Grid item xs={2}>\n                        <IconButton disabled={range === 0}\n                                    onClick={() => onRangeUpDown(-1)}\n                                    className={classes.rightLefButton}>\n                            <ArrowLeft />\n                        </IconButton>\n                    </Grid>\n                    <Grid item xs={8}>\n                        <Slider value={range}\n                                onChange={onChange}\n                                valueLabelDisplay=\"off\"\n                                min={0}\n                                max={maxRange - 1}\n                                track={false}\n                                step={1}/>\n                    </Grid>\n                    <Grid item xs={2}>\n                        <IconButton disabled={range === maxRange - 1}\n                                    onClick={() => onRangeUpDown(1)}\n                                    className={classes.rightLefButton}>\n                            <ArrowRight fontSize=\"inherit\" />\n                        </IconButton>\n                    </Grid>\n                </Grid>\n            )}\n\n\n        </div>\n    )\n}\n\nexport default ExpenseRevenueChart","import React from 'react'\n\nimport { Grid } from \"@material-ui/core\"\n\nimport { LiquidAssets } from \"../../types/LiquidAssets/LiquidAssets\"\n\nimport { getCounterPartiesData, splitData } from \"./index\"\nimport ExpenseRevenueChart, { ExpenseRevenueChartData } from \"./ExpenseRevenueChart\"\n\ninterface Props {\n    liquidAssets: LiquidAssets\n}\n\nfunction CounterpartiesCharts(props: Props) {\n    const {liquidAssets} = props\n\n    const counterPartiesData: ExpenseRevenueChartData = getCounterPartiesData(liquidAssets)\n\n    const [expenseData, revenueData] = splitData(counterPartiesData)\n\n    return (\n        <Grid container justify={\"space-around\"}>\n            <Grid item>\n                <ExpenseRevenueChart title={\"Crediteuren\"} data={expenseData} />\n            </Grid>\n            <Grid item>\n                <ExpenseRevenueChart title={\"Debiteuren\"} data={revenueData} />\n            </Grid>\n        </Grid>\n    )\n}\n\nexport default CounterpartiesCharts;\n","import React from 'react'\n\nimport { Grid } from \"@material-ui/core\"\n\nimport { Journal } from \"../../types/Journal/Journal\"\nimport { AccountSummaryMap } from \"../../types/AccountSummaryMap\"\n\nimport { getProfitLossData, splitData } from \"./index\"\nimport ExpenseRevenueChart, { ExpenseRevenueChartData } from \"./ExpenseRevenueChart\"\n\ninterface Props {\n    journal: Journal\n}\n\nfunction ProfitLossCharts(props: Props) {\n    const { journal } = props\n\n    const journalEntries = journal.journalEntries\n    const summary = new AccountSummaryMap(journalEntries)\n    const accounts = summary.getAccounts()\n\n    const counterPartiesData: ExpenseRevenueChartData = getProfitLossData(summary, accounts)\n\n    const [revenueData, expenseData] = splitData(counterPartiesData)\n\n    return (\n        <Grid container justify={\"space-around\"}>\n            <Grid item>\n                <ExpenseRevenueChart title={\"Uitgaven\"} data={expenseData} />\n            </Grid>\n            <Grid item>\n                <ExpenseRevenueChart title={\"Ontvangsten\"} data={revenueData} />\n            </Grid>\n        </Grid>\n    )\n}\n\nexport default ProfitLossCharts","import React from 'react'\nimport { Doughnut } from \"react-chartjs-2\"\nimport { LedgerAllocationMap } from \"../../types/Allocation/LedgerAllocationMap\"\nimport { getAllocationsData, getPieChartOptions } from \"./index\"\nimport { getWidthHeight } from \"./config\"\nimport { createStyles, makeStyles } from \"@material-ui/core/styles\"\n\nlet [width, height] = getWidthHeight()\nwidth *= 2\nheight /= 2\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        root: {\n            width: width,\n            height: height,\n            margin: \"auto\"\n        }\n    }),\n);\n\ninterface AllocationsChartProps {\n    allocations: LedgerAllocationMap\n}\n\nfunction AllocationsChart(props: AllocationsChartProps) {\n    const { allocations } = props\n\n    const classes = useStyles()\n\n    const data = getAllocationsData(allocations)\n    const options = getPieChartOptions(\"Toewijzing transacties\")\n\n    return (\n        <div className={classes.root}>\n            <Doughnut data={data}\n                      options={options}\n                      width={width}\n                      height={height}/>\n        </div>\n    )\n}\n\nexport default AllocationsChart","import React from 'react'\nimport { useSelector } from \"react-redux\"\n\nimport { selectPeriodFilter } from \"../app/FilterSlice\"\nimport { selectJournal, selectLedgerAllocations, selectLiquidAssets } from \"../app/AccountingSlice\"\n\nimport { Routes } from \"../routes/routes\"\n\nimport PageHeader from \"./PageHeader\"\nimport LiquidAssetsCharts from \"../components/Charts/LiquidAssetsCharts\"\nimport CounterpartiesCharts from \"../components/Charts/CounterpartiesCharts\"\nimport ProfitLossCharts from \"../components/Charts/ProfitLossCharts\"\nimport AllocationsChart from \"../components/Charts/AllocationsChart\"\n\nfunction ChartsPage() {\n    const liquidAssets = useSelector(selectLiquidAssets)\n    const ledgerAllocations = useSelector(selectLedgerAllocations)\n    const journal = useSelector(selectJournal)\n    const periodFilter = useSelector(selectPeriodFilter)\n\n    const filteredAssets = liquidAssets.filterOnPeriod(periodFilter)\n    const filteredJournal = journal.filterOnPeriod(periodFilter)\n    const allocations = ledgerAllocations.filterOnPeriod(periodFilter)\n\n    return (\n        <div>\n            <PageHeader title={Routes.Charts}/>\n            <LiquidAssetsCharts liquidAssets={filteredAssets}/>\n            <CounterpartiesCharts liquidAssets={filteredAssets}/>\n            <AllocationsChart allocations={allocations}/>\n            <ProfitLossCharts journal={filteredJournal}/>\n        </div>\n    )\n}\n\nexport default ChartsPage","import { LedgerAccount } from \"../Ledger/LedgerAccount\"\nimport { JournalEntry } from \"./JournalEntry\"\nimport { LedgerScheme } from \"../Ledger/LedgerScheme\"\nimport { Amount, CreditDebit } from \"../Amount\"\nimport { EntryLeg } from \"./EntryLeg\"\nimport { Period } from \"../Period\"\nimport { DateString } from \"../DateString\"\nimport { Accounting } from \"../Accounting\"\nimport { EntryLegData, JournalEntryData } from \"../../model\"\n\nexport const EditorTemplates = {\n    'Lonen': {\n        accounts: [\n            \"BSchSalNet\",\n            \"BSchSalOna\",\n            \"BSchBepLhe\",\n            \"BSchSalPsv\",\n            \"BSchOvsStp\",\n            \"BSchOvsStp\",\n            \"BSchSalTvg\",\n            \"WPerLesLon\",\n            \"WPerSolPsv\",\n            \"WPerLesVag\",\n            \"WPerPenPen\",\n            \"WBedWkrWkg\",\n            \"WBedAdlBet\",\n        ],\n        rules: [\n            \"WPerLesLon = BSchSalNet + BSchBepLhe + BSchOvsStp\",\n            \"WPerSolPsv = BSchSalPsv\",\n            \"WPerLesVag = BSchSalTvg\",\n            \"WPerPenPen = BSchOvsStp\",\n            \"WBedWkrWkg = BSchSalOna\",\n        ]\n    },\n    'Lonen kort': {\n        accounts: [\n            \"BSchSalNet\",\n            \"BSchBepLhe\",\n            \"WPerLesLon\",\n            \"WBedAdlBet\",\n        ],\n        rules: [\n            \"WPerLesLon = BSchSalNet + BSchBepLhe\",\n        ]\n    }\n}\n\nclass LegEditor {\n    static readonly MANUAL_LEG = -1     // Manually added leg, not bound to a journalEntry leg\n\n    id: number\n    account: LedgerAccount\n    debit: string\n    debitValue: number\n    credit: string\n    creditValue: number\n    \n    constructor(private journalEditor: JournalEditor) {\n        this.id = LegEditor.MANUAL_LEG\n        this.account = LedgerScheme.unmapped\n        this.debit = \"0\"\n        this.debitValue = 0\n        this.credit = \"0\"\n        this.creditValue = 0\n    }\n\n    /**\n     * Construct a legEditor from an entryLeg\n     */\n    static fromEntryLeg(leg: EntryLeg, id: number, journalEditor: JournalEditor) {\n        const legEditor = new LegEditor(journalEditor)\n        const amount = leg.amount\n        const debitValue = amount.isDebit ? -amount.value : 0\n        const creditValue = amount.isCredit ? amount.value : 0\n        legEditor.id = id\n        legEditor.account = leg.ledgerAccount\n        legEditor.debit = debitValue ? debitValue.toFixed(2)  : \"\"\n        legEditor.debitValue = debitValue\n        legEditor.credit = creditValue ? creditValue.toFixed(2) : \"\"\n        legEditor.creditValue = creditValue\n        return legEditor\n    }\n\n    get amount() {\n        return Amount.fromAmountCurrency(this.creditValue - this.debitValue, Accounting.currency)\n    }\n\n    /**\n     * Convert this leg to entryLegData\n     */\n    get entryLegData(): EntryLegData {\n        return {\n            ledgerAccountCode: this.account.code,\n            amountData: this.amount.data\n        }\n    }\n\n    /**\n     * Update the account for this leg\n     * @param account\n     */\n    updateAccount(account: LedgerAccount) {\n        this.account = account\n    }\n\n    /**\n     * Update the leg amount\n     * Allow for data that is no number (eg 1.) but convert to a number whenever possible\n     */\n    updateAmount(creditDebit: CreditDebit, value: string) {\n        const stringValue = value || \"\"\n        if (creditDebit === CreditDebit.Debit) {\n            this.debit = stringValue\n            this.credit = \"\"\n            this.creditValue = 0\n        } else {\n            this.debit = \"\"\n            this.debitValue = 0\n            this.credit = stringValue\n        }\n        if (!isNaN(+value)) {\n            const numericValue = +value\n            if (creditDebit === CreditDebit.Debit) {\n                this.debitValue = numericValue\n            } else {\n                this.creditValue = numericValue\n            }\n        }\n    }\n\n    /**\n     * Finalize the amounts\n     * If a debit amount has been registered then clear the credit amount (and vice versa)\n     */\n    finalizeAmount() {\n        if (this.creditValue) {\n            this.credit = this.creditValue.toFixed(2)\n            this.debitValue = 0\n            this.debit = \"\"\n        } else if (this.debitValue) {\n            this.debit = this.debitValue.toFixed(2)\n            this.creditValue = 0\n            this.credit = \"\"\n        } else {\n            this.debit = \"\"\n            this.debitValue = 0\n            this.credit = \"\"\n            this.creditValue = 0\n        }\n        this.journalEditor.onLegAmount(this)\n    }\n}\n\nexport class JournalEditor {\n    private _reason: string\n    private _date: Date\n    private _period: Period\n    private _legs: LegEditor[]\n    private rules: string[] = []\n\n    constructor() {\n        this._reason = \"\"\n        this._date = new Date()\n        this._period = Period.fromDate(DateString.fromDate(this._date))\n        this._legs = []\n        // Minimally one leg is required\n        this.addLeg()\n    }\n\n    /**\n     * Creates a new editor for the given journalEntry\n     */\n    static fromJournalEntry(journalEntry: JournalEntry): JournalEditor {\n        const journalEditor = new JournalEditor()\n        journalEditor._reason = journalEntry.reason\n        journalEditor._date = journalEntry.date.Date\n        journalEditor._period = new Period(journalEntry.period.data)\n        journalEditor._legs = journalEntry.legs.map((leg, i) =>\n            LegEditor.fromEntryLeg(leg, i, journalEditor))\n        return journalEditor\n    }\n\n    static fromTemplate(id: string): JournalEditor {\n        const template = EditorTemplates[id as keyof typeof EditorTemplates]\n        const editor = new JournalEditor()\n        if (template) {\n            editor.rules = template.rules\n            editor._legs = template.accounts.map(account => {\n                const legEditor = new LegEditor(editor)\n                legEditor.account = LedgerScheme.getAccount(account)\n                legEditor.updateAmount(legEditor.account.CreditDebit ?? CreditDebit.Debit, \"0\")\n                return legEditor\n            })\n        }\n        return editor\n    }\n\n    /**\n     * Returns a shallow clone of the current editor\n     */\n    clone() {\n        const journalEditor = new JournalEditor()\n        journalEditor._reason = this._reason\n        journalEditor._date = this._date\n        journalEditor._period = this._period\n        journalEditor._legs = this._legs\n        return journalEditor\n    }\n\n    /**\n     * Apply any rules that are affected by the change in the leg amount value\n     */\n    onLegAmount(legEditor: LegEditor) {\n        this.rules\n            .map(rule => rule.split(\"=\"))\n            .filter(([, rhs]) => rhs.includes(legEditor.account.code))  // Evaluate RHS's that have changed\n            .forEach(([lhs, rhs]) => {\n                this.legs.forEach(leg => {\n                    // Substitute account by its value\n                    rhs = rhs.replace(leg.account.code, leg.amount.value.toString())\n                })\n                this.legs.filter(leg => leg.account.CreditDebit && leg.account.code === lhs.trim())\n                    // Select legs that match the LHS of the rule\n                    .forEach(leg => {\n                        try {\n                            // eslint-disable-next-line no-new-func\n                            const evalRhs = new Function(`return (${rhs})`)()\n                            leg.updateAmount(leg.account.CreditDebit!, evalRhs)\n                            leg.finalizeAmount()\n                        } catch {}\n                    })\n            })\n    }\n\n    get reason() { return this._reason }\n    set reason(reason: string) { this._reason = reason }\n\n    get date() { return this._date }\n    set date(date: Date) {\n        this._date = date\n        this._period = Period.fromDate(DateString.fromDate(date))\n    }\n\n    get legs() { return this._legs }\n    get nonZeroLegs() { return this._legs.filter(leg => !leg.amount.isZero())}\n    addLeg() {\n        const leg = new LegEditor(this)\n        const { debit, credit } = this.totals()\n        const amount = Amount.fromAmountCurrency(credit - debit).reversed()  // To get to debit === credit\n        leg.updateAmount(amount.creditDebit, amount.isZero() ? \"\" : Math.abs(amount.value).toString())\n        leg.finalizeAmount()\n        this._legs.push(leg)\n    }\n\n    /**\n     * Remove leg by its index\n     */\n    removeLeg(i: number) {\n        this._legs.splice(i, 1)\n    }\n\n    /**\n     * Returns the total debit anc credit amounts for the legs\n     */\n    totals() {\n        return this.nonZeroLegs.reduce((sum, leg) => {\n            let { debit, credit } = sum\n            debit += leg.debitValue\n            credit += leg.creditValue\n            return { debit, credit }\n        }, { debit: 0, credit: 0 })\n    }\n\n    /**\n     * Tells if the current data is valid\n     * Only valid data can be applied and stored in the journal\n     */\n    isValid() {\n        const { debit, credit } = this.totals()\n        return debit !== 0 &&\n            credit !== 0 &&\n            debit === credit &&\n            this.reason &&\n            ! this.legs.find(leg => leg.account === LedgerScheme.unmapped)\n    }\n\n    /**\n     * Tells is the current data can be deleted from the journal\n     * Only data that consists of legs that are freely allocatable can be deleted\n     * If any of the legs is bound to a bankaccount the data cannot be deleted\n     */\n    canBeDeleted() {\n        return this.legs.every(leg => leg.account.isEditable)\n    }\n\n    /**\n     * Apply the current data to the given journalEntry (or construct a new one if missing)\n     * The applied data will be returned\n     */\n    apply(journalEntry?: JournalEntry): JournalEntryData {\n        let data: JournalEntryData\n        if (journalEntry) {\n            data = { ...journalEntry.data }\n            data.date = DateString.fromDate(this.date).data\n            data.period = this._period.data\n            data.reason = this.reason\n            data.entryLegsData = []\n\n            // Update or delete existing legs\n            journalEntry.data.entryLegsData.forEach((leg, i) => {\n                const legEditor = this.legs.find(l => l.id === i)\n                if (legEditor) {\n                    data.entryLegsData.push({\n                        ...leg,\n                        ...legEditor.entryLegData\n                    })\n                } else {\n                    // leg has been deleted\n                }\n            })\n            // Add new legs\n        } else {\n            data = {\n                id: `memorial.${new Date().toISOString()}`,\n                date: DateString.fromDate(this.date).data,\n                period: this._period.data,\n                reason: this.reason,\n                entryLegsData: []\n            }\n        }\n\n        // Only add non-Zero legs\n        this.nonZeroLegs.filter(leg => leg.id === LegEditor.MANUAL_LEG)\n            .forEach(leg => {\n                data.entryLegsData.push(leg.entryLegData)\n            })\n        return data\n    }\n\n}","import React, { useEffect } from 'react'\nimport { useDispatch } from \"react-redux\"\nimport { useHistory, useLocation } from \"react-router-dom\"\nimport { deleteJournalEntry, updateJournalEntry } from \"../app/AccountingSlice\"\n\nimport { createStyles, makeStyles } from \"@material-ui/core/styles\"\nimport { Grid, Paper, TextField } from \"@material-ui/core\"\nimport Button from \"@material-ui/core/Button\"\nimport IconButton from \"@material-ui/core/IconButton\"\nimport DeleteIcon from \"@material-ui/icons/Delete\"\nimport AddIcon from \"@material-ui/icons/Add\"\n\nimport { Routes } from \"../routes/routes\"\nimport PageHeader from \"./PageHeader\"\nimport DateSelector from \"../components/Selectors/DateSelector\"\nimport FormatAmount from \"../components/Utils/FormatAmount\"\nimport RGSAccountSelector from \"../components/Editors/RGSAccountSelector\"\nimport AmountEditor from \"../components/Editors/AmountEditor\"\nimport ItemSelect from \"../components/Selectors/ItemSelect\"\nimport { Table, Thead, Tr, Th, Tbody, Td } from \"../components/ResponsiveTable\"\n\nimport { LedgerAccount } from \"../types/Ledger/LedgerAccount\"\nimport { LedgerScheme } from \"../types/Ledger/LedgerScheme\"\nimport { Accounting } from \"../types/Accounting\"\nimport { Amount, CreditDebit } from \"../types/Amount\"\nimport { EditorTemplates, JournalEditor } from \"../types/Journal/JournalEditor\"\nimport { JournalEntry } from \"../types/Journal/JournalEntry\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        paper: {\n            padding: 15,\n            width: 600,\n            margin: \"auto\"\n        },\n        headerGrid: {\n            marginBottom: 10\n        },\n        footerGrid: {\n            marginTop: 15\n        },\n        description: {\n            width: 350\n        },\n        amount: {\n            textAlign: \"right\"\n        },\n        totals: {\n            fontWeight: \"bold\"\n        },\n        templateSelector: {\n            marginBottom: 25\n        }\n    }),\n);\n\n\nfunction MemorialPage() {\n    const [journalEntry, setJournalEntry] = React.useState<JournalEntry | undefined>(undefined)\n    const [data, setData] = React.useState<JournalEditor>(new JournalEditor())\n    const [template, setTemplate] = React.useState(\"\")\n\n    const classes = useStyles()\n    const dispatch = useDispatch()\n    const history = useHistory()\n    const search = useLocation().search\n\n    useEffect(() => {\n        const id = new URLSearchParams(search).get('id')\n        if (id) {\n            const accounting = new Accounting()\n            if (accounting.journal.hasJournalEntry(id)) {\n                const journalEntry = accounting.journal.getJournalEntry(id)\n                setJournalEntry(journalEntry)\n                setData(JournalEditor.fromJournalEntry(journalEntry))\n            }\n        }\n    }, [search])\n\n    const currency = Accounting.currency\n\n    const { debit, credit } = data.totals()\n\n    const updateData = () => setData(data.clone())\n\n    const onAddLine = () => {\n        data.addLeg()\n        updateData()\n    }\n\n    const onDescription = (event: any) => {\n        data.reason = event.target.value\n        updateData()\n    }\n\n    const onDate = (date: Date | null) => {\n        data.date = date || new Date()\n        updateData()\n    }\n\n    const onAdd = () => {\n        dispatch(updateJournalEntry({journalEntryData: data.apply(journalEntry)}))\n        onCancel()\n    }\n\n    const onDelete = () => {\n        dispatch(deleteJournalEntry({journalEntryData: data.apply(journalEntry)}))\n        onCancel()\n    }\n\n    const onCancel = () => {\n        if (journalEntry) {\n            history.goBack()\n        } else {\n            setData(new JournalEditor())\n        }\n    }\n\n    const templates = EditorTemplates\n\n    const onTemplate = (id: string | null) => {\n        if (id) {\n            setTemplate(id)\n            setData(JournalEditor.fromTemplate(id))\n        } else {\n            setTemplate(\"\")\n        }\n    }\n\n    return (\n        <div>\n            <PageHeader title={journalEntry ? Routes.Edit : Routes.Memorial} periodFilter={false} withName={false}/>\n\n            {!journalEntry && <div className={classes.templateSelector}>\n                <ItemSelect title={\"Template\"} width={150}\n                            items={Object.keys(templates)} item={template} onItem={onTemplate} />\n            </div>}\n\n            <Paper elevation={3} className={classes.paper}>\n\n            <Grid container alignItems={\"flex-start\"} justify={\"space-between\"} spacing={4} className={classes.headerGrid}>\n                <Grid item>\n                    <TextField value={data.reason}\n                               className={classes.description}\n                               onChange={onDescription}\n                               aria-label={\"Omschrijving\"}\n                               label={\"Omschrijving\"} />\n                </Grid>\n\n                <Grid item>\n                    <DateSelector label={\"Datum\"}\n                                  disableUnderline={false}\n                                  date={data.date}\n                                  onDate={onDate} />\n                </Grid>\n            </Grid>\n\n            <Table>\n                <Thead>\n                    <Tr>\n                        <Th>Grootboekrekening</Th>\n                        <Th className={classes.amount}>Debet {currency}</Th>\n                        <Th className={classes.amount}>Credit {currency}</Th>\n                        <Th/>\n                    </Tr>\n                </Thead>\n                <Tbody>\n                    {data.legs.map((leg, i) => {\n\n                        const onLedgerAccount = (account: LedgerAccount) => {\n                            leg.updateAccount(account)\n                            updateData()\n                        }\n\n                        const onDebit = (debit: string) => {\n                            leg.updateAmount(CreditDebit.Debit, debit)\n                            updateData()\n                        }\n\n                        const onCredit = (credit: string) => {\n                            leg.updateAmount(CreditDebit.Credit, credit)\n                            updateData()\n                        }\n\n                        const onBlur = () => {\n                            leg.finalizeAmount()\n                            updateData()\n                        }\n\n                        const deleteLine = () => {\n                            data.removeLeg(i)\n                            updateData()\n                        }\n\n                        if (leg.account.isEditable) {\n                            return (\n                                <Tr key={i}>\n                                    <Td>\n                                        <RGSAccountSelector ledgerAccount={leg.account}\n                                                            accountOptions={LedgerScheme.allocatableAccounts}\n                                                            onChange={onLedgerAccount}/>\n                                    </Td>\n                                    <Td className={classes.amount}>\n                                        <AmountEditor value={leg.debit}\n                                                      onChange={onDebit}\n                                                      onBlur={onBlur} />\n                                    </Td>\n                                    <Td className={classes.amount}>\n                                        <AmountEditor value={leg.credit}\n                                                      onChange={onCredit}\n                                                      onBlur={onBlur} />\n                                    </Td>\n                                    <Td className={classes.amount}>\n                                        <IconButton onClick={deleteLine}><DeleteIcon/></IconButton>\n                                    </Td>\n                                </Tr>)\n                        } else {\n                            return (\n                                <Tr key={i}>\n                                    <Td>{leg.account.shortDescription}</Td>\n                                    <Td className={classes.amount}>{leg.debit}</Td>\n                                    <Td className={classes.amount}>{leg.credit}</Td>\n                                    <Td className={classes.amount}>\n                                        <IconButton disabled={true}><DeleteIcon/></IconButton>\n                                    </Td>\n                                </Tr>)\n                        }\n                    })}\n                    <Tr className={classes.totals}>\n                        <Td>Totaal</Td>\n                        <Td className={classes.amount}>\n                            <FormatAmount amount={Amount.fromAmountCurrency(debit, currency)} debitCredit={false} />\n                        </Td>\n                        <Td className={classes.amount}>\n                            <FormatAmount amount={Amount.fromAmountCurrency(credit, currency)} debitCredit={false} />\n                        </Td>\n                        <Td className={classes.amount}>\n                            <IconButton onClick={onAddLine}><AddIcon/></IconButton>\n                        </Td>\n                    </Tr>\n                </Tbody>\n            </Table>\n\n            <Grid container spacing={2} justify={\"flex-end\"} className={classes.footerGrid}>\n                {journalEntry && data.canBeDeleted() && <Grid item>\n                    <Button onClick={onDelete}\n                            variant={\"contained\"}\n                            color={\"primary\"}>\n                        Verwijder\n                    </Button>\n                </Grid>}\n\n                <Grid item>\n                    <Button onClick={onCancel}\n                            variant={\"contained\"}\n                            color={\"primary\"}>\n                        Cancel\n                    </Button>\n                </Grid>\n\n                <Grid item>\n                    <Button disabled={!data.isValid()}\n                            onClick={onAdd}\n                            variant={\"contained\"}\n                            color={\"primary\"}>\n                        OK\n                    </Button>\n                </Grid>\n            </Grid>\n\n            </Paper>\n\n        </div>\n    )\n}\n\nexport default MemorialPage;\n","import React, { useState } from 'react'\nimport { useDispatch, useSelector } from \"react-redux\"\n\nimport { selectState } from \"../../app/store\"\n\nimport { restoreStateFromStorage, saveStateToStorage } from \"../../services/stateIO\"\n\ninterface StateSyncProps {\n    children: React.ReactNode,\n}\n\nfunction StateSync(props: StateSyncProps) {\n    const [ initialized, setInitialized ] = useState(false)\n    const state = useSelector(selectState)\n    const dispatch = useDispatch();\n\n    React.useEffect(() => {\n        if (initialized) {\n            // Try to write state to sessionStorage\n            saveStateToStorage(state, sessionStorage)\n        } else {\n            // Try to restore state from sessionStorage\n            restoreStateFromStorage(sessionStorage, dispatch)\n            setInitialized(true)\n        }\n    }, [state, initialized, dispatch])\n\n    return (\n        <React.Fragment>\n            {initialized && props.children}\n        </React.Fragment>\n    )\n}\n\nexport default StateSync","import React, { useState } from 'react'\nimport { LedgerScheme } from \"../../types/Ledger/LedgerScheme\"\nimport { CircularProgress, makeStyles } from \"@material-ui/core\"\n\nconst useStyles = makeStyles({\n    progress: {\n        marginTop: 50\n    },\n});\n\ninterface OwnProps {\n    children: React.ReactNode\n}\n\ninterface State {\n    initialized: null | \"Loading\" | \"Loaded\" | \"Failed\"\n    errorMsg: string\n}\n\nfunction AppLoader(props: OwnProps) {\n    const [ state, setState ] = useState<State>({\n        initialized: null,\n        errorMsg: \"\"\n    })\n    const styles = useStyles()\n\n    React.useEffect(() => {\n        async function initialize() {\n            setState({ ...state, initialized: \"Loading\"} )\n            await LedgerScheme.load()\n            if (LedgerScheme.allocatableAccounts.length > 0) {\n                setState({ ...state, initialized: \"Loaded\"} )\n            }\n        }\n\n        if (state.initialized === null) {\n            initialize().catch(reason => {\n                setState({ initialized: \"Failed\", errorMsg: reason } )\n            })\n        }\n    }, [state])\n\n    if (state.initialized === \"Failed\") {\n        throw Error(`Grootboekschema kan niet geladen worden: ${state.errorMsg}`)\n    } else if (state.initialized === \"Loaded\") {\n        return (\n            <div>\n                {props.children}\n            </div>\n        )\n    } else {\n        return <CircularProgress  className={styles.progress} />\n    }\n}\n\nexport default AppLoader;\n","import React from 'react'\nimport { Card, Grid, makeStyles } from \"@material-ui/core\"\nimport { Error, Home } from \"@material-ui/icons\"\nimport Button from \"@material-ui/core/Button\"\nimport { useHistory } from \"react-router-dom\"\nimport { Routes } from \"../../routes/routes\"\n\nconst useStyles = makeStyles({\n    grid: {\n        minHeight: '90vh'\n    },\n    card: {\n        padding: 100\n    },\n    errorMsg: {\n        margin: 15\n    },\n    button: {\n        marginTop: 25\n    }\n});\n\ninterface OwnProps {\n    title: string\n    errorMsg?: string\n    onAcknowledge: () => void\n}\n\nfunction ErrorMessage(props: OwnProps) {\n    const { title, errorMsg } = props\n    const classes = useStyles()\n\n    const history = useHistory();\n\n    const goHome = () => {\n        props.onAcknowledge()\n        history.push(Routes.Home.path)\n    }\n\n    const msg = errorMsg ? `Foutmelding: ${errorMsg}` : \"\"\n    return (\n        <Grid\n            container\n            direction=\"column\"\n            alignItems=\"center\"\n            justify=\"center\"\n            className={classes.grid}\n        >\n            <Card raised={true} className={classes.card}>\n                <div>\n                    <Error color={'error'} fontSize={'large'} />\n                    <div className={classes.errorMsg}>\n                        <h3>{title}</h3>\n                        <p>{msg}</p>\n                    </div>\n                    <Button className={classes.button}\n                            variant={\"contained\"}\n                            color={\"primary\"}\n                            onClick={goHome} startIcon={<Home/>}>\n                        {Routes.Home.text}\n                    </Button>\n                </div>\n            </Card>\n        </Grid>\n    )\n}\n\nexport default ErrorMessage;\n","import React, { Component, ErrorInfo, ReactNode } from \"react\";\nimport ErrorMessage from \"./ErrorMessage\"\n\ninterface Props {\n    children: ReactNode;\n}\n\ninterface State {\n    hasError: boolean\n    error: Error | null\n}\n\nconst initialState:State = {\n    hasError: false,\n    error: null\n}\n\nclass ErrorBoundary extends Component<Props, State> {\n    public state: State = {...initialState}\n\n    public static getDerivedStateFromError(error: Error): State {\n        // Update lastState so the next render will show the fallback UI.\n        return { hasError: true, error };\n    }\n\n    public componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n        console.error(\"Uncaught error:\", error, errorInfo);\n    }\n\n    private onAcknowledge = () => {\n        this.setState({...initialState})\n    }\n\n    public render() {\n        if (this.state.hasError) {\n            return <ErrorMessage title={\"Sorry.. there was an error\"}\n                                 errorMsg={this.state.error?.message}\n                                 onAcknowledge={this.onAcknowledge}/>\n        }\n\n        return this.props.children;\n    }\n}\n\nexport default ErrorBoundary;\n","import React from 'react'\nimport { FormControl, InputLabel, ListSubheader, MenuItem, Select } from \"@material-ui/core\"\nimport { range } from \"../../services/utils\"\nimport { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\"\nimport { Period } from \"../../types/Period\"\nimport { VATDeclarationPeriod } from \"../../types/VAT/VATDeclarationPeriod\"\n\nconst useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        formControl: {\n            margin: theme.spacing(1),\n            minWidth: 150,\n        },\n    }),\n);\n\ninterface VATPeriodSelectorProps {\n    periods: Period[]\n    period: VATDeclarationPeriod | null\n    onPeriod: (vatDeclarationPeriod: VATDeclarationPeriod | null) => void\n}\n\nfunction VATPeriodSelector(props: VATPeriodSelectorProps) {\n    const { period, periods } = props\n\n    const classes = useStyles();\n\n    const value = period ? period.id : \"\"\n\n    const onChange = (event: any) => {\n        const value = event.target.value || \"\"\n        const period = value ? VATDeclarationPeriod.fromId(value) : null\n        props.onPeriod(period)\n    }\n\n    const items = periods.map(period => {\n        const year = period.value\n        const now = new Date()\n        const quarters = range(1, 5)\n            .map(quarter => new VATDeclarationPeriod(year, quarter))\n            .filter(vatPeriod => vatPeriod.startDate <= now)\n        return { year, quarters }\n    })\n\n    return (\n        <FormControl className={classes.formControl}>\n\n            <InputLabel htmlFor=\"select-vat-period\">\n                Aangifte Tijdvak\n            </InputLabel>\n\n            <Select id=\"select-vat-period\"\n                    value={value} onChange={onChange}>\n\n                {items.map(item => ([\n                    // Show year header\n                    <ListSubheader>{item.year}</ListSubheader>,\n\n                    // Show quarters\n                    item.quarters.map(quarter => (\n                        <MenuItem key={quarter.id} value={quarter.id}>\n                            {quarter.year} Kwartaal {quarter.quarter}\n                        </MenuItem>\n                    ))\n                ]))}\n\n            </Select>\n        </FormControl>\n    )\n}\n\nexport default VATPeriodSelector;\n","import FormatAmount from \"../Utils/FormatAmount\"\nimport { Amount } from \"../../types/Amount\"\nimport React from \"react\"\n\nexport function FormatVATAmount(props: { value: number | null, currency: string, precision?: number }) {\n    const {value, currency, precision} = props\n\n    return value !== null\n        ? <FormatAmount amount={Amount.fromAmountCurrency(value, currency)}\n                        precision={precision || 0}\n                        debitCredit={true}/>\n        : <span/>\n}\n\nexport default FormatVATAmount;\n","import React, { useState } from 'react'\nimport { createStyles, makeStyles, useTheme } from \"@material-ui/core/styles\"\nimport { Dialog, useMediaQuery } from \"@material-ui/core\"\nimport { DialogActions, DialogContent, DialogTitle } from \"../Utils/CustomDialog\"\nimport Button from \"@material-ui/core/Button\"\nimport { Table, Tbody, Td, Th, Thead, Tr } from \"react-super-responsive-table\"\nimport { VATRate } from \"../../types/VAT/VATRate\"\nimport AmountEditor from \"../Editors/AmountEditor\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { VATSpecificationEntryData } from \"../../model\"\n\nconst useStyles = makeStyles(() =>\n    createStyles({\n        table: {\n            maxWidth: 250,\n            marginTop: 15,\n            marginBottom: 15,\n            margin: \"auto\"\n        },\n        amount: {\n            textAlign: \"right\",\n        },\n    }),\n);\n\ninterface ManualEntryDialogProps {\n    category: string\n    data: VATSpecificationEntryData\n    vatRate: VATRate\n    onClose: (data: VATSpecificationEntryData | null) => void\n}\n\nconst zeroData = {\n    bruto: \"0\",\n    vat: \"0\",\n    netto: \"0\"\n}\n\nfunction ManualEntryDialog(props: ManualEntryDialogProps) {\n    const { category, data, vatRate } = props\n\n    const [open, ] = React.useState(true);\n    const [line, setLine] = useState({...data})\n\n    const classes = useStyles();\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const onNetto = (value: string) => {\n        const brutoNetto = VATLine.brutoNetto({netto: value}, vatRate.percentage)\n        setLine({...line, ...brutoNetto})\n    }\n\n    const onVAT = (value: string) => {\n        const brutoNetto = VATLine.brutoNetto({vat: value}, vatRate.percentage)\n        setLine({...line, ...brutoNetto})\n    }\n\n    const onBruto = (value: string) => {\n        const brutoNetto = VATLine.brutoNetto({bruto: value}, vatRate.percentage)\n        setLine({...line, ...brutoNetto})\n    }\n\n    const onBlur = () => {\n    }\n\n    const handleClose = () => {\n        props.onClose(null)\n    };\n\n    const saveChanges = () => {\n        props.onClose(line)\n    }\n\n    const clear = () => {\n        const clearedLine = {...line, ...zeroData}\n        setLine(clearedLine)\n        props.onClose(clearedLine)\n    }\n\n    const showBrutoNetto = vatRate.percentage !== 0\n\n    const canSave = ![line.netto, line.vat, line.bruto].some(v => isNaN(+v))\n\n    return (\n        <Dialog fullWidth={false} fullScreen={onXs} maxWidth={false}\n                onClose={handleClose} aria-labelledby=\"customized-dialog-title\" open={open}>\n            <DialogTitle id=\"customized-dialog-title\" onClose={handleClose}>\n                {category}\n            </DialogTitle>\n            <DialogContent dividers>\n                <h4>Bedrag invoer</h4>\n                <div>U kunt voor deze post in onderstaande tabel handmatig een bedrag invoeren</div>\n                <Table className={classes.table}>\n                    <Thead>\n                        <Tr>\n                            <Th/>\n                            <Th className={classes.amount}>Bedrag</Th>\n                        </Tr>\n                    </Thead>\n                    <Tbody className={classes.amount}>\n                        {showBrutoNetto && <Tr>\n                            <Td>Excl. BTW</Td>\n                            <Td>\n                                <AmountEditor value={line.netto} onChange={onNetto} onBlur={onBlur}/>\n                            </Td>\n                        </Tr>}\n                        <Tr>\n                            <Td>BTW</Td>\n                            <Td>\n                                <AmountEditor value={line.vat} onChange={onVAT} onBlur={onBlur}/>\n                            </Td>\n                        </Tr>\n                        {showBrutoNetto && <Tr>\n                            <Td>Incl. BTW</Td>\n                            <Td>\n                                <AmountEditor value={line.bruto} onChange={onBruto} onBlur={onBlur}/>\n                            </Td>\n                        </Tr>}\n                    </Tbody>\n                </Table>\n            </DialogContent>\n            <DialogActions>\n                <Button onClick={clear} color=\"primary\">\n                    Clear\n                </Button>\n                <Button disabled={!canSave} onClick={saveChanges} color=\"primary\">\n                    OK\n                </Button>\n            </DialogActions>\n        </Dialog>\n    )\n}\n\nexport default ManualEntryDialog;\n","import { createStyles, makeStyles, Theme } from \"@material-ui/core/styles\"\n\nexport const useStyles = makeStyles((theme: Theme) =>\n    createStyles({\n        document: {\n            maxWidth: 800,\n            margin: \"auto\"\n        },\n        registrationStatus: {\n            textAlign: \"right\",\n        },\n        registerVAT: {\n            marginTop: 25,\n            textAlign: \"right\"\n        },\n        category: {\n            paddingTop: 25,\n            [theme.breakpoints.up('sm')]: {\n                width: \"60%\",\n            },\n            verticalAlign: \"bottom\"\n        },\n        categoryDetails: {\n            paddingLeft: 40\n        },\n        netto: {\n            [theme.breakpoints.up('sm')]: {\n                width: \"20%\",\n            },\n            textAlign: \"right\",\n            verticalAlign: \"top\",\n        },\n        vat: {\n            [theme.breakpoints.up('sm')]: {\n                width: \"20%\",\n            },\n            textAlign: \"right\",\n            verticalAlign: \"top\"\n        },\n        manualButton: {\n            [theme.breakpoints.down('sm')]: {\n                width: \"100%\",\n            },\n        }\n    }),\n)","import { reverseData, VATDeclaration } from \"../../types/VAT/VATDeclaration\"\nimport { VATDeclarationItemDetails } from \"../../types/VAT/VATDeclarationItem\"\nimport { VATSpecificationEntryData } from \"../../model\"\nimport React, { useState } from \"react\"\nimport { NO_VAT } from \"../../types/VAT/VATRate\"\nimport ManualEntryDialog from \"./ManualEntryDialog\"\nimport { Td, Tr } from \"react-super-responsive-table\"\nimport Button from \"@material-ui/core/Button\"\nimport FormatVATAmount from \"./FormatVATAmount\"\nimport { useStyles } from \"./VATStyling\"\n\nexport function VATManualEntry(props: {\n    declaration: VATDeclaration,\n    category: string,\n    currency: string,\n    detail: VATDeclarationItemDetails,\n    onManual: (category: string, line: VATSpecificationEntryData) => void\n}) {\n    const {declaration, category, currency, detail} = props\n\n    const [dialog, setDialog] = useState(false)\n    const classes = useStyles()\n\n    let line = detail.vatLines[0]\n    if (VATDeclaration.isExpenseCategory(category)) {\n        line = reverseData(line)\n    }\n    const vatRate = declaration.getVATRate(category)\n    const showNetto = vatRate.id !== NO_VAT.id\n\n    const onCloseDialog = (data: VATSpecificationEntryData | null) => {\n        setDialog(false)\n        if (data) {\n            props.onManual(category, data)\n        }\n    }\n\n    const openDialog = () => {\n        setDialog(true)\n    }\n\n    return (\n        <>\n            {dialog && <ManualEntryDialog category={category}\n                                          data={line}\n                                          vatRate={vatRate}\n                                          onClose={onCloseDialog}/>}\n            <Tr>\n                <Td className={`noheader ${classes.categoryDetails}`}>\n                    <Button className={classes.manualButton} size={\"small\"} onClick={openDialog} variant={\"outlined\"}>\n                        Handmatige Invoer\n                    </Button>\n                </Td>\n                <Td className={classes.netto}>\n                    {showNetto && <FormatVATAmount value={+line.netto} currency={currency} precision={2}/>}\n                </Td>\n                <Td className={classes.vat}>\n                    <FormatVATAmount value={+line.vat} currency={currency} precision={2}/>\n                </Td>\n                <Td/>\n            </Tr>\n        </>\n    )\n}","import { VATDeclaration } from \"../../types/VAT/VATDeclaration\"\nimport { getLines, VATDeclarationItem } from \"../../types/VAT/VATDeclarationItem\"\nimport { VATSpecificationEntryData } from \"../../model\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport React from \"react\"\nimport { DateString } from \"../../types/DateString\"\nimport { VATRates } from \"../../types/VAT/VATRates\"\nimport { Td, Th, Tr } from \"react-super-responsive-table\"\nimport FormatVATAmount from \"./FormatVATAmount\"\nimport { VATManualEntry } from \"./VATManualEntry\"\nimport { useStyles } from \"./VATStyling\"\n\nexport function VATCategoryDetails(props: {\n    declaration: VATDeclaration,\n    category: string,\n    item: VATDeclarationItem,\n    currency: string,\n    onManual: (category: string, line: VATSpecificationEntryData) => void\n}) {\n    const {declaration, category, item, currency, onManual} = props\n    const classes = useStyles()\n\n    const total = VATLine.addVATLines(getLines(item.details))\n\n    return (\n        <React.Fragment>\n            {/* Detail lines */}\n            {item.details.map(detail => {\n                const journalEntry = detail.journalEntry\n                if (journalEntry) {\n                    const vatDate = journalEntry.vatDate!\n                    const date = DateString.fromDate(vatDate)\n                    const description = journalEntry.reason\n                    const vatRates = new VATRates(vatDate).rates\n                    return detail.vatLines.map((vatSpecification, i) => {\n                        const rate = vatRates[vatSpecification.id]\n                        return (\n                            <Tr key={i}>\n                                <Td className={`noheader ${classes.categoryDetails}`}>\n                                    {`${date.format()} - ${description} (${rate.percentageString})`}\n                                </Td>\n                                <Td className={classes.netto}>\n                                    <FormatVATAmount value={+vatSpecification.netto} currency={currency} precision={2}/>\n                                </Td>\n                                <Td className={classes.vat}>\n                                    <FormatVATAmount value={+vatSpecification.vat} currency={currency} precision={2}/>\n                                </Td>\n                                <Td/>\n                            </Tr>\n                        )\n                    })\n                } else {\n                    // Manual entry\n                    return <VATManualEntry key={\"manual\" + category}\n                                           declaration={declaration}\n                                           currency={currency}\n                                           detail={detail}\n                                           category={category}\n                                           onManual={onManual}/>\n                }\n            })}\n\n            {/* Detail totals */}\n            {item.details.length > 0 && <Tr>\n                <Th className={`noheader ${classes.categoryDetails}`}>Totaal</Th>\n                <Th className={classes.netto}>\n                    <FormatVATAmount value={total.netto} currency={currency} precision={2}/>\n                </Th>\n                <Th className={classes.vat}>\n                    <FormatVATAmount value={total.vat} currency={currency} precision={2}/>\n                </Th>\n                <Th className={classes.vat}>\n                    <FormatVATAmount value={item.declared ?? null} currency={currency} precision={2}/>\n                </Th>\n            </Tr>}\n        </React.Fragment>\n    )\n}","import React, { useEffect, useState } from 'react'\nimport { Table, Tbody, Td, Th, Thead, Tr } from \"react-super-responsive-table\"\nimport { VATLine } from \"../../types/VAT/VATLine\"\nimport { VATDeclaration, VATDeclarationTag } from \"../../types/VAT/VATDeclaration\"\nimport { Grid, IconButton, useMediaQuery } from \"@material-ui/core\"\nimport { Check, DomainDisabled, Error, ExpandLess, ExpandMore } from \"@material-ui/icons\"\nimport { useTheme } from \"@material-ui/core/styles\"\nimport { VATDeclarationPeriod } from \"../../types/VAT/VATDeclarationPeriod\"\nimport { Journal } from \"../../types/Journal/Journal\"\nimport { getLines } from \"../../types/VAT/VATDeclarationItem\"\nimport FormatVATAmount from \"./FormatVATAmount\"\nimport Button from \"@material-ui/core/Button\"\nimport { JournalEntry } from \"../../types/Journal/JournalEntry\"\nimport { useDispatch } from \"react-redux\"\nimport { deleteJournalEntry, updateJournalEntry } from \"../../app/AccountingSlice\"\nimport FormatDate from \"../Utils/FormatDate\"\nimport { VATSpecificationEntryData } from \"../../model\"\nimport { VATCategoryDetails } from \"./VATCategoryDetails\"\nimport { useStyles } from \"./VATStyling\"\nimport { useURLState } from \"../useURLState\"\n\ninterface VATDeclarationViewProps {\n    journal: Journal\n    period: VATDeclarationPeriod\n}\n\nfunction VATDeclarationView(props: VATDeclarationViewProps) {\n    const { journal, period } = props\n\n    const [urlState, setURLState] = useURLState()\n    const openDetailsKey = \"openVAT\"\n    const openDetails = urlState.getStringArrayValue(openDetailsKey)\n\n    const [declaration, setDeclaration] = useState(new VATDeclaration(journal, period))\n    const dispatch = useDispatch()\n\n    useEffect(() => {\n        setDeclaration(new VATDeclaration(journal, period))\n    }, [journal, period])\n\n    const theme = useTheme()\n    const onXs = useMediaQuery(theme.breakpoints.only('xs'));\n\n    const classes = useStyles();\n\n    const journalEntryId = declaration.id\n    const isRegistered = journal.hasJournalEntry(journalEntryId)\n    const journalEntry = isRegistered ? journal.getJournalEntry(journalEntryId) : null\n\n    const document = declaration.getDeclarationDocument(journalEntry)\n    const currency = declaration.currency\n    const total = declaration.total\n\n    const onDetails = (category: string) => {\n        const id = VATDeclaration.getManualId(category)\n        if (openDetails.includes(id)) {\n            setURLState({[openDetailsKey]: openDetails.filter(c => c !== id)})\n        } else {\n            setURLState({[openDetailsKey]: openDetails.concat(id)})\n        }\n    }\n\n    const onClick = () => {\n        const journalEntry = JournalEntry.fromVATDeclaration(declaration)\n        const action = isRegistered ? deleteJournalEntry : updateJournalEntry\n        dispatch(action({journalEntryData: journalEntry.data}))\n    }\n\n    const onManual = (category: string, line: VATSpecificationEntryData) => {\n        declaration.setManualVAT(category, line)\n        const newDeclaration = new VATDeclaration(journal, declaration.period, declaration.manualVATs)\n        setDeclaration(newDeclaration)\n    }\n\n    const itemIsDeclaredOK = (item: any) => {\n        const total = VATLine.addVATLines(getLines(item.details))\n        const declared = item.declared ? -1 * item.declared : 0\n        return declared.toFixed(2) === total.vat.toFixed(2)\n    }\n\n    return (\n        <div className={classes.document}>\n            <div className={classes.registrationStatus}>\n                <Grid container justify={onXs ? \"center\" : \"flex-end\"} alignItems={\"center\"} spacing={1}>\n                    {isRegistered\n                        ? <><Grid item>\n                            Aangifte boekingsdatum: <FormatDate date={journal.getJournalEntry(journalEntryId).date}/>\n                        </Grid>\n                            <Grid item><Check/></Grid></>\n                        : <><Grid item>Deze aangifte is nog niet geboekt</Grid>\n                            <Grid item><DomainDisabled/></Grid></>}\n                </Grid>\n            </div>\n\n            <Table key={Math.random()}>\n            {Object.entries(document).map(([title, categories], index) => {\n                return (\n                    <React.Fragment key={title}>\n\n                        {/* Document header */}\n                        <Thead>\n                            <Tr>\n                                <Th className={classes.category}>{title}</Th>\n\n                                <Th className={classes.netto}>\n                                    {onXs ? \"Excl. BTW\"\n                                          : index === 0 ? \"Bedrag waarover de omzetbelasting wordt berekend\" : \"\"}\n                                </Th>\n\n                                <Th className={classes.vat}>\n                                    {onXs ? \"BTW\"\n                                          : index === 0 ? \"Omzetbelasting\" : \"\"}\n                                </Th>\n\n                                <Th className={classes.vat}>\n                                    {onXs ? \"Aangifte\"\n                                        : index === 0 ? \"Aangifte\" : \"\"}\n                                </Th>\n\n                            </Tr>\n                        </Thead>\n                        <Tbody>\n                            {/* Category entries */}\n                            {Object.entries(categories).map(([category, item]) => {\n                                const isOpen = openDetails.includes(VATDeclaration.getManualId(category))\n                                return (\n                                    <React.Fragment key={category}>\n\n                                        {/* Category header */}\n                                        <Tr>\n                                            <Td className={\"noheader\"}>\n                                                {!onXs && category}\n                                                {item.details.length > 0 &&\n                                                <IconButton size={\"small\"}\n                                                            color={\"primary\"}\n                                                            onClick={() => onDetails(category)}\n                                                            aria-label={\"BTW detail specificatie\"}>\n                                                    {isOpen ? <ExpandLess/> : <ExpandMore/>}\n                                                </IconButton>}\n                                                {onXs && category}\n                                            </Td>\n                                            <Td className={classes.netto}>\n                                                <FormatVATAmount value={item.netto} currency={currency}/>\n                                            </Td>\n                                            <Td className={classes.vat}>\n                                                <FormatVATAmount value={item.vat} currency={currency}/>\n                                            </Td>\n                                            <Td className={classes.vat}>\n                                                {isRegistered && item.declared !== undefined && (itemIsDeclaredOK(item) ? <Check/> : <Error/>)}\n                                            </Td>\n                                        </Tr>\n\n                                        {/* Category details */}\n                                        {isOpen && <VATCategoryDetails declaration={declaration}\n                                                                       category={category}\n                                                                       item={item}\n                                                                       currency={currency}\n                                                                       onManual={onManual}/>}\n\n                                    </React.Fragment>\n                                )\n                            })}\n                        </Tbody>\n                    </React.Fragment>\n                )\n            })}\n\n            {/* Document Total */}\n            <Tbody>\n                <Tr>\n                    <Th className={classes.category}>Totaal {total > 0 ? \"te betalen\" : total < 0 ? \"te ontvangen\" : \"\"}</Th>\n                    <Th/>\n                    <Th className={`${classes.category} ${classes.vat}`}>\n                        <FormatVATAmount value={total} currency={currency} precision={0}/>\n                    </Th>\n                    <Th className={`${classes.category} ${classes.vat}`}>\n                        {journalEntry &&\n                        <FormatVATAmount value={declaration.declaredAmount(journalEntry, VATDeclarationTag.Declared)}\n                                         currency={currency} precision={0}/>}\n                    </Th>\n                </Tr>\n            </Tbody>\n        </Table>\n\n        <div className={classes.registerVAT}>\n            <Button onClick={onClick}\n                    color={\"primary\"}\n                    variant={\"contained\"}>\n                {isRegistered ? \"Verwijder deze boeking\" : \"Boek Deze Aangifte\"}\n            </Button>\n        </div>\n\n        </div>\n    )\n}\n\nexport default VATDeclarationView;\n","import React from 'react'\nimport PageHeader from \"./PageHeader\"\nimport { Routes } from \"../routes/routes\"\nimport { useDispatch, useSelector } from \"react-redux\"\nimport { selectPeriodFilter, selectVATPeriod, setVATPeriod } from \"../app/FilterSlice\"\nimport { selectJournal } from \"../app/AccountingSlice\"\nimport { VATDeclarationPeriod } from \"../types/VAT/VATDeclarationPeriod\"\nimport VATPeriodSelector from \"../components/VAT/VATPeriodSelector\"\nimport VATDeclarationView from \"../components/VAT/VATDeclarationView\"\n\nfunction VATPage() {\n    const dispatch = useDispatch()\n\n    const vatPeriod = useSelector(selectVATPeriod)\n    const periodFilter = useSelector(selectPeriodFilter)\n    const journal = useSelector(selectJournal).filterOnPeriod(periodFilter)\n    const periods = journal.distinctPeriods()\n\n    const onVATPeriod = (vatPeriod: VATDeclarationPeriod | null) =>\n        dispatch(setVATPeriod({vatPeriodData: vatPeriod ? vatPeriod.data : null}))\n\n    return (\n        <div>\n            <PageHeader title={Routes.VAT}/>\n\n            <VATPeriodSelector periods={periods} period={vatPeriod} onPeriod={onVATPeriod}/>\n\n            {vatPeriod && <VATDeclarationView journal={journal} period={vatPeriod}/>}\n        </div>\n    )\n}\n\nexport default VATPage;\n","import React from 'react'\nimport { BrowserRouter, Route, Switch } from \"react-router-dom\"\n\nimport './App.css';\n\nimport UploadPage from \"./pages/UploadPage\";\nimport MapPage from \"./pages/MapPage\";\nimport TrialBalancePage from \"./pages/TrialBalancePage\";\nimport HomePage from \"./pages/HomePage\";\nimport BankPage from \"./pages/BankPage\"\nimport JournalPage from \"./pages/JournalPage\"\nimport LedgerPage from \"./pages/LedgerPage\"\nimport MenuAppBar from \"./components/Menu/MenuAppBar\"\nimport ChartsPage from \"./pages/ChartsPage\"\nimport MemorialPage from \"./pages/MemorialPage\"\n\nimport { RouteItem, Routes } from \"./routes/routes\"\nimport StateSync from \"./components/Utils/StateSync\"\nimport AppLoader from \"./components/Utils/AppLoader\"\nimport { APP } from \"./config\"\nimport { useSelector } from \"react-redux\"\nimport { selectLiquidAssets } from \"./app/AccountingSlice\"\nimport ErrorBoundary from \"./components/Utils/ErrorBoundary\"\nimport { MuiPickersUtilsProvider } from \"@material-ui/pickers\"\nimport DateFnsUtils from \"@date-io/date-fns\"\nimport { nl } from 'date-fns/locale'\nimport VATPage from \"./pages/VATPage\"\nimport { ThemeProvider } from \"@material-ui/styles\"\nimport { createMuiTheme } from \"@material-ui/core\"\n\nfunction App() {\n    const liquidAssets = useSelector(selectLiquidAssets)\n    const requiresData = (page: () => JSX.Element): () => JSX.Element =>\n        liquidAssets.hasData() ? page : HomePage\n\n    const routes: [RouteItem, () => JSX.Element][] = [\n        [Routes.Ledger, LedgerPage],\n        [Routes.Journal, requiresData(JournalPage)],\n        [Routes.Map, requiresData(MapPage)],\n        [Routes.TrialBalance, requiresData(TrialBalancePage)],\n        [Routes.VAT, requiresData(VATPage)],\n        [Routes.Bank, requiresData(BankPage)],\n        [Routes.Upload, UploadPage],\n        [Routes.Charts, ChartsPage],\n        [Routes.Memorial, MemorialPage],\n        [Routes.Edit, MemorialPage],\n        [Routes.Home, HomePage],\n    ]\n\n    const defaultMaterialTheme = createMuiTheme({\n        overrides: {\n            MuiInputBase: {\n                root: {\n                    fontSize: \"0.875rem\"\n                }\n            }\n        }\n    });\n\n        return (\n            <div className=\"App\">\n                <BrowserRouter>\n                    <ErrorBoundary>\n                    <AppLoader>\n                    <StateSync>\n                    <ThemeProvider theme={defaultMaterialTheme}>\n                    <MuiPickersUtilsProvider utils={DateFnsUtils} locale={nl}>\n                    <MenuAppBar title={APP.TITLE}>\n                        <Switch>\n                            {routes.map(([route, component]) => {\n                                return (\n                                    <Route key={route.id}\n                                           path={route.path}\n                                           component={component}/>\n                                )\n                            })}\n                        </Switch>\n                    </MenuAppBar>\n                    </MuiPickersUtilsProvider>\n                    </ThemeProvider>\n                    </StateSync>\n                    </AppLoader>\n                    </ErrorBoundary>\n                </BrowserRouter>\n            </div>\n        )\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { unstable_createMuiStrictModeTheme } from '@material-ui/core';\nimport {ThemeProvider} from '@material-ui/core/styles';\n\nimport 'react-super-responsive-table/dist/SuperResponsiveTableStyle.css';\nimport './index.css';\n\nimport App from './App';\nimport { store, setAccountingState } from './app/store';\nimport { Provider } from 'react-redux';\nimport * as serviceWorker from './serviceWorker';\n\n// Use theme to solve the following material ui issue:\n// material ui Warning: findDOMNode is deprecated in StrictMode.\n//   findDOMNode was passed an instance of Transition which is inside StrictMode.\n//   Instead, add a ref directly to the element you want to reference.\nconst theme = unstable_createMuiStrictModeTheme({\n    breakpoints: {\n        unit: \"em\",\n        values: {\n            xs: 0,\n            sm: 40,\n            md: 60,\n            lg: 80,\n            xl: 120,\n        },\n    },\n})\n\n// Initialize Accounting\nsetAccountingState(store)\n\n// Prevent accidental unload\nfunction confirmUnload(ev: BeforeUnloadEvent) {\n    ev.preventDefault();\n    let confirm:string|null = null\n    const age = store.getState().age.age\n    if (age > 0) {\n        // Warn user for unsaved changes\n        confirm = `Er zijn nog ${age} onbewaarde veranderingen`\n    }\n    return ev.returnValue = confirm\n}\nwindow.addEventListener(\"beforeunload\", confirmUnload)\n\nReactDOM.render(\n  <React.StrictMode>\n      <ThemeProvider theme={theme}>\n        <Provider store={store}>\n          <App />\n        </Provider>\n      </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n","var wrap = require('comlink').wrap,Worker = require(\"!worker-loader?{}!/home/vegter/projects/Boekhoud-Source/node_modules/comlink-loader/dist/comlink-worker-loader.js!/home/vegter/projects/Boekhoud-Source/node_modules/react-scripts/node_modules/babel-loader/lib/index.js??ref--5-oneOf-2!/home/vegter/projects/Boekhoud-Source/src/components/Workers/worker.ts\"),inst;module.exports = function f() {if (this instanceof f) return wrap(Worker());return inst || (inst = wrap(Worker()));};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"2f32257636f7da63ac66.worker.js\");\n};"],"sourceRoot":""}